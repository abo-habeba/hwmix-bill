import{_ as H}from"./ContextMenu-BYrGwoFu.js";import{z as F,g as J,r as a,Z as K,w as I,an as L,ap as W,P as X,o as f,c as U,d as o,a as Y,k as P,j as p,b as z,t as E,a9 as V,q as A,ar as ee,a6 as te,a3 as ae,ao as le,F as $,_ as se,u as ne,U as oe}from"./index-BkFnaqPs.js";import{u as re,D as ie}from"./DeletedItem-CmaCmSVZ.js";const ce={id:"dataTable",style:{position:"relative !important"}},ue={__name:"UsersDataTable",setup(M){const r=F(),w=J(),B=re(),s=a([]),g=a(0),u=a([]),i=a(null),h=a(!1),S=a(10),d=a(""),c=a({nickname:"",phone:"",status:"",created_at_from:"",created_at_to:""}),y=a({page:1,sortBy:[],itemsPerPage:10}),R=a([{title:"#",key:"index",sortable:!1},{title:"اسم الشهره",key:"nickname",align:"start"},{title:"الهاتف",key:"phone",align:"start"},{title:"الرصيد",key:"balance",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"start"},{title:"الإجراءات",key:"action",sortable:!1,align:"center"}]),k=a(null),j=a(()=>{w.push({name:"edit-user",params:{id:i.value.id}}),v()}),N=a(()=>{s.value.length?k.value=u.value.filter(e=>s.value.includes(e.id)):k.value=[i.value],B.dialogDelete=!0,v()}),q=a(()=>{v()}),O=a(()=>{const e=i.value.status==="0"?"1":"0";K("user",{status:e},i.value.id).then(()=>{u.value.forEach(t=>{t.id===i.value.id&&(t.status=e)}),v()})}),x=a([]),b=a([]);I(()=>i.value,async e=>{if(!e)return;const t=await r.can(["users.update_all","users.update_children","users.update_self","users.create","admin.super","admin.company"]),n=await r.can(["users.delete_all","users.delete_children","users.delete_self","admin.super","admin.company"]),l=await r.can(["users.view_any","users.view_children","users.view_self","admin.super","admin.company"]);b.value=[!s.value.length&&t?{title:Number(e==null?void 0:e.status)===1?"تعطيل":"تفعيل",color:Number(e==null?void 0:e.status)===1?"#ffc107":"#28a745",icon:Number(e==null?void 0:e.status)===1?"ri-toggle-line":"ri-toggle-fill",callback:O.value}:null,!s.value.length&&t?{title:"تعديل",color:"#007bff",icon:"ri-pencil-line",callback:j.value}:null,n?{title:"حذف",color:"#dc3545",icon:"ri-delete-bin-line",callback:N.value}:null,!s.value.length&&l?{title:"عرض",color:"#17a2b8",icon:"ri-eye-line",callback:q.value}:null].filter(Boolean)},{immediate:!0}),L(()=>{b.value.length===0?x.value=[{title:"لا تملك إجراءات",color:"#6c757d",icon:"ri-spam-3-line",callback:()=>{}}]:x.value=b.value});const Q=e=>{u.value=u.value.filter(t=>!e.includes(t.id)),s.value=[]},m=a(null),T=(e,{item:t})=>{i.value=t,e.preventDefault(),m.value&&m.value.showContextMenu(e)},v=()=>{m.value?m.value.colsContextMenu():console.error("Context menu is not initialized.")};I(d,e=>{e&&e.length>=3?(c.value.nickname=e,c.value.phone=e,C()):!e&&(c.value.nickname||c.value.phone)&&(c.value.nickname="",c.value.phone="",C())});async function C(){h.value=!0;const{page:e,itemsPerPage:t,sortBy:n}=y.value,l=n.length?n[0].key:"id",D=n.length&&n[0].order?n[0].order:"desc",G=t===-1?g.value:t;try{const _=await W("users",{page:e,per_page:G,sort_by:l,sort_order:D,...c.value,search:d.value.length>=3?d.value:""},!1,!1,!1);u.value=_.data,g.value=_.total}catch(_){console.error("Error fetching users:",_)}finally{h.value=!1}}function Z({item:e,index:t}){return{class:e.status==="1"?"active-row":"inactive-row","data-index":t}}return X(()=>{}),(e,t)=>{const n=H;return f(),U($,null,[o(ie,{onUpdateItems:Q,api:"users/delete",dataDelete:{items:k.value,key:"nickname"}},null,8,["dataDelete"]),Y("div",ce,[s.value.length?(f(),P(V,{key:0,class:"text-center my-2 mx-10",density:"compact",variant:"flat",style:{"background-color":"#dc3545 !important",color:"white",position:"absolute",top:"-30px","z-index":"10"},"prepend-icon":"ri-delete-bin-line",onClick:N.value},{default:p(()=>[z(" حذف عدد "+E(s.value.length)+" من العناصر ",1)]),_:1},8,["onClick"])):A("",!0),o(le,{"item-value":"id","items-per-page":S.value,"onUpdate:itemsPerPage":t[1]||(t[1]=l=>S.value=l),options:y.value,"onUpdate:options":[t[2]||(t[2]=l=>y.value=l),C],headers:R.value,items:u.value,"items-length":g.value,loading:h.value,search:d.value,hover:"","show-current-page":"","row-props":Z,modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value=l),"show-select":"","item-selectable":"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة","onContextmenu:row":T,onClick:v},{top:p(()=>[o(ee,{color:"transparent"},{default:p(()=>[o(te,{clearable:"",class:"ma-10","max-width":"200",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l),"prepend-inner-icon":"ri-search-line",label:"بحث...","hide-details":"",rounded:""},null,8,["modelValue"])]),_:1})]),"item.index":p(({index:l})=>[z(E(l+1),1)]),"item.action":p(({item:l})=>[o(V,{density:"compact",variant:"text",color:"#0086CD","prepend-icon":"ri-more-2-fill",onClick:ae(D=>T(D,{item:l}),["stop"])},null,8,["onClick"])]),_:1},8,["items-per-page","options","headers","items","items-length","loading","search","modelValue"]),o(n,{ref_key:"contextMenu",ref:m,actions:x.value},null,8,["actions"])])],64)}}},de={};function pe(M,r){return f(),P(V,{class:"text-center",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:{name:"edit-user"}})}const me=se(de,[["render",pe],["__scopeId","data-v-8b3e4ec3"]]),ge={__name:"users",setup(M){const r=F();return console.log(r.can(["users.create","admin.super","admin.company"])),(w,B)=>{const s=ue;return f(),U($,null,[ne(r).can(["users.create","admin.super","admin.company"])?(f(),P(me,{key:0,class:"ma-3"})):A("",!0),o(oe,{class:"pa-0",title:"المستخدمين"},{default:p(()=>[o(s)]),_:1})],64)}}};export{ge as default};
