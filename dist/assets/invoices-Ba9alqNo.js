import{_ as $,r as d,j as S,Q as z,l as y,k as s,bd as Q,g as W,o as n,d as t,aD as X,W as P,ai as U,b as m,a6 as Z,a1 as M,c as g,a_ as q,a as k,s as w,X as N,t as b,a4 as I,F as R,B as E,a5 as x,a8 as A,Z as H,N as J,au as ee,a9 as L,V as ae,be as le,n as se,bf as te}from"./index-B-osrc5p.js";const oe={key:0,class:"text-center py-5"},ne={key:2},re={class:"text-subtitle-1 mr-2"},ue={class:"text-caption grey--text text--darken-1"},ie={__name:"invoices",setup(de){const T=W(),B=d(T.params.userId),f=d(null);d([]);const r=d([]),_=d(!0),V=d(!1),c=d(null),v=d(""),u=d({show:!1,message:"",color:"success",timeout:3e3}),D=["companies.view_any","users.create","products.view_any","users.view_all","invoices.view_any"],G={companies:{page:{key:"companies.page",label:"صفحة الشركات"},view_any:{key:"companies.view_any",label:"عرض كل الشركات"},view:{key:"companies.view",label:"عرض تفاصيل الشركة"},create:{key:"companies.create",label:"إنشاء شركة جديدة"},update_any:{key:"companies.update_any",label:"تعديل أى شركة"},delete_any:{key:"companies.delete_any",label:"حذف أى شركة"}},users:{page:{key:"users.page",label:"صفحة المستخدمين"},view_all:{key:"users.view_all",label:"عرض كل المستخدمين"},view_children:{key:"users.view_children",label:"عرض المستخدمين التابعين"},create:{key:"users.create",label:"إنشاء مستخدم"},update_any:{key:"users.update_any",label:"تعديل أى مستخدم"},delete_any:{key:"users.delete_any",label:"حذف أى مستخدم"}},products:{page:{key:"products.page",label:"صفحة المنتجات"},view_any:{key:"products.view_any",label:"عرض كل المنتجات"},create:{key:"products.create",label:"إنشاء منتج"},delete_any:{key:"products.delete_any",label:"حذف أى منتج"}},invoices:{page:{key:"invoices.page",label:"صفحة الفواتير"},view_any:{key:"invoices.view_any",label:"عرض كل الفواتير"},create:{key:"invoices.create",label:"إنشاء فاتورة"},update_any:{key:"invoices.update_any",label:"تعديل أى فاتورة"}}},h=S(()=>{if(!f.value)return[];const l=[];for(const e in f.value)if(f.value.hasOwnProperty(e)){const a=f.value[e],o=a.page&&a.page.label?a.page.label:e.replace(/_/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "),p=[];for(const i in a)a.hasOwnProperty(i)&&i!=="page"&&p.push({label:a[i].label,value:a[i].key});l.push({name:o,permissions:p})}return l}),C=S(()=>{if(!v.value)return h.value;const l=v.value.toLowerCase();return h.value.filter(e=>{const a=e.name.toLowerCase().includes(l),o=e.permissions.some(p=>p.label.toLowerCase().includes(l)||p.value.toLowerCase().includes(l));return a||o})}),j=l=>{const e=new Set(r.value);return l.permissions.length>0&&l.permissions.every(a=>e.has(a.value))},O=(l,e)=>{e?l.permissions.forEach(a=>{r.value.includes(a.value)||r.value.push(a.value)}):r.value=r.value.filter(a=>!l.permissions.some(o=>o.value===a))},F=l=>{},K=async()=>{_.value=!0,c.value=null;try{await new Promise(l=>setTimeout(l,800)),f.value=G,r.value=[...D]}catch(l){console.error("Error fetching dummy permissions:",l),c.value="تعذر تحميل الصلاحيات الوهمية.",u.value={show:!0,message:"فشل تحميل الصلاحيات!",color:"error",timeout:4e3}}finally{_.value=!1}},Y=async()=>{V.value=!0,c.value=null;try{await new Promise(l=>setTimeout(l,800)),console.log(`صلاحيات المستخدم ${B.value} الجديدة:`,r.value),u.value={show:!0,message:"تم حفظ الصلاحيات بنجاح (وهمي)!",color:"success",timeout:3e3}}catch(l){console.error("Error saving dummy permissions:",l),c.value="تعذر حفظ الصلاحيات الوهمية.",u.value={show:!0,message:"فشل حفظ الصلاحيات!",color:"error",timeout:4e3}}finally{V.value=!1}};return z(()=>{K()}),(l,e)=>(n(),y(Q,null,{default:s(()=>[t(te,null,{default:s(()=>[t(X,null,{default:s(()=>[t(P,{class:"mx-auto","max-width":"800"},{default:s(()=>[t(U,{class:"text-h5 primary white--text d-flex justify-space-between align-center"},{default:s(()=>[e[4]||(e[4]=m(" إدارة صلاحيات المستخدم ")),t(Z,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),"append-icon":"mdi-magnify",label:"ابحث عن صلاحية","single-line":"","hide-details":"",dark:"",dense:"",class:"ml-4",style:{"max-width":"250px"}},null,8,["modelValue"])]),_:1}),t(M,{class:"pt-4"},{default:s(()=>[_.value?(n(),g("div",oe,[t(q,{indeterminate:"",color:"primary",size:"64"}),e[5]||(e[5]=k("p",{class:"mt-3"},"جاري تحميل الصلاحيات...",-1))])):w("",!0),c.value?(n(),y(N,{key:1,type:"error",dense:"",prominent:"",border:"left"},{default:s(()=>[m(" حدث خطأ أثناء تحميل الصلاحيات: "+b(c.value),1)]),_:1})):w("",!0),!_.value&&!c.value?(n(),g("div",ne,[e[6]||(e[6]=k("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)),C.value.length>0?(n(),y(I,{key:0,class:"mb-10"},{default:s(()=>[(n(!0),g(R,null,E(C.value,a=>(n(),y(x,{class:"pa-0",key:a.name,cols:"12"},{default:s(()=>[t(P,{variant:"outlined",class:"mb-4"},{default:s(()=>[t(U,{class:"py-2 px-2 bg-grey-lighten-4 d-flex align-center"},{default:s(()=>[t(A,{"model-value":j(a),"onUpdate:modelValue":o=>O(a,o),"hide-details":"",color:"primary",class:"ma-0 pa-0"},null,8,["model-value","onUpdate:modelValue"]),k("span",re,b(a.name),1),t(H),k("span",ue,b(a.permissions.length)+" صلاحية",1)]),_:2},1024),t(M,null,{default:s(()=>[t(I,null,{default:s(()=>[(n(!0),g(R,null,E(a.permissions,(o,p)=>(n(),y(x,{class:"py-0 px-3",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:p},{default:s(()=>[t(A,{modelValue:r.value,"onUpdate:modelValue":[e[1]||(e[1]=i=>r.value=i),()=>F(a)],label:o.label,value:o.value,density:"comfortable",color:"primary",class:"permission-checkbox py-0 px-3","hide-details":""},null,8,["modelValue","label","value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):v.value?(n(),y(x,{key:1,cols:"12"},{default:s(()=>[t(N,{type:"info",text:""},{default:s(()=>[m(' لا توجد صلاحيات مطابقة لـ "'+b(v.value)+'" في أي مجموعة. ',1)]),_:1})]),_:1})):w("",!0)])):w("",!0)]),_:1}),t(J),t(ee,{class:"d-flex justify-end pa-4"},{default:s(()=>[t(L,{color:"primary",loading:V.value,disabled:_.value||c.value,onClick:Y},{default:s(()=>[t(ae,{left:""},{default:s(()=>e[7]||(e[7]=[m("mdi-content-save")])),_:1}),e[8]||(e[8]=m(" حفظ التغييرات "))]),_:1},8,["loading","disabled"])]),_:1}),t(le,{modelValue:u.value.show,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.show=a),timeout:u.value.timeout,color:u.value.color},{action:s(({attrs:a})=>[t(L,se({text:""},a,{onClick:e[2]||(e[2]=o=>u.value.show=!1)}),{default:s(()=>e[9]||(e[9]=[m(" إغلاق ")])),_:2},1040)]),default:s(()=>[m(b(u.value.message)+" ",1)]),_:1},8,["modelValue","timeout","color"])]),_:1})]),_:1})]),_:1})]),_:1}))}},pe=$(ie,[["__scopeId","data-v-ed430f97"]]);export{pe as default};
