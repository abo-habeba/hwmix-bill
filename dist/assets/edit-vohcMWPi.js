import{S as W,r,w as L,o as n,c as y,d as e,k as l,b as V,t as R,a9 as U,W as T,ai as B,a4 as F,a5 as c,a1 as N,l as x,F as D,B as $,a8 as le,s as j,X as ae,au as M,Z as te,u as G,Y as Q,$ as X,Q as Y,a as S,al as Z,_ as se,A as ue,ap as oe,ar as ne,g as re,av as de,aw as ie,ax as P,N as E,a2 as me,a6 as w,ay as O,q as pe,az as ve,h as fe}from"./index-BbyQ-Ba8.js";import{g as ce}from"./permissions-3fwV70Qx.js";const Ve={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(q,{emit:g}){const{xs:A}=W(),b=q,k=g,m=r(b.roles),p=r(!1),d=r([]);L(()=>b.user.roles,i=>{d.value=i?i.map(u=>u.name):[]},{immediate:!0});function v(){const i={user_id:b.user.id,roles:d.value};console.log(i),X("role/assignRole",i).then(u=>{k("update:user",u),p.value=!1})}return(i,u)=>(n(),y(D,null,[e(U,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:u[0]||(u[0]=f=>p.value=!0)},{default:l(()=>[V(R(m.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(Q,{fullscreen:G(A),modelValue:p.value,"onUpdate:modelValue":u[3]||(u[3]=f=>p.value=f),"max-width":"500"},{default:l(()=>[e(T,{class:"pa-4"},{default:l(()=>[e(B,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>u[4]||(u[4]=[V("تعديل ادوار المستخدم ")])),_:1}),e(U,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>u[5]||(u[5]=[V(" اضافة دور جديد ")])),_:1}),e(F,{class:"mb-7"},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(N,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[m.value.length?(n(),x(F,{key:0},{default:l(()=>[(n(!0),y(D,null,$(m.value,(f,s)=>(n(),x(c,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:s},{default:l(()=>[f?(n(),x(le,{key:0,modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=_=>d.value=_),label:f.name,value:f.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):j("",!0)]),_:2},1024))),128))]),_:1})):(n(),x(ae,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>u[6]||(u[6]=[V(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(M,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(U,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:u[2]||(u[2]=f=>p.value=!1)},{default:l(()=>u[7]||(u[7]=[V(" إلغاء ")])),_:1}),e(te),e(U,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:v},{default:l(()=>u[8]||(u[8]=[V(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},be={key:0},ye={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(q,{expose:g}){const A=q,b=r(null),k=r([]);Y(()=>{});const m=r(!1);function p(){m.value=!0}return L(()=>A.userRole,d=>{d&&d.permissions&&(k.value=d.permissions,b.value=ce(k.value))},{immediate:!0}),g({openDialog:p}),(d,v)=>(n(),x(Q,{modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=i=>m.value=i),"max-width":"500px"},{default:l(()=>[e(T,null,{default:l(()=>[e(B,null,{default:l(()=>[S("span",null," صلاحيات الدور "+R(q.userRole.name),1)]),_:1}),b.value?(n(),y("div",be,[(n(!0),y(D,null,$(b.value,(i,u)=>(n(),y("div",{key:u},[v[2]||(v[2]=S("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(B,null,{default:l(()=>[S("span",null,R(i.name),1)]),_:2},1024),(n(!0),y(D,null,$(i.permissions,(f,s)=>(n(),x(Z,{class:"ma-1",key:s,color:"blue","text-color":"white"},{default:l(()=>[V(R(f.name),1)]),_:2},1024))),128))]))),128))])):j("",!0),e(M,null,{default:l(()=>[e(U,{text:"",onClick:v[0]||(v[0]=i=>m.value=!1)},{default:l(()=>v[3]||(v[3]=[V("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ge={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},xe={__name:"edit",setup(q){W();const g=re(),A=fe(),b=r(!1),k=r(g.params.id),m=r([]),p=r([]);r([]);const d=r([]),v=r([]),i=ue(),u=r(null),f=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],s=r({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),_=r(g.params.tab||f[0].tab),I=r(!1);Y(()=>{H(),g.params.id&&(b.value=!0,oe("roles").then(o=>{m.value=o.data,console.log("roles",m.value)}).catch(o=>{m.value=[]}),ne("user",k.value,!0).then(o=>{s.value=o,d.value=o.companies}).finally(o=>{b.value=!1}))});function H(){const o=[...s.value.companies.map(a=>({...a,disabled:!1})),...i.user.companies.map(a=>({...a,disabled:!0}))],t=Array.from(new Map(o.map(a=>[a.id,a])).values());return v.value=t,d.value=v.value.filter(a=>a.id===i.user.company_id),t}function J(o){return{title:o.name,subtitle:o.field,disabled:!o.disabled}}function K(){console.log("selectedCompanies",d.value),p.value=Array.from(d.value.map(o=>typeof o=="object"&&o.id!==void 0?o.id:o)),console.log("companyIds",p.value),s.value.company_id=p.value.length<=0?null:p.value[0],s.value.company_ids=p.value.length>0?p.value:null,s.value.companies=null,X("user",s.value,g.params.id).then(()=>{A.go(-1)})}const z=r({});function h(o){o&&(z.value=o,u.value.openDialog())}return(o,t)=>(n(),x(T,null,{default:l(()=>[e(ie,{class:"ma-5",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(n(),y(D,null,$(f,(a,C)=>e(de,{key:C,value:a.tab,"append-icon":a.icon},{default:l(()=>[V(R(a.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(ve,{modelValue:_.value,"onUpdate:modelValue":t[11]||(t[11]=a=>_.value=a)},{default:l(()=>[e(P,{value:"account"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(T,{elevation:"0",loading:b.value,title:G(g).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(E),e(N,null,{default:l(()=>[e(me,{class:"mt-6",ref:"userForm",modelValue:I.value,"onUpdate:modelValue":t[9]||(t[9]=a=>I.value=a)},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(w,{modelValue:s.value.full_name,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.full_name=a),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(c,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(w,{modelValue:s.value.nickname,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.nickname=a),label:" اسم الشهرة "},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(w,{required:"",modelValue:s.value.email,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.email=a),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(w,{modelValue:s.value.phone,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.phone=a),label:" رقم الهاتف ",placeholder:"0123456789"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(w,{modelValue:s.value.username,"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.username=a),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(O,{modelValue:s.value.customer_type,"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.customer_type=a),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",required:"",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(O,{modelValue:d.value,"onUpdate:modelValue":t[7]||(t[7]=a=>d.value=a),items:v.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":J},null,8,["modelValue","items"])]),_:1}),e(E,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(c,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(w,{required:"",modelValue:s.value.password,"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.password=a),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(U,{disabled:!I.value,class:pe({"forbidden-cursor":!I.value}),onClick:K},{default:l(()=>t[12]||(t[12]=[V(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(P,{value:"role"},{default:l(()=>[e(T,{elevation:"0",class:"ma-4"},{default:l(()=>{var a;return[m.value&&s.value?(n(),x(Ve,{key:0,user:s.value,"onUpdate:user":t[10]||(t[10]=C=>s.value=C),roles:m.value},null,8,["user","roles"])):j("",!0),e(B,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[13]||(t[13]=[V(" ادوار المستخدم ")])),_:1}),((a=s.value)==null?void 0:a.roles.length)>0?(n(),x(N,{key:1},{default:l(()=>[(n(!0),y(D,null,$(s.value.roles,(C,ee)=>(n(),y("span",{key:ee},[e(Z,{onClick:ke=>h(C),class:"ma-2",variant:"outlined"},{default:l(()=>[V(R(C.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(n(),y("div",ge,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(ye,{ref_key:"roleDetail",ref:u,userRole:z.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},we=se(xe,[["__scopeId","data-v-f0d0ccdc"]]);export{we as default};
