import{_ as x,r as s,P as F,w as I,o as k,c as B,d as n,j as u,b as y,t as v,a9 as A,ao as U,bo as E,F as T,ap as $,k as H,U as M}from"./index-CBThZYUU.js";import{_ as N}from"./PayInstallmentDialog-CaUHKO-I.js";const S={__name:"InstallmentsDataTable",setup(b){const g=[{title:"رقم القسط",key:"installment_number"},{title:"العميل",key:"user.nickname",sortable:!1},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"قيمة القسط",key:"amount"},{title:"الحالة",key:"status_label"},{title:"المتبقي",key:"remaining"},{title:"الإجراءات",key:"actions",sortable:!1}],i=s([]),c=s(!1),_=s(null),f=s(1),D=s(10),d=s(0),m=s(!1),o=s({page:1,itemsPerPage:10,sortBy:["due_date"],sortDesc:[!1]});function h(a){_.value=a,c.value=!0}function C({item:a}){const t=parseFloat(a.remaining)||0,e=new Date(a.due_date),l=new Date;return e.setHours(0,0,0,0),l.setHours(0,0,0,0),a.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:a.status==="canceled"?{style:{backgroundColor:"#CFD8DC"}}:a.status==="partially_paid"?{style:{backgroundColor:"#FFECB3"}}:t>0&&e<l?{style:{backgroundColor:"#EF9A9A"}}:t>0?{style:{backgroundColor:"#E0F2F7"}}:{}}function V(){p()}async function p(){m.value=!0;const{page:a,itemsPerPage:t,sortBy:e}=o.value,l=e.length?e[0].key:"due_date",P=e.length&&e[0].order?e[0].order:"asc",w={page:a||1,limit:t||10,sort_by:l,sort_order:P};try{const r=await $("installments",w,!0,!0,!0);i.value=r.data,d.value=r.total}catch(r){console.error("فشل في جلب الأقساط:",r)}finally{m.value=!1}}return F(()=>{}),I(()=>o.value.page,()=>{p()}),(a,t)=>(k(),B(T,null,[n(U,{"item-value":"id",options:o.value,"onUpdate:options":[t[0]||(t[0]=e=>o.value=e),p],headers:g,items:i.value,"items-length":d.value,loading:m.value,hover:"","show-current-page":"","row-props":C,"loading-text":"جاري تحميل البيانات","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة"},{"item.index":u(({index:e})=>[y(v(e+1),1)]),"item.actions":u(({item:e})=>[n(A,{color:e.status==="paid"?"grey":"primary",disabled:e.status==="paid"||e.status==="canceled",density:"compact",onClick:l=>h(e)},{default:u(()=>[y(v(e.status==="paid"?"تم الدفع":"دفع القسط"),1)]),_:2},1032,["color","disabled","onClick"])]),_:1},8,["options","items","items-length","loading"]),n(E,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),length:Math.ceil(d.value/D.value),class:"mt-4","show-first-last":!0,"total-visible":5},null,8,["modelValue","length"]),n(N,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),installment:_.value,"onUpdate:installment":V},null,8,["modelValue","installment"])],64))}},j=x(S,[["__scopeId","data-v-06e8b449"]]),q={__name:"installments",setup(b){return(g,i)=>(k(),H(M,{class:"pa-0",title:"الاقساط"},{default:u(()=>[n(j)]),_:1}))}};export{q as default};
