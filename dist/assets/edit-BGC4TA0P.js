import{S as L,r as p,w as A,o as d,c as V,d as e,k as l,b,t as I,a9 as $,W as P,ai as q,a4 as B,a5 as g,a1 as j,l as w,F as h,B as S,a8 as ne,s as z,X as ue,au as G,Z as re,u as x,Y as Q,$ as X,Q as Y,a as F,al as Z,_ as H,ag as ie,v as de,V as me,n as pe,a3 as M,a7 as ce,a6 as N,aa as D,A as ve,ap as fe,ar as be,g as Ve,av as ye,aw as ge,ax as O,N as W,a2 as ke,ay as K,q as xe,az as _e,h as we}from"./index-DdRopabZ.js";import{g as Ce}from"./permissions-3fwV70Qx.js";const Ue={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(k,{emit:y}){const{xs:C}=L(),f=k,_=y,m=p(f.roles),c=p(!1),r=p([]);A(()=>f.user.roles,u=>{r.value=u?u.map(a=>a.name):[]},{immediate:!0});function i(){const u={user_id:f.user.id,roles:r.value};console.log(u),X("role/assignRole",u).then(a=>{_("update:user",a),c.value=!1})}return(u,a)=>(d(),V(h,null,[e($,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:a[0]||(a[0]=v=>c.value=!0)},{default:l(()=>[b(I(m.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(Q,{fullscreen:x(C),modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=v=>c.value=v),"max-width":"500"},{default:l(()=>[e(P,{class:"pa-4"},{default:l(()=>[e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>a[4]||(a[4]=[b("تعديل ادوار المستخدم ")])),_:1}),e($,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>a[5]||(a[5]=[b(" اضافة دور جديد ")])),_:1}),e(B,{class:"mb-7"},{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(j,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[m.value.length?(d(),w(B,{key:0},{default:l(()=>[(d(!0),V(h,null,S(m.value,(v,s)=>(d(),w(g,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:s},{default:l(()=>[v?(d(),w(ne,{key:0,modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=U=>r.value=U),label:v.name,value:v.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):z("",!0)]),_:2},1024))),128))]),_:1})):(d(),w(ue,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>a[6]||(a[6]=[b(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(G,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e($,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:a[2]||(a[2]=v=>c.value=!1)},{default:l(()=>a[7]||(a[7]=[b(" إلغاء ")])),_:1}),e(re),e($,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:i},{default:l(()=>a[8]||(a[8]=[b(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},Re={key:0},Ne={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(k,{expose:y}){const C=k,f=p(null),_=p([]);Y(()=>{});const m=p(!1);function c(){m.value=!0}return A(()=>C.userRole,r=>{r&&r.permissions&&(_.value=r.permissions,f.value=Ce(_.value))},{immediate:!0}),y({openDialog:c}),(r,i)=>(d(),w(Q,{modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=u=>m.value=u),"max-width":"500px"},{default:l(()=>[e(P,null,{default:l(()=>[e(q,null,{default:l(()=>[F("span",null," صلاحيات الدور "+I(k.userRole.name),1)]),_:1}),f.value?(d(),V("div",Re,[(d(!0),V(h,null,S(f.value,(u,a)=>(d(),V("div",{key:a},[i[2]||(i[2]=F("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(q,null,{default:l(()=>[F("span",null,I(u.name),1)]),_:2},1024),(d(!0),V(h,null,S(u.permissions,(v,s)=>(d(),w(Z,{class:"ma-1",key:s,color:"blue","text-color":"white"},{default:l(()=>[b(I(v.name),1)]),_:2},1024))),128))]))),128))])):z("",!0),e(G,null,{default:l(()=>[e($,{text:"",onClick:i[0]||(i[0]=u=>m.value=!1)},{default:l(()=>i[3]||(i[3]=[b("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},$e={class:"phone-input-wrapper"},Ie={key:0},he={key:1},De={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(k,{emit:y}){const C=k,f=y,{initialPhoneNumber:_}=ie(C),m=p(_.value);A(m,i=>{f("update:phoneNumber",i)}),A(_,i=>{i!==m.value&&(m.value=i)});async function c(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){D.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const i=["tel"],u={multiple:!1},a=await navigator.contacts.select(i,u);a&&a.length&&a[0].tel&&a[0].tel.length?(m.value=a[0].tel[0],D.success("تم اختيار الرقم بنجاح")):D.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{D.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}const r=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(i,u)=>(d(),V("div",$e,[e(x(N),{modelValue:m.value,"onUpdate:modelValue":u[2]||(u[2]=a=>m.value=a),label:k.label,placeholder:k.placeholder,rules:k.rules,counter:k.counter,type:"number",class:"phone-input",clearable:"","onClick:appendInner":c,"append-inner-icon-cb":()=>{}},{"append-inner":l(()=>[e(x(de),{location:"top"},{activator:l(({props:a})=>[e(x(me),pe(a,{class:"contact-picker-icon",color:x(r)?"primary":"grey",size:"24",style:x(r)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:u[0]||(u[0]=M(v=>x(r)&&c(),["stop"])),tabindex:"0",onKeydown:u[1]||(u[1]=ce(M(v=>x(r)&&c(),["prevent"]),["enter"])),"aria-disabled":!x(r)}),{default:l(()=>u[3]||(u[3]=[b(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[x(r)?(d(),V("span",Ie,"اختيار من جهات الاتصال")):(d(),V("span",he,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"])]))}},Pe=H(De,[["__scopeId","data-v-32fa6bcf"]]),Se={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Te={__name:"edit",setup(k){L();const y=Ve(),C=we(),f=p(!1),_=p(y.params.id),m=p([]),c=p([]);p([]);const r=p([]),i=p([]),u=ve(),a=p(null),v=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],s=p({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),U=p(y.params.tab||v[0].tab),T=p(!1),J=[n=>!!n||"اسم الشهرة مطلوب"],ee=[n=>!!n||"رقم الهاتف مطلوب",n=>/^\d{10,15}$/.test(n)||"رقم الهاتف غير صحيح"];Y(()=>{le(),y.params.id?(f.value=!0,fe("roles").then(n=>{m.value=n.data,console.log("roles",m.value)}).catch(n=>{m.value=[]}),be("user",_.value,!0).then(n=>{s.value=n,r.value=n.companies}).finally(n=>{f.value=!1})):s.value.password="12345678"});function le(){const n=[...s.value.companies.map(t=>({...t,disabled:!1})),...u.user.companies.map(t=>({...t,disabled:!0}))],o=Array.from(new Map(n.map(t=>[t.id,t])).values());return i.value=o,r.value=i.value.filter(t=>t.id===u.user.company_id),o}function ae(n){return{title:n.name,subtitle:n.field,disabled:!n.disabled}}function te(){console.log("selectedCompanies",r.value),c.value=Array.from(r.value.map(n=>typeof n=="object"&&n.id!==void 0?n.id:n)),console.log("companyIds",c.value),s.value.company_id=c.value.length<=0?null:c.value[0],s.value.company_ids=c.value.length>0?c.value:null,s.value.companies=null,X("user",s.value,y.params.id).then(()=>{D.success(y.params.id?"تم تعديل المستخدم بنجاح":"تم إضافة المستخدم بنجاح"),setTimeout(()=>{C.go(-1)},1200)})}const E=p({});function oe(n){n&&(E.value=n,a.value.openDialog())}return(n,o)=>(d(),w(P,null,{default:l(()=>[e(ge,{class:"ma-5",modelValue:U.value,"onUpdate:modelValue":o[0]||(o[0]=t=>U.value=t),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(d(),V(h,null,S(v,(t,R)=>e(ye,{key:R,value:t.tab,"append-icon":t.icon},{default:l(()=>[b(I(t.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(_e,{modelValue:U.value,"onUpdate:modelValue":o[11]||(o[11]=t=>U.value=t)},{default:l(()=>[e(O,{value:"account"},{default:l(()=>[e(B,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(P,{elevation:"0",loading:f.value,title:x(y).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(W),e(j,null,{default:l(()=>[e(ke,{class:"mt-6",ref:"userForm",modelValue:T.value,"onUpdate:modelValue":o[9]||(o[9]=t=>T.value=t)},{default:l(()=>[e(B,null,{default:l(()=>[e(g,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(N,{modelValue:s.value.full_name,"onUpdate:modelValue":o[1]||(o[1]=t=>s.value.full_name=t),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(g,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(N,{required:"",modelValue:s.value.nickname,"onUpdate:modelValue":o[2]||(o[2]=t=>s.value.nickname=t),label:" اسم الشهرة ",rules:J},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(N,{modelValue:s.value.email,"onUpdate:modelValue":o[3]||(o[3]=t=>s.value.email=t),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Pe,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:s.value.phone,"onUpdate:phoneNumber":o[4]||(o[4]=t=>s.value.phone=t),rules:ee,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(g,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(N,{modelValue:s.value.username,"onUpdate:modelValue":o[5]||(o[5]=t=>s.value.username=t),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(K,{modelValue:s.value.customer_type,"onUpdate:modelValue":o[6]||(o[6]=t=>s.value.customer_type=t),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(K,{modelValue:r.value,"onUpdate:modelValue":o[7]||(o[7]=t=>r.value=t),items:i.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":ae,"return-object":""},null,8,["modelValue","items"])]),_:1}),e(W,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(g,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(N,{required:"",modelValue:s.value.password,"onUpdate:modelValue":o[8]||(o[8]=t=>s.value.password=t),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e($,{disabled:!T.value,class:xe({"forbidden-cursor":!T.value}),onClick:te},{default:l(()=>o[12]||(o[12]=[b(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(O,{value:"role"},{default:l(()=>[e(P,{elevation:"0",class:"ma-4"},{default:l(()=>{var t;return[m.value&&s.value?(d(),w(Ue,{key:0,user:s.value,"onUpdate:user":o[10]||(o[10]=R=>s.value=R),roles:m.value},null,8,["user","roles"])):z("",!0),e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>o[13]||(o[13]=[b(" ادوار المستخدم ")])),_:1}),((t=s.value)==null?void 0:t.roles.length)>0?(d(),w(j,{key:1},{default:l(()=>[(d(!0),V(h,null,S(s.value.roles,(R,se)=>(d(),V("span",{key:se},[e(Z,{onClick:Ae=>oe(R),class:"ma-2",variant:"outlined"},{default:l(()=>[b(I(R.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(d(),V("div",Se,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Ne,{ref_key:"roleDetail",ref:a,userRole:E.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Fe=H(Te,[["__scopeId","data-v-f298d284"]]);export{Fe as default};
