import{S as Y,r as d,w as F,o as r,c as g,d as e,k as l,b as V,t as I,a9 as D,W as A,ai as q,a4 as B,a5 as w,a1 as E,l as U,F as P,B as S,a8 as ne,s as L,X as re,au as O,Z,u as _,Y as W,$ as J,Q as ee,av as ie,a as j,al as le,_ as ae,ag as de,v as me,V as pe,n as ce,a3 as H,a7 as ve,i as fe,a6 as T,N as M,H as be,I as Ve,L as ye,aa as z,A as ge,ap as ke,ar as xe,g as we,aw as _e,ax as Ce,ay as Q,a2 as Ne,az as X,q as Ue,aA as Re,h as Ie}from"./index-eQY_ApO-.js";const $e={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(C,{emit:N}){const{xs:$}=Y(),x=C,R=N,i=d(x.roles),p=d(!1),c=d([]);F(()=>x.user.roles,v=>{c.value=v?v.map(t=>t.name):[]},{immediate:!0});function b(){const v={user_id:x.user.id,roles:c.value};console.log(v),J("role/assignRole",v).then(t=>{R("update:user",t),p.value=!1})}return(v,t)=>(r(),g(P,null,[e(D,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:t[0]||(t[0]=k=>p.value=!0)},{default:l(()=>[V(I(i.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(W,{fullscreen:_($),modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=k=>p.value=k),"max-width":"500"},{default:l(()=>[e(A,{class:"pa-4"},{default:l(()=>[e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[4]||(t[4]=[V("تعديل ادوار المستخدم ")])),_:1}),e(D,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>t[5]||(t[5]=[V(" اضافة دور جديد ")])),_:1}),e(B,{class:"mb-7"},{default:l(()=>[e(w,{cols:"12"},{default:l(()=>[e(E,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[i.value.length?(r(),U(B,{key:0},{default:l(()=>[(r(!0),g(P,null,S(i.value,(k,a)=>(r(),U(w,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:a},{default:l(()=>[k?(r(),U(ne,{key:0,modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=f=>c.value=f),label:k.name,value:k.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):L("",!0)]),_:2},1024))),128))]),_:1})):(r(),U(re,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>t[6]||(t[6]=[V(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(O,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(D,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:t[2]||(t[2]=k=>p.value=!1)},{default:l(()=>t[7]||(t[7]=[V(" إلغاء ")])),_:1}),e(Z),e(D,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:b},{default:l(()=>t[8]||(t[8]=[V(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},De={key:0},Pe={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(C,{expose:N}){const $=C,x=d(null),R=d([]);ee(()=>{});const i=d(!1);function p(){i.value=!0}return F(()=>$.userRole,async c=>{c&&c.permissions&&(R.value=c.permissions,x.value=await ie(R.value))},{immediate:!0}),N({openDialog:p}),(c,b)=>(r(),U(W,{modelValue:i.value,"onUpdate:modelValue":b[1]||(b[1]=v=>i.value=v),"max-width":"500px"},{default:l(()=>[e(A,null,{default:l(()=>[e(q,null,{default:l(()=>[j("span",null," صلاحيات الدور "+I(C.userRole.name),1)]),_:1}),x.value?(r(),g("div",De,[(r(!0),g(P,null,S(x.value,(v,t)=>(r(),g("div",{key:t},[b[2]||(b[2]=j("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(q,null,{default:l(()=>[j("span",null,I(v.name),1)]),_:2},1024),(r(!0),g(P,null,S(v.permissions,(k,a)=>(r(),U(le,{class:"ma-1",key:a,color:"blue","text-color":"white"},{default:l(()=>[V(I(k.name),1)]),_:2},1024))),128))]))),128))])):L("",!0),e(O,null,{default:l(()=>[e(D,{text:"",onClick:b[0]||(b[0]=v=>i.value=!1)},{default:l(()=>b[3]||(b[3]=[V("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Te={class:"phone-input-wrapper"},Ae={key:0},Se={key:1},he={key:0},qe={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(C,{emit:N}){const $=C,x=N,{initialPhoneNumber:R}=de($),i=d(R.value);F(i,f=>{x("update:phoneNumber",f)}),F(R,f=>{f!==i.value&&(i.value=f)});const p=d(!1),c=d([]),b=d("");function v(f){let u=f.replace(/\s+/g,"").replace(/^\+/,"");return u=u.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),u}async function t(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){z.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const f=["tel","name"],u={multiple:!1},m=await navigator.contacts.select(f,u);m&&m.length&&m[0].tel&&m[0].tel.length?m[0].tel.length===1?i.value=v(m[0].tel[0]):(c.value=m[0].tel.map(v),b.value=m[0].name?m[0].name[0]:"",p.value=!0):z.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{z.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function k(f){i.value=v(f),p.value=!1}const a=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(f,u)=>(r(),g("div",Te,[e(_(T),{modelValue:_(i),"onUpdate:modelValue":u[2]||(u[2]=m=>fe(i)?i.value=m:null),label:C.label,placeholder:C.placeholder,rules:C.rules,counter:C.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":t,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(_(me),{location:"top"},{activator:l(({props:m})=>[e(_(pe),ce(m,{class:"contact-picker-icon",color:_(a)?"primary":"grey",size:"24",style:_(a)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:u[0]||(u[0]=H(h=>_(a)&&t(),["stop"])),tabindex:"0",onKeydown:u[1]||(u[1]=ve(H(h=>_(a)&&t(),["prevent"]),["enter"])),"aria-disabled":!_(a)}),{default:l(()=>u[5]||(u[5]=[V(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[_(a)?(r(),g("span",Ae,"اختيار من جهات الاتصال")):(r(),g("span",Se,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(W,{modelValue:p.value,"onUpdate:modelValue":u[4]||(u[4]=m=>p.value=m),"max-width":"400"},{default:l(()=>[e(A,null,{default:l(()=>[e(q,{class:"text-h6"},{default:l(()=>[u[6]||(u[6]=V("اختر رقم الهاتف ")),b.value?(r(),g("span",he,"("+I(b.value)+")",1)):L("",!0)]),_:1}),e(M),e(be,null,{default:l(()=>[(r(!0),g(P,null,S(c.value,(m,h)=>(r(),U(Ve,{key:h,onClick:K=>k(m),style:{cursor:"pointer"}},{default:l(()=>[e(ye,null,{default:l(()=>[V(I(m),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(O,null,{default:l(()=>[e(Z),e(D,{text:"",onClick:u[3]||(u[3]=m=>p.value=!1)},{default:l(()=>u[7]||(u[7]=[V("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fe=ae(qe,[["__scopeId","data-v-9bfc0763"]]),Be={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Le={__name:"edit",setup(C){Y();const N=we(),$=Ie(),x=d(!1),R=d(N.params.id),i=d([]),p=d([]);d([]);const c=d([]),b=d([]),v=ge(),t=d(null),k=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=d({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),f=d(N.params.tab||k[0].tab),u=d(!1),m=[n=>!!n||"اسم الشهرة مطلوب"],h=[n=>!!n||"رقم الهاتف مطلوب"];ee(()=>{K(),N.params.id?(x.value=!0,ke("roles").then(n=>{i.value=n.data,console.log("roles",i.value)}).catch(n=>{i.value=[]}),xe("user",R.value,!0).then(n=>{a.value=n,c.value=n.companies}).finally(n=>{x.value=!1})):a.value.password="12345678"});function K(){var s;const n=[...a.value.companies.map(y=>({...y,disabled:!1})),...(s=v.user)==null?void 0:s.companies.map(y=>({...y,disabled:!0}))],o=Array.from(new Map(n.map(y=>[y.id,y])).values());return b.value=o,c.value=b.value.filter(y=>y.id===v.user.company_id),o}function te(n){return{title:n.name,subtitle:n.field,disabled:!n.disabled}}function oe(){console.log("selectedCompanies",c.value),p.value=Array.from(c.value.map(n=>typeof n=="object"&&n.id!==void 0?n.id:n)),console.log("companyIds",p.value),a.value.company_id=p.value.length<=0?null:p.value[0],a.value.company_ids=p.value.length>0?p.value:null,a.value.companies=null,J("user",a.value,N.params.id).then(()=>{setTimeout(()=>{$.go(-1)},1200)})}const G=d({});function se(n){n&&(G.value=n,t.value.openDialog())}return(n,o)=>(r(),U(A,null,{default:l(()=>[e(Ce,{class:"ma-5",modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=s=>f.value=s),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),g(P,null,S(k,(s,y)=>e(_e,{key:y,value:s.tab,"append-icon":s.icon},{default:l(()=>[V(I(s.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(Re,{modelValue:f.value,"onUpdate:modelValue":o[11]||(o[11]=s=>f.value=s)},{default:l(()=>[e(Q,{value:"account"},{default:l(()=>[e(B,null,{default:l(()=>[e(w,{cols:"12"},{default:l(()=>[e(A,{elevation:"0",loading:x.value,title:_(N).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(M),e(E,null,{default:l(()=>[e(Ne,{class:"mt-6",ref:"userForm",modelValue:u.value,"onUpdate:modelValue":o[9]||(o[9]=s=>u.value=s)},{default:l(()=>[e(B,null,{default:l(()=>[e(w,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{modelValue:a.value.full_name,"onUpdate:modelValue":o[1]||(o[1]=s=>a.value.full_name=s),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(w,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":o[2]||(o[2]=s=>a.value.nickname=s),label:" اسم الشهرة ",rules:m},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.email,"onUpdate:modelValue":o[3]||(o[3]=s=>a.value.email=s),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Fe,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":o[4]||(o[4]=s=>a.value.phone=s),rules:h,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(w,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.username,"onUpdate:modelValue":o[5]||(o[5]=s=>a.value.username=s),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(X,{modelValue:a.value.customer_type,"onUpdate:modelValue":o[6]||(o[6]=s=>a.value.customer_type=s),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(w,{cols:"12"},{default:l(()=>[e(X,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=s=>c.value=s),items:b.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":te,"return-object":""},null,8,["modelValue","items"])]),_:1}),e(M,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(w,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{required:"",modelValue:a.value.password,"onUpdate:modelValue":o[8]||(o[8]=s=>a.value.password=s),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(D,{disabled:!u.value,class:Ue({"forbidden-cursor":!u.value}),onClick:oe},{default:l(()=>o[12]||(o[12]=[V(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(Q,{value:"role"},{default:l(()=>[e(A,{elevation:"0",class:"ma-4"},{default:l(()=>{var s;return[i.value&&a.value?(r(),U($e,{key:0,user:a.value,"onUpdate:user":o[10]||(o[10]=y=>a.value=y),roles:i.value},null,8,["user","roles"])):L("",!0),e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>o[13]||(o[13]=[V(" ادوار المستخدم ")])),_:1}),((s=a.value)==null?void 0:s.roles.length)>0?(r(),U(E,{key:1},{default:l(()=>[(r(!0),g(P,null,S(a.value.roles,(y,ue)=>(r(),g("span",{key:ue},[e(le,{onClick:je=>se(y),class:"ma-2",variant:"outlined"},{default:l(()=>[V(I(y.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),g("div",Be,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Pe,{ref_key:"roleDetail",ref:t,userRole:G.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ee=ae(Le,[["__scopeId","data-v-f5564e72"]]);export{Ee as default};
