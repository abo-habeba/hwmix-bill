import{_ as J,o as O,l as I,k as t,a as y,d as e,aI as le,a4 as N,a5 as r,a6 as q,az as z,aH as re,c as D,b as U,aJ as ue,F as B,B as G,aK as ae,a9 as C,s as me,W as j,S as be,r as x,w as T,ah as ye,Q as ce,ap as M,ai as K,t as A,a1 as fe,a2 as Ve,aL as ge,N as pe,au as ve,Y as oe,$ as ie,j as _e,I as xe,n as we,a7 as ke,ak as se,a3 as R,q as de,V as te,aG as he,aa as ne}from"./index-D371WGQu.js";import{_ as Ue}from"./AttributesDisplay-DKUWxkzu.js";const Ce={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Oe={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(u,{emit:P}){return(b,o)=>(O(),I(re,null,{default:t(()=>[y("div",Ce,[y("div",null,[e(le,{modelValue:u.modelValue.active,"onUpdate:modelValue":o[0]||(o[0]=i=>u.modelValue.active=i),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),y("div",null,[e(le,{modelValue:u.modelValue.featured,"onUpdate:modelValue":o[1]||(o[1]=i=>u.modelValue.featured=i),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),y("div",null,[e(le,{modelValue:u.modelValue.returnable,"onUpdate:modelValue":o[2]||(o[2]=i=>u.modelValue.returnable=i),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(N,{dense:""},{default:t(()=>[e(r,{cols:"12",sm:"12"},{default:t(()=>[e(q,{modelValue:u.modelValue.name,"onUpdate:modelValue":o[3]||(o[3]=i=>u.modelValue.name=i),label:"اسم المنتج",rules:u.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",sm:"6"},{default:t(()=>[e(z,{modelValue:u.modelValue.category_id,"onUpdate:modelValue":o[4]||(o[4]=i=>u.modelValue.category_id=i),items:u.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",sm:"6"},{default:t(()=>[e(z,{modelValue:u.modelValue.brand_id,"onUpdate:modelValue":o[5]||(o[5]=i=>u.modelValue.brand_id=i),items:u.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",sm:"12"},{default:t(()=>[e(q,{modelValue:u.modelValue.desc,"onUpdate:modelValue":o[6]||(o[6]=i=>u.modelValue.desc=i),label:"الوصف",rules:u.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",sm:"12"},{default:t(()=>[e(q,{modelValue:u.modelValue.desc_long,"onUpdate:modelValue":o[7]||(o[7]=i=>u.modelValue.desc_long=i),label:"الوصف المفصل",rules:u.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},qe=J(Oe,[["__scopeId","data-v-c923be84"]]),Se={__name:"ProductVariantAttributes",props:{modelValue:Array,attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{emit:P}){const b=u,o=P;function i(k){const d=b.attributes.find(f=>f.id===k);return d?d.values:[]}function m(k,d){const f=i(k).find(p=>p.id===d);return f&&f.color?`background:${f.color};color:${S(f.color)};border-radius:6px;`:""}function S(k){if(!k)return"#000";const d=k.substring(1),f=parseInt(d,16),p=f>>16&255,s=f>>8&255,n=f>>0&255;return .299*p+.587*s+.114*n>186?"#000":"#fff"}function w(){const k={attribute_id:null,attribute_value_id:null};o("update:modelValue",[...b.modelValue,k])}function v(k){const d=[...b.modelValue];d.splice(k,1),o("update:modelValue",d)}return(k,d)=>(O(),D(B,null,[e(ue,{class:"ma-2"},{default:t(()=>d[0]||(d[0]=[U("الخصائص (Attributes)")])),_:1}),(O(!0),D(B,null,G(u.modelValue,(f,p)=>(O(),I(N,{dense:"",key:p,class:"d-flex align-center"},{default:t(()=>[e(r,{cols:"5"},{default:t(()=>[e(z,{modelValue:f.attribute_id,"onUpdate:modelValue":[s=>f.attribute_id=s,()=>f.attribute_value_id=null],items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(r,{cols:"5"},{default:t(()=>[e(z,{modelValue:f.attribute_value_id,"onUpdate:modelValue":s=>f.attribute_value_id=s,items:i(f.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!f.attribute_id,"hide-details":"auto",style:ae(m(f.attribute_id,f.attribute_value_id))},null,8,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(r,{cols:"2"},{default:t(()=>[e(C,{class:"ma-0 pa-0",icon:"ri-delete-bin-line",color:"error",size:"x-small",onClick:s=>v(p)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-1 pa-1",text:"",color:"primary",small:"",onClick:w},{default:t(()=>d[1]||(d[1]=[U("+ إضافة خاصية")])),_:1})],64))}},Pe=J(Se,[["__scopeId","data-v-73ca1f89"]]),Ae={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(u,{emit:P}){const b=u,o=P,i=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function m(S){if(b.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const w=[...b.modelValue];w.splice(S,1),o("update:modelValue",w)}return(S,w)=>(O(),D(B,null,[e(ue,{class:"ma-2"},{default:t(()=>w[1]||(w[1]=[U("المخزون")])),_:1}),(O(!0),D(B,null,G(u.modelValue,(v,k)=>(O(),I(N,{dense:"",key:v.id||k},{default:t(()=>[e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(q,{modelValue:v.cost,"onUpdate:modelValue":d=>v.cost=d,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:u.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(q,{modelValue:v.quantity,"onUpdate:modelValue":d=>v.quantity=d,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:u.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[u.warehouses&&u.warehouses.length>0?(O(),I(z,{key:0,modelValue:v.warehouse_id,"onUpdate:modelValue":d=>v.warehouse_id=d,"item-value":"id","item-title":"name",items:u.warehouses,label:"المخزن",rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(O(),I(z,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(z,{modelValue:v.status,"onUpdate:modelValue":d=>v.status=d,items:i,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[d=>!!d||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(q,{modelValue:v.expiry,"onUpdate:modelValue":d=>v.expiry=d,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(q,{modelValue:v.loc,"onUpdate:modelValue":d=>v.loc=d,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),u.modelValue.length>1?(O(),I(C,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:w[0]||(w[0]=v=>m(S.sIndex))})):me("",!0)],64))}},$e=J(Ae,[["__scopeId","data-v-382b902c"]]),Ee={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(u,{emit:P}){return(b,o)=>(O(),I(N,null,{default:t(()=>[e(r,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(q,{modelValue:u.variant.retail_price,"onUpdate:modelValue":o[0]||(o[0]=i=>u.variant.retail_price=i),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(q,{modelValue:u.variant.wholesale_price,"onUpdate:modelValue":o[1]||(o[1]=i=>u.variant.wholesale_price=i),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(z,{modelValue:u.variant.status,"onUpdate:modelValue":o[2]||(o[2]=i=>u.variant.status=i),items:u.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(q,{modelValue:u.variant.min_quantity,"onUpdate:modelValue":o[3]||(o[3]=i=>u.variant.min_quantity=i),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(j,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e(Pe,{modelValue:u.variant.attributes,"onUpdate:modelValue":o[4]||(o[4]=i=>u.variant.attributes=i),attributes:u.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(r,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(j,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e($e,{modelValue:u.variant.stocks,"onUpdate:modelValue":o[5]||(o[5]=i=>u.variant.stocks=i),warehouses:u.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(r,{cols:"12",class:"my-2 py-1"},{default:t(()=>[e(C,{color:"error",onClick:o[6]||(o[6]=i=>b.$emit("remove-variant",u.variantIndex))},{default:t(()=>o[7]||(o[7]=[U("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Ne=J(Ee,[["__scopeId","data-v-baa8ac87"]]),Ie={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(u,{emit:P}){const b=u,o=P;be();const i=x(b.dialog),m=x(null),S=x(!1),w=x([]),v=x([]),k=x([]),d=x([]),f=l=>typeof l=="number"&&!isNaN(l)||"يجب أن يكون رقمًا",p=l=>parseFloat(l)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",s=l=>typeof l=="number"&&!isNaN(l)&&l!==null||"مطلوب ويجب أن يكون رقمًا",n={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},h=x(JSON.parse(JSON.stringify(n)));function V(l){return{id:l.id,name:l.name||"",active:l.active??!0,featured:l.featured??!1,returnable:l.returnable??!0,desc:l.desc||"",desc_long:l.desc_long||"",category_id:l.category_id||null,brand_id:l.brand_id||null,variants:(l.variants||[]).map(a=>({id:a.id,barcode:a.barcode||"",sku:a.sku||"",retail_price:parseFloat(a.retail_price)||0,wholesale_price:parseFloat(a.wholesale_price)||0,image:a.image||null,weight:parseFloat(a.weight)||0,dimensions:a.dimensions||"",min_quantity:a.min_quantity||"",tax:parseFloat(a.tax)||0,discount:parseFloat(a.discount)||0,status:a.status||"active",attributes:(a.attributes||[]).map(c=>({attribute_id:c.attribute_id||null,attribute_value_id:c.attribute_value_id||null})),stocks:(a.stocks||[]).map(c=>({id:c.id,quantity:c.quantity||0,reserved:c.reserved||0,min_quantity:c.min_quantity||0,cost:parseFloat(c.cost)||0,batch:c.batch||"",expiry:c.expiry?new Date(c.expiry).toISOString().substr(0,10):null,loc:c.loc||"",status:c.status??"available",warehouse_id:c.warehouse?c.warehouse.id:null}))}))}}const F={name:[l=>!!l||"اسم المنتج مطلوب",l=>typeof l=="string"&&l.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[l=>!l||typeof l=="string"||"الوصف يجب أن يكون نصًا"],description_long:[l=>!l||typeof l=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[s,p],wholesale_price:[s,p],tax:[f,p],discount:[f,p],weight:[f,p],quantity:[s,p],cost:[f,p]};function $(){h.value.variants.length>0&&h.value.variants[0].stocks.length>0&&v.value.length>0&&h.value.variants[0].stocks[0].warehouse_id===null&&(h.value.variants[0].stocks[0].warehouse_id=v.value[0].id)}T(()=>b.dialog,async l=>{i.value=l,l&&(b.isEditMode&&b.product?h.value=V(b.product):(h.value=JSON.parse(JSON.stringify(n)),$()),await ye(),m.value&&m.value.resetValidation())},{immediate:!0}),T(i,l=>{o("update:dialog",l)}),T(()=>b.product,l=>{b.isEditMode&&l&&(h.value=V(l))}),ce(async()=>{await Promise.all([L(),W(),H(),Q()]),b.isEditMode||$()});async function L(){try{const l=await M("brands",null,!0,!1);w.value=l.data}catch(l){console.error("Error fetching brands:",l)}}async function W(){try{const l=await M("attributes",null,!0,!0);d.value=l.data}catch(l){console.error("Error fetching attributes:",l)}}async function H(){try{const l=await M("warehouses",null,!0,!1);v.value=l.data,b.isEditMode||$()}catch(l){console.error("Error fetching warehouses:",l)}}async function Q(){try{const l=await M("categories",null,!0,!1);k.value=l.data}catch(l){console.error("Error fetching categories:",l)}}function Y(){h.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:v.value.length>0?v.value[0].id:null}]})}function Z(l){h.value.variants.splice(l,1)}async function X(){if(!m.value)return;const{valid:l}=await m.value.validate();if(l)try{const a=JSON.parse(JSON.stringify(h.value));Object.prototype.hasOwnProperty.call(a,"active")||Object.prototype.hasOwnProperty.call(a,"is_active")&&(a.active=a.is_active,delete a.is_active),Object.prototype.hasOwnProperty.call(a,"returnable")||Object.prototype.hasOwnProperty.call(a,"is_returnable")&&(a.returnable=a.is_returnable,delete a.is_returnable),Object.prototype.hasOwnProperty.call(a,"desc")||Object.prototype.hasOwnProperty.call(a,"description")&&(a.desc=a.description,delete a.description),Object.prototype.hasOwnProperty.call(a,"desc_long")||Object.prototype.hasOwnProperty.call(a,"description_long")&&(a.desc_long=a.description_long,delete a.desc_long),a.variants.forEach(E=>{E.stocks&&E.stocks.length>0&&E.stocks.forEach(_=>{!_.warehouse_id&&v.value.length>0&&(_.warehouse_id=v.value[0].id)})});let c;if(a.id)c=await ie("product",a,a.id);else{const{id:E,..._}=a;c=await ie("product",_)}o("saved",c.data),g()}catch(a){console.error("Error saving product:",a)}}const ee=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function g(){i.value=!1,o("close")}return(l,a)=>(O(),I(oe,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=c=>i.value=c),"max-width":"900px"},{default:t(()=>[e(j,null,{default:t(()=>[e(C,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:g}),e(K,{class:"ma-3 text-center"},{default:t(()=>[y("h2",null,A(u.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(fe,{class:"pa-0"},{default:t(()=>[e(Ve,{ref_key:"productForm",ref:m,modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=c=>S.value=c)},{default:t(()=>[e(qe,{modelValue:h.value,categories:k.value,brands:w.value,productRules:F,"onUpdate:modelValue":a[0]||(a[0]=c=>h.value=c)},null,8,["modelValue","categories","brands"]),e(j,{class:"pa-2 ma-1",outlined:""},{default:t(()=>[e(K,{class:"ma-2"},{default:t(()=>a[3]||(a[3]=[U(" خيارات المنتج ")])),_:1}),(O(!0),D(B,null,G(h.value.variants,(c,E)=>(O(),I(N,{class:"bg-grey-lighten-1 pa-2",key:E},{default:t(()=>[e(Ne,{variant:c,variantIndex:E,attributes:d.value,warehouses:v.value,statusOptions:ee,productRules:F,onRemoveVariant:Z},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(N,null,{default:t(()=>[e(r,{cols:"12"},{default:t(()=>[e(C,{class:"ma-3",color:"primary",onClick:Y},{default:t(()=>a[4]||(a[4]=[U("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(ge,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:t(()=>[e(pe,{class:"my-2"}),e(ve,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:t(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!S.value,onClick:X,class:"text-capitalize"},{default:t(()=>[U(A(u.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(C,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:g,class:"text-capitalize"},{default:t(()=>a[5]||(a[5]=[U(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Fe=J(Ie,[["__scopeId","data-v-3d1a12b1"]]),ze={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(u,{emit:P}){const b=u,o=P,i=_e({get:()=>b.modelValue,set:p=>o("update:modelValue",p)}),m=x({});T(()=>b.variant,p=>{m.value=JSON.parse(JSON.stringify(p||{}))},{immediate:!0});function S(p){if(!p)return[];const s=b.attributes.find(n=>n.id===p);return s?s.values:[]}function w(p){if(!p)return"#000";const s=p.substring(1),n=parseInt(s,16),h=n>>16&255,V=n>>8&255,F=n>>0&255;return .299*h+.587*V+.114*F>186?"#000":"#fff"}function v(){m.value.attributes=m.value.attributes||[],m.value.attributes.push({attribute_id:null,attribute_value_id:null})}function k(p){m.value.attributes.splice(p,1)}function d(){o("update:modelValue",!1)}function f(){o("save",JSON.parse(JSON.stringify(m.value))),d()}return(p,s)=>(O(),I(oe,{modelValue:i.value,"onUpdate:modelValue":s[7]||(s[7]=n=>i.value=n),"max-width":"600"},{default:t(()=>[e(j,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(K,null,{default:t(()=>s[8]||(s[8]=[U("تعديل متغير المنتج")])),_:1}),e(N,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(r,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:t(()=>[e(N,null,{default:t(()=>[e(r,{cols:"4"},{default:t(()=>[e(q,{modelValue:m.value.purchase_price,"onUpdate:modelValue":s[0]||(s[0]=n=>m.value.purchase_price=n),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:t(()=>[e(q,{modelValue:m.value.retail_price,"onUpdate:modelValue":s[1]||(s[1]=n=>m.value.retail_price=n),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:t(()=>[e(q,{modelValue:m.value.wholesale_price,"onUpdate:modelValue":s[2]||(s[2]=n=>m.value.wholesale_price=n),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:t(()=>[e(N,null,{default:t(()=>[e(r,{cols:"6"},{default:t(()=>[e(q,{modelValue:m.value.tax_rate,"onUpdate:modelValue":s[3]||(s[3]=n=>m.value.tax_rate=n),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:t(()=>[e(q,{modelValue:m.value.discount,"onUpdate:modelValue":s[4]||(s[4]=n=>m.value.discount=n),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{class:"py-0",cols:"12"},{default:t(()=>[e(N,null,{default:t(()=>[e(r,{cols:"6"},{default:t(()=>[e(q,{modelValue:m.value.expiry_date,"onUpdate:modelValue":s[5]||(s[5]=n=>m.value.expiry_date=n),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:t(()=>[e(q,{modelValue:m.value.image_url,"onUpdate:modelValue":s[6]||(s[6]=n=>m.value.image_url=n),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12",class:"mt-4"},{default:t(()=>[e(ue,null,{default:t(()=>s[9]||(s[9]=[U("الخصائص (Attributes)")])),_:1}),(O(!0),D(B,null,G(m.value.attributes,(n,h)=>(O(),I(N,{dense:"",key:h,class:"d-flex align-center"},{default:t(()=>[e(r,{cols:"5"},{default:t(()=>[e(z,{modelValue:n.attribute_id,"onUpdate:modelValue":V=>n.attribute_id=V,items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>n.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(r,{cols:"5"},{default:t(()=>[e(z,{modelValue:n.attribute_value_id,"onUpdate:modelValue":V=>n.attribute_value_id=V,items:S(n.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!n.attribute_id,":return-object":!1,"hide-details":"auto",style:ae((()=>{const V=S(n.attribute_id).find(F=>F.id===n.attribute_value_id);return V&&V.color?`background:${V.color};color:${w(V.color)};border-radius:6px;`:""})())},{item:t(({item:V,props:F})=>[e(xe,we({ref_for:!0},F,{style:V.raw.color?`background:${V.raw.color};color:${w(V.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:t(({item:V})=>[y("span",{style:ae(V.raw.color?`background:${V.raw.color};color:${w(V.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},A(V.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(r,{cols:"2"},{default:t(()=>[e(C,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:V=>k(h)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-2",text:"",color:"primary",small:"",onClick:v},{default:t(()=>s[10]||(s[10]=[U("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(pe,{class:"my-4"}),e(N,null,{default:t(()=>[e(r,{cols:"6"},{default:t(()=>[e(C,{"prepend-icon":"ri-close-line",color:"error",onClick:d},{default:t(()=>s[11]||(s[11]=[U(" إلغاء ")])),_:1})]),_:1}),e(r,{cols:"6",class:"text-center"},{default:t(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",onClick:f},{default:t(()=>s[12]||(s[12]=[U(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},De=J(ze,[["__scopeId","data-v-400d4050"]]),je={class:"d-flex align-center justify-space-between mb-2"},Je={class:"d-flex align-center gap-2"},Me=["onClick"],Be={key:0},Re={colspan:"5",class:"pa-0"},Te={__name:"products",setup(u){const P=x(!1),b=x({}),o=x(!1),i=x([]),m=x(!1),S=x(null),w=x(null),v=x(0),k=x(!1),d=x({page:1,itemsPerPage:10,sortBy:[]}),f=x(""),p=x(!1),s=x(null),n=x([]),h=[{title:"الاسم",key:"name"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],V=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];ce(()=>{$(),F()});function F(){M("attributes",null,!0,!1).then(g=>{n.value=g.data})}function $(){k.value=!0;const{page:g,itemsPerPage:l,sortBy:a}=d.value,c=a.length?a[0].key:"id",E=a.length&&a[0].order?a[0].order:"desc";M("products",{page:g,per_page:l,sort_by:c,sort_order:E,search:f.value}).then(_=>{i.value=_.data,v.value=_.total}).finally(()=>{k.value=!1})}function L(){o.value=!1,b.value={},P.value=!0}function W(g){P.value=!0,o.value=!0,b.value=JSON.parse(JSON.stringify(g))}function H(g){const l=i.value.findIndex(a=>a.id===g.id);l!==-1?i.value[l]=g:i.value.push(g),P.value=!1}function Q(g){S.value=g,m.value=!0}function Y(){S.value&&he("product/delete",S.value.id).then(()=>{$(),ne.success("تم حذف المنتج بنجاح"),m.value=!1,S.value=null}).catch(()=>ne.error("حدث خطأ أثناء حذف المنتج"))}function Z(g){w.value=w.value===g?null:g}function X(g,l){s.value=JSON.parse(JSON.stringify(g)),s.value.product_id=l,console.log("openVariantEditDialog",s.value),console.log("attributes",n.value),p.value=!0}function ee(g){const l=i.value.find(c=>c.id===(g.product_id||w.value));if(!l)return;const a=l.variants.findIndex(c=>c.id===g.id);a!==-1&&(l.variants[a]=g),p.value=!1}return(g,l)=>(O(),I(re,{class:"pa-1",style:{"max-width":"1200px"}},{default:t(()=>[e(Fe,{dialog:P.value,"onUpdate:dialog":l[0]||(l[0]=a=>P.value=a),product:b.value,isEditMode:o.value,onSaved:H},null,8,["dialog","product","isEditMode"]),e(De,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=a=>p.value=a),variant:s.value,attributes:n.value,onSave:ee},null,8,["modelValue","variant","attributes"]),e(j,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:t(()=>[y("div",je,[l[8]||(l[8]=y("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(C,{color:"primary",onClick:L,size:"small"},{default:t(()=>l[7]||(l[7]=[U("+ إضافة منتج")])),_:1}),y("div",Je,[e(q,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=a=>f.value=a),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:ke($,["enter"]),onBlur:$,clearable:"","onClick:clear":l[3]||(l[3]=()=>{f.value="",$()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":$},null,8,["modelValue"])])]),e(se,{items:i.value,headers:h,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:k.value,options:d.value,"server-items-length":v.value,"items-per-page":d.value.itemsPerPage,page:d.value.page,"sort-by":d.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":$},{item:t(({item:a})=>{var c,E;return[y("tr",{class:de({"bg-product-expanded":w.value===a.id}),onClick:_=>Z(a.id),style:{cursor:"pointer"}},[y("td",null,A(a.name),1),y("td",null,A(((c=a.category)==null?void 0:c.name)??"-"),1),y("td",null,A(((E=a.brand)==null?void 0:E.name)??"-"),1),y("td",{onClick:l[4]||(l[4]=R(()=>{},["stop"]))},[e(C,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:R(_=>W(a),["stop"])},null,8,["onClick"]),e(C,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:R(_=>Q(a),["stop"])},null,8,["onClick"])])],10,Me),w.value===a.id?(O(),D("tr",Be,[y("td",Re,[e(se,{items:a.variants,headers:V,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:t(({item:_})=>[y("tr",{class:de(_.quantity<=_.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[y("td",null,A(_.sku),1),y("td",null,A(_.barcode),1),y("td",null,A(_.quantity),1),y("td",null,A(_.min_quantity),1),y("td",null,A(_.cost),1),y("td",null,A(_.wholesale_price),1),y("td",null,A(_.retail_price),1),y("td",null,A(_.discount),1),y("td",null,[e(Ue,{attributes:_.attributes,"font-size":"10px"},null,8,["attributes"])]),y("td",null,[y("div",null,[e(C,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:R(Ke=>X(_,a.id),["stop"])},{default:t(()=>[e(te,{size:"16"},{default:t(()=>l[9]||(l[9]=[U("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(C,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:t(()=>[e(te,{size:"16"},{default:t(()=>l[10]||(l[10]=[U("ri-delete-bin-line")])),_:1})]),_:1}),e(C,{size:"x-small",icon:"",color:"success",title:"طباعة"},{default:t(()=>[e(te,{size:"16"},{default:t(()=>l[11]||(l[11]=[U("ri-printer-line")])),_:1})]),_:1})])])],2)]),_:2},1032,["items"])])])):me("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(oe,{modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=a=>m.value=a),"max-width":"340"},{default:t(()=>[e(j,null,{default:t(()=>[e(K,null,{default:t(()=>l[12]||(l[12]=[U("تأكيد الحذف")])),_:1}),e(fe,null,{default:t(()=>l[13]||(l[13]=[U("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(ve,null,{default:t(()=>[e(C,{color:"error",onClick:Y,size:"small"},{default:t(()=>l[14]||(l[14]=[U("تأكيد")])),_:1}),e(C,{onClick:l[5]||(l[5]=a=>m.value=!1),size:"small"},{default:t(()=>l[15]||(l[15]=[U("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},We=J(Te,[["__scopeId","data-v-92b438d3"]]);export{We as default};
