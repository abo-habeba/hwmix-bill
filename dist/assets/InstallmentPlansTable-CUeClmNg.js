const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThermalInstallmentPrint-DzcSCscQ.js","assets/index-CrwZ4Pe6.js","assets/index-B17eNJ45.css","assets/ThermalInstallmentPrint-Bl1cRlaJ.css"])))=>i.map(i=>d[i]);
import{_ as q,r as d,h as K,P as O,c as h,d as a,j as l,az as S,X,F as $,aj as Y,o as c,a9 as p,a3 as V,b as i,a as v,aI as J,t as g,bm as Q,A as W,k as x,ar as D,q as k,a4 as P,a5 as r,U as Z,ao as ee,a1 as te,ap as ae,Y as le,z as ne,bf as se,aK as oe,T as ie,ag as re}from"./index-CrwZ4Pe6.js";import{_ as ue}from"./InfoDisplay-D-l4BTWH.js";import{P as de}from"./PayInstallmentDialog-ONyyW34K.js";const ce={class:"progress-bar-container"},me={class:"d-flex flex-wrap"},pe={key:0,class:"text-grey-darken-1"},fe={class:"text-end mt-2 me-4"},_e={__name:"InstallmentPlansTable",setup(ye){const B=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],w=d(null);function z(n,e){var s;w.value=(s=e==null?void 0:e.item)==null?void 0:s.id,console.log("Selected Row ID:",w.value)}const N=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status_label"},{title:"الإجراءات",key:"actions",sortable:!1}];function U(n){if(n&&n.id){const e=ne();let s="اسم الشركة";if(e.user&&e.user.companies&&e.user.company_id){const y=e.user.companies.find(C=>C.id===e.user.company_id);y&&(s=y.name)}const t=n,u=document.createElement("div");document.body.appendChild(u),se(()=>import("./ThermalInstallmentPrint-DzcSCscQ.js"),__vite__mapDeps([0,1,2,3])).then(y=>{const C=y.default,R=oe({render(){return ie(C,{installment:t,companyName:s,ref:"thermalRef"})},mounted(){re(()=>{this.$refs.thermalRef.printThermal&&this.$refs.thermalRef.printThermal(),setTimeout(()=>{R.unmount(),document.body.removeChild(u)},500)})}});R.mount(u)})}}const I=d([]),m=d([]),o=d({}),f=d(!1),F=d(null),b=d(!1),A=d(!0);function _(n){const e=parseFloat(n.total_installments_pay)||0,s=parseFloat(n.total_installments_amount)||1;return Math.min(Math.round(e/s*100),100)}function M(n){const e=_(n);return e===100?"#4CAF50":e>=50?"#2196F3":e>=20?"#FFC107":"#F44336"}const H=K(()=>o.value.start_date?new Date(o.value.start_date).toLocaleDateString("ar-EG"):"—");function T({item:n}){const e=parseFloat(n.remaining)||0,s=new Date(n.due_date),t=new Date;return s.setHours(0,0,0,0),t.setHours(0,0,0,0),n.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:e>0&&s<t?{style:{backgroundColor:"#EF9A9A"}}:e>0?{style:{backgroundColor:"#FFE082"}}:_(n)=="100"?{style:{backgroundColor:"#E8F5E9"}}:{}}function L(){Y("installment-plans",{per_page:-1},!0,!0,!1).then(n=>{I.value=n||[]})}function j(n){n.paid_installments.forEach(e=>{const s=m.value.findIndex(t=>t.id===e.id);s!==-1&&(m.value[s]={...m.value[s],...e})})}function G(n){!n||!Array.isArray(n.installments)||(o.value=n,console.log("currentPlan.value",o.value),m.value=n.installments,f.value=!0)}function E(n,e){F.value=n,A.value=e,b.value=!0}return O(L),(n,e)=>{const s=ue;return c(),h($,null,[a(S,{"fixed-header":"",headers:B,items:I.value,"item-value":"id","row-props":T,class:"elevation-1",density:"compact","hide-default-footer":"",hover:"","onClick:row":z},{"item.actions":l(({item:t})=>[a(p,{color:"primary",density:"compact",onClick:V(u=>G(t),["stop"])},{default:l(()=>e[4]||(e[4]=[i("عرض الأقساط")])),_:2},1032,["onClick"])]),"item.paid_percentage":l(({item:t})=>[v("div",ce,[v("div",{class:"progress-bar-fill",style:J({width:_(t)+"%",backgroundColor:M(t)})},g(_(t))+"% ",5)])]),"item.plan_products":l(({item:t})=>[a(Q,{column:""},{default:l(()=>[v("div",me,[(c(!0),h($,null,W(t.invoice_items.slice(0,2),u=>(c(),x(D,{key:u.id,size:"small",color:"info",variant:"outlined"},{default:l(()=>[i(g(u.name),1)]),_:2},1024))),128)),t.invoice_items.length>2?(c(),x(D,{key:0,class:"text-grey px-1"},{default:l(()=>[i("منتجات "+g(t.invoice_items.length-2)+" اخرين ",1)]),_:2},1024)):k("",!0)]),!t.invoice_items||t.invoice_items.length===0?(c(),h("span",pe,"لا توجد منتجات")):k("",!0)]),_:2},1024)]),"no-data":l(()=>[a(P,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>e[5]||(e[5]=[i("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items"]),a(X,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),"max-width":"900px",scrollable:""},{default:l(()=>[a(Z,null,{default:l(()=>[a(ee,{class:"bg-primary text-white"},{default:l(()=>e[6]||(e[6]=[i(" تفاصيل خطة التقسيط ")])),_:1}),a(te,{style:{"max-height":"70vh","overflow-y":"auto"}},{default:l(()=>[a(P,{class:"px-4 pt-4",dense:""},{default:l(()=>[a(r,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-user-line",label:"المستخدم",text:((t=o.value.user)==null?void 0:t.nickname)||"غير متوفر"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-file-text-line",label:"الفاتورة",text:((t=o.value.invoice)==null?void 0:t.invoice_number)||"—"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-calendar-line",label:"تاريخ الخطة",text:H.value},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-money-dollar-box-line",label:"إجمالي الفاتورة",text:o.value.total_amount},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-wallet-line",label:"إجمالي المتبقي",text:o.value.total_installments_remaining},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-coin-line",label:"إجمالي المدفوع",text:o.value.total_pay},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-heart-line",label:"المقدم",text:o.value.down_payment},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-list-ordered",label:"عدد الأقساط",text:((t=o.value.installments)==null?void 0:t.length)||0},null,8,["text"])]}),_:1})]),_:1}),a(S,{"row-props":T,headers:N,items:m.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":l(({item:t})=>[a(D,{color:t.status==="paid"?"success":"error",dark:""},{default:l(()=>[i(g(t.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[t.status!=="paid"?(c(),x(p,{key:0,color:t.status==="paid"?"grey":"success",disabled:t.status==="paid",density:"compact",class:"me-1",onClick:V(u=>E(t,!0),["stop"])},{default:l(()=>e[7]||(e[7]=[i(" دفع القسط ")])),_:2},1032,["color","disabled","onClick"])):k("",!0),t.status!=="paid"?(c(),x(p,{key:1,color:t.status==="paid"?"grey":"warning",disabled:t.status==="paid",density:"compact",onClick:V(u=>E(t,!1),["stop"])},{default:l(()=>e[8]||(e[8]=[i(" مبلغ مختلف ")])),_:2},1032,["color","disabled","onClick"])):k("",!0)]),"no-data":l(()=>[a(P,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>e[9]||(e[9]=[i(" لا توجد أقساط لهذه الخطة ")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),a(ae,{class:"bg-grey-lighten-4",style:{position:"sticky",bottom:"0","z-index":"1"}},{default:l(()=>[a(le),a(p,{"prepend-icon":"ri-close-line",text:"",onClick:e[0]||(e[0]=t=>f.value=!1)},{default:l(()=>e[10]||(e[10]=[i("إغلاق")])),_:1}),v("div",fe,[a(p,{"prepend-icon":"ri-printer-line",color:"primary",onClick:e[1]||(e[1]=t=>U(o.value))},{default:l(()=>e[11]||(e[11]=[i(" طباعة الخطة ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(de,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),installment:F.value,"direct-pay":A.value,"onUpdate:installment":j},null,8,["modelValue","installment","direct-pay"])],64)}}},ke=q(_e,[["__scopeId","data-v-384f7a00"]]);export{ke as default};
