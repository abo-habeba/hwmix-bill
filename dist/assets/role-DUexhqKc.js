import{g as se}from"./permissions-XJZ49INo.js";import{_ as te,S as oe,r as i,A as ie,w as ne,Q as re,ap as ue,aa as D,c as S,d as l,k as s,a4 as h,W as y,u as E,Y as G,o as m,a5 as U,a as v,Z as g,l as k,b as r,a9 as u,s as I,ak as de,aA as me,a6 as N,ai as z,t as $,N as B,a1 as R,a2 as ve,F,B as P,a8 as j,au as L,h as ce,$ as pe,aB as fe}from"./index-DmsAcnE9.js";const xe={class:"mx-auto mt-10 pa-10",style:{"max-width":"700px","background-color":"white"}},Ve={class:"d-flex gap-2"},ye={class:"text-subtitle-1 mr-2"},ge={__name:"role",setup(ke){ce();const{xs:O}=oe(),f=i(!1),x=i(!1),b=i(!1),c=i(!1),p=i(!1),C=i(""),T=i(!1),_=i(null),q=i({}),V=i([]),A=ie();ne(()=>A.user,a=>{a&&a.permissions&&(q.value=a.permissions,V.value=se(a.permissions),console.log("Permission Groups Initialized:",V.value))},{immediate:!0}),re(async()=>{f.value=!0,ue("roles").then(a=>{d.value=a.data,f.value=!1}).catch(a=>{f.value=!1,a.data&&a.data.error==="Unauthorized"||D.error("حدث خطأ أثناء جلب الأدوار")})});const M=i([{title:"اسم الدور",key:"name",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"center"},{title:"الإجراءات",key:"actions",align:"center",sortable:!1}]),d=i([]),o=i({id:null,name:"",permissions:[]}),Q=[a=>!!a||"اسم الدور مطلوب",a=>a.length>=3||"يجب أن يكون الاسم 3 أحرف على الأقل"],W=a=>!a.permissions||a.permissions.length===0?!1:a.permissions.every(e=>o.value.permissions.includes(e.value)),Y=(a,e)=>{const t=new Set(o.value.permissions);e?a.permissions.forEach(n=>{t.add(n.value)}):a.permissions.forEach(n=>{t.delete(n.value)}),o.value.permissions=Array.from(t)},Z=a=>{},H=()=>{o.value={id:null,name:"",permissions:[]},c.value=!0},w=()=>{var a;c.value=!1,o.value={id:null,name:"",permissions:[]},(a=_.value)==null||a.resetValidation()},J=a=>{o.value={...a,permissions:[...a.permissions]},c.value=!0},K=a=>{o.value={...a},p.value=!0},X=async()=>{x.value=!0;const{valid:a}=await _.value.validate();if(!a){D.error("يرجى تعبئة جميع الحقول المطلوبة بشكل صحيح"),x.value=!1;return}try{const e=await pe("role",o.value,o.value.id);if(o.value.id){let t=d.value.findIndex(n=>n.id===e.id);t!==-1&&Object.assign(d.value[t],e)}else d.value.push(e);w()}catch(e){console.error("Error saving role:",e),D.error("حدث خطأ أثناء حفظ الدور")}finally{x.value=!1}},ee=async()=>{b.value=!0;try{await fe("role",o.value.id),d.value=d.value.filter(a=>a.id!==o.value.id)}catch(a){console.error("Error deleting role:",a)}finally{p.value=!1,b.value=!1}};return(a,e)=>(m(),S("div",xe,[l(h,null,{default:s(()=>[l(U,{cols:"12",class:"d-flex align-center"},{default:s(()=>[e[9]||(e[9]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold"},"إدارة الأدوار"),v("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"},"قم بإدارة أدوار المستخدمين وصلاحياتهم في النظام")],-1)),l(g),E(A).can(["roles_create","super_admin","company_owner"])?(m(),k(u,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:e[0]||(e[0]=t=>H()),elevation:"2",size:"large"},{default:s(()=>e[8]||(e[8]=[r(" دور جديد ")])),_:1})):I("",!0)]),_:1})]),_:1}),l(y,{elevation:"2"},{default:s(()=>[l(de,{headers:M.value,items:d.value,loading:f.value,search:C.value,hover:"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة"},{top:s(()=>[l(me,{color:"transparent"},{default:s(()=>[l(N,{class:"ma-10",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":""},null,8,["modelValue"])]),_:1})]),"item.actions":s(({item:t})=>[v("div",Ve,[l(u,{icon:"ri-pencil-line",color:"primary",size:"small",variant:"text",onClick:n=>J(t)},null,8,["onClick"]),l(u,{icon:"ri-delete-bin-line",color:"error",size:"small",variant:"text",onClick:n=>K(t)},null,8,["onClick"])])]),_:1},8,["headers","items","loading","search"])]),_:1}),l(G,{fullscreen:E(O),modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),"max-width":"700",persistent:""},{default:s(()=>[l(y,{style:{position:"relative"}},{default:s(()=>[v("div",{onClick:w,style:{position:"fixed",top:"5px",left:"5px","z-index":"100"}},[l(u,{icon:"ri-close-line",variant:"text",color:"grey-darken-1"})]),l(z,{class:"text-h5"},{default:s(()=>[r($(o.value.id?"تعديل دور":"إضافة دور جديد")+" ",1),l(g)]),_:1}),l(B),l(R,null,{default:s(()=>[l(ve,{ref_key:"form",ref:_,modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=t=>T.value=t)},{default:s(()=>[l(N,{modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.name=t),label:"اسم الدور",rules:Q,required:"",variant:"outlined",density:"comfortable",class:"mb-4"},null,8,["modelValue"]),l(B,{class:"my-4"}),e[10]||(e[10]=v("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)),V.value?(m(),k(h,{key:0,class:"mb-10"},{default:s(()=>[(m(!0),S(F,null,P(V.value,t=>(m(),k(U,{class:"pa-0",key:t.name,cols:"12"},{default:s(()=>[l(y,{variant:"outlined",class:"mb-4"},{default:s(()=>[l(z,{class:"py-2 px-2 bg-grey-lighten-4 d-flex align-center"},{default:s(()=>[l(j,{"model-value":W(t),"onUpdate:modelValue":n=>Y(t,n),"hide-details":"",color:"primary",class:"ma-0 pa-0"},null,8,["model-value","onUpdate:modelValue"]),v("span",ye,$(t.name),1),l(g)]),_:2},1024),l(R,null,{default:s(()=>[l(h,null,{default:s(()=>[(m(!0),S(F,null,P(t.permissions,(n,le)=>(m(),k(U,{class:"py-0 px-3",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:le},{default:s(()=>[l(j,{modelValue:o.value.permissions,"onUpdate:modelValue":[e[3]||(e[3]=ae=>o.value.permissions=ae),()=>Z(t)],label:n.name,value:n.value,density:"comfortable",color:"primary",class:"permission-checkbox py-0 px-3","hide-details":""},null,8,["modelValue","label","value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),l(B),l(L,{style:{position:"sticky",bottom:"0","background-color":"white","z-index":"5"},class:"pa-4 d-flex justify-center"},{default:s(()=>[l(u,{"append-icon":"ri-close-line",color:"error",variant:"text",onClick:w,class:"mx-2"},{default:s(()=>e[11]||(e[11]=[r(" إلغاء ")])),_:1}),l(u,{"append-icon":"ri-save-line",color:"primary",loading:x.value,onClick:X,class:"mx-2"},{default:s(()=>e[12]||(e[12]=[r(" حفظ ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"]),l(G,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value=t),"max-width":"400"},{default:s(()=>[l(y,null,{default:s(()=>[l(z,{class:"text-h5 pa-4"},{default:s(()=>e[13]||(e[13]=[r(" تأكيد الحذف ")])),_:1}),l(R,{class:"pa-4"},{default:s(()=>e[14]||(e[14]=[r(" هل أنت متأكد من حذف هذا الدور؟ لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),l(L,{class:"pa-4"},{default:s(()=>[l(g),l(u,{color:"grey-darken-1",variant:"text",onClick:e[6]||(e[6]=t=>p.value=!1)},{default:s(()=>e[15]||(e[15]=[r(" إلغاء ")])),_:1}),l(u,{color:"error",loading:b.value,onClick:ee},{default:s(()=>e[16]||(e[16]=[r(" حذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},_e=te(ge,[["__scopeId","data-v-2b9d9561"]]);export{_e as default};
