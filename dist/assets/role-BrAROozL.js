import{_ as ae,S as se,r as i,A as te,w as oe,Q as ie,ap as ne,aa as D,c as S,d as l,k as s,a4 as U,W as V,u as N,Y as $,o as m,a5 as h,a as v,Z as y,l as g,b as r,a9 as u,s as A,ak as re,aB as ue,a6 as F,ai as B,t as de,N as z,a1 as R,a2 as me,F as G,B as I,a8 as P,au as j,h as ve,av as ce,$ as pe,aC as fe}from"./index-B-osrc5p.js";const xe={class:"mx-auto mt-10 pa-10",style:{"max-width":"700px","background-color":"white"}},Ve={class:"d-flex gap-2"},ye={__name:"role",setup(ge){ve();const{xs:L}=se(),f=i(!1),x=i(!1),k=i(!1),c=i(!1),p=i(!1),b=i(""),T=i(!1),C=i(null),O=i({}),w=i([]),E=te();oe(()=>E.user,async a=>{a&&a.permissions&&(O.value=a.permissions,w.value=await ce(a.permissions))},{immediate:!0}),ie(async()=>{f.value=!0,ne("roles").then(a=>{d.value=a.data,f.value=!1}).catch(a=>{f.value=!1,a.data&&a.data.error==="Unauthorized"||D.error("حدث خطأ أثناء جلب الأدوار")})});const q=i([{title:"اسم الدور",key:"name",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"center"},{title:"الإجراءات",key:"actions",align:"center",sortable:!1}]),d=i([]),o=i({id:null,name:"",permissions:[]}),M=[a=>!!a||"اسم الدور مطلوب",a=>a.length>=3||"يجب أن يكون الاسم 3 أحرف على الأقل"],Q=a=>!a.permissions||a.permissions.length===0?!1:a.permissions.every(e=>o.value.permissions.includes(e.value)),W=(a,e)=>{const t=new Set(o.value.permissions);e?a.permissions.forEach(n=>{t.add(n.value)}):a.permissions.forEach(n=>{t.delete(n.value)}),o.value.permissions=Array.from(t)},Y=a=>{},Z=()=>{o.value={id:null,name:"",permissions:[]},c.value=!0},_=()=>{var a;c.value=!1,o.value={id:null,name:"",permissions:[]},(a=C.value)==null||a.resetValidation()},H=a=>{o.value={...a,permissions:[...a.permissions]},c.value=!0},J=a=>{o.value={...a},p.value=!0},K=async()=>{x.value=!0;const{valid:a}=await C.value.validate();if(!a){D.error("يرجى تعبئة جميع الحقول المطلوبة بشكل صحيح"),x.value=!1;return}try{const e=await pe("role",o.value,o.value.id);if(o.value.id){let t=d.value.findIndex(n=>n.id===e.id);t!==-1&&Object.assign(d.value[t],e)}else d.value.push(e);_()}catch(e){console.error("Error saving role:",e),D.error("حدث خطأ أثناء حفظ الدور")}finally{x.value=!1}},X=async()=>{k.value=!0;try{await fe("role",o.value.id),d.value=d.value.filter(a=>a.id!==o.value.id)}catch(a){console.error("Error deleting role:",a)}finally{p.value=!1,k.value=!1}};return(a,e)=>(m(),S("div",xe,[l(U,null,{default:s(()=>[l(h,{cols:"12",class:"d-flex align-center"},{default:s(()=>[e[9]||(e[9]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold"},"إدارة الأدوار"),v("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"},"قم بإدارة أدوار المستخدمين وصلاحياتهم في النظام")],-1)),l(y),N(E).can(["roles.create","admin.super","company.owner"])?(m(),g(u,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:e[0]||(e[0]=t=>Z()),elevation:"2",size:"large"},{default:s(()=>e[8]||(e[8]=[r(" دور جديد ")])),_:1})):A("",!0)]),_:1})]),_:1}),l(V,{elevation:"2"},{default:s(()=>[l(re,{headers:q.value,items:d.value,loading:f.value,search:b.value,hover:"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة"},{top:s(()=>[l(ue,{color:"transparent"},{default:s(()=>[l(F,{class:"ma-10",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":""},null,8,["modelValue"])]),_:1})]),"item.actions":s(({item:t})=>[v("div",Ve,[l(u,{icon:"ri-pencil-line",color:"primary",size:"small",variant:"text",onClick:n=>H(t)},null,8,["onClick"]),l(u,{icon:"ri-delete-bin-line",color:"error",size:"small",variant:"text",onClick:n=>J(t)},null,8,["onClick"])])]),_:1},8,["headers","items","loading","search"])]),_:1}),l($,{fullscreen:N(L),modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),"max-width":"700",persistent:""},{default:s(()=>[l(V,{style:{position:"relative"}},{default:s(()=>[v("div",{onClick:_,style:{position:"fixed",top:"5px",left:"5px","z-index":"100"}},[l(u,{icon:"ri-close-line",variant:"text",color:"grey-darken-1"})]),l(B,{class:"text-h5"},{default:s(()=>[r(de(o.value.id?"تعديل دور":"إضافة دور جديد")+" ",1),l(y)]),_:1}),l(z),l(R,null,{default:s(()=>[l(me,{ref_key:"form",ref:C,modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=t=>T.value=t)},{default:s(()=>[l(F,{modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.name=t),label:"اسم الدور",rules:M,required:"",variant:"outlined",density:"comfortable",class:"mb-4"},null,8,["modelValue"]),l(z,{class:"my-4"}),e[10]||(e[10]=v("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)),w.value?(m(),g(U,{key:0,class:"mb-10"},{default:s(()=>[(m(!0),S(G,null,I(w.value,t=>(m(),g(h,{class:"pa-0",key:t.name,cols:"12"},{default:s(()=>[l(V,{variant:"outlined",class:"mb-4"},{default:s(()=>[l(B,{class:"py-2 px-2 bg-grey-lighten-4 d-flex align-center"},{default:s(()=>[l(P,{"model-value":Q(t),label:t.name,"onUpdate:modelValue":n=>W(t,n),"hide-details":"",color:"primary",class:"ma-0 pa-0"},null,8,["model-value","label","onUpdate:modelValue"]),l(y)]),_:2},1024),l(R,null,{default:s(()=>[l(U,null,{default:s(()=>[(m(!0),S(G,null,I(t.permissions,(n,ee)=>(m(),g(h,{class:"py-0 px-3",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:ee},{default:s(()=>[l(P,{modelValue:o.value.permissions,"onUpdate:modelValue":[e[3]||(e[3]=le=>o.value.permissions=le),()=>Y(t)],label:n.label,value:n.value,density:"comfortable",color:"primary",class:"permission-checkbox py-0 px-3","hide-details":""},null,8,["modelValue","label","value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):A("",!0)]),_:1},8,["modelValue"])]),_:1}),l(z),l(j,{style:{position:"sticky",bottom:"0","background-color":"white","z-index":"5"},class:"pa-4 d-flex justify-center"},{default:s(()=>[l(u,{"append-icon":"ri-close-line",color:"error",variant:"text",onClick:_,class:"mx-2"},{default:s(()=>e[11]||(e[11]=[r(" إلغاء ")])),_:1}),l(u,{"append-icon":"ri-save-line",color:"primary",loading:x.value,onClick:K,class:"mx-2"},{default:s(()=>e[12]||(e[12]=[r(" حفظ ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"]),l($,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value=t),"max-width":"400"},{default:s(()=>[l(V,null,{default:s(()=>[l(B,{class:"text-h5 pa-4"},{default:s(()=>e[13]||(e[13]=[r(" تأكيد الحذف ")])),_:1}),l(R,{class:"pa-4"},{default:s(()=>e[14]||(e[14]=[r(" هل أنت متأكد من حذف هذا الدور؟ لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),l(j,{class:"pa-4"},{default:s(()=>[l(y),l(u,{color:"grey-darken-1",variant:"text",onClick:e[6]||(e[6]=t=>p.value=!1)},{default:s(()=>e[15]||(e[15]=[r(" إلغاء ")])),_:1}),l(u,{color:"error",loading:k.value,onClick:X},{default:s(()=>e[16]||(e[16]=[r(" حذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},be=ae(ye,[["__scopeId","data-v-6e0933a5"]]);export{be as default};
