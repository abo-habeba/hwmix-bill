import{_ as ee,S as se,r as f,w as N,Q as le,ah as S,o as b,m as z,n as l,d as e,X as H,a2 as v,aa as R,a as r,t as m,a1 as ae,q as G,u as W,ak as ne,a7 as x,a8 as n,al as k,aG as j,aH as X,au as Z,aI as J,b as p,c as K,F as te,C as ue,N as ie,Z as oe,a0 as re,ay as ce,ac as Y,an as A,ad as me,V as O,v as pe,aq as fe,aF as ve,aE as h}from"./index-Cdh-_j1X.js";const Ve={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(F,{emit:C}){const U=F,w=C,{xs:_}=se(),V=f(U.dialog),y=f(null),g=f(!1),d=f({name:"",slug:"",is_active:!0,featured:!1,is_returnable:!0,description:"",description_long:"",category_id:null,brand_id:null,warehouse_id:null,variants:[{attributes:[{attribute_id:null,attribute_value_id:null}],dimensions:"",discount:null,expiry_date:"",image_url:"",status:"active",tax_rate:null}]}),M=f([]),D=f([]),P=f([]),E={name:[u=>!!u||"اسم المنتج مطلوب",u=>typeof u=="string"&&u.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[u=>!u||typeof u=="string"||"الوصف يجب أن يكون نصًا"],description_long:[u=>!u||typeof u=="string"||"الوصف المفصل يجب أن يكون نصًا"]};N(()=>U.dialog,u=>V.value=u),N(V,u=>w("update:dialog",u)),N(()=>U.product,u=>{u&&Object.keys(u).length&&(d.value={...u})}),le(()=>{T(),I(),$()});function T(){S("brands").then(u=>{M.value=u.data})}function I(){S("warehouses").then(u=>{D.value=u.data})}function $(){S("categories").then(u=>{P.value=u.data})}function q(){w("close"),V.value=!1}function c(){d.value.variants.push({attributes:[{attribute_id:null,attribute_value_id:null}],dimensions:"",discount:null,expiry_date:"",image_url:"",status:"active",tax_rate:null})}function o(u){d.value.variants.splice(u,1)}function i(){y.value&&y.value.validate().then(async({valid:u})=>{if(u)try{const t=await re("product",d.value,d.value.id||!1);w("saved",t.data),q()}catch{}})}return(u,t)=>(b(),z(oe,{fullscreen:W(_),modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a)},{default:l(()=>[e(H,null,{default:l(()=>[e(v,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:q}),e(R,{class:"ma-5 text-center"},{default:l(()=>[r("h2",null,m(F.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(ae,{class:G(W(_)?"px-2":"px-5")},{default:l(()=>[e(ne,{ref_key:"productForm",ref:y,modelValue:g.value,"onUpdate:modelValue":t[9]||(t[9]=a=>g.value=a)},{default:l(()=>[e(x,{class:"elevation-10 my-3"},{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value.name=a),label:"اسم المنتج",rules:E.name,required:""},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(x,null,{default:l(()=>[e(n,null,{default:l(()=>[e(j,{modelValue:d.value.is_active,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value.is_active=a),label:"نشط",color:d.value.is_active?"primary":"grey"},null,8,["modelValue","color"])]),_:1}),e(n,null,{default:l(()=>[e(j,{modelValue:d.value.featured,"onUpdate:modelValue":t[2]||(t[2]=a=>d.value.featured=a),label:"مميز",color:d.value.featured?"primary":"grey"},null,8,["modelValue","color"])]),_:1}),e(n,null,{default:l(()=>[e(j,{modelValue:d.value.is_returnable,"onUpdate:modelValue":t[3]||(t[3]=a=>d.value.is_returnable=a),label:"قابل للإرجاع",color:d.value.is_returnable?"primary":"grey"},null,8,["modelValue","color"])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(x,null,{default:l(()=>[e(n,null,{default:l(()=>[e(X,{modelValue:d.value.category_id,"onUpdate:modelValue":t[4]||(t[4]=a=>d.value.category_id=a),"item-value":"id","item-title":"name",items:P.value||[],label:"الفئة",rules:[a=>!!a||"الفئة مطلوبة"],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(n,{class:"px-0"},{default:l(()=>[e(X,{modelValue:d.value.brand_id,"onUpdate:modelValue":t[5]||(t[5]=a=>d.value.brand_id=a),"item-value":"id","item-title":"name",items:M.value||[],label:"العلامة التجارية"},null,8,["modelValue","items"])]),_:1}),e(n,null,{default:l(()=>[D.value.length?(b(),z(Z,{key:0,modelValue:d.value.warehouse_id,"onUpdate:modelValue":t[6]||(t[6]=a=>d.value.warehouse_id=a),"item-value":"id","item-title":"name",items:D.value||[],label:"المخزن",required:""},null,8,["modelValue","items"])):(b(),z(Z,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,required:""}))]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(J,{rows:"1","auto-grow":"",modelValue:d.value.description,"onUpdate:modelValue":t[7]||(t[7]=a=>d.value.description=a),label:"الوصف القصير",rules:E.description},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(J,{rows:"2","auto-grow":"",modelValue:d.value.description_long,"onUpdate:modelValue":t[8]||(t[8]=a=>d.value.description_long=a),label:"الوصف المفصل",rules:E.description_long},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(R,null,{default:l(()=>t[11]||(t[11]=[p(" تفاصيل المنتج الإضافية ")])),_:1}),(b(!0),K(te,null,ue(d.value.variants,(a,B)=>(b(),z(x,{class:"elevation-10 my-5",key:B},{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"4"},{default:l(()=>[e(k,{modelValue:a.purchase_price,"onUpdate:modelValue":s=>a.purchase_price=s,label:"سعر الشراء",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(n,{cols:"4"},{default:l(()=>[e(k,{modelValue:a.retail_price,"onUpdate:modelValue":s=>a.retail_price=s,label:"سعر التجزئة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(n,{cols:"4"},{default:l(()=>[e(k,{modelValue:a.wholesale_price,"onUpdate:modelValue":s=>a.wholesale_price=s,label:"سعر الجملة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(n,{cols:"12"},{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"6"},{default:l(()=>[e(k,{modelValue:a.tax_rate,"onUpdate:modelValue":s=>a.tax_rate=s,label:"نسبة الضريبة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(n,{cols:"6"},{default:l(()=>[e(k,{modelValue:a.discount,"onUpdate:modelValue":s=>a.discount=s,label:"الخصم",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(n,{class:"py-0",cols:"12"},{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"6"},{default:l(()=>[e(k,{modelValue:a.expiry_date,"onUpdate:modelValue":s=>a.expiry_date=s,label:"تاريخ الانتهاء",type:"date"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(n,{cols:"6"},{default:l(()=>[e(k,{modelValue:a.image_url,"onUpdate:modelValue":s=>a.image_url=s,label:"رابط الصورة"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(n,{cols:"12"},{default:l(()=>[e(v,{variant:"text",color:"primary",onClick:c},{default:l(()=>t[12]||(t[12]=[p("+ إضافة تفاصيل جديدة")])),_:1}),e(v,{variant:"text",color:"error",onClick:s=>o(B)},{default:l(()=>t[13]||(t[13]=[p("حذف التفاصيل")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(ie,{class:"my-4"}),e(x,null,{default:l(()=>[e(n,{cols:"6"},{default:l(()=>[e(v,{"prepend-icon":"ri-close-line",color:"error",onClick:q},{default:l(()=>t[14]||(t[14]=[p(" إلغاء ")])),_:1})]),_:1}),e(n,{cols:"6",class:"text-center"},{default:l(()=>[e(v,{"prepend-icon":"ri-save-line",color:"success",class:G({"forbidden-cursor":!g.value}),onClick:i},{default:l(()=>[p(m(F.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})]),_:1},8,["fullscreen","modelValue"]))}},_e=ee(Ve,[["__scopeId","data-v-cf5ec4f9"]]),ye={class:"d-flex align-center justify-space-between mb-2"},be=["onClick"],ge={key:0,class:"variant-table-bg"},xe={colspan:"5",class:"pa-0"},ke={__name:"products",setup(F){const C=f(!1),U=f({}),w=f(!1),_=f([]),V=f(!1),y=f(null),g=f(null),d=[{title:"الاسم",key:"name"},{title:"الكمية",key:"stock_quantity"},{title:"الفئة",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],M=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"سعر الشراء",key:"purchase_price"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر التجزئة",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];le(()=>{D()});function D(){S("products").then(c=>{_.value=c.data})}function P(){U.value={},w.value=!1,C.value=!0}function E(c){U.value={...c},w.value=!0,C.value=!0}function T(c){const o=_.value.findIndex(i=>i.id===c.id);o!==-1?_.value[o]=c:_.value.push(c),C.value=!1}function I(c){y.value=c,V.value=!0}function $(){y.value&&ve("product-variant",y.value.id).then(()=>{_.value=_.value.filter(c=>c.id!==y.value.id),h.success("تم حذف المنتج بنجاح"),V.value=!1,y.value=null}).catch(()=>h.error("حدث خطأ أثناء حذف المنتج"))}function q(c){g.value=g.value===c?null:c}return(c,o)=>(b(),z(ce,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(_e,{dialog:C.value,"onUpdate:dialog":o[0]||(o[0]=i=>C.value=i),product:U.value,isEditMode:w.value,onSaved:T},null,8,["dialog","product","isEditMode"]),e(H,{class:"pa-2"},{default:l(()=>[r("div",ye,[o[5]||(o[5]=r("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(v,{color:"primary",onClick:P,size:"small"},{default:l(()=>o[4]||(o[4]=[p("+ إضافة منتج")])),_:1})]),e(Y,{items:_.value,headers:d,"item-key":"id",class:"text-start th-no-padding",density:"compact",style:{direction:"rtl"},"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}"},{item:l(({item:i})=>{var u,t,a,B;return[r("tr",{class:G({"expanded-row":g.value===i.id}),onClick:s=>q(i.id),style:{cursor:"pointer"}},[r("td",null,m(i.name),1),r("td",null,m(i.stock_quantity??((t=(u=i.variants)==null?void 0:u[0])==null?void 0:t.stock_quantity)??"-"),1),r("td",null,m(((a=i.category)==null?void 0:a.name)||"-"),1),r("td",null,m(((B=i.brand)==null?void 0:B.name)||"-"),1),r("td",{onClick:o[1]||(o[1]=A(()=>{},["stop"]))},[e(v,{size:"x-small",icon:"ri-edit-line",color:"blue",onClick:A(s=>E(i),["stop"])},null,8,["onClick"]),e(v,{size:"x-small",icon:"ri-delete-bin-line",color:"red",onClick:A(s=>I(i),["stop"])},null,8,["onClick"])])],10,be),g.value===i.id?(b(),K("tr",ge,[r("td",xe,[e(Y,{items:i.variants,headers:M,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:s})=>[r("tr",null,[r("td",null,m(s.sku),1),r("td",null,m(s.barcode),1),r("td",null,m(s.purchase_price),1),r("td",null,m(s.wholesale_price),1),r("td",null,m(s.retail_price),1),r("td",null,m(s.discount),1),r("td",null,[(b(!0),K(te,null,ue(s.attributes,(L,de)=>(b(),z(me,{key:de,size:"x-small"},{default:l(()=>{var Q;return[p(m(L.name)+": "+m(((Q=L.value)==null?void 0:Q.name)||"-"),1)]}),_:2},1024))),128))]),r("td",null,[e(v,{size:"x-small",icon:"",color:"blue",title:"تعديل"},{default:l(()=>[e(O,{size:"16"},{default:l(()=>o[6]||(o[6]=[p("ri-edit-line")])),_:1})]),_:1}),e(v,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(O,{size:"16"},{default:l(()=>o[7]||(o[7]=[p("ri-delete-bin-line")])),_:1})]),_:1}),e(v,{size:"x-small",icon:"",color:"success",title:"طباعة"},{default:l(()=>[e(O,{size:"16"},{default:l(()=>o[8]||(o[8]=[p("ri-printer-line")])),_:1})]),_:1})])])]),_:2},1032,["items"])])])):pe("",!0)]}),_:1},8,["items"])]),_:1}),e(oe,{modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=i=>V.value=i),"max-width":"340"},{default:l(()=>[e(H,null,{default:l(()=>[e(R,null,{default:l(()=>o[9]||(o[9]=[p("تأكيد الحذف")])),_:1}),e(ae,null,{default:l(()=>o[10]||(o[10]=[p("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(fe,null,{default:l(()=>[e(v,{color:"error",onClick:$,size:"small"},{default:l(()=>o[11]||(o[11]=[p("تأكيد")])),_:1}),e(v,{onClick:o[2]||(o[2]=i=>V.value=!1),size:"small"},{default:l(()=>o[12]||(o[12]=[p("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ue=ee(ke,[["__scopeId","data-v-11b11397"]]);export{Ue as default};
