import{_ as M,o as C,l as N,k as t,a as y,d as e,aI as te,a4 as E,a5 as m,a6 as O,az as I,aH as me,c as z,b as k,aJ as oe,F as R,B as L,aK as ue,a9 as h,s as ce,W as j,S as ge,r as g,w as K,ah as fe,Q as pe,ap as J,ai as G,t as $,a1 as ve,a2 as _e,aL as xe,N as be,au as ye,Y as ie,$ as se,j as we,I as ke,n as he,a7 as Ue,ak as de,a3 as T,q as ne,V as ae,aG as Ce,aa as re,aM as Oe,U as Se}from"./index-eQY_ApO-.js";import{_ as qe}from"./AttributesDisplay-BdFmkGun.js";import{P as Pe}from"./ProductSticker-eXCQGoDw.js";const $e={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Ae={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(o,{emit:P}){return(b,i)=>(C(),N(me,null,{default:t(()=>[y("div",$e,[y("div",null,[e(te,{modelValue:o.modelValue.active,"onUpdate:modelValue":i[0]||(i[0]=s=>o.modelValue.active=s),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),y("div",null,[e(te,{modelValue:o.modelValue.featured,"onUpdate:modelValue":i[1]||(i[1]=s=>o.modelValue.featured=s),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),y("div",null,[e(te,{modelValue:o.modelValue.returnable,"onUpdate:modelValue":i[2]||(i[2]=s=>o.modelValue.returnable=s),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(E,{dense:""},{default:t(()=>[e(m,{cols:"12",sm:"12"},{default:t(()=>[e(O,{modelValue:o.modelValue.name,"onUpdate:modelValue":i[3]||(i[3]=s=>o.modelValue.name=s),label:"اسم المنتج",rules:o.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(I,{modelValue:o.modelValue.category_id,"onUpdate:modelValue":i[4]||(i[4]=s=>o.modelValue.category_id=s),items:o.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(I,{modelValue:o.modelValue.brand_id,"onUpdate:modelValue":i[5]||(i[5]=s=>o.modelValue.brand_id=s),items:o.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"12"},{default:t(()=>[e(O,{modelValue:o.modelValue.desc,"onUpdate:modelValue":i[6]||(i[6]=s=>o.modelValue.desc=s),label:"الوصف",rules:o.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",sm:"12"},{default:t(()=>[e(O,{modelValue:o.modelValue.desc_long,"onUpdate:modelValue":i[7]||(i[7]=s=>o.modelValue.desc_long=s),label:"الوصف المفصل",rules:o.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},Ee=M(Ae,[["__scopeId","data-v-c923be84"]]),Ne={__name:"ProductVariantAttributesForm",props:{modelValue:Array,attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:P}){const b=o,i=P;function s(x){const n=b.attributes.find(f=>f.id===x);return n?n.values:[]}function c(x,n){const f=s(x).find(p=>p.id===n);return f&&f.color?`background:${f.color};color:${S(f.color)};border-radius:6px;`:""}function S(x){if(!x)return"#000";const n=x.substring(1),f=parseInt(n,16),p=f>>16&255,d=f>>8&255,r=f>>0&255;return .299*p+.587*d+.114*r>186?"#000":"#fff"}function _(){const x={attribute_id:null,attribute_value_id:null};i("update:modelValue",[...b.modelValue,x])}function v(x){const n=[...b.modelValue];n.splice(x,1),i("update:modelValue",n)}return(x,n)=>(C(),z(R,null,[e(oe,{class:"ma-2"},{default:t(()=>n[0]||(n[0]=[k("الخصائص (Attributes)")])),_:1}),(C(!0),z(R,null,L(o.modelValue,(f,p)=>(C(),N(E,{dense:"",key:p,class:"d-flex align-center"},{default:t(()=>[e(m,{cols:"5"},{default:t(()=>[e(I,{modelValue:f.attribute_id,"onUpdate:modelValue":[d=>f.attribute_id=d,()=>f.attribute_value_id=null],items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(m,{cols:"5"},{default:t(()=>[e(I,{modelValue:f.attribute_value_id,"onUpdate:modelValue":d=>f.attribute_value_id=d,items:s(f.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!f.attribute_id,"hide-details":"auto",style:ue(c(f.attribute_id,f.attribute_value_id))},null,8,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(m,{cols:"2"},{default:t(()=>[e(h,{class:"ma-0 pa-0",icon:"ri-delete-bin-line",color:"error",size:"x-small",onClick:d=>v(p)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-1 pa-1",text:"",color:"primary",small:"",onClick:_},{default:t(()=>n[1]||(n[1]=[k("+ إضافة خاصية")])),_:1})],64))}},Fe=M(Ne,[["__scopeId","data-v-6ebc13d6"]]),Ie={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(o,{emit:P}){const b=o,i=P,s=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function c(S){if(b.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const _=[...b.modelValue];_.splice(S,1),i("update:modelValue",_)}return(S,_)=>(C(),z(R,null,[e(oe,{class:"ma-2"},{default:t(()=>_[1]||(_[1]=[k("المخزون")])),_:1}),(C(!0),z(R,null,L(o.modelValue,(v,x)=>(C(),N(E,{dense:"",key:v.id||x},{default:t(()=>[e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(O,{modelValue:v.cost,"onUpdate:modelValue":n=>v.cost=n,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:o.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(O,{modelValue:v.quantity,"onUpdate:modelValue":n=>v.quantity=n,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:o.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[o.warehouses&&o.warehouses.length>0?(C(),N(I,{key:0,modelValue:v.warehouse_id,"onUpdate:modelValue":n=>v.warehouse_id=n,"item-value":"id","item-title":"name",items:o.warehouses,label:"المخزن",rules:[n=>!!n||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(C(),N(I,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[n=>!!n||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(I,{modelValue:v.status,"onUpdate:modelValue":n=>v.status=n,items:s,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[n=>!!n||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(O,{modelValue:v.expiry,"onUpdate:modelValue":n=>v.expiry=n,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(O,{modelValue:v.loc,"onUpdate:modelValue":n=>v.loc=n,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),o.modelValue.length>1?(C(),N(h,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:_[0]||(_[0]=v=>c(S.sIndex))})):ce("",!0)],64))}},De=M(Ie,[["__scopeId","data-v-382b902c"]]),ze={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(o,{emit:P}){return(b,i)=>(C(),N(E,null,{default:t(()=>[e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(O,{modelValue:o.variant.retail_price,"onUpdate:modelValue":i[0]||(i[0]=s=>o.variant.retail_price=s),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(O,{modelValue:o.variant.wholesale_price,"onUpdate:modelValue":i[1]||(i[1]=s=>o.variant.wholesale_price=s),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(I,{modelValue:o.variant.status,"onUpdate:modelValue":i[2]||(i[2]=s=>o.variant.status=s),items:o.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(O,{modelValue:o.variant.min_quantity,"onUpdate:modelValue":i[3]||(i[3]=s=>o.variant.min_quantity=s),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(j,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e(Fe,{modelValue:o.variant.attributes,"onUpdate:modelValue":i[4]||(i[4]=s=>o.variant.attributes=s),attributes:o.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(m,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(j,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e(De,{modelValue:o.variant.stocks,"onUpdate:modelValue":i[5]||(i[5]=s=>o.variant.stocks=s),warehouses:o.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(m,{cols:"12",class:"my-2 py-1"},{default:t(()=>[e(h,{color:"error",onClick:i[6]||(i[6]=s=>b.$emit("remove-variant",o.variantIndex))},{default:t(()=>i[7]||(i[7]=[k("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},je=M(ze,[["__scopeId","data-v-7876a012"]]),Me={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(o,{emit:P}){const b=o,i=P;ge();const s=g(b.dialog),c=g(null),S=g(!1),_=g([]),v=g([]),x=g([]),n=g([]),f=a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",p=a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",d=a=>typeof a=="number"&&!isNaN(a)&&a!==null||"مطلوب ويجب أن يكون رقمًا",r={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},w=g(JSON.parse(JSON.stringify(r)));function V(a){return{id:a.id,name:a.name||"",active:a.active??!0,featured:a.featured??!1,returnable:a.returnable??!0,desc:a.desc||"",desc_long:a.desc_long||"",category_id:a.category_id||null,brand_id:a.brand_id||null,variants:(a.variants||[]).map(l=>({id:l.id,barcode:l.barcode||"",sku:l.sku||"",retail_price:parseFloat(l.retail_price)||0,wholesale_price:parseFloat(l.wholesale_price)||0,image:l.image||null,weight:parseFloat(l.weight)||0,dimensions:l.dimensions||"",min_quantity:l.min_quantity||"",tax:parseFloat(l.tax)||0,discount:parseFloat(l.discount)||0,status:l.status||"active",attributes:(l.attributes||[]).map(u=>({attribute_id:u.attribute_id||null,attribute_value_id:u.attribute_value_id||null})),stocks:(l.stocks||[]).map(u=>({id:u.id,quantity:u.quantity||0,reserved:u.reserved||0,min_quantity:u.min_quantity||0,cost:parseFloat(u.cost)||0,batch:u.batch||"",expiry:u.expiry?new Date(u.expiry).toISOString().substr(0,10):null,loc:u.loc||"",status:u.status??"available",warehouse_id:u.warehouse?u.warehouse.id:null}))}))}}const F={name:[a=>!!a||"اسم المنتج مطلوب",a=>typeof a=="string"&&a.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[a=>!a||typeof a=="string"||"الوصف يجب أن يكون نصًا"],description_long:[a=>!a||typeof a=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[d,p],wholesale_price:[d,p],tax:[f,p],discount:[f,p],weight:[f,p],quantity:[d,p],cost:[f,p]};function A(){w.value.variants.length>0&&w.value.variants[0].stocks.length>0&&v.value.length>0&&w.value.variants[0].stocks[0].warehouse_id===null&&(w.value.variants[0].stocks[0].warehouse_id=v.value[0].id)}K(()=>b.dialog,async a=>{s.value=a,a&&(b.isEditMode&&b.product?w.value=V(b.product):(w.value=JSON.parse(JSON.stringify(r)),A()),await fe(),c.value&&c.value.resetValidation())},{immediate:!0}),K(s,a=>{i("update:dialog",a)}),K(()=>b.product,a=>{b.isEditMode&&a&&(w.value=V(a))}),pe(async()=>{await Promise.all([W(),H(),Q(),Y()]),b.isEditMode||A()});async function W(){try{const a=await J("brands",null,!0,!1);_.value=a.data}catch(a){console.error("Error fetching brands:",a)}}async function H(){try{const a=await J("attributes",null,!0,!0);n.value=a.data}catch(a){console.error("Error fetching attributes:",a)}}async function Q(){try{const a=await J("warehouses",null,!0,!1);v.value=a.data,b.isEditMode||A()}catch(a){console.error("Error fetching warehouses:",a)}}async function Y(){try{const a=await J("categories",null,!0,!1);x.value=a.data}catch(a){console.error("Error fetching categories:",a)}}function Z(){w.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:v.value.length>0?v.value[0].id:null}]})}function X(a){w.value.variants.splice(a,1)}async function ee(){if(!c.value)return;const{valid:a}=await c.value.validate();if(a)try{const l=JSON.parse(JSON.stringify(w.value));Object.prototype.hasOwnProperty.call(l,"active")||Object.prototype.hasOwnProperty.call(l,"is_active")&&(l.active=l.is_active,delete l.is_active),Object.prototype.hasOwnProperty.call(l,"returnable")||Object.prototype.hasOwnProperty.call(l,"is_returnable")&&(l.returnable=l.is_returnable,delete l.is_returnable),Object.prototype.hasOwnProperty.call(l,"desc")||Object.prototype.hasOwnProperty.call(l,"description")&&(l.desc=l.description,delete l.description),Object.prototype.hasOwnProperty.call(l,"desc_long")||Object.prototype.hasOwnProperty.call(l,"description_long")&&(l.desc_long=l.description_long,delete l.desc_long),l.variants.forEach(q=>{q.stocks&&q.stocks.length>0&&q.stocks.forEach(D=>{!D.warehouse_id&&v.value.length>0&&(D.warehouse_id=v.value[0].id)})});let u;if(l.id)u=await se("product",l,l.id);else{const{id:q,...D}=l;u=await se("product",D)}i("saved",u.data),B()}catch(l){console.error("Error saving product:",l)}}const le=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function B(){s.value=!1,i("close")}return(a,l)=>(C(),N(ie,{modelValue:s.value,"onUpdate:modelValue":l[2]||(l[2]=u=>s.value=u),"max-width":"900px"},{default:t(()=>[e(j,null,{default:t(()=>[e(h,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:B}),e(G,{class:"ma-3 text-center"},{default:t(()=>[y("h2",null,$(o.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(ve,{class:"pa-0"},{default:t(()=>[e(_e,{ref_key:"productForm",ref:c,modelValue:S.value,"onUpdate:modelValue":l[1]||(l[1]=u=>S.value=u)},{default:t(()=>[e(Ee,{modelValue:w.value,categories:x.value,brands:_.value,productRules:F,"onUpdate:modelValue":l[0]||(l[0]=u=>w.value=u)},null,8,["modelValue","categories","brands"]),e(j,{class:"pa-2 ma-1",outlined:""},{default:t(()=>[e(G,{class:"ma-2"},{default:t(()=>l[3]||(l[3]=[k(" خيارات المنتج ")])),_:1}),(C(!0),z(R,null,L(w.value.variants,(u,q)=>(C(),N(E,{class:"bg-grey-lighten-1 pa-2",key:q},{default:t(()=>[e(je,{variant:u,variantIndex:q,attributes:n.value,warehouses:v.value,statusOptions:le,productRules:F,onRemoveVariant:X},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(E,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(h,{class:"ma-3",color:"primary",onClick:Z},{default:t(()=>l[4]||(l[4]=[k("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(xe,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:t(()=>[e(be,{class:"my-2"}),e(ye,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:t(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!S.value,onClick:ee,class:"text-capitalize"},{default:t(()=>[k($(o.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(h,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:B,class:"text-capitalize"},{default:t(()=>l[5]||(l[5]=[k(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Je=M(Me,[["__scopeId","data-v-3c260ea2"]]),Re={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(o,{emit:P}){const b=o,i=P,s=we({get:()=>b.modelValue,set:p=>i("update:modelValue",p)}),c=g({});K(()=>b.variant,p=>{c.value=JSON.parse(JSON.stringify(p||{}))},{immediate:!0});function S(p){if(!p)return[];const d=b.attributes.find(r=>r.id===p);return d?d.values:[]}function _(p){if(!p)return"#000";const d=p.substring(1),r=parseInt(d,16),w=r>>16&255,V=r>>8&255,F=r>>0&255;return .299*w+.587*V+.114*F>186?"#000":"#fff"}function v(){c.value.attributes=c.value.attributes||[],c.value.attributes.push({attribute_id:null,attribute_value_id:null})}function x(p){c.value.attributes.splice(p,1)}function n(){i("update:modelValue",!1)}function f(){i("save",JSON.parse(JSON.stringify(c.value))),n()}return(p,d)=>(C(),N(ie,{modelValue:s.value,"onUpdate:modelValue":d[7]||(d[7]=r=>s.value=r),"max-width":"600"},{default:t(()=>[e(j,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(G,null,{default:t(()=>d[8]||(d[8]=[k("تعديل متغير المنتج")])),_:1}),e(E,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(m,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:t(()=>[e(E,null,{default:t(()=>[e(m,{cols:"4"},{default:t(()=>[e(O,{modelValue:c.value.purchase_price,"onUpdate:modelValue":d[0]||(d[0]=r=>c.value.purchase_price=r),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"4"},{default:t(()=>[e(O,{modelValue:c.value.retail_price,"onUpdate:modelValue":d[1]||(d[1]=r=>c.value.retail_price=r),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"4"},{default:t(()=>[e(O,{modelValue:c.value.wholesale_price,"onUpdate:modelValue":d[2]||(d[2]=r=>c.value.wholesale_price=r),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(E,null,{default:t(()=>[e(m,{cols:"6"},{default:t(()=>[e(O,{modelValue:c.value.tax_rate,"onUpdate:modelValue":d[3]||(d[3]=r=>c.value.tax_rate=r),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:t(()=>[e(O,{modelValue:c.value.discount,"onUpdate:modelValue":d[4]||(d[4]=r=>c.value.discount=r),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{class:"py-0",cols:"12"},{default:t(()=>[e(E,null,{default:t(()=>[e(m,{cols:"6"},{default:t(()=>[e(O,{modelValue:c.value.expiry_date,"onUpdate:modelValue":d[5]||(d[5]=r=>c.value.expiry_date=r),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:t(()=>[e(O,{modelValue:c.value.image_url,"onUpdate:modelValue":d[6]||(d[6]=r=>c.value.image_url=r),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",class:"mt-4"},{default:t(()=>[e(oe,null,{default:t(()=>d[9]||(d[9]=[k("الخصائص (Attributes)")])),_:1}),(C(!0),z(R,null,L(c.value.attributes,(r,w)=>(C(),N(E,{dense:"",key:w,class:"d-flex align-center"},{default:t(()=>[e(m,{cols:"5"},{default:t(()=>[e(I,{modelValue:r.attribute_id,"onUpdate:modelValue":V=>r.attribute_id=V,items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>r.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(m,{cols:"5"},{default:t(()=>[e(I,{modelValue:r.attribute_value_id,"onUpdate:modelValue":V=>r.attribute_value_id=V,items:S(r.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!r.attribute_id,":return-object":!1,"hide-details":"auto",style:ue((()=>{const V=S(r.attribute_id).find(F=>F.id===r.attribute_value_id);return V&&V.color?`background:${V.color};color:${_(V.color)};border-radius:6px;`:""})())},{item:t(({item:V,props:F})=>[e(ke,he({ref_for:!0},F,{style:V.raw.color?`background:${V.raw.color};color:${_(V.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:t(({item:V})=>[y("span",{style:ue(V.raw.color?`background:${V.raw.color};color:${_(V.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},$(V.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(m,{cols:"2"},{default:t(()=>[e(h,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:V=>x(w)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-2",text:"",color:"primary",small:"",onClick:v},{default:t(()=>d[10]||(d[10]=[k("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(be,{class:"my-4"}),e(E,null,{default:t(()=>[e(m,{cols:"6"},{default:t(()=>[e(h,{"prepend-icon":"ri-close-line",color:"error",onClick:n},{default:t(()=>d[11]||(d[11]=[k(" إلغاء ")])),_:1})]),_:1}),e(m,{cols:"6",class:"text-center"},{default:t(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",onClick:f},{default:t(()=>d[12]||(d[12]=[k(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Be=M(Re,[["__scopeId","data-v-400d4050"]]),Te={class:"d-flex align-center justify-space-between mb-2"},Ke={class:"d-flex align-center gap-2"},Ge=["onClick"],Le={key:0},We={colspan:"5",class:"pa-0"},He={__name:"products",setup(o){const P=g(!1),b=g({}),i=g(!1),s=g([]),c=g(!1),S=g(null),_=g(null),v=g(0),x=g(!1),n=g({page:1,itemsPerPage:10,sortBy:[]}),f=g(""),p=g(!1),d=g(null),r=g([]);g(null);const w=[{title:"الاسم",key:"name"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],V=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];pe(()=>{A(),F()});function F(){J("attributes",null,!0,!1).then(a=>{r.value=a.data})}function A(){x.value=!0;const{page:a,itemsPerPage:l,sortBy:u}=n.value,q=u.length?u[0].key:"id",D=u.length&&u[0].order?u[0].order:"desc";J("products",{page:a,per_page:l,sort_by:q,sort_order:D,search:f.value}).then(U=>{s.value=U.data,v.value=U.total}).finally(()=>{x.value=!1})}function W(){i.value=!1,b.value={},P.value=!0}function H(a){P.value=!0,i.value=!0,b.value=JSON.parse(JSON.stringify(a))}function Q(a){const l=s.value.findIndex(u=>u.id===a.id);l!==-1?s.value[l]=a:s.value.push(a),P.value=!1}function Y(a){S.value=a,c.value=!0}function Z(){S.value&&Ce("product/delete",S.value.id).then(()=>{A(),re.success("تم حذف المنتج بنجاح"),c.value=!1,S.value=null}).catch(()=>re.error("حدث خطأ أثناء حذف المنتج"))}function X(a){_.value=_.value===a?null:a}function ee(a,l){d.value=JSON.parse(JSON.stringify(a)),d.value.product_id=l,console.log("openVariantEditDialog",d.value),console.log("attributes",r.value),p.value=!0}function le(a){const l=s.value.find(q=>q.id===(a.product_id||_.value));if(!l)return;const u=l.variants.findIndex(q=>q.id===a.id);u!==-1&&(l.variants[u]=a),p.value=!1}function B(a){const l=document.createElement("div");document.body.appendChild(l);const u=Oe({render(){return Se(Pe,{product:a,ref:"stickerRef"})},mounted(){fe(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{u.unmount(),document.body.removeChild(l)},500)})}});u.mount(l)}return(a,l)=>(C(),N(me,{class:"pa-1",style:{"max-width":"1200px"}},{default:t(()=>[e(Je,{dialog:P.value,"onUpdate:dialog":l[0]||(l[0]=u=>P.value=u),product:b.value,isEditMode:i.value,onSaved:Q},null,8,["dialog","product","isEditMode"]),e(Be,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=u=>p.value=u),variant:d.value,attributes:r.value,onSave:le},null,8,["modelValue","variant","attributes"]),e(j,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:t(()=>[y("div",Te,[l[8]||(l[8]=y("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(h,{color:"primary",onClick:W,size:"small"},{default:t(()=>l[7]||(l[7]=[k("+ إضافة منتج")])),_:1}),y("div",Ke,[e(O,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=u=>f.value=u),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Ue(A,["enter"]),onBlur:A,clearable:"","onClick:clear":l[3]||(l[3]=()=>{f.value="",A()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":A},null,8,["modelValue"])])]),e(de,{items:s.value,headers:w,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:x.value,options:n.value,"server-items-length":v.value,"items-per-page":n.value.itemsPerPage,page:n.value.page,"sort-by":n.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":A},{item:t(({item:u})=>{var q,D;return[y("tr",{class:ne({"bg-product-expanded":_.value===u.id}),onClick:U=>X(u.id),style:{cursor:"pointer"}},[y("td",null,$(u.name),1),y("td",null,$(((q=u.category)==null?void 0:q.name)??"-"),1),y("td",null,$(((D=u.brand)==null?void 0:D.name)??"-"),1),y("td",{onClick:l[4]||(l[4]=T(()=>{},["stop"]))},[e(h,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:T(U=>H(u),["stop"])},null,8,["onClick"]),e(h,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:T(U=>Y(u),["stop"])},null,8,["onClick"])])],10,Ge),_.value===u.id?(C(),z("tr",Le,[y("td",We,[e(de,{items:u.variants,headers:V,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:t(({item:U})=>[y("tr",{class:ne(U.quantity<=U.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[y("td",null,$(U.sku),1),y("td",null,$(U.barcode),1),y("td",null,$(U.quantity),1),y("td",null,$(U.min_quantity),1),y("td",null,$(U.cost),1),y("td",null,$(U.wholesale_price),1),y("td",null,$(U.retail_price),1),y("td",null,$(U.discount),1),y("td",null,[e(qe,{attributes:U.attributes,"font-size":"10px"},null,8,["attributes"])]),y("td",null,[y("div",null,[e(h,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:T(Ve=>ee(U,u.id),["stop"])},{default:t(()=>[e(ae,{size:"16"},{default:t(()=>l[9]||(l[9]=[k("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(h,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:t(()=>[e(ae,{size:"16"},{default:t(()=>l[10]||(l[10]=[k("ri-delete-bin-line")])),_:1})]),_:1}),e(h,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:T(Ve=>B(U),["stop"])},{default:t(()=>[e(ae,{size:"16"},{default:t(()=>l[11]||(l[11]=[k("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):ce("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(ie,{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=u=>c.value=u),"max-width":"340"},{default:t(()=>[e(j,null,{default:t(()=>[e(G,null,{default:t(()=>l[12]||(l[12]=[k("تأكيد الحذف")])),_:1}),e(ve,null,{default:t(()=>l[13]||(l[13]=[k("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(ye,null,{default:t(()=>[e(h,{color:"error",onClick:Z,size:"small"},{default:t(()=>l[14]||(l[14]=[k("تأكيد")])),_:1}),e(h,{onClick:l[5]||(l[5]=u=>c.value=!1),size:"small"},{default:t(()=>l[15]||(l[15]=[k("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Xe=M(He,[["__scopeId","data-v-b40111f1"]]);export{Xe as default};
