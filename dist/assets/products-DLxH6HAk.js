import{_ as B,o as S,l as N,k as l,a as g,d as e,aC as te,a5 as c,a6 as $,ay as I,a4 as E,c as j,b as U,aD as oe,F as J,B as L,aE as ue,a9 as C,s as re,W as z,S as ve,r as h,w as W,ah as be,Q as ce,ap as M,ai as G,t as A,a1 as me,q as fe,u as Ve,a2 as ye,N as pe,Y as se,$ as ie,j as ge,I as xe,n as _e,aF as we,a7 as ke,ak as de,a3 as K,V as ae,au as he,aB as Ue,aa as ne}from"./index-ngQ_cKUn.js";import{_ as Ce}from"./AttributesDisplay-CBwulZcz.js";const Oe={class:"d-flex space-between flex-wrap justify-center align-center pa-1"},Se={class:"pa-1 ma-1"},$e={class:"pa-1 ma-1"},Pe={class:"pa-1 ma-1"},Ae={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(u,{emit:P}){return(y,s)=>(S(),N(E,{class:"my-2"},{default:l(()=>[g("div",Oe,[g("div",Se,[e(te,{modelValue:u.modelValue.active,"onUpdate:modelValue":s[0]||(s[0]=n=>u.modelValue.active=n),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",$e,[e(te,{modelValue:u.modelValue.featured,"onUpdate:modelValue":s[1]||(s[1]=n=>u.modelValue.featured=n),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",Pe,[e(te,{modelValue:u.modelValue.returnable,"onUpdate:modelValue":s[2]||(s[2]=n=>u.modelValue.returnable=n),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(c,{cols:"12",class:"pa-1 mx-2",sm:"4"},{default:l(()=>[e($,{modelValue:u.modelValue.name,"onUpdate:modelValue":s[3]||(s[3]=n=>u.modelValue.name=n),label:"اسم المنتج",rules:u.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",class:"pa-1 mx-2",sm:"4"},{default:l(()=>[e(I,{modelValue:u.modelValue.category_id,"onUpdate:modelValue":s[4]||(s[4]=n=>u.modelValue.category_id=n),items:u.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",class:"pa-1 mx-2",sm:"4"},{default:l(()=>[e(I,{modelValue:u.modelValue.brand_id,"onUpdate:modelValue":s[5]||(s[5]=n=>u.modelValue.brand_id=n),items:u.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",class:"pa-1 mx-2",sm:"4"},{default:l(()=>[e($,{modelValue:u.modelValue.desc,"onUpdate:modelValue":s[6]||(s[6]=n=>u.modelValue.desc=n),label:"الوصف",rules:u.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",class:"pa-1 mx-2",sm:"4"},{default:l(()=>[e($,{modelValue:u.modelValue.desc_long,"onUpdate:modelValue":s[7]||(s[7]=n=>u.modelValue.desc_long=n),label:"الوصف المفصل",rules:u.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1}))}},Ee=B(Ae,[["__scopeId","data-v-313c24d7"]]),Ne={__name:"ProductVariantAttributes",props:{modelValue:Array,attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{emit:P}){const y=u,s=P;function n(V){const d=y.attributes.find(v=>v.id===V);return d?d.values:[]}function m(V,d){const v=n(V).find(b=>b.id===d);return v&&v.color?`background:${v.color};color:${O(v.color)};border-radius:6px;`:""}function O(V){if(!V)return"#000";const d=V.substring(1),v=parseInt(d,16),b=v>>16&255,o=v>>8&255,r=v>>0&255;return .299*b+.587*o+.114*r>186?"#000":"#fff"}function _(){const V={attribute_id:null,attribute_value_id:null};s("update:modelValue",[...y.modelValue,V])}function x(V){const d=[...y.modelValue];d.splice(V,1),s("update:modelValue",d)}return(V,d)=>(S(),j(J,null,[e(oe,{class:"ma-1"},{default:l(()=>d[0]||(d[0]=[U("الخصائص (Attributes)")])),_:1}),(S(!0),j(J,null,L(u.modelValue,(v,b)=>(S(),N(E,{dense:"",key:b,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5",class:"pa-0 ma-0"},{default:l(()=>[e(I,{modelValue:v.attribute_id,"onUpdate:modelValue":[o=>v.attribute_id=o,()=>v.attribute_value_id=null],items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",class:"pa-0 ma-0"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(c,{cols:"5",class:"pa-0 ma-0"},{default:l(()=>[e(I,{modelValue:v.attribute_value_id,"onUpdate:modelValue":o=>v.attribute_value_id=o,items:n(v.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!v.attribute_id,"hide-details":"auto",style:ue(m(v.attribute_id,v.attribute_value_id)),class:"pa-0 ma-0"},null,8,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2"},{default:l(()=>[e(C,{class:"my-a",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:o=>x(b)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-1 pa-1",text:"",color:"primary",small:"",onClick:_},{default:l(()=>d[1]||(d[1]=[U("+ إضافة خاصية")])),_:1})],64))}},qe=B(Ne,[["__scopeId","data-v-75ce27a9"]]),Fe={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],qty:[]})}},emits:["update:modelValue"],setup(u,{emit:P}){const y=u,s=P,n=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function m(O){if(y.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const _=[...y.modelValue];_.splice(O,1),s("update:modelValue",_)}return(O,_)=>(S(),j(J,null,[e(oe,{class:"ma-1"},{default:l(()=>_[1]||(_[1]=[U("المخزون (Stocks)")])),_:1}),(S(!0),j(J,null,L(u.modelValue,(x,V)=>(S(),N(E,{dense:"",key:x.id||V},{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:x.cost,"onUpdate:modelValue":d=>x.cost=d,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:u.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:x.qty,"onUpdate:modelValue":d=>x.qty=d,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:u.stockRules.qty,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"4"},{default:l(()=>[u.warehouses&&u.warehouses.length>0?(S(),N(I,{key:0,modelValue:x.warehouse_id,"onUpdate:modelValue":d=>x.warehouse_id=d,"item-value":"id","item-title":"name",items:u.warehouses,label:"المخزن",rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(S(),N(I,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(c,{cols:"4"},{default:l(()=>[e(I,{modelValue:x.status,"onUpdate:modelValue":d=>x.status=d,items:n,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[d=>!!d||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:x.expiry,"onUpdate:modelValue":d=>x.expiry=d,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:x.loc,"onUpdate:modelValue":d=>x.loc=d,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),u.modelValue.length>1?(S(),N(C,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:_[0]||(_[0]=x=>m(O.sIndex))})):re("",!0)],64))}},De=B(Fe,[["__scopeId","data-v-7b0f1eb8"]]),Ie={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(u,{emit:P}){return(y,s)=>(S(),N(E,null,{default:l(()=>[e(c,{cols:"12",sm:"4",class:"my-0 py-1"},{default:l(()=>[e($,{modelValue:u.variant.retail_price,"onUpdate:modelValue":s[0]||(s[0]=n=>u.variant.retail_price=n),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"4",class:"my-0 py-1"},{default:l(()=>[e($,{modelValue:u.variant.wholesale_price,"onUpdate:modelValue":s[1]||(s[1]=n=>u.variant.wholesale_price=n),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"4",class:"my-0 py-1"},{default:l(()=>[e(I,{modelValue:u.variant.status,"onUpdate:modelValue":s[2]||(s[2]=n=>u.variant.status=n),items:u.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(z,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(qe,{modelValue:u.variant.attributes,"onUpdate:modelValue":s[3]||(s[3]=n=>u.variant.attributes=n),attributes:u.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(z,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(De,{modelValue:u.variant.stocks,"onUpdate:modelValue":s[4]||(s[4]=n=>u.variant.stocks=n),warehouses:u.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(C,{color:"error",onClick:s[5]||(s[5]=n=>y.$emit("remove-variant",u.variantIndex))},{default:l(()=>s[6]||(s[6]=[U("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},je=B(Ie,[["__scopeId","data-v-22709d07"]]),ze={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(u,{emit:P}){const y=u,s=P,{xs:n}=ve(),m=h(y.dialog),O=h(null),_=h(!1),x=h([]),V=h([]),d=h([]),v=h([]),b=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",o=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",r=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",F={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{qty:0,reserved:0,min_qty:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},f=h(JSON.parse(JSON.stringify(F)));function D(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(a=>({id:a.id,barcode:a.barcode||"",sku:a.sku||"",retail_price:parseFloat(a.retail_price)||0,wholesale_price:parseFloat(a.wholesale_price)||0,image:a.image||null,weight:parseFloat(a.weight)||0,dimensions:a.dimensions||"",tax:parseFloat(a.tax)||0,discount:parseFloat(a.discount)||0,status:a.status||"active",attributes:(a.attributes||[]).map(p=>({attribute_id:p.attribute_id||null,attribute_value_id:p.attribute_value_id||null})),stocks:(a.stocks||[]).map(p=>({id:p.id,qty:p.qty||0,reserved:p.reserved||0,min_qty:p.min_qty||0,cost:parseFloat(p.cost)||0,batch:p.batch||"",expiry:p.expiry?new Date(p.expiry).toISOString().substr(0,10):null,loc:p.loc||"",status:p.status??"available",warehouse_id:p.warehouse?p.warehouse.id:null}))}))}}const q={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[r,o],wholesale_price:[r,o],tax:[b,o],discount:[b,o],weight:[b,o],qty:[r,o],cost:[b,o]};function R(){f.value.variants.length>0&&f.value.variants[0].stocks.length>0&&V.value.length>0&&f.value.variants[0].stocks[0].warehouse_id===null&&(f.value.variants[0].stocks[0].warehouse_id=V.value[0].id)}W(()=>y.dialog,async t=>{m.value=t,t&&(y.isEditMode&&y.product?f.value=D(y.product):(f.value=JSON.parse(JSON.stringify(F)),R()),await be(),O.value&&O.value.resetValidation())},{immediate:!0}),W(m,t=>{s("update:dialog",t)}),W(()=>y.product,t=>{y.isEditMode&&t&&(f.value=D(t))}),ce(async()=>{await Promise.all([H(),Q(),Y(),Z()]),y.isEditMode||R()});async function H(){try{const t=await M("brands",null,!0,!1);x.value=t.data}catch(t){console.error("Error fetching brands:",t)}}async function Q(){try{const t=await M("attributes",null,!0,!0);v.value=t.data}catch(t){console.error("Error fetching attributes:",t)}}async function Y(){try{const t=await M("warehouses",null,!0,!1);V.value=t.data,y.isEditMode||R()}catch(t){console.error("Error fetching warehouses:",t)}}async function Z(){try{const t=await M("categories",null,!0,!1);d.value=t.data}catch(t){console.error("Error fetching categories:",t)}}function X(){f.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{qty:0,reserved:0,min_qty:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:V.value.length>0?V.value[0].id:null}]})}function ee(t){f.value.variants.splice(t,1)}async function le(){if(!O.value)return;const{valid:t}=await O.value.validate();if(t)try{const a=JSON.parse(JSON.stringify(f.value));Object.prototype.hasOwnProperty.call(a,"active")||Object.prototype.hasOwnProperty.call(a,"is_active")&&(a.active=a.is_active,delete a.is_active),Object.prototype.hasOwnProperty.call(a,"returnable")||Object.prototype.hasOwnProperty.call(a,"is_returnable")&&(a.returnable=a.is_returnable,delete a.is_returnable),Object.prototype.hasOwnProperty.call(a,"desc")||Object.prototype.hasOwnProperty.call(a,"description")&&(a.desc=a.description,delete a.description),Object.prototype.hasOwnProperty.call(a,"desc_long")||Object.prototype.hasOwnProperty.call(a,"description_long")&&(a.desc_long=a.description_long,delete a.desc_long),a.variants.forEach(k=>{k.stocks&&k.stocks.length>0&&k.stocks.forEach(T=>{!T.warehouse_id&&V.value.length>0&&(T.warehouse_id=V.value[0].id)})});let p;if(a.id)p=await ie("product",a,a.id);else{const{id:k,...T}=a;p=await ie("product",T)}s("saved",p.data),i()}catch(a){console.error("Error saving product:",a)}}const w=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function i(){m.value=!1,s("close")}return(t,a)=>(S(),N(se,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=p=>m.value=p)},{default:l(()=>[e(z,null,{default:l(()=>[e(C,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:i}),e(G,{class:"ma-3 text-center"},{default:l(()=>[g("h2",null,A(u.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(me,{class:fe(Ve(n)?"px-2":"px-5")},{default:l(()=>[e(ye,{ref_key:"productForm",ref:O,modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=p=>_.value=p)},{default:l(()=>[e(Ee,{modelValue:f.value,categories:d.value,brands:x.value,productRules:q,"onUpdate:modelValue":a[0]||(a[0]=p=>f.value=p)},null,8,["modelValue","categories","brands"]),e(z,{class:"py-2 px-4 ma-2"},{default:l(()=>[e(G,null,{default:l(()=>a[3]||(a[3]=[U(" خيارات المنتج ")])),_:1}),(S(!0),j(J,null,L(f.value.variants,(p,k)=>(S(),N(E,{class:"bg-grey-lighten-4 pa-2",key:k},{default:l(()=>[e(je,{variant:p,variantIndex:k,attributes:v.value,warehouses:V.value,statusOptions:w,productRules:q,onRemoveVariant:ee},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(E,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(C,{class:"my-3",color:"primary",onClick:X},{default:l(()=>a[4]||(a[4]=[U("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(pe,{class:"my-4"}),e(E,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(C,{"prepend-icon":"ri-close-line",color:"error",onClick:i},{default:l(()=>a[5]||(a[5]=[U(" إلغاء ")])),_:1})]),_:1}),e(c,{cols:"6",class:"text-end"},{default:l(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",disabled:!_.value,onClick:le},{default:l(()=>[U(A(u.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})]),_:1},8,["modelValue"]))}},Be=B(ze,[["__scopeId","data-v-98b065e9"]]),Me={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(u,{emit:P}){const y=u,s=P,n=ge({get:()=>y.modelValue,set:b=>s("update:modelValue",b)}),m=h({});W(()=>y.variant,b=>{m.value=JSON.parse(JSON.stringify(b||{}))},{immediate:!0});function O(b){if(!b)return[];const o=y.attributes.find(r=>r.id===b);return o?o.values:[]}function _(b){if(!b)return"#000";const o=b.substring(1),r=parseInt(o,16),F=r>>16&255,f=r>>8&255,D=r>>0&255;return .299*F+.587*f+.114*D>186?"#000":"#fff"}function x(){m.value.attributes=m.value.attributes||[],m.value.attributes.push({attribute_id:null,attribute_value_id:null})}function V(b){m.value.attributes.splice(b,1)}function d(){s("update:modelValue",!1)}function v(){s("save",JSON.parse(JSON.stringify(m.value))),d()}return(b,o)=>(S(),N(se,{modelValue:n.value,"onUpdate:modelValue":o[7]||(o[7]=r=>n.value=r),"max-width":"600"},{default:l(()=>[e(z,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(G,null,{default:l(()=>o[8]||(o[8]=[U("تعديل متغير المنتج")])),_:1}),e(E,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(c,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(E,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:m.value.purchase_price,"onUpdate:modelValue":o[0]||(o[0]=r=>m.value.purchase_price=r),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:m.value.retail_price,"onUpdate:modelValue":o[1]||(o[1]=r=>m.value.retail_price=r),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e($,{modelValue:m.value.wholesale_price,"onUpdate:modelValue":o[2]||(o[2]=r=>m.value.wholesale_price=r),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(E,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e($,{modelValue:m.value.tax_rate,"onUpdate:modelValue":o[3]||(o[3]=r=>m.value.tax_rate=r),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e($,{modelValue:m.value.discount,"onUpdate:modelValue":o[4]||(o[4]=r=>m.value.discount=r),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{class:"py-0",cols:"12"},{default:l(()=>[e(E,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e($,{modelValue:m.value.expiry_date,"onUpdate:modelValue":o[5]||(o[5]=r=>m.value.expiry_date=r),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e($,{modelValue:m.value.image_url,"onUpdate:modelValue":o[6]||(o[6]=r=>m.value.image_url=r),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",class:"mt-4"},{default:l(()=>[e(oe,null,{default:l(()=>o[9]||(o[9]=[U("الخصائص (Attributes)")])),_:1}),(S(!0),j(J,null,L(m.value.attributes,(r,F)=>(S(),N(E,{dense:"",key:F,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5"},{default:l(()=>[e(I,{modelValue:r.attribute_id,"onUpdate:modelValue":f=>r.attribute_id=f,items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>r.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(c,{cols:"5"},{default:l(()=>[e(I,{modelValue:r.attribute_value_id,"onUpdate:modelValue":f=>r.attribute_value_id=f,items:O(r.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!r.attribute_id,":return-object":!1,"hide-details":"auto",style:ue((()=>{const f=O(r.attribute_id).find(D=>D.id===r.attribute_value_id);return f&&f.color?`background:${f.color};color:${_(f.color)};border-radius:6px;`:""})())},{item:l(({item:f,props:D})=>[e(xe,_e({ref_for:!0},D,{style:f.raw.color?`background:${f.raw.color};color:${_(f.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:f})=>[g("span",{style:ue(f.raw.color?`background:${f.raw.color};color:${_(f.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},A(f.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2"},{default:l(()=>[e(C,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:f=>V(F)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-2",text:"",color:"primary",small:"",onClick:x},{default:l(()=>o[10]||(o[10]=[U("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(pe,{class:"my-4"}),e(E,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(C,{"prepend-icon":"ri-close-line",color:"error",onClick:d},{default:l(()=>o[11]||(o[11]=[U(" إلغاء ")])),_:1})]),_:1}),e(c,{cols:"6",class:"text-center"},{default:l(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",onClick:v},{default:l(()=>o[12]||(o[12]=[U(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Je=B(Me,[["__scopeId","data-v-400d4050"]]),Re={class:"d-flex align-center justify-space-between mb-2"},Te={class:"d-flex align-center gap-2"},Ke=["onClick"],We={key:0},Ge={colspan:"5",class:"pa-0 bg-variant-table"},Le={class:"bg-variant-table"},He={__name:"products",setup(u){const P=h(!1),y=h({}),s=h(!1),n=h([]),m=h(!1),O=h(null),_=h(null),x=h(0),V=h(!1),d=h({page:1,itemsPerPage:10,sortBy:[]}),v=h(""),b=h(!1),o=h(null),r=h([]),F=[{title:"الاسم",key:"name"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],f=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];ce(()=>{q(),D()});function D(){M("attributes",null,!0,!1).then(w=>{r.value=w.data})}function q(){V.value=!0;const{page:w,itemsPerPage:i,sortBy:t}=d.value,a=t.length?t[0].key:"id",p=t.length&&t[0].order?t[0].order:"desc";M("products",{page:w,per_page:i,sort_by:a,sort_order:p,search:v.value}).then(k=>{n.value=k.data,x.value=k.total}).finally(()=>{V.value=!1})}function R(){s.value=!1,y.value={},P.value=!0}function H(w){P.value=!0,s.value=!0,y.value=JSON.parse(JSON.stringify(w))}function Q(w){const i=n.value.findIndex(t=>t.id===w.id);i!==-1?n.value[i]=w:n.value.push(w),P.value=!1}function Y(w){O.value=w,m.value=!0}function Z(){O.value&&Ue("product/delete",O.value.id).then(()=>{q(),ne.success("تم حذف المنتج بنجاح"),m.value=!1,O.value=null}).catch(()=>ne.error("حدث خطأ أثناء حذف المنتج"))}function X(w){_.value=_.value===w?null:w}function ee(w,i){o.value=JSON.parse(JSON.stringify(w)),o.value.product_id=i,console.log("openVariantEditDialog",o.value),console.log("attributes",r.value),b.value=!0}function le(w){const i=n.value.find(a=>a.id===(w.product_id||_.value));if(!i)return;const t=i.variants.findIndex(a=>a.id===w.id);t!==-1&&(i.variants[t]=w),b.value=!1}return(w,i)=>(S(),N(we,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(Be,{dialog:P.value,"onUpdate:dialog":i[0]||(i[0]=t=>P.value=t),product:y.value,isEditMode:s.value,onSaved:Q},null,8,["dialog","product","isEditMode"]),e(Je,{modelValue:b.value,"onUpdate:modelValue":i[1]||(i[1]=t=>b.value=t),variant:o.value,attributes:r.value,onSave:le},null,8,["modelValue","variant","attributes"]),e(z,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[g("div",Re,[i[8]||(i[8]=g("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(C,{color:"primary",onClick:R,size:"small"},{default:l(()=>i[7]||(i[7]=[U("+ إضافة منتج")])),_:1}),g("div",Te,[e($,{modelValue:v.value,"onUpdate:modelValue":i[2]||(i[2]=t=>v.value=t),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:ke(q,["enter"]),onBlur:q,clearable:"","onClick:clear":i[3]||(i[3]=()=>{v.value="",q()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":q},null,8,["modelValue"])])]),e(de,{items:n.value,headers:F,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:V.value,options:d.value,"server-items-length":x.value,"items-per-page":d.value.itemsPerPage,page:d.value.page,"sort-by":d.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":q},{item:l(({item:t})=>{var a,p;return[g("tr",{class:fe({"bg-product-expanded":_.value===t.id}),onClick:k=>X(t.id),style:{cursor:"pointer"}},[g("td",null,A(t.name),1),g("td",null,A(((a=t.category)==null?void 0:a.name)??"-"),1),g("td",null,A(((p=t.brand)==null?void 0:p.name)??"-"),1),g("td",{onClick:i[4]||(i[4]=K(()=>{},["stop"]))},[e(C,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:K(k=>H(t),["stop"])},null,8,["onClick"]),e(C,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:K(k=>Y(t),["stop"])},null,8,["onClick"])])],10,Ke),_.value===t.id?(S(),j("tr",We,[g("td",Ge,[e(de,{items:t.variants,headers:f,"item-key":"id",density:"compact",class:"text-start bg-variant-table","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:k})=>[g("tr",Le,[g("td",null,A(k.sku),1),g("td",null,A(k.barcode),1),g("td",null,A(k.quantity),1),g("td",null,A(k.cost),1),g("td",null,A(k.wholesale_price),1),g("td",null,A(k.retail_price),1),g("td",null,A(k.discount),1),g("td",null,[e(Ce,{attributes:k.attributes,"font-size":"10px"},null,8,["attributes"])]),g("td",null,[g("div",null,[e(C,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:K(T=>ee(k,t.id),["stop"])},{default:l(()=>[e(ae,{size:"16"},{default:l(()=>i[9]||(i[9]=[U("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(C,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(ae,{size:"16"},{default:l(()=>i[10]||(i[10]=[U("ri-delete-bin-line")])),_:1})]),_:1}),e(C,{size:"x-small",icon:"",color:"success",title:"طباعة"},{default:l(()=>[e(ae,{size:"16"},{default:l(()=>i[11]||(i[11]=[U("ri-printer-line")])),_:1})]),_:1})])])])]),_:2},1032,["items"])])])):re("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(se,{modelValue:m.value,"onUpdate:modelValue":i[6]||(i[6]=t=>m.value=t),"max-width":"340"},{default:l(()=>[e(z,null,{default:l(()=>[e(G,null,{default:l(()=>i[12]||(i[12]=[U("تأكيد الحذف")])),_:1}),e(me,null,{default:l(()=>i[13]||(i[13]=[U("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(he,null,{default:l(()=>[e(C,{color:"error",onClick:Z,size:"small"},{default:l(()=>i[14]||(i[14]=[U("تأكيد")])),_:1}),e(C,{onClick:i[5]||(i[5]=t=>m.value=!1),size:"small"},{default:l(()=>i[15]||(i[15]=[U("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ze=B(He,[["__scopeId","data-v-bf442646"]]);export{Ze as default};
