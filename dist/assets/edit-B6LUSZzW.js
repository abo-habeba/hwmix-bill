import{S as Y,r as m,w as S,o as r,c as k,d as e,k as l,b as y,t as D,a9 as I,W as A,ai as F,a4 as B,a5 as _,a1 as E,l as R,F as P,B as h,a8 as ne,s as L,X as re,au as O,Z,u as w,Y as W,$ as J,Q as ie,av as de,a as j,al as ee,_ as le,ag as me,v as pe,V as ce,n as fe,a3 as H,a7 as ve,i as be,a6 as T,N as M,H as Ve,I as ye,L as ge,aa as z,A as ke,g as xe,aw as _e,ax as we,ay as Q,a2 as Ce,az as X,q as Ne,aA as Ue,h as Re,aq as De,ar as $e}from"./index-u8Bn63ul.js";const Ie={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(C,{emit:N}){const{xs:$}=Y(),V=C,U=N,i=m(V.roles),c=m(!1),v=m([]);S(()=>V.user.roles,p=>{v.value=p?p.map(t=>t.name):[]},{immediate:!0});function b(){const p={user_id:V.user.id,roles:v.value};console.log(p),J("role/assignRole",p).then(t=>{U("update:user",t),c.value=!1})}return(p,t)=>(r(),k(P,null,[e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:t[0]||(t[0]=x=>c.value=!0)},{default:l(()=>[y(D(i.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(W,{fullscreen:w($),modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=x=>c.value=x),"max-width":"500"},{default:l(()=>[e(A,{class:"pa-4"},{default:l(()=>[e(F,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[4]||(t[4]=[y("تعديل ادوار المستخدم ")])),_:1}),e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>t[5]||(t[5]=[y(" اضافة دور جديد ")])),_:1}),e(B,{class:"mb-7"},{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(E,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[i.value.length?(r(),R(B,{key:0},{default:l(()=>[(r(!0),k(P,null,h(i.value,(x,a)=>(r(),R(_,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:a},{default:l(()=>[x?(r(),R(ne,{key:0,modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=f=>v.value=f),label:x.name,value:x.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):L("",!0)]),_:2},1024))),128))]),_:1})):(r(),R(re,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>t[6]||(t[6]=[y(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(O,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(I,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:t[2]||(t[2]=x=>c.value=!1)},{default:l(()=>t[7]||(t[7]=[y(" إلغاء ")])),_:1}),e(Z),e(I,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:b},{default:l(()=>t[8]||(t[8]=[y(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},Pe={key:0},Te={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(C,{expose:N}){const $=C,V=m(null),U=m([]);ie(()=>{});const i=m(!1);function c(){i.value=!0}return S(()=>$.userRole,async v=>{v&&v.permissions&&(U.value=v.permissions,V.value=await de(U.value))},{immediate:!0}),N({openDialog:c}),(v,b)=>(r(),R(W,{modelValue:i.value,"onUpdate:modelValue":b[1]||(b[1]=p=>i.value=p),"max-width":"500px"},{default:l(()=>[e(A,null,{default:l(()=>[e(F,null,{default:l(()=>[j("span",null," صلاحيات الدور "+D(C.userRole.name),1)]),_:1}),V.value?(r(),k("div",Pe,[(r(!0),k(P,null,h(V.value,(p,t)=>(r(),k("div",{key:t},[b[2]||(b[2]=j("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(F,null,{default:l(()=>[j("span",null,D(p.name),1)]),_:2},1024),(r(!0),k(P,null,h(p.permissions,(x,a)=>(r(),R(ee,{class:"ma-1",key:a,color:"blue","text-color":"white"},{default:l(()=>[y(D(x.name),1)]),_:2},1024))),128))]))),128))])):L("",!0),e(O,null,{default:l(()=>[e(I,{text:"",onClick:b[0]||(b[0]=p=>i.value=!1)},{default:l(()=>b[3]||(b[3]=[y("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ae={class:"phone-input-wrapper"},Se={key:0},he={key:1},qe={key:0},Fe={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(C,{emit:N}){const $=C,V=N,{initialPhoneNumber:U}=me($),i=m(U.value);S(i,f=>{V("update:phoneNumber",f)}),S(U,f=>{f!==i.value&&(i.value=f)});const c=m(!1),v=m([]),b=m("");function p(f){let n=f.replace(/\s+/g,"").replace(/^\+/,"");return n=n.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),n}async function t(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){z.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const f=["tel","name"],n={multiple:!1},d=await navigator.contacts.select(f,n);d&&d.length&&d[0].tel&&d[0].tel.length?d[0].tel.length===1?i.value=p(d[0].tel[0]):(v.value=d[0].tel.map(p),b.value=d[0].name?d[0].name[0]:"",c.value=!0):z.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{z.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function x(f){i.value=p(f),c.value=!1}const a=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(f,n)=>(r(),k("div",Ae,[e(w(T),{modelValue:w(i),"onUpdate:modelValue":n[2]||(n[2]=d=>be(i)?i.value=d:null),label:C.label,placeholder:C.placeholder,rules:C.rules,counter:C.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":t,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(w(pe),{location:"top"},{activator:l(({props:d})=>[e(w(ce),fe(d,{class:"contact-picker-icon",color:w(a)?"primary":"grey",size:"24",style:w(a)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:n[0]||(n[0]=H(q=>w(a)&&t(),["stop"])),tabindex:"0",onKeydown:n[1]||(n[1]=ve(H(q=>w(a)&&t(),["prevent"]),["enter"])),"aria-disabled":!w(a)}),{default:l(()=>n[5]||(n[5]=[y(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[w(a)?(r(),k("span",Se,"اختيار من جهات الاتصال")):(r(),k("span",he,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(W,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=d=>c.value=d),"max-width":"400"},{default:l(()=>[e(A,null,{default:l(()=>[e(F,{class:"text-h6"},{default:l(()=>[n[6]||(n[6]=y("اختر رقم الهاتف ")),b.value?(r(),k("span",qe,"("+D(b.value)+")",1)):L("",!0)]),_:1}),e(M),e(Ve,null,{default:l(()=>[(r(!0),k(P,null,h(v.value,(d,q)=>(r(),R(ye,{key:q,onClick:K=>x(d),style:{cursor:"pointer"}},{default:l(()=>[e(ge,null,{default:l(()=>[y(D(d),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(O,null,{default:l(()=>[e(Z),e(I,{text:"",onClick:n[3]||(n[3]=d=>c.value=!1)},{default:l(()=>n[7]||(n[7]=[y("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Be=le(Fe,[["__scopeId","data-v-9bfc0763"]]),Le={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},je={__name:"edit",setup(C){Y();const N=xe(),$=Re(),V=m(!1),U=m(null),i=m([]),c=m([]),v=m([]),b=m([]),p=ke(),t=m(null),x=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=m({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),f=m(N.params.tab||x[0].tab),n=m(!1),d=[u=>!!u||"اسم الشهرة مطلوب"],q=[u=>!!u||"رقم الهاتف مطلوب"];S(()=>p.user,u=>{u&&ae()},{immediate:!0}),S(()=>N.params.id,u=>{u?(U.value=u,K()):(a.value.password="12345678",V.value=!1)},{immediate:!0});function K(){V.value=!0,De("roles",{},!1,!1,!1).then(u=>{i.value=u,V.value=!1}).catch(()=>{i.value=[]}),$e("user",U.value,!1,!1,!1).then(u=>{a.value=u,v.value=u.user.companies,V.value=!1}).finally(()=>{V.value=!1})}function ae(){var o;const u=[...a.value.companies.map(g=>({...g,disabled:!1})),...(o=p.user)==null?void 0:o.companies.map(g=>({...g,disabled:!0}))],s=Array.from(new Map(u.map(g=>[g.id,g])).values());return b.value=s,v.value=b.value.filter(g=>g.id===p.user.company_id),s}function te(u){return{title:u.name,subtitle:u.field,disabled:!u.disabled}}function se(){c.value=Array.from(v.value.map(u=>typeof u=="object"&&u.id!==void 0?u.id:u)),a.value.company_id=c.value.length<=0?null:c.value[0],a.value.company_ids=c.value.length>0?c.value:null,a.value.companies=null,J("user",a.value,N.params.id).then(()=>{setTimeout(()=>{$.go(-1)},1200)})}const G=m({});function oe(u){u&&(G.value=u,t.value.openDialog())}return(u,s)=>(r(),R(A,null,{default:l(()=>[e(we,{class:"ma-5",modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=o=>f.value=o),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),k(P,null,h(x,(o,g)=>e(_e,{key:g,value:o.tab,"append-icon":o.icon},{default:l(()=>[y(D(o.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(Ue,{modelValue:f.value,"onUpdate:modelValue":s[11]||(s[11]=o=>f.value=o)},{default:l(()=>[e(Q,{value:"account"},{default:l(()=>[e(B,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(A,{elevation:"0",loading:V.value,title:w(N).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(M),e(E,null,{default:l(()=>[e(Ce,{class:"mt-6",ref:"userForm",modelValue:n.value,"onUpdate:modelValue":s[9]||(s[9]=o=>n.value=o)},{default:l(()=>[e(B,null,{default:l(()=>[e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{modelValue:a.value.full_name,"onUpdate:modelValue":s[1]||(s[1]=o=>a.value.full_name=o),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":s[2]||(s[2]=o=>a.value.nickname=o),label:" اسم الشهرة ",rules:d},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.email,"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.email=o),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Be,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":s[4]||(s[4]=o=>a.value.phone=o),rules:q,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.username,"onUpdate:modelValue":s[5]||(s[5]=o=>a.value.username=o),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(X,{modelValue:a.value.customer_type,"onUpdate:modelValue":s[6]||(s[6]=o=>a.value.customer_type=o),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(X,{modelValue:v.value,"onUpdate:modelValue":s[7]||(s[7]=o=>v.value=o),items:b.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":te,"return-object":""},null,8,["modelValue","items"])]),_:1}),e(M,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{required:"",modelValue:a.value.password,"onUpdate:modelValue":s[8]||(s[8]=o=>a.value.password=o),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(I,{disabled:!n.value,class:Ne({"forbidden-cursor":!n.value}),onClick:se},{default:l(()=>s[12]||(s[12]=[y(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(Q,{value:"role"},{default:l(()=>[e(A,{elevation:"0",class:"ma-4"},{default:l(()=>{var o;return[i.value&&a.value?(r(),R(Ie,{key:0,user:a.value,"onUpdate:user":s[10]||(s[10]=g=>a.value=g),roles:i.value},null,8,["user","roles"])):L("",!0),e(F,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>s[13]||(s[13]=[y(" ادوار المستخدم ")])),_:1}),((o=a.value)==null?void 0:o.roles.length)>0?(r(),R(E,{key:1},{default:l(()=>[(r(!0),k(P,null,h(a.value.roles,(g,ue)=>(r(),k("span",{key:ue},[e(ee,{onClick:ze=>oe(g),class:"ma-2",variant:"outlined"},{default:l(()=>[y(D(g.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),k("div",Le,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Te,{ref_key:"roleDetail",ref:t,userRole:G.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=le(je,[["__scopeId","data-v-6b1a3b71"]]);export{Me as default};
