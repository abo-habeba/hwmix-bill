import{_ as J,o as q,k as D,j as l,a as g,b as e,aJ as se,a4 as N,a5 as m,a6 as A,aA as M,aI as Ve,c as B,d as k,aK as ce,F as L,A as Y,aL as de,a9 as O,q as ge,U as R,R as Ue,r as w,w as X,ag as xe,P as _e,ap as H,ah as W,t as E,a1 as re,a2 as Ce,aM as he,M as we,au as me,X as Q,Z as fe,h as Oe,H as Se,m as qe,a7 as Ae,aj as pe,a3 as G,p as ve,V as ne,aH as Pe,$ as be,aN as $e,T as Ee}from"./index-tdsIHtnS.js";import{_ as Ne}from"./AttributesDisplay-DnT0L2cA.js";import{P as ye}from"./ProductSticker-C3e2baoc.js";const De={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Fe={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(u,{emit:$}){return(x,i)=>(q(),D(Ve,null,{default:l(()=>[g("div",De,[g("div",null,[e(se,{modelValue:u.modelValue.active,"onUpdate:modelValue":i[0]||(i[0]=s=>u.modelValue.active=s),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:u.modelValue.featured,"onUpdate:modelValue":i[1]||(i[1]=s=>u.modelValue.featured=s),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:u.modelValue.returnable,"onUpdate:modelValue":i[2]||(i[2]=s=>u.modelValue.returnable=s),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(N,{dense:""},{default:l(()=>[e(m,{cols:"12",sm:"12"},{default:l(()=>[e(A,{modelValue:u.modelValue.name,"onUpdate:modelValue":i[3]||(i[3]=s=>u.modelValue.name=s),label:"اسم المنتج",rules:u.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:u.modelValue.category_id,"onUpdate:modelValue":i[4]||(i[4]=s=>u.modelValue.category_id=s),items:u.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:u.modelValue.brand_id,"onUpdate:modelValue":i[5]||(i[5]=s=>u.modelValue.brand_id=s),items:u.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"12"},{default:l(()=>[e(A,{modelValue:u.modelValue.desc,"onUpdate:modelValue":i[6]||(i[6]=s=>u.modelValue.desc=s),label:"الوصف",rules:u.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",sm:"12"},{default:l(()=>[e(A,{modelValue:u.modelValue.desc_long,"onUpdate:modelValue":i[7]||(i[7]=s=>u.modelValue.desc_long=s),label:"الوصف المفصل",rules:u.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},Me=J(Fe,[["__scopeId","data-v-c923be84"]]),Ie={__name:"ProductVariantAttributesForm",props:{modelValue:Array,attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{emit:$}){const x=u,i=$;function s(h){const d=x.attributes.find(p=>p.id===h);return d?d.values:[]}function c(h,d){const p=s(h).find(v=>v.id===d);return p&&p.color?`background:${p.color};color:${P(p.color)};border-radius:6px;`:""}function P(h){if(!h)return"#000";const d=h.substring(1),p=parseInt(d,16),v=p>>16&255,n=p>>8&255,r=p>>0&255;return .299*v+.587*n+.114*r>186?"#000":"#fff"}function C(){const h={attribute_id:null,attribute_value_id:null};i("update:modelValue",[...x.modelValue,h])}function y(h){const d=[...x.modelValue];d.splice(h,1),i("update:modelValue",d)}return(h,d)=>(q(),B(L,null,[e(ce,{class:"ma-2"},{default:l(()=>d[0]||(d[0]=[k("الخصائص (Attributes)")])),_:1}),(q(!0),B(L,null,Y(u.modelValue,(p,v)=>(q(),D(N,{dense:"",key:v,class:"d-flex align-center"},{default:l(()=>[e(m,{cols:"5"},{default:l(()=>[e(M,{modelValue:p.attribute_id,"onUpdate:modelValue":[n=>p.attribute_id=n,()=>p.attribute_value_id=null],items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(m,{cols:"5"},{default:l(()=>[e(M,{modelValue:p.attribute_value_id,"onUpdate:modelValue":n=>p.attribute_value_id=n,items:s(p.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!p.attribute_id,"hide-details":"auto",style:de(c(p.attribute_id,p.attribute_value_id))},null,8,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(m,{cols:"2"},{default:l(()=>[e(O,{class:"ma-0 pa-0",icon:"ri-delete-bin-line",color:"error",size:"x-small",onClick:n=>y(v)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-1 pa-1",text:"",color:"primary",small:"",onClick:C},{default:l(()=>d[1]||(d[1]=[k("+ إضافة خاصية")])),_:1})],64))}},je=J(Ie,[["__scopeId","data-v-6ebc13d6"]]),ze={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(u,{emit:$}){const x=u,i=$,s=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function c(P){if(x.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const C=[...x.modelValue];C.splice(P,1),i("update:modelValue",C)}return(P,C)=>(q(),B(L,null,[e(ce,{class:"ma-2"},{default:l(()=>C[1]||(C[1]=[k("المخزون")])),_:1}),(q(!0),B(L,null,Y(u.modelValue,(y,h)=>(q(),D(N,{dense:"",key:y.id||h},{default:l(()=>[e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(A,{modelValue:y.cost,"onUpdate:modelValue":d=>y.cost=d,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:u.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(A,{modelValue:y.quantity,"onUpdate:modelValue":d=>y.quantity=d,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:u.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[u.warehouses&&u.warehouses.length>0?(q(),D(M,{key:0,modelValue:y.warehouse_id,"onUpdate:modelValue":d=>y.warehouse_id=d,"item-value":"id","item-title":"name",items:u.warehouses,label:"المخزن",rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(q(),D(M,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(M,{modelValue:y.status,"onUpdate:modelValue":d=>y.status=d,items:s,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[d=>!!d||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(A,{modelValue:y.expiry,"onUpdate:modelValue":d=>y.expiry=d,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(A,{modelValue:y.loc,"onUpdate:modelValue":d=>y.loc=d,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),u.modelValue.length>1?(q(),D(O,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:C[0]||(C[0]=y=>c(P.sIndex))})):ge("",!0)],64))}},Re=J(ze,[["__scopeId","data-v-382b902c"]]),Be={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(u,{emit:$}){return(x,i)=>(q(),D(N,null,{default:l(()=>[e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(A,{modelValue:u.variant.retail_price,"onUpdate:modelValue":i[0]||(i[0]=s=>u.variant.retail_price=s),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(A,{modelValue:u.variant.wholesale_price,"onUpdate:modelValue":i[1]||(i[1]=s=>u.variant.wholesale_price=s),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(M,{modelValue:u.variant.status,"onUpdate:modelValue":i[2]||(i[2]=s=>u.variant.status=s),items:u.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(A,{modelValue:u.variant.min_quantity,"onUpdate:modelValue":i[3]||(i[3]=s=>u.variant.min_quantity=s),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(je,{modelValue:u.variant.attributes,"onUpdate:modelValue":i[4]||(i[4]=s=>u.variant.attributes=s),attributes:u.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(m,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Re,{modelValue:u.variant.stocks,"onUpdate:modelValue":i[5]||(i[5]=s=>u.variant.stocks=s),warehouses:u.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(m,{cols:"12",class:"my-2 py-1"},{default:l(()=>[e(O,{color:"error",onClick:i[6]||(i[6]=s=>x.$emit("remove-variant",u.variantIndex))},{default:l(()=>i[7]||(i[7]=[k("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Je=J(Be,[["__scopeId","data-v-7876a012"]]),Te={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(u,{emit:$}){const x=u,i=$;Ue();const s=w(x.dialog),c=w(null),P=w(!1),C=w([]),y=w([]),h=w([]),d=w([]),p=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",v=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",n=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",r={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},U=w(JSON.parse(JSON.stringify(r)));function _(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(a=>({id:a.id,barcode:a.barcode||"",sku:a.sku||"",retail_price:parseFloat(a.retail_price)||0,wholesale_price:parseFloat(a.wholesale_price)||0,image:a.image||null,weight:parseFloat(a.weight)||0,dimensions:a.dimensions||"",min_quantity:a.min_quantity||"",tax:parseFloat(a.tax)||0,discount:parseFloat(a.discount)||0,status:a.status||"active",attributes:(a.attributes||[]).map(V=>({attribute_id:V.attribute_id||null,attribute_value_id:V.attribute_value_id||null})),stocks:(a.stocks||[]).map(V=>({id:V.id,quantity:V.quantity||0,reserved:V.reserved||0,min_quantity:V.min_quantity||0,cost:parseFloat(V.cost)||0,batch:V.batch||"",expiry:V.expiry?new Date(V.expiry).toISOString().substr(0,10):null,loc:V.loc||"",status:V.status??"available",warehouse_id:V.warehouse?V.warehouse.id:null}))}))}}const F={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[n,v],wholesale_price:[n,v],tax:[p,v],discount:[p,v],weight:[p,v],quantity:[n,v],cost:[p,v]};function T(){var t,a;(t=U.value)!=null&&t.variants&&U.value.variants&&(a=U.value.variants[0])!=null&&a.stocks&&y.value&&U.value.variants[0].stocks[0].warehouse_id===null&&(U.value.variants[0].stocks[0].warehouse_id=y.value[0].id)}X(()=>x.dialog,async t=>{s.value=t,t&&(x.isEditMode&&x.product?U.value=_(x.product):(U.value=JSON.parse(JSON.stringify(r)),T()),await xe(),c.value&&c.value.resetValidation())},{immediate:!0}),X(s,t=>{i("update:dialog",t)}),X(()=>x.product,t=>{x.isEditMode&&t&&(U.value=_(t))}),_e(async()=>{await Promise.all([j(),ee(),le(),te()]),x.isEditMode||T()});async function j(){try{const t=await H("brands",null,!0,!1);C.value=t.data}catch(t){console.error("Error fetching brands:",t)}}async function ee(){try{const t=await H("attributes",null,!0,!1);d.value=t}catch(t){console.error("Error fetching attributes:",t)}}async function le(){try{const t=await H("warehouses",null,!0,!1);y.value=t.data,x.isEditMode||T()}catch(t){console.error("Error fetching warehouses:",t)}}async function te(){try{const t=await H("categories",null,!0,!1);h.value=t.data}catch(t){console.error("Error fetching categories:",t)}}function ae(){U.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:y.value.length>0?y.value[0].id:null}]})}function ue(t){U.value.variants.splice(t,1)}async function oe(){if(!c.value)return;const{valid:t}=await c.value.validate();if(t)try{const a=JSON.parse(JSON.stringify(U.value));Object.prototype.hasOwnProperty.call(a,"active")||Object.prototype.hasOwnProperty.call(a,"is_active")&&(a.active=a.is_active,delete a.is_active),Object.prototype.hasOwnProperty.call(a,"returnable")||Object.prototype.hasOwnProperty.call(a,"is_returnable")&&(a.returnable=a.is_returnable,delete a.is_returnable),Object.prototype.hasOwnProperty.call(a,"desc")||Object.prototype.hasOwnProperty.call(a,"description")&&(a.desc=a.description,delete a.description),Object.prototype.hasOwnProperty.call(a,"desc_long")||Object.prototype.hasOwnProperty.call(a,"description_long")&&(a.desc_long=a.description_long,delete a.desc_long),a.variants.forEach(I=>{I.stocks&&I.stocks.length>0&&I.stocks.forEach(b=>{!b.warehouse_id&&y.value.length>0&&(b.warehouse_id=y.value[0].id)})});let V;if(a.id)V=await fe("product",a,a.id);else{const{id:I,...b}=a;V=await fe("product",b)}i("saved",V),K()}catch(a){console.error("Error saving product:",a)}}const ie=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function K(){s.value=!1,i("close")}return(t,a)=>(q(),D(Q,{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=V=>s.value=V),"max-width":"900px"},{default:l(()=>[e(R,null,{default:l(()=>[e(O,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:K}),e(W,{class:"ma-3 text-center"},{default:l(()=>[g("h2",null,E(u.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(re,{class:"pa-0"},{default:l(()=>[e(Ce,{ref_key:"productForm",ref:c,modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=V=>P.value=V)},{default:l(()=>[e(Me,{modelValue:U.value,categories:h.value,brands:C.value,productRules:F,"onUpdate:modelValue":a[0]||(a[0]=V=>U.value=V)},null,8,["modelValue","categories","brands"]),e(R,{class:"pa-2 ma-1",outlined:""},{default:l(()=>[e(W,{class:"ma-2"},{default:l(()=>a[3]||(a[3]=[k(" خيارات المنتج ")])),_:1}),(q(!0),B(L,null,Y(U.value.variants,(V,I)=>(q(),D(N,{class:"bg-grey-lighten-1 pa-2",key:I},{default:l(()=>[e(Je,{variant:V,variantIndex:I,attributes:d.value,warehouses:y.value,statusOptions:ie,productRules:F,onRemoveVariant:ue},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(N,null,{default:l(()=>[e(m,{cols:"12"},{default:l(()=>[e(O,{class:"ma-3",color:"primary",onClick:ae},{default:l(()=>a[4]||(a[4]=[k("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(he,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:l(()=>[e(we,{class:"my-2"}),e(me,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!P.value,onClick:oe,class:"text-capitalize"},{default:l(()=>[k(E(u.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(O,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:K,class:"text-capitalize"},{default:l(()=>a[5]||(a[5]=[k(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},He=J(Te,[["__scopeId","data-v-b6e12ce1"]]),Le={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(u,{emit:$}){const x=u,i=$,s=Oe({get:()=>x.modelValue,set:v=>i("update:modelValue",v)}),c=w({});X(()=>x.variant,v=>{c.value=JSON.parse(JSON.stringify(v||{}))},{immediate:!0});function P(v){if(!v)return[];const n=x.attributes.find(r=>r.id===v);return n?n.values:[]}function C(v){if(!v)return"#000";const n=v.substring(1),r=parseInt(n,16),U=r>>16&255,_=r>>8&255,F=r>>0&255;return .299*U+.587*_+.114*F>186?"#000":"#fff"}function y(){c.value.attributes=c.value.attributes||[],c.value.attributes.push({attribute_id:null,attribute_value_id:null})}function h(v){c.value.attributes.splice(v,1)}function d(){i("update:modelValue",!1)}function p(){i("save",JSON.parse(JSON.stringify(c.value))),d()}return(v,n)=>(q(),D(Q,{modelValue:s.value,"onUpdate:modelValue":n[7]||(n[7]=r=>s.value=r),"max-width":"600"},{default:l(()=>[e(R,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(W,null,{default:l(()=>n[8]||(n[8]=[k("تعديل متغير المنتج")])),_:1}),e(N,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(m,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(m,{cols:"4"},{default:l(()=>[e(A,{modelValue:c.value.purchase_price,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value.purchase_price=r),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"4"},{default:l(()=>[e(A,{modelValue:c.value.retail_price,"onUpdate:modelValue":n[1]||(n[1]=r=>c.value.retail_price=r),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"4"},{default:l(()=>[e(A,{modelValue:c.value.wholesale_price,"onUpdate:modelValue":n[2]||(n[2]=r=>c.value.wholesale_price=r),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(m,{cols:"6"},{default:l(()=>[e(A,{modelValue:c.value.tax_rate,"onUpdate:modelValue":n[3]||(n[3]=r=>c.value.tax_rate=r),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(A,{modelValue:c.value.discount,"onUpdate:modelValue":n[4]||(n[4]=r=>c.value.discount=r),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{class:"py-0",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(m,{cols:"6"},{default:l(()=>[e(A,{modelValue:c.value.expiry_date,"onUpdate:modelValue":n[5]||(n[5]=r=>c.value.expiry_date=r),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(A,{modelValue:c.value.image_url,"onUpdate:modelValue":n[6]||(n[6]=r=>c.value.image_url=r),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",class:"mt-4"},{default:l(()=>[e(ce,null,{default:l(()=>n[9]||(n[9]=[k("الخصائص (Attributes)")])),_:1}),(q(!0),B(L,null,Y(c.value.attributes,(r,U)=>(q(),D(N,{dense:"",key:U,class:"d-flex align-center"},{default:l(()=>[e(m,{cols:"5"},{default:l(()=>[e(M,{modelValue:r.attribute_id,"onUpdate:modelValue":_=>r.attribute_id=_,items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>r.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(m,{cols:"5"},{default:l(()=>[e(M,{modelValue:r.attribute_value_id,"onUpdate:modelValue":_=>r.attribute_value_id=_,items:P(r.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!r.attribute_id,":return-object":!1,"hide-details":"auto",style:de((()=>{const _=P(r.attribute_id).find(F=>F.id===r.attribute_value_id);return _&&_.color?`background:${_.color};color:${C(_.color)};border-radius:6px;`:""})())},{item:l(({item:_,props:F})=>[e(Se,qe({ref_for:!0},F,{style:_.raw.color?`background:${_.raw.color};color:${C(_.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:_})=>[g("span",{style:de(_.raw.color?`background:${_.raw.color};color:${C(_.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},E(_.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(m,{cols:"2"},{default:l(()=>[e(O,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:_=>h(U)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-2",text:"",color:"primary",small:"",onClick:y},{default:l(()=>n[10]||(n[10]=[k("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(we,{class:"my-4"}),e(N,null,{default:l(()=>[e(m,{cols:"6"},{default:l(()=>[e(O,{"prepend-icon":"ri-close-line",color:"error",onClick:d},{default:l(()=>n[11]||(n[11]=[k(" إلغاء ")])),_:1})]),_:1}),e(m,{cols:"6",class:"text-center"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",onClick:p},{default:l(()=>n[12]||(n[12]=[k(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ke=J(Le,[["__scopeId","data-v-400d4050"]]),Ge={class:"d-flex align-center justify-space-between mb-2"},We={class:"d-flex align-center gap-2"},Ze=["onClick"],Xe={key:0},Qe={colspan:"5",class:"pa-0"},Ye={id:"mobile-sticker-print"},el={__name:"products",setup(u){const $=w(!1),x=w({}),i=w(!1),s=w([]),c=w(!1),P=w(null),C=w(null),y=w(0),h=w(!1),d=w({page:1,itemsPerPage:10,sortBy:[]}),p=w(""),v=w(!1),n=w(null),r=w([]),U=w(null),_=[{title:"الاسم",key:"name"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],F=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];_e(()=>{T()});function T(){H("attributes",null,!0,!1).then(b=>{r.value=b.data})}function j(){h.value=!0;const{page:b,itemsPerPage:o,sortBy:f}=d.value,z=f.length?f[0].key:"id",Z=f.length&&f[0].order?f[0].order:"desc";H("products",{page:b,per_page:o,sort_by:z,sort_order:Z,search:p.value}).then(S=>{s.value=S.data,y.value=S.total}).finally(()=>{h.value=!1})}function ee(){i.value=!1,x.value={},$.value=!0}function le(b){$.value=!0,i.value=!0,x.value=JSON.parse(JSON.stringify(b))}function te(b){const o=s.value.findIndex(f=>f.id===b.id);o!==-1?s.value[o]=b:s.value.push(b),$.value=!1}function ae(b){P.value=b,c.value=!0}function ue(){P.value&&Pe("product/delete",P.value.id).then(()=>{j(),be.success("تم حذف المنتج بنجاح"),c.value=!1,P.value=null}).catch(()=>be.error("حدث خطأ أثناء حذف المنتج"))}function oe(b){C.value=C.value===b?null:b}function ie(b,o){n.value=JSON.parse(JSON.stringify(b)),n.value.product_id=o,console.log("openVariantEditDialog",n.value),console.log("attributes",r.value),v.value=!0}function K(b){const o=s.value.find(z=>z.id===(b.product_id||C.value));if(!o)return;const f=o.variants.findIndex(z=>z.id===b.id);f!==-1&&(o.variants[f]=b),v.value=!1}function t(){return/android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(navigator.userAgent)}const a=w(!1);function V(b){if(t())U.value=b,a.value=!0;else{const o=document.createElement("div");document.body.appendChild(o);const f=$e({render(){return Ee(ye,{product:b,ref:"stickerRef"})},mounted(){xe(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{f.unmount(),document.body.removeChild(o)},5e3)})}});f.mount(o)}}function I(){const b=document.body.innerHTML,o=document.getElementById("mobile-sticker-print").outerHTML;document.body.innerHTML=o,window.print(),document.body.innerHTML=b,a.value=!1}return(b,o)=>(q(),D(Ve,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(He,{dialog:$.value,"onUpdate:dialog":o[0]||(o[0]=f=>$.value=f),product:x.value,isEditMode:i.value,onSaved:te},null,8,["dialog","product","isEditMode"]),e(Ke,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=f=>v.value=f),variant:n.value,attributes:r.value,onSave:K},null,8,["modelValue","variant","attributes"]),e(R,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[g("div",Ge,[o[10]||(o[10]=g("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(O,{color:"primary",onClick:ee,size:"small"},{default:l(()=>o[9]||(o[9]=[k("+ إضافة منتج")])),_:1}),g("div",We,[e(A,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=f=>p.value=f),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Ae(j,["enter"]),onBlur:j,clearable:"","onClick:clear":o[3]||(o[3]=()=>{p.value="",j()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":j},null,8,["modelValue"])])]),e(pe,{items:s.value,headers:_,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:h.value,options:d.value,"server-items-length":y.value,"items-per-page":d.value.itemsPerPage,page:d.value.page,"sort-by":d.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":j},{item:l(({item:f})=>{var z,Z;return[g("tr",{class:ve({"bg-product-expanded":C.value===f.id}),onClick:S=>oe(f.id),style:{cursor:"pointer"}},[g("td",null,E(f.name),1),g("td",null,E(((z=f.category)==null?void 0:z.name)??"-"),1),g("td",null,E(((Z=f.brand)==null?void 0:Z.name)??"-"),1),g("td",{onClick:o[4]||(o[4]=G(()=>{},["stop"]))},[e(O,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:G(S=>le(f),["stop"])},null,8,["onClick"]),e(O,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:G(S=>ae(f),["stop"])},null,8,["onClick"])])],10,Ze),C.value===f.id?(q(),B("tr",Xe,[g("td",Qe,[e(pe,{items:f.variants,headers:F,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:S})=>[g("tr",{class:ve(S.quantity<=S.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[g("td",null,E(S.sku),1),g("td",null,E(S.barcode),1),g("td",null,E(S.quantity),1),g("td",null,E(S.min_quantity),1),g("td",null,E(S.cost),1),g("td",null,E(S.wholesale_price),1),g("td",null,E(S.retail_price),1),g("td",null,E(S.discount),1),g("td",null,[e(Ne,{attributes:S.attributes,"font-size":"10px"},null,8,["attributes"])]),g("td",null,[g("div",null,[e(O,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:G(ke=>ie(S,f.id),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[11]||(o[11]=[k("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(O,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[12]||(o[12]=[k("ri-delete-bin-line")])),_:1})]),_:1}),e(O,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:G(ke=>V(S),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[13]||(o[13]=[k("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):ge("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(Q,{modelValue:c.value,"onUpdate:modelValue":o[6]||(o[6]=f=>c.value=f),"max-width":"340"},{default:l(()=>[e(R,null,{default:l(()=>[e(W,null,{default:l(()=>o[14]||(o[14]=[k("تأكيد الحذف")])),_:1}),e(re,null,{default:l(()=>o[15]||(o[15]=[k("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(me,null,{default:l(()=>[e(O,{color:"error",onClick:ue,size:"small"},{default:l(()=>o[16]||(o[16]=[k("تأكيد")])),_:1}),e(O,{onClick:o[5]||(o[5]=f=>c.value=!1),size:"small"},{default:l(()=>o[17]||(o[17]=[k("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:a.value,"onUpdate:modelValue":o[8]||(o[8]=f=>a.value=f),"max-width":"350"},{default:l(()=>[e(R,null,{default:l(()=>[e(W,{class:"text-center"},{default:l(()=>o[18]||(o[18]=[k("معاينة استيكر المنتج")])),_:1}),e(re,null,{default:l(()=>[g("div",Ye,[e(ye,{product:U.value,ref:"mobileStickerRef"},null,8,["product"])])]),_:1}),e(me,{class:"justify-center"},{default:l(()=>[e(O,{color:"primary",onClick:I},{default:l(()=>o[19]||(o[19]=[k("طباعة")])),_:1}),e(O,{color:"grey",onClick:o[7]||(o[7]=f=>a.value=!1)},{default:l(()=>o[20]||(o[20]=[k("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ul=J(el,[["__scopeId","data-v-7b065e93"]]);export{ul as default};
