import{r as k,w as G,o as S,k as F,j as l,d as e,H as X,q as fe,aH as Ce,aj as T,_ as B,a as w,aI as ne,a4 as N,a5 as p,aw as I,a6 as P,aG as _e,c as R,b as C,aJ as pe,F as J,A as Y,aK as re,m as xe,a9 as O,U as z,R as Oe,ag as we,z as Se,P as ke,ap as W,t as $,a1 as me,a2 as Ae,aL as qe,M as he,aq as ce,X as Q,Z as ve,h as Pe,a7 as $e,aA as be,a3 as K,p as ye,V as de,aF as Ee,$ as Ve,aM as Fe,T as Ne}from"./index-Bxnr7HaU.js";import{_ as De}from"./AttributesDisplay-CdathJ3j.js";import{P as ge}from"./ProductSticker-CcZUp4vD.js";const Ie={__name:"ProductFreeTextInput",props:{modelValue:[String,null]},emits:["update:modelValue"],setup(o,{emit:q}){const g=q,n=o,c=k([]),s=k(!1),h=k(n.modelValue||"");let U=null;const f=k(!1);G(()=>n.modelValue,u=>{typeof u=="string"&&u!==h.value?h.value=u:u===null&&(h.value="",f.value=!1)},{immediate:!0});async function E(u){if(g("update:modelValue",u),h.value=u,U&&clearTimeout(U),f.value&&u.length>0&&c.value.length===0){U=setTimeout(()=>{},400);return}U=setTimeout(async()=>{var r;if(!u||u.length<2){c.value=[],f.value=!1;return}f.value=!1,s.value=!0;try{const _=((r=(await T("product-variants/search-by-product",{search:u,per_page:20},!1,!1,!1)).data)==null?void 0:r.map(V=>({id:V.id,name:V.full_product_name||V.product_name||"بدون اسم",...V})))||[];c.value=_,_.length===0&&(f.value=!0)}catch(d){console.error(d),c.value=[],f.value=!0}finally{s.value=!1}},400)}function m(u){console.log("Selection prevented:",u)}function y(){g("update:modelValue",""),h.value="",c.value=[],f.value=!1}return(u,r)=>(S(),F(Ce,{items:c.value,loading:s.value,search:h.value,"item-title":"name","item-value":"id",label:"اسم المنتج",clearable:"","hide-no-data":"","no-filter":"","hide-details":"","model-value":h.value,"return-object":"","onUpdate:search":E,"onUpdate:modelValue":m,"onClick:clear":y},{item:l(({item:d})=>[e(X,{title:d.raw.name,class:"text-medium-emphasis cursor-default",style:{pointerEvents:"none"}},null,8,["title"])]),"no-data":l(()=>[h.value?(S(),F(X,{key:0,title:h.value},null,8,["title"])):fe("",!0)]),_:1},8,["items","loading","search","model-value"]))}},je={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Me={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(o,{emit:q}){return(g,n)=>{const c=Ie;return S(),F(_e,null,{default:l(()=>[w("div",je,[w("div",null,[e(ne,{modelValue:o.modelValue.active,"onUpdate:modelValue":n[0]||(n[0]=s=>o.modelValue.active=s),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),w("div",null,[e(ne,{modelValue:o.modelValue.featured,"onUpdate:modelValue":n[1]||(n[1]=s=>o.modelValue.featured=s),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),w("div",null,[e(ne,{modelValue:o.modelValue.returnable,"onUpdate:modelValue":n[2]||(n[2]=s=>o.modelValue.returnable=s),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(N,{dense:""},{default:l(()=>[e(p,{cols:"12",sm:"12"},{default:l(()=>[e(c,{modelValue:o.modelValue.name,"onUpdate:modelValue":n[3]||(n[3]=s=>o.modelValue.name=s)},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:l(()=>[e(I,{modelValue:o.modelValue.category_id,"onUpdate:modelValue":n[4]||(n[4]=s=>o.modelValue.category_id=s),items:o.categories,"item-value":"id","item-title":"name",label:"القسم",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:l(()=>[e(I,{modelValue:o.modelValue.brand_id,"onUpdate:modelValue":n[5]||(n[5]=s=>o.modelValue.brand_id=s),items:o.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"12"},{default:l(()=>[e(P,{modelValue:o.modelValue.desc,"onUpdate:modelValue":n[6]||(n[6]=s=>o.modelValue.desc=s),label:"الوصف",rules:o.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",sm:"12"},{default:l(()=>[e(P,{modelValue:o.modelValue.desc_long,"onUpdate:modelValue":n[7]||(n[7]=s=>o.modelValue.desc_long=s),label:"الوصف المفصل",rules:o.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})}}},ze=B(Me,[["__scopeId","data-v-d241e28b"]]),Te={__name:"ProductVariantAttributesForm",props:{modelValue:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:q}){const g=o,n=q;function c(m){const y=g.attributes.find(u=>u.id===m);return(y==null?void 0:y.values)||[]}function s(m,y){const u=[...g.modelValue];u[m]={attribute_id:y,attribute_value_id:null},n("update:modelValue",u)}function h(){const m=[...g.modelValue,{attribute_id:null,attribute_value_id:null}];n("update:modelValue",m)}function U(m){const y=[...g.modelValue];y.splice(m,1),n("update:modelValue",y)}function f(m){if(!m)return"#000";const y=m.substring(1),u=parseInt(y,16),r=u>>16&255,d=u>>8&255,_=u&255;return .299*r+.587*d+.114*_>186?"#000":"#fff"}function E(m,y){const u=c(m).find(r=>r.id===y);return u!=null&&u.color?`background:${u.color};color:${f(u.color)};border-radius:6px;padding-inline:6px;`:""}return(m,y)=>(S(),R(J,null,[e(pe,{class:"ma-2"},{default:l(()=>y[0]||(y[0]=[C("الخصائص (Attributes)")])),_:1}),(S(!0),R(J,null,Y(o.modelValue,(u,r)=>(S(),F(N,{dense:"",key:r,class:"d-flex align-center"},{default:l(()=>[e(p,{cols:"5"},{default:l(()=>[e(I,{modelValue:u.attribute_id,"onUpdate:modelValue":[d=>u.attribute_id=d,d=>s(r,d)],items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(p,{cols:"5"},{default:l(()=>[e(I,{modelValue:u.attribute_value_id,"onUpdate:modelValue":d=>u.attribute_value_id=d,items:c(u.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"","hide-details":"auto",disabled:!u.attribute_id,style:re(E(u.attribute_id,u.attribute_value_id))},{item:l(({props:d,item:_})=>[e(X,xe({ref_for:!0},d,{style:_.raw.color?`background:${_.raw.color};`:""}),null,16,["style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(p,{cols:"2",class:"text-end"},{default:l(()=>[e(O,{icon:"ri-delete-bin-line",color:"error",size:"x-small",variant:"text",onClick:d=>U(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-2",text:"",color:"primary",density:"comfortable",onClick:h},{default:l(()=>y[1]||(y[1]=[C(" + إضافة خاصية ")])),_:1})],64))}},Re=B(Te,[["__scopeId","data-v-da98878c"]]),Be={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(o,{emit:q}){const g=o,n=q,c=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function s(h){if(g.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const U=[...g.modelValue];U.splice(h,1),n("update:modelValue",U)}return(h,U)=>(S(),R(J,null,[e(pe,{class:"ma-2"},{default:l(()=>U[1]||(U[1]=[C("المخزون")])),_:1}),(S(!0),R(J,null,Y(o.modelValue,(f,E)=>(S(),F(N,{dense:"",key:f.id||E},{default:l(()=>[e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(P,{modelValue:f.cost,"onUpdate:modelValue":m=>f.cost=m,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:o.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(P,{modelValue:f.quantity,"onUpdate:modelValue":m=>f.quantity=m,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:o.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[o.warehouses&&o.warehouses.length>0?(S(),F(I,{key:0,modelValue:f.warehouse_id,"onUpdate:modelValue":m=>f.warehouse_id=m,"item-value":"id","item-title":"name",items:o.warehouses,label:"المخزن",rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(S(),F(I,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(I,{modelValue:f.status,"onUpdate:modelValue":m=>f.status=m,items:c,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[m=>!!m||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(P,{modelValue:f.expiry,"onUpdate:modelValue":m=>f.expiry=m,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(p,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(P,{modelValue:f.loc,"onUpdate:modelValue":m=>f.loc=m,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),o.modelValue.length>1?(S(),F(O,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:U[0]||(U[0]=f=>s(h.sIndex))})):fe("",!0)],64))}},Je=B(Be,[["__scopeId","data-v-382b902c"]]),Le={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(o,{emit:q}){return(g,n)=>(S(),F(N,null,{default:l(()=>[e(p,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(P,{modelValue:o.variant.retail_price,"onUpdate:modelValue":n[0]||(n[0]=c=>o.variant.retail_price=c),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(P,{modelValue:o.variant.wholesale_price,"onUpdate:modelValue":n[1]||(n[1]=c=>o.variant.wholesale_price=c),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(I,{modelValue:o.variant.status,"onUpdate:modelValue":n[2]||(n[2]=c=>o.variant.status=c),items:o.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(P,{modelValue:o.variant.min_quantity,"onUpdate:modelValue":n[3]||(n[3]=c=>o.variant.min_quantity=c),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(z,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Re,{modelValue:o.variant.attributes,"onUpdate:modelValue":n[4]||(n[4]=c=>o.variant.attributes=c),attributes:o.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(p,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(z,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Je,{modelValue:o.variant.stocks,"onUpdate:modelValue":n[5]||(n[5]=c=>o.variant.stocks=c),warehouses:o.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(p,{cols:"12",class:"my-2 py-1"},{default:l(()=>[e(O,{color:"error",onClick:n[6]||(n[6]=c=>g.$emit("remove-variant",o.variantIndex))},{default:l(()=>n[7]||(n[7]=[C("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},He=B(Le,[["__scopeId","data-v-d71e48c9"]]),Ke={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(o,{emit:q}){const g=o,n=q;Oe();const c=k(g.dialog),s=k(null),h=k(!1),U=k([]),f=k([]),E=k([]),m=k([]),y=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",u=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",r=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",d={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},_=k(JSON.parse(JSON.stringify(d)));function V(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(i=>({id:i.id,barcode:i.barcode||"",sku:i.sku||"",retail_price:parseFloat(i.retail_price)||0,wholesale_price:parseFloat(i.wholesale_price)||0,image:i.image||null,weight:parseFloat(i.weight)||0,dimensions:i.dimensions||"",min_quantity:i.min_quantity||"",tax:parseFloat(i.tax)||0,discount:parseFloat(i.discount)||0,status:i.status||"active",attributes:(i.attributes||[]).map(x=>({attribute_id:x.attribute_id||null,attribute_value_id:x.attribute_value_id||null})),stocks:(i.stocks||[]).map(x=>({id:x.id,quantity:x.quantity||0,reserved:x.reserved||0,min_quantity:x.min_quantity||0,cost:parseFloat(x.cost)||0,batch:x.batch||"",expiry:x.expiry?new Date(x.expiry).toISOString().substr(0,10):null,loc:x.loc||"",status:x.status??"available",warehouse_id:x.warehouse?x.warehouse.id:null}))}))}}const D={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[r,u],wholesale_price:[r,u],tax:[y,u],discount:[y,u],weight:[y,u],quantity:[r,u],cost:[y,u]};function L(){var t,i;(t=_.value)!=null&&t.variants&&_.value.variants&&(i=_.value.variants[0])!=null&&i.stocks&&f.value&&_.value.variants[0].stocks[0].warehouse_id===null&&(_.value.variants[0].stocks[0].warehouse_id=f.value[0].id)}G(()=>g.dialog,async t=>{c.value=t,t&&(g.isEditMode&&g.product?_.value=V(g.product):(_.value=JSON.parse(JSON.stringify(d)),L()),await we(),s.value&&s.value.resetValidation())},{immediate:!0}),G(c,t=>{n("update:dialog",t)}),G(()=>g.product,t=>{g.isEditMode&&t&&(_.value=V(t))});const j=Se();ke(async()=>{j.loadingApi=!0;try{await Promise.all([ee(),le(),te(),ae()]),console.log("All initial data fetched successfully!")}catch(t){console.error("An error occurred during data fetching:",t)}finally{j.loadingApi=!1,g.isEditMode||L()}});async function ee(){try{const t=await T("brands",null,!0,!1);U.value=t.data}catch(t){console.error("Error fetching brands:",t)}}async function le(){try{const t=await T("attributes",null,!0,!1);m.value=t.data}catch(t){console.error("Error fetching attributes:",t)}}async function te(){try{const t=await T("warehouses",null,!0,!1);f.value=t.data}catch(t){console.error("Error fetching warehouses:",t)}}async function ae(){try{const t=await T("categories",null,!0,!1);E.value=t.data}catch(t){console.error("Error fetching categories:",t)}}function ue(){_.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:f.value.length>0?f.value[0].id:null}]})}function oe(t){_.value.variants.splice(t,1)}async function ie(){if(!s.value)return;const{valid:t}=await s.value.validate();if(t)try{const i=JSON.parse(JSON.stringify(_.value));Object.prototype.hasOwnProperty.call(i,"active")||Object.prototype.hasOwnProperty.call(i,"is_active")&&(i.active=i.is_active,delete i.is_active),Object.prototype.hasOwnProperty.call(i,"returnable")||Object.prototype.hasOwnProperty.call(i,"is_returnable")&&(i.returnable=i.is_returnable,delete i.is_returnable),Object.prototype.hasOwnProperty.call(i,"desc")||Object.prototype.hasOwnProperty.call(i,"description")&&(i.desc=i.description,delete i.description),Object.prototype.hasOwnProperty.call(i,"desc_long")||Object.prototype.hasOwnProperty.call(i,"description_long")&&(i.desc_long=i.description_long,delete i.desc_long),i.variants.forEach(b=>{b.stocks&&b.stocks.length>0&&b.stocks.forEach(a=>{!a.warehouse_id&&f.value.length>0&&(a.warehouse_id=f.value[0].id)})});let x;if(i.id)x=await ve("product",i,i.id);else{const{id:b,...a}=i;x=await ve("product",a)}n("saved",x),H()}catch(i){console.error("Error saving product:",i)}}const se=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function H(){c.value=!1,n("close")}return(t,i)=>(S(),F(Q,{modelValue:c.value,"onUpdate:modelValue":i[2]||(i[2]=x=>c.value=x),"max-width":"900px",persistent:""},{default:l(()=>[e(z,null,{default:l(()=>[e(O,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:H}),e(W,{class:"ma-3 text-center"},{default:l(()=>[w("h2",null,$(o.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(me,{class:"pa-0"},{default:l(()=>[e(Ae,{ref_key:"productForm",ref:s,modelValue:h.value,"onUpdate:modelValue":i[1]||(i[1]=x=>h.value=x)},{default:l(()=>[e(ze,{modelValue:_.value,categories:E.value,brands:U.value,productRules:D,"onUpdate:modelValue":i[0]||(i[0]=x=>_.value=x)},null,8,["modelValue","categories","brands"]),e(z,{class:"pa-2 ma-1",outlined:""},{default:l(()=>[e(W,{class:"ma-2"},{default:l(()=>i[3]||(i[3]=[C(" خيارات المنتج ")])),_:1}),(S(!0),R(J,null,Y(_.value.variants,(x,b)=>(S(),F(N,{class:"bg-grey-lighten-1 pa-2",key:b},{default:l(()=>[e(He,{variant:x,variantIndex:b,attributes:m.value,warehouses:f.value,statusOptions:se,productRules:D,onRemoveVariant:oe},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(N,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(O,{class:"ma-3",color:"primary",onClick:ue},{default:l(()=>i[4]||(i[4]=[C("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(qe,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:l(()=>[e(he,{class:"my-2"}),e(ce,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!h.value,onClick:ie,class:"text-capitalize"},{default:l(()=>[C($(o.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(O,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:H,class:"text-capitalize"},{default:l(()=>i[5]||(i[5]=[C(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ge=B(Ke,[["__scopeId","data-v-3747ad60"]]),We={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(o,{emit:q}){const g=o,n=q,c=Pe({get:()=>g.modelValue,set:u=>n("update:modelValue",u)}),s=k({});G(()=>g.variant,u=>{s.value=JSON.parse(JSON.stringify(u||{}))},{immediate:!0});function h(u){if(!u)return[];const r=g.attributes.find(d=>d.id===u);return r?r.values:[]}function U(u){if(!u)return"#000";const r=u.substring(1),d=parseInt(r,16),_=d>>16&255,V=d>>8&255,D=d>>0&255;return .299*_+.587*V+.114*D>186?"#000":"#fff"}function f(){s.value.attributes=s.value.attributes||[],s.value.attributes.push({attribute_id:null,attribute_value_id:null})}function E(u){s.value.attributes.splice(u,1)}function m(){n("update:modelValue",!1)}function y(){n("save",JSON.parse(JSON.stringify(s.value))),m()}return(u,r)=>(S(),F(Q,{modelValue:c.value,"onUpdate:modelValue":r[7]||(r[7]=d=>c.value=d),"max-width":"600",persistent:""},{default:l(()=>[e(z,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(W,null,{default:l(()=>r[8]||(r[8]=[C("تعديل متغير المنتج")])),_:1}),e(N,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(p,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(p,{cols:"4"},{default:l(()=>[e(P,{modelValue:s.value.purchase_price,"onUpdate:modelValue":r[0]||(r[0]=d=>s.value.purchase_price=d),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"4"},{default:l(()=>[e(P,{modelValue:s.value.retail_price,"onUpdate:modelValue":r[1]||(r[1]=d=>s.value.retail_price=d),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"4"},{default:l(()=>[e(P,{modelValue:s.value.wholesale_price,"onUpdate:modelValue":r[2]||(r[2]=d=>s.value.wholesale_price=d),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(p,{cols:"6"},{default:l(()=>[e(P,{modelValue:s.value.tax_rate,"onUpdate:modelValue":r[3]||(r[3]=d=>s.value.tax_rate=d),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"6"},{default:l(()=>[e(P,{modelValue:s.value.discount,"onUpdate:modelValue":r[4]||(r[4]=d=>s.value.discount=d),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{class:"py-0",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(p,{cols:"6"},{default:l(()=>[e(P,{modelValue:s.value.expiry_date,"onUpdate:modelValue":r[5]||(r[5]=d=>s.value.expiry_date=d),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(p,{cols:"6"},{default:l(()=>[e(P,{modelValue:s.value.image_url,"onUpdate:modelValue":r[6]||(r[6]=d=>s.value.image_url=d),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{cols:"12",class:"mt-4"},{default:l(()=>[e(pe,null,{default:l(()=>r[9]||(r[9]=[C("الخصائص (Attributes)")])),_:1}),(S(!0),R(J,null,Y(s.value.attributes,(d,_)=>(S(),F(N,{dense:"",key:_,class:"d-flex align-center"},{default:l(()=>[e(p,{cols:"5"},{default:l(()=>[e(I,{modelValue:d.attribute_id,"onUpdate:modelValue":V=>d.attribute_id=V,items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>d.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(p,{cols:"5"},{default:l(()=>[e(I,{modelValue:d.attribute_value_id,"onUpdate:modelValue":V=>d.attribute_value_id=V,items:h(d.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!d.attribute_id,":return-object":!1,"hide-details":"auto",style:re((()=>{const V=h(d.attribute_id).find(D=>D.id===d.attribute_value_id);return V&&V.color?`background:${V.color};color:${U(V.color)};border-radius:6px;`:""})())},{item:l(({item:V,props:D})=>[e(X,xe({ref_for:!0},D,{style:V.raw.color?`background:${V.raw.color};color:${U(V.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:V})=>[w("span",{style:re(V.raw.color?`background:${V.raw.color};color:${U(V.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},$(V.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(p,{cols:"2"},{default:l(()=>[e(O,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:V=>E(_)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-2",text:"",color:"primary",small:"",onClick:f},{default:l(()=>r[10]||(r[10]=[C("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(he,{class:"my-4"}),e(N,null,{default:l(()=>[e(p,{cols:"6"},{default:l(()=>[e(O,{"prepend-icon":"ri-close-line",color:"error",onClick:m},{default:l(()=>r[11]||(r[11]=[C(" إلغاء ")])),_:1})]),_:1}),e(p,{cols:"6",class:"text-center"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",onClick:y},{default:l(()=>r[12]||(r[12]=[C(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ze=B(We,[["__scopeId","data-v-2f5b889d"]]),Xe={class:"d-flex align-center justify-space-between mb-2"},Qe={class:"d-flex align-center gap-2"},Ye=["onClick"],el={key:0},ll={colspan:"5",class:"pa-0"},tl={id:"mobile-sticker-print"},al={__name:"products",setup(o){const q=k(!1),g=k({}),n=k(!1),c=k([]),s=k(!1),h=k(null),U=k(null),f=k(0),E=k(!1),m=k({page:1,itemsPerPage:10,sortBy:[]}),y=k(""),u=k(!1),r=k(null),d=k([]),_=k(null),V=[{title:"الاسم",key:"name"},{title:"اجمالي الكمية",key:"total_available_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],D=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];ke(()=>{L()});function L(){T("attributes",null,!0,!1).then(b=>{d.value=b.data})}function j(){E.value=!0;const{page:b,itemsPerPage:a,sortBy:v}=m.value,M=v.length?v[0].key:"id",Z=v.length&&v[0].order?v[0].order:"desc";T("products",{page:b,per_page:a,sort_by:M,sort_order:Z,search:y.value}).then(A=>{c.value=A.data,f.value=A.total}).finally(()=>{E.value=!1})}function ee(){n.value=!1,g.value={},q.value=!0}function le(b){q.value=!0,n.value=!0,g.value=JSON.parse(JSON.stringify(b))}function te(b){const a=c.value.findIndex(v=>v.id===b.id);a!==-1?c.value[a]=b:c.value.push(b),q.value=!1}function ae(b){h.value=b,s.value=!0}function ue(){h.value&&Ee("product/delete",h.value.id).then(()=>{j(),Ve.success("تم حذف المنتج بنجاح"),s.value=!1,h.value=null}).catch(()=>Ve.error("حدث خطأ أثناء حذف المنتج"))}function oe(b){U.value=U.value===b?null:b}function ie(b,a){r.value=JSON.parse(JSON.stringify(b)),r.value.product_id=a,console.log("openVariantEditDialog",r.value),console.log("attributes",d.value),u.value=!0}function se(b){const a=c.value.find(M=>M.id===(b.product_id||U.value));if(!a)return;const v=a.variants.findIndex(M=>M.id===b.id);v!==-1&&(a.variants[v]=b),u.value=!1}function H(){return/android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(navigator.userAgent)}const t=k(!1);function i(b){if(H())_.value=b,t.value=!0;else{const a=document.createElement("div");document.body.appendChild(a);const v=Fe({render(){return Ne(ge,{product:b,ref:"stickerRef"})},mounted(){we(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{v.unmount(),document.body.removeChild(a)},5e3)})}});v.mount(a)}}function x(){const b=document.body.innerHTML,a=document.getElementById("mobile-sticker-print").outerHTML;document.body.innerHTML=a,window.print(),document.body.innerHTML=b,t.value=!1}return(b,a)=>(S(),F(_e,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(Ge,{dialog:q.value,"onUpdate:dialog":a[0]||(a[0]=v=>q.value=v),product:g.value,isEditMode:n.value,onSaved:te},null,8,["dialog","product","isEditMode"]),e(Ze,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=v=>u.value=v),variant:r.value,attributes:d.value,onSave:se},null,8,["modelValue","variant","attributes"]),e(z,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[w("div",Xe,[a[10]||(a[10]=w("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(O,{color:"primary",onClick:ee,size:"small"},{default:l(()=>a[9]||(a[9]=[C("+ إضافة منتج")])),_:1}),w("div",Qe,[e(P,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=v=>y.value=v),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:$e(j,["enter"]),onBlur:j,clearable:"","onClick:clear":a[3]||(a[3]=()=>{y.value="",j()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":j},null,8,["modelValue"])])]),e(be,{items:c.value,headers:V,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:E.value,options:m.value,"server-items-length":f.value,"items-per-page":m.value.itemsPerPage,page:m.value.page,"sort-by":m.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":j},{item:l(({item:v})=>{var M,Z;return[w("tr",{class:ye({"bg-product-expanded":U.value===v.id}),onClick:A=>oe(v.id),style:{cursor:"pointer"}},[w("td",null,$(v.name),1),w("td",null,$(v.total_available_quantity),1),w("td",null,$(((M=v.category)==null?void 0:M.name)??"-"),1),w("td",null,$(((Z=v.brand)==null?void 0:Z.name)??"-"),1),w("td",{onClick:a[4]||(a[4]=K(()=>{},["stop"]))},[e(O,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:K(A=>le(v),["stop"])},null,8,["onClick"]),e(O,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:K(A=>ae(v),["stop"])},null,8,["onClick"])])],10,Ye),U.value===v.id?(S(),R("tr",el,[w("td",ll,[e(be,{items:v.variants,headers:D,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:A})=>[w("tr",{class:ye(A.quantity<=A.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[w("td",null,$(A.sku),1),w("td",null,$(A.barcode),1),w("td",null,$(A.quantity),1),w("td",null,$(A.min_quantity),1),w("td",null,$(A.cost),1),w("td",null,$(A.wholesale_price),1),w("td",null,$(A.retail_price),1),w("td",null,$(A.discount),1),w("td",null,[a[11]||(a[11]=C("= ")),e(De,{attributes:A.attributes,"font-size":"10px"},null,8,["attributes"])]),w("td",null,[w("div",null,[e(O,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:K(Ue=>ie(A,v.id),["stop"])},{default:l(()=>[e(de,{size:"16"},{default:l(()=>a[12]||(a[12]=[C("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(O,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(de,{size:"16"},{default:l(()=>a[13]||(a[13]=[C("ri-delete-bin-line")])),_:1})]),_:1}),e(O,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:K(Ue=>i(A),["stop"])},{default:l(()=>[e(de,{size:"16"},{default:l(()=>a[14]||(a[14]=[C("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):fe("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(Q,{modelValue:s.value,"onUpdate:modelValue":a[6]||(a[6]=v=>s.value=v),"max-width":"340",persistent:""},{default:l(()=>[e(z,null,{default:l(()=>[e(W,null,{default:l(()=>a[15]||(a[15]=[C("تأكيد الحذف")])),_:1}),e(me,null,{default:l(()=>a[16]||(a[16]=[C("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(ce,null,{default:l(()=>[e(O,{color:"error",onClick:ue,size:"small"},{default:l(()=>a[17]||(a[17]=[C("تأكيد")])),_:1}),e(O,{onClick:a[5]||(a[5]=v=>s.value=!1),size:"small"},{default:l(()=>a[18]||(a[18]=[C("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:t.value,"onUpdate:modelValue":a[8]||(a[8]=v=>t.value=v),"max-width":"350",persistent:""},{default:l(()=>[e(z,null,{default:l(()=>[e(W,{class:"text-center"},{default:l(()=>a[19]||(a[19]=[C("معاينة استيكر المنتج")])),_:1}),e(me,null,{default:l(()=>[w("div",tl,[e(ge,{product:_.value,ref:"mobileStickerRef"},null,8,["product"])])]),_:1}),e(ce,{class:"justify-center"},{default:l(()=>[e(O,{color:"primary",onClick:x},{default:l(()=>a[20]||(a[20]=[C("طباعة")])),_:1}),e(O,{color:"grey",onClick:a[7]||(a[7]=v=>t.value=!1)},{default:l(()=>a[21]||(a[21]=[C("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},sl=B(al,[["__scopeId","data-v-366d0d81"]]);export{sl as default};
