import{S as ae,r as m,w as S,o as r,c as y,d as e,k as l,b,t as I,aa as P,W as q,ai as L,a5 as z,a6 as _,a2 as W,l as N,F as A,B as T,a9 as fe,s as j,X as ve,av as G,Z as te,u as k,Y as H,$ as se,Q as be,aw as ye,a as M,al as oe,_ as ne,ag as Ve,v as ge,V as ke,n as xe,a4 as J,a8 as we,i as _e,a7 as h,N as K,H as Ce,I as Ue,L as Ne,a0 as O,A as Re,g as De,ax as Ie,ay as $e,az as ee,a3 as Pe,aA as le,q as Ae,aB as he,h as qe,aq as Se,ar as Te}from"./index-ncGZ4GRr.js";const Fe={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(C,{emit:w}){const{xs:$}=ae(),V=C,R=w,d=m(V.roles),c=m(!1),f=m([]);S(()=>V.user.roles,p=>{f.value=p?p.map(o=>o.name):[]},{immediate:!0});function v(){const p={user_id:V.user.id,roles:f.value};console.log(p),se("role/assignRole",p).then(o=>{R("update:user",o),c.value=!1})}return(p,o)=>(r(),y(A,null,[e(P,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:o[0]||(o[0]=g=>c.value=!0)},{default:l(()=>[b(I(d.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(H,{fullscreen:k($),modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=g=>c.value=g),"max-width":"500"},{default:l(()=>[e(q,{class:"pa-4"},{default:l(()=>[e(L,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>o[4]||(o[4]=[b("تعديل ادوار المستخدم ")])),_:1}),e(P,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>o[5]||(o[5]=[b(" اضافة دور جديد ")])),_:1}),e(z,{class:"mb-7"},{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(W,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[d.value.length?(r(),N(z,{key:0},{default:l(()=>[(r(!0),y(A,null,T(d.value,(g,x)=>(r(),N(_,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:x},{default:l(()=>[g?(r(),N(fe,{key:0,modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=a=>f.value=a),label:g.name,value:g.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):j("",!0)]),_:2},1024))),128))]),_:1})):(r(),N(ve,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>o[6]||(o[6]=[b(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(G,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(P,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:o[2]||(o[2]=g=>c.value=!1)},{default:l(()=>o[7]||(o[7]=[b(" إلغاء ")])),_:1}),e(te),e(P,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:v},{default:l(()=>o[8]||(o[8]=[b(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},Be={key:0},Le={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(C,{expose:w}){const $=C,V=m(null),R=m([]);be(()=>{});const d=m(!1);function c(){d.value=!0}return S(()=>$.userRole,async f=>{f&&f.permissions&&(R.value=f.permissions,V.value=await ye(R.value))},{immediate:!0}),w({openDialog:c}),(f,v)=>(r(),N(H,{modelValue:d.value,"onUpdate:modelValue":v[1]||(v[1]=p=>d.value=p),"max-width":"500px"},{default:l(()=>[e(q,null,{default:l(()=>[e(L,null,{default:l(()=>[M("span",null," صلاحيات الدور "+I(C.userRole.name),1)]),_:1}),V.value?(r(),y("div",Be,[(r(!0),y(A,null,T(V.value,(p,o)=>(r(),y("div",{key:o},[v[2]||(v[2]=M("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(L,null,{default:l(()=>[M("span",null,I(p.name),1)]),_:2},1024),(r(!0),y(A,null,T(p.permissions,(g,x)=>(r(),N(oe,{class:"ma-1",key:x,color:"blue","text-color":"white"},{default:l(()=>[b(I(g.name),1)]),_:2},1024))),128))]))),128))])):j("",!0),e(G,null,{default:l(()=>[e(P,{text:"",onClick:v[0]||(v[0]=p=>d.value=!1)},{default:l(()=>v[3]||(v[3]=[b("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},je={class:"phone-input-wrapper"},ze={key:0},Ee={key:1},Me={key:0},Oe={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(C,{emit:w}){const $=C,V=w,{initialPhoneNumber:R}=Ve($),d=m(R.value);S(d,a=>{V("update:phoneNumber",a)}),S(R,a=>{a!==d.value&&(d.value=a)});const c=m(!1),f=m([]),v=m("");function p(a){let u=a.replace(/\s+/g,"").replace(/^\+/,"");return u=u.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),u}async function o(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){O.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const a=["tel","name"],u={multiple:!1},i=await navigator.contacts.select(a,u);i&&i.length&&i[0].tel&&i[0].tel.length?i[0].tel.length===1?d.value=p(i[0].tel[0]):(f.value=i[0].tel.map(p),v.value=i[0].name?i[0].name[0]:"",c.value=!0):O.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{O.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function g(a){d.value=p(a),c.value=!1}const x=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(a,u)=>(r(),y("div",je,[e(k(h),{modelValue:k(d),"onUpdate:modelValue":u[2]||(u[2]=i=>_e(d)?d.value=i:null),label:C.label,placeholder:C.placeholder,rules:C.rules,counter:C.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":o,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(k(ge),{location:"top"},{activator:l(({props:i})=>[e(k(ke),xe(i,{class:"contact-picker-icon",color:k(x)?"primary":"grey",size:"24",style:k(x)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:u[0]||(u[0]=J(F=>k(x)&&o(),["stop"])),tabindex:"0",onKeydown:u[1]||(u[1]=we(J(F=>k(x)&&o(),["prevent"]),["enter"])),"aria-disabled":!k(x)}),{default:l(()=>u[5]||(u[5]=[b(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[k(x)?(r(),y("span",ze,"اختيار من جهات الاتصال")):(r(),y("span",Ee,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(H,{modelValue:c.value,"onUpdate:modelValue":u[4]||(u[4]=i=>c.value=i),"max-width":"400"},{default:l(()=>[e(q,null,{default:l(()=>[e(L,{class:"text-h6"},{default:l(()=>[u[6]||(u[6]=b("اختر رقم الهاتف ")),v.value?(r(),y("span",Me,"("+I(v.value)+")",1)):j("",!0)]),_:1}),e(K),e(Ce,null,{default:l(()=>[(r(!0),y(A,null,T(f.value,(i,F)=>(r(),N(Ue,{key:F,onClick:Q=>g(i),style:{cursor:"pointer"}},{default:l(()=>[e(Ne,null,{default:l(()=>[b(I(i),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(G,null,{default:l(()=>[e(te),e(P,{text:"",onClick:u[3]||(u[3]=i=>c.value=!1)},{default:l(()=>u[7]||(u[7]=[b("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},We=ne(Oe,[["__scopeId","data-v-9bfc0763"]]),Ke={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Ge={__name:"edit",setup(C){ae();const w=De(),$=qe(),V=m(!1),R=m(null),d=m([]),c=m([]),f=m([]),v=m([]),p=Re(),o=m(null),g=m(null);console.log("selectedCompanies init:",f.value);const x=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=m({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),u=m(w.params.tab||x[0].tab),i=m(!1),F=[s=>!!s||"اسم الشهرة مطلوب"],Q=[s=>!!s||"رقم الهاتف مطلوب"],ue=[s=>Array.isArray(s)&&s.length>0||"حدد شركة واحدة على الأقل"],re=[s=>!!s||"كلمة المرور مطلوبة",s=>s.length>=6||"كلمة المرور يجب أن لا تقل عن 6 أحرف"];S(()=>p.user,s=>{s&&X()},{immediate:!0}),S(()=>w.params.id,s=>{s?(R.value=s,ie()):(a.value.password="12345678",V.value=!1,a.value.customer_type="retail")},{immediate:!0});function ie(){V.value=!0,Se("roles",{per_page:-1},!1,!1,!1).then(s=>{d.value=s,console.log("roles",d.value)}).catch(()=>{d.value=[]}),Te("user",R.value,!1,!1,!1).then(s=>{a.value=s,console.log("user ",s),console.log("user.value.companies:",a.value.companies),X()}).finally(()=>{V.value=!1})}function X(){var E,Z;const s=new Set((((E=p.user)==null?void 0:E.companies)||[]).map(U=>U.id)),t=(a.value.companies||[]).map(U=>({...U,disabled:!s.has(U.id)})),D=[...(((Z=p.user)==null?void 0:Z.companies)||[]).map(U=>({...U,disabled:!1})),...t],B=Array.from(new Map(D.map(U=>[U.id,U])).values());return v.value=B,f.value=B.filter(U=>(a.value.companies||[]).some(ce=>ce.id===U.id)),B}function de(s){return console.log("itemProps →",s),{title:s.name,subtitle:s.field,disabled:s.disabled}}async function me(){const{valid:s}=await g.value.validate();s&&(c.value=Array.from(f.value.map(t=>typeof t=="object"&&t.id!==void 0?t.id:t)),a.value.company_id=c.value.length<=0?null:c.value[0],a.value.company_ids=c.value.length>0?c.value:null,a.value.companies=null,se("user",a.value,w.params.id).then(()=>{setTimeout(()=>{$.go(-1)},1200)}))}const Y=m({});function pe(s){s&&(Y.value=s,o.value.openDialog())}return(s,t)=>(r(),N(q,null,{default:l(()=>[e($e,{class:"ma-5",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),y(A,null,T(x,(n,D)=>e(Ie,{key:D,value:n.tab,"append-icon":n.icon},{default:l(()=>[b(I(n.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(he,{modelValue:u.value,"onUpdate:modelValue":t[11]||(t[11]=n=>u.value=n)},{default:l(()=>[e(ee,{value:"account"},{default:l(()=>[e(z,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(q,{elevation:"0",loading:V.value,title:k(w).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(K),e(W,null,{default:l(()=>[e(Pe,{class:"mt-6",ref_key:"userForm",ref:g,modelValue:i.value,"onUpdate:modelValue":t[9]||(t[9]=n=>i.value=n)},{default:l(()=>[e(z,null,{default:l(()=>[e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(h,{modelValue:a.value.full_name,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.full_name=n),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(h,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":t[2]||(t[2]=n=>a.value.nickname=n),label:" اسم الشهرة ",rules:F},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(h,{modelValue:a.value.email,"onUpdate:modelValue":t[3]||(t[3]=n=>a.value.email=n),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(We,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":t[4]||(t[4]=n=>a.value.phone=n),rules:Q,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(h,{modelValue:a.value.username,"onUpdate:modelValue":t[5]||(t[5]=n=>a.value.username=n),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(le,{modelValue:a.value.customer_type,"onUpdate:modelValue":t[6]||(t[6]=n=>a.value.customer_type=n),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[v.value?(r(),N(le,{key:0,modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=n=>f.value=n),items:v.value,label:"حدد شركة علي الاقل","item-title":"name","item-value":"id","item-color":"red",chips:"",multiple:"","closable-chips":"","item-props":de,"return-object":"",rules:ue,required:""},null,8,["modelValue","items"])):j("",!0)]),_:1}),e(K,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(h,{required:!k(w).params.id,modelValue:a.value.password,"onUpdate:modelValue":t[8]||(t[8]=n=>a.value.password=n),label:" الباسورد ",rules:k(w).params.id?[]:re},null,8,["required","modelValue","rules"])]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(P,{disabled:!i.value,class:Ae({"forbidden-cursor":!i.value}),onClick:me},{default:l(()=>t[12]||(t[12]=[b(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(ee,{value:"role"},{default:l(()=>[e(q,{elevation:"0",class:"ma-4"},{default:l(()=>{var n;return[d.value&&a.value?(r(),N(Fe,{key:0,user:a.value,"onUpdate:user":t[10]||(t[10]=D=>a.value=D),roles:d.value},null,8,["user","roles"])):j("",!0),e(L,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[13]||(t[13]=[b(" ادوار المستخدم ")])),_:1}),((n=a.value)==null?void 0:n.roles.length)>0?(r(),N(W,{key:1},{default:l(()=>[(r(!0),y(A,null,T(a.value.roles,(D,B)=>(r(),y("span",{key:B},[e(oe,{onClick:E=>pe(D),class:"ma-2",variant:"outlined"},{default:l(()=>[b(I(D.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),y("div",Ke,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Le,{ref_key:"roleDetail",ref:o,userRole:Y.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Qe=ne(Ge,[["__scopeId","data-v-b74aba77"]]);export{Qe as default};
