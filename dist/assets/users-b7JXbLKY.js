import{_ as H}from"./ContextMenu-UtoeM4Uw.js";import{z as E,g as J,r as a,Z as K,w as T,ah as L,aj as W,P as X,o as v,c as F,d as o,a as Y,k as D,j as u,b as I,t as z,a9 as V,q as U,al as ee,a6 as te,a3 as ae,ai as le,F as A,_ as se,u as ne,U as oe}from"./index-Bkhlk-wl.js";import{u as re,D as ie}from"./DeletedItem-CQ9qEveM.js";const ce={id:"dataTable",style:{position:"relative !important"}},ue={__name:"UsersDataTable",setup(P){const r=E(),w=J(),M=re(),s=a([]),_=a(0),c=a([]),i=a(null),g=a(!1),B=a(10),d=a(""),$=a({nickname:"",phone:"",status:"",created_at_from:"",created_at_to:""}),h=a({page:1,sortBy:[],itemsPerPage:10}),j=a([{title:"#",key:"index",sortable:!1},{title:"اسم الشهره",key:"nickname",align:"start"},{title:"الهاتف",key:"phone",align:"start"},{title:"الرصيد",key:"balance",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"start"},{title:"الإجراءات",key:"action",sortable:!1,align:"center"}]),y=a(null),R=a(()=>{w.push({name:"edit-user",params:{id:i.value.id}}),m()}),S=a(()=>{s.value.length?y.value=c.value.filter(e=>s.value.includes(e.id)):y.value=[i.value],M.dialogDelete=!0,m()}),q=a(()=>{m()}),O=a(()=>{const e=i.value.status==="0"?"1":"0";K("user",{status:e},i.value.id).then(()=>{c.value.forEach(t=>{t.id===i.value.id&&(t.status=e)}),m()})}),x=a([]),b=a([]);T(()=>i.value,async e=>{if(!e)return;const t=await r.can(["users.update_all","users.update_children","users.update_self","users.create","admin.super","admin.company"]),n=await r.can(["users.delete_all","users.delete_children","users.delete_self","admin.super","admin.company"]),l=await r.can(["users.view_any","users.view_children","users.view_self","admin.super","admin.company"]);b.value=[!s.value.length&&t?{title:Number(e==null?void 0:e.status)===1?"تعطيل":"تفعيل",color:Number(e==null?void 0:e.status)===1?"#ffc107":"#28a745",icon:Number(e==null?void 0:e.status)===1?"ri-toggle-line":"ri-toggle-fill",callback:O.value}:null,!s.value.length&&t?{title:"تعديل",color:"#007bff",icon:"ri-pencil-line",callback:R.value}:null,n?{title:"حذف",color:"#dc3545",icon:"ri-delete-bin-line",callback:S.value}:null,!s.value.length&&l?{title:"عرض",color:"#17a2b8",icon:"ri-eye-line",callback:q.value}:null].filter(Boolean)},{immediate:!0}),L(()=>{b.value.length===0?x.value=[{title:"لا تملك إجراءات",color:"#6c757d",icon:"ri-spam-3-line",callback:()=>{}}]:x.value=b.value});const Q=e=>{c.value=c.value.filter(t=>!e.includes(t.id)),s.value=[]},p=a(null),N=(e,{item:t})=>{i.value=t,e.preventDefault(),p.value&&p.value.showContextMenu(e)},m=()=>{p.value?p.value.colsContextMenu():console.error("Context menu is not initialized.")};T(d,e=>{(e&&e.length>=3||e.length===0)&&k()});async function k(){g.value=!0;const{page:e,itemsPerPage:t,sortBy:n}=h.value,l=n.length?n[0].key:"id",C=n.length&&n[0].order?n[0].order:"desc",G=t===-1?_.value:t;try{const f=await W("users/search",{page:e,per_page:G,sort_by:l,sort_order:C,...$.value,search:d.value.length>=3?d.value:""},!1,!1,!1);c.value=f.data,_.value=f.total}catch(f){console.error("Error fetching users:",f)}finally{g.value=!1}}function Z({item:e,index:t}){return{class:e.status==="active"?"active-row":"inactive-row","data-index":t}}return X(()=>{}),(e,t)=>{const n=H;return v(),F(A,null,[o(ie,{onUpdateItems:Q,api:"users/delete",dataDelete:{items:y.value,key:"nickname"}},null,8,["dataDelete"]),Y("div",ce,[s.value.length?(v(),D(V,{key:0,class:"text-center my-2 mx-10",density:"compact",variant:"flat",style:{"background-color":"#dc3545 !important",color:"white",position:"absolute",top:"-30px","z-index":"10"},"prepend-icon":"ri-delete-bin-line",onClick:S.value},{default:u(()=>[I(" حذف عدد "+z(s.value.length)+" من العناصر ",1)]),_:1},8,["onClick"])):U("",!0),o(le,{"item-value":"id","items-per-page":B.value,"onUpdate:itemsPerPage":t[1]||(t[1]=l=>B.value=l),options:h.value,"onUpdate:options":[t[2]||(t[2]=l=>h.value=l),k],headers:j.value,items:c.value,"items-length":_.value,loading:g.value,hover:"","show-current-page":"","row-props":Z,modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value=l),"show-select":"","item-selectable":"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة","onContextmenu:row":N,onClick:m},{top:u(()=>[o(ee,{color:"transparent"},{default:u(()=>[o(te,{clearable:"",class:"ma-10","max-width":"200",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l),"prepend-inner-icon":"ri-search-line",label:"بحث...","hide-details":"",rounded:""},null,8,["modelValue"])]),_:1})]),"item.index":u(({index:l})=>[I(z(l+1),1)]),"item.action":u(({item:l})=>[o(V,{density:"compact",variant:"text",color:"#0086CD","prepend-icon":"ri-more-2-fill",onClick:ae(C=>N(C,{item:l}),["stop"])},null,8,["onClick"])]),_:1},8,["items-per-page","options","headers","items","items-length","loading","modelValue"]),o(n,{ref_key:"contextMenu",ref:p,actions:x.value},null,8,["actions"])])],64)}}},de={};function pe(P,r){return v(),D(V,{class:"text-center",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:{name:"edit-user"}})}const me=se(de,[["render",pe],["__scopeId","data-v-8b3e4ec3"]]),ge={__name:"users",setup(P){const r=E();return console.log(r.can(["users.create","admin.super","admin.company"])),(w,M)=>{const s=ue;return v(),F(A,null,[ne(r).can(["users.create","admin.super","admin.company"])?(v(),D(me,{key:0,class:"ma-3"})):U("",!0),o(oe,{class:"pa-0",title:"المستخدمين"},{default:u(()=>[o(s)]),_:1})],64)}}};export{ge as default};
