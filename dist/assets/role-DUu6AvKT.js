import{_ as ne,R as ie,r as n,z as re,h as ue,w as $,P as de,ap as A,$ as R,c as T,d as l,j as t,a4 as k,U as b,u as M,X as j,o as m,a5 as V,a as v,Y as C,k as w,b as r,a9 as u,q as I,aj as me,aC as ve,a6 as h,ah as z,t as q,M as G,a1 as L,a2 as pe,aD as ce,F as H,A as O,aE as fe,aF as Ve,aG as xe,a8 as X,at as Y,g as ye,au as ge,Z as ke,aH as be}from"./index-B5r5gRHK.js";const Ce={class:"mx-auto mt-10 pa-10",style:{"max-width":"700px","background-color":"white"}},we={class:"d-flex gap-2"},_e={__name:"role",setup(Ue){ye();const{xs:Z}=ie(),_=n(!1),x=n(!1),U=n(!1),p=n(!1),c=n(!1),d=n(""),B=n(!1),D=n(null),y=n([]),E=n([]),F=re(),f=n([]),o=n({id:null,name:"",permissions:[]}),J=[a=>!!a||"اسم الدور مطلوب",a=>a.length>=3||"يجب أن يكون الاسم 3 أحرف على الأقل"],K=n([{title:"اسم الدور",key:"name",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"center"},{title:"الإجراءات",key:"actions",align:"center",sortable:!1}]),N=a=>a.permissions.every(e=>o.value.permissions.includes(e.value)),Q=(a,e)=>{const s=new Set(o.value.permissions);e?a.permissions.forEach(i=>s.add(i.value)):a.permissions.forEach(i=>s.delete(i.value)),o.value.permissions=Array.from(s)},W=()=>{},P=ue(()=>{if(!d.value)return y.value;const a=d.value.toLowerCase();return y.value.filter(e=>{const s=e.name.toLowerCase().includes(a),i=e.permissions.some(g=>g.label.toLowerCase().includes(a)||g.value.toLowerCase().includes(a));return s||i})});$([()=>o.value.permissions,()=>P.value],()=>{E.value=P.value.map((a,e)=>a.permissions.some(s=>o.value.permissions.includes(s.value))?e:null).filter(a=>a!==null)},{immediate:!0,deep:!0}),$(()=>F.user,async a=>{a&&a.permissions&&(y.value=await ge(a.permissions))},{immediate:!0}),de(async()=>{var a;_.value=!0;try{const e=await A("roles",{per_page:-1},!1,!1,!1);f.value=e}catch(e){((a=e.data)==null?void 0:a.error)==="Unauthorized"||R.error("حدث خطأ أثناء جلب الأدوار")}finally{_.value=!1}});const ee=()=>{o.value={id:null,name:"",permissions:[]},p.value=!0},S=()=>{var a;p.value=!1,o.value={id:null,name:"",permissions:[]},(a=D.value)==null||a.resetValidation()},le=a=>{o.value={...a,permissions:[...a.permissions]},p.value=!0},ae=a=>{o.value={...a},c.value=!0},se=async()=>{x.value=!0;const{valid:a}=await D.value.validate();if(!a){R.error("يرجى تعبئة جميع الحقول المطلوبة بشكل صحيح"),x.value=!1;return}try{const e=await ke("role",o.value,o.value.id),s=await A("roles");f.value=s.data,S()}catch(e){console.error("Error saving role:",e),R.error("حدث خطأ أثناء حفظ الدور")}finally{x.value=!1}},te=async()=>{U.value=!0;try{await be("role",o.value.id),f.value=f.value.filter(a=>a.id!==o.value.id)}catch(a){console.error("Error deleting role:",a)}finally{c.value=!1,U.value=!1}};return(a,e)=>(m(),T("div",Ce,[l(k,null,{default:t(()=>[l(V,{cols:"12",class:"d-flex align-center"},{default:t(()=>[e[11]||(e[11]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold"},"إدارة الأدوار"),v("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"},"قم بإدارة أدوار المستخدمين وصلاحياتهم في النظام")],-1)),l(C),M(F).can(["roles.create","admin.super","admin.company"])?(m(),w(u,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:e[0]||(e[0]=s=>ee()),elevation:"2",size:"large"},{default:t(()=>e[10]||(e[10]=[r(" دور جديد ")])),_:1})):I("",!0)]),_:1})]),_:1}),l(b,{elevation:"2"},{default:t(()=>[l(me,{headers:K.value,items:f.value,search:d.value,loading:_.value,"loading-text":"جاري تحميل البيانات","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة","items-per-page":"10",class:"elevation-1",hover:""},{top:t(()=>[l(ve,{color:"transparent"},{default:t(()=>[l(h,{class:"ma-10",modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":""},null,8,["modelValue"])]),_:1})]),"item.actions":t(({item:s})=>[v("div",we,[l(u,{icon:"ri-pencil-line",color:"primary",size:"small",variant:"text",onClick:i=>le(s)},null,8,["onClick"]),l(u,{icon:"ri-delete-bin-line",color:"error",size:"small",variant:"text",onClick:i=>ae(s)},null,8,["onClick"])])]),_:1},8,["headers","items","search","loading"])]),_:1}),l(j,{fullscreen:M(Z),modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=s=>p.value=s),"max-width":"700",persistent:""},{default:t(()=>[l(b,{style:{position:"relative"}},{default:t(()=>[v("div",{onClick:S,style:{position:"fixed",top:"5px",left:"5px","z-index":"100"}},[l(u,{icon:"ri-close-line",variant:"text",color:"grey-darken-1"})]),l(z,{class:"text-h5"},{default:t(()=>[r(q(o.value.id?"تعديل دور":"إضافة دور جديد")+" ",1),l(C)]),_:1}),l(G,{class:"my-4"}),l(L,null,{default:t(()=>[l(pe,{ref_key:"form",ref:D,modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=s=>B.value=s)},{default:t(()=>[l(k,{dense:""},{default:t(()=>[l(V,{cols:"12",xs:"6"},{default:t(()=>[l(h,{modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.name=s),label:"اسم الدور",rules:J,required:"",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(G,{class:"my-4"}),y.value?(m(),w(k,{key:0,class:"mb-10"},{default:t(()=>[l(V,{cols:"4"},{default:t(()=>e[12]||(e[12]=[v("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)])),_:1}),l(V,{cols:"8"},{default:t(()=>[l(h,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":""},null,8,["modelValue"])]),_:1}),l(ce,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=s=>E.value=s),class:"my-4",variant:"popout",multiple:""},{default:t(()=>[(m(!0),T(H,null,O(P.value,s=>(m(),w(fe,{class:"pa-0",key:s.name},{default:t(()=>[l(Ve,{style:{"background-color":"#f0f4f8"},class:"text-subtitle"},{default:t(()=>[r(q(s.name),1)]),_:2},1024),l(xe,null,{default:t(()=>[l(b,{class:"mt-3",variant:"outlined"},{default:t(()=>[l(z,{class:"py-2 px-2 bg-grey-lighten-4 d-flex align-center"},{default:t(()=>[l(X,{"model-value":N(s),label:N(s)?"إلغاء تحديد الكل":"تحديد الكل","onUpdate:modelValue":i=>Q(s,i),"hide-details":"",color:"primary",class:"ma-0 pa-0"},null,8,["model-value","label","onUpdate:modelValue"]),l(C)]),_:2},1024),l(L,null,{default:t(()=>[l(k,null,{default:t(()=>[(m(!0),T(H,null,O(s.permissions,(i,g)=>(m(),w(V,{class:"py-0 px-3",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:g},{default:t(()=>[l(X,{modelValue:o.value.permissions,"onUpdate:modelValue":[e[4]||(e[4]=oe=>o.value.permissions=oe),()=>W(s)],label:i.label,value:i.value,density:"comfortable",color:"primary",class:"permission-checkbox py-0 px-3","hide-details":""},null,8,["modelValue","label","value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),l(G),l(Y,{style:{position:"sticky",bottom:"0","background-color":"white","z-index":"5"},class:"pa-4 d-flex justify-center"},{default:t(()=>[l(u,{"append-icon":"ri-close-line",color:"error",variant:"text",onClick:S,class:"mx-2"},{default:t(()=>e[13]||(e[13]=[r(" إلغاء ")])),_:1}),l(u,{"append-icon":"ri-save-line",color:"primary",loading:x.value,onClick:se,class:"mx-2"},{default:t(()=>e[14]||(e[14]=[r(" حفظ ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"]),l(j,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=s=>c.value=s),"max-width":"400"},{default:t(()=>[l(b,null,{default:t(()=>[l(z,{class:"text-h5 pa-4"},{default:t(()=>e[15]||(e[15]=[r(" تأكيد الحذف ")])),_:1}),l(L,{class:"pa-4"},{default:t(()=>e[16]||(e[16]=[r(" هل أنت متأكد من حذف هذا الدور؟ لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),l(Y,{class:"pa-4"},{default:t(()=>[l(C),l(u,{color:"grey-darken-1",variant:"text",onClick:e[8]||(e[8]=s=>c.value=!1)},{default:t(()=>e[17]||(e[17]=[r(" إلغاء ")])),_:1}),l(u,{color:"error",loading:U.value,onClick:te},{default:t(()=>e[18]||(e[18]=[r(" حذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ee=ne(_e,[["__scopeId","data-v-a9f07262"]]);export{Ee as default};
