import{_ as U}from"./InfoDisplay-Hn-ghBW9.js";import{_ as q,r as d,j as y,Q as z,c as g,d as a,k as l,ak as A,Y as G,F as B,aq as R,o as c,aa as p,a4 as k,b as i,a as x,aL as j,t as b,bq as Q,B as W,l as C,al as T,s as V,a5 as w,a6 as r,W as Y,ai as Z,a2 as J,av as K,Z as O}from"./index-Dj2BcGnU.js";import{_ as X}from"./PayInstallmentDialog-DEvyYYmO.js";const ee={class:"progress-bar-container"},te={key:0,class:"text-grey-darken-1"},ae={__name:"InstallmentPlansTable",setup(le){const $=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],h=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status"},{title:"الإجراءات",key:"actions",sortable:!1}],D=d([]),u=d([]),o=d({}),f=d(!1),F=d(null),_=d(!1),I=d(!0);function v(n){const t=parseFloat(n.total_installments_pay)||0,s=parseFloat(n.total_installments_amount)||1;return Math.min(Math.round(t/s*100),100)}function E(n){const t=v(n);return t===100?"#4CAF50":t>=50?"#2196F3":t>=20?"#FFC107":"#F44336"}const S=y(()=>o.value.start_date?new Date(o.value.start_date).toLocaleDateString("ar-EG"):"—");function M({item:n}){const t=parseFloat(n.remaining)||0,s=new Date(n.due_date),e=new Date;return s.setHours(0,0,0,0),e.setHours(0,0,0,0),n.status==="تم الدفع"?{style:{backgroundColor:"#A5D6A7"}}:t>0&&s<e?{style:{backgroundColor:"#EF9A9A"}}:t>0?{style:{backgroundColor:"#FFE082"}}:{}}y(()=>u.value.reduce((n,t)=>n+(t.remaining||0),0)),y(()=>u.value.reduce((n,t)=>n+(t.amount-(t.remaining||0)),0));function N(){R("installment-plans",{per_page:-1},!0,!0,!1).then(n=>{D.value=n||[]})}function H(n){n.forEach(t=>{const s=u.value.findIndex(e=>e.id===t.id);s!==-1&&(u.value[s]={...u.value[s],...t})})}function L(n){!n||!Array.isArray(n.installments)||(o.value=n,u.value=n.installments,f.value=!0)}function P(n,t){F.value=n,I.value=t,_.value=!0}return z(N),(n,t)=>{const s=U;return c(),g(B,null,[a(A,{headers:$,items:D.value,"item-value":"id",class:"elevation-1",density:"compact","hide-default-footer":""},{"item.actions":l(({item:e})=>[a(p,{color:"primary",density:"compact",onClick:k(m=>L(e),["stop"])},{default:l(()=>t[3]||(t[3]=[i("عرض الأقساط")])),_:2},1032,["onClick"])]),"item.paid_percentage":l(({item:e})=>[x("div",ee,[x("div",{class:"progress-bar-fill",style:j({width:v(e)+"%",backgroundColor:E(e)})},b(v(e))+"% ",5)])]),"item.plan_products":l(({item:e})=>[a(Q,{column:""},{default:l(()=>[x("div",null,[(c(!0),g(B,null,W(e.invoice_items,m=>(c(),C(T,{key:m.id,size:"small",color:"info",variant:"outlined"},{default:l(()=>[i(b(m.name),1)]),_:2},1024))),128))]),!e.invoice_items||e.invoice_items.length===0?(c(),g("span",te,"لا توجد منتجات")):V("",!0)]),_:2},1024)]),"no-data":l(()=>[a(w,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>t[4]||(t[4]=[i("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items"]),a(G,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),"max-width":"900px",scrollable:""},{default:l(()=>[a(Y,null,{default:l(()=>[a(Z,{class:"bg-primary text-white"},{default:l(()=>t[5]||(t[5]=[i("تفاصيل خطة التقسيط")])),_:1}),a(J,null,{default:l(()=>[a(w,{class:"px-4 pt-4",dense:""},{default:l(()=>[a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(s,{icon:"ri-user-line",label:"المستخدم",text:((e=o.value.user)==null?void 0:e.nickname)||"غير متوفر"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(s,{icon:"ri-file-text-line",label:"الفاتورة",text:((e=o.value.invoice)==null?void 0:e.invoice_number)||"—"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-calendar-line",label:"تاريخ البدء",text:S.value},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-money-dollar-box-line",label:"إجمالي الفاتورة",text:o.value.total_amount},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-wallet-line",label:"إجمالي المتبقي",text:o.value.total_installments_remaining},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-coin-line",label:"إجمالي المدفوع",text:o.value.total_pay},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-heart-line",label:"المقدم",text:o.value.down_payment},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(s,{icon:"ri-list-ordered",label:"عدد الأقساط",text:((e=o.value.installments)==null?void 0:e.length)||0},null,8,["text"])]}),_:1})]),_:1}),a(A,{"row-props":M,headers:h,items:u.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":l(({item:e})=>[a(T,{color:e.status==="تم الدفع"?"success":"error",dark:""},{default:l(()=>[i(b(e.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[e.status!=="تم الدفع"?(c(),C(p,{key:0,color:e.status==="تم الدفع"?"grey":"success",disabled:e.status==="تم الدفع",density:"compact",class:"me-1",onClick:k(m=>P(e,!0),["stop"])},{default:l(()=>t[6]||(t[6]=[i("دفع القسط")])),_:2},1032,["color","disabled","onClick"])):V("",!0),e.status!=="تم الدفع"?(c(),C(p,{key:1,color:e.status==="تم الدفع"?"grey":"warning",disabled:e.status==="تم الدفع",density:"compact",onClick:k(m=>P(e,!1),["stop"])},{default:l(()=>t[7]||(t[7]=[i("مبلغ مختلف")])),_:2},1032,["color","disabled","onClick"])):V("",!0)]),"no-data":l(()=>[a(w,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>t[8]||(t[8]=[i("لا توجد أقساط لهذه الخطة")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),a(K,null,{default:l(()=>[a(O),a(p,{text:"",onClick:t[0]||(t[0]=e=>f.value=!1)},{default:l(()=>t[9]||(t[9]=[i("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(X,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e),installment:F.value,"direct-pay":I.value,"onUpdate:installment":H},null,8,["modelValue","installment","direct-pay"])],64)}}},re=q(ae,[["__scopeId","data-v-51d2516f"]]);export{re as default};
