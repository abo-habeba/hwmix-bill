import{_ as I,r as s,Q as B,w as C,o as k,c as T,d as n,k as u,b as f,t as y,a9 as U,aq as F,bp as $,F as E,ap as M,l as N,W as S}from"./index-CY8n7IqI.js";import{_ as q}from"./PayInstallmentDialog-QaZxVV7w.js";const A={__name:"InstallmentsDataTable",setup(b){const g=[{title:"رقم القسط",key:"installment_number"},{title:"العميل",key:"user.nickname",sortable:!1},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"قيمة القسط",key:"amount"},{title:"الحالة",key:"status"},{title:"المتبقي",key:"remaining"},{title:"الإجراءات",key:"actions",sortable:!1}],l=s([]),d=s(!1),v=s(null),_=s(1),h=s(10),c=s(0),m=s(!1),o=s({page:1,itemsPerPage:10,sortBy:["due_date"],sortDesc:[!1]});function x(a){v.value=a,d.value=!0}function V(a){a.forEach(t=>{const e=l.value.findIndex(r=>r.id===t.id);e!==-1&&(l.value[e]=t)})}async function p(){m.value=!0;const{page:a,itemsPerPage:t,sortBy:e}=o.value,r=e.length?e[0].key:"due_date",w=e.length&&e[0].order?e[0].order:"asc",D={page:a||1,limit:t||10,sort_by:r,sort_order:w};try{const i=await M("installments",D,!0,!0,!0);l.value=i.data,c.value=i.total}catch(i){console.error("فشل في جلب الأقساط:",i)}finally{m.value=!1}}B(()=>{p()}),C(()=>o.value.page,()=>{p()});function P({item:a,index:t}){return{class:a.status==="تم الدفع"?"paid-row":"unpaid-row","data-index":t}}return(a,t)=>(k(),T(E,null,[n(F,{"item-value":"id",options:o.value,"onUpdate:options":[t[0]||(t[0]=e=>o.value=e),p],headers:g,items:l.value,"items-length":c.value,loading:m.value,hover:"","show-current-page":"","row-props":P,"loading-text":"جاري تحميل البيانات","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة"},{"item.index":u(({index:e})=>[f(y(e+1),1)]),"item.actions":u(({item:e})=>[n(U,{color:e.status==="تم الدفع"?"grey":"primary",disabled:e.status==="تم الدفع",density:"compact",onClick:r=>x(e)},{default:u(()=>[f(y(e.status==="تم الدفع"?"تم الدفع":"دفع القسط"),1)]),_:2},1032,["color","disabled","onClick"])]),_:1},8,["options","items","items-length","loading"]),n($,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),length:Math.ceil(c.value/h.value),class:"mt-4","show-first-last":!0,"total-visible":5},null,8,["modelValue","length"]),n(q,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),installment:v.value,"onUpdate:installment":V},null,8,["modelValue","installment"])],64))}},O=I(A,[["__scopeId","data-v-e6a74b71"]]),W={__name:"installments",setup(b){return(g,l)=>(k(),N(S,{class:"pa-0",title:"الاقساط"},{default:u(()=>[n(O)]),_:1}))}};export{W as default};
