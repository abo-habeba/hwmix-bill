import{_ as A,h as E,r as l,w as b,aj as T,P as U,o as h,c as j,d as p,j as g,b as D,t as P,a9 as N,ai as M,k as O,bk as S,q,F as R}from"./index-Cvpi-78G.js";import{P as $}from"./PayInstallmentDialog-Cr5jcLdQ.js";const z={__name:"InstallmentsDataTable",props:{filters:{type:Object,default:()=>({})},pagination:{type:Boolean,default:!0},selectedHeaders:{type:Array,default:()=>[]}},emits:["update:totalItems"],setup(i,{emit:C}){const I=C,s=i,f=[{title:"رقم القسط",key:"installment_number"},{title:"العميل",key:"user.nickname",sortable:!1},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"قيمة القسط",key:"amount"},{title:"الحالة",key:"status_label"},{title:"المتبقي",key:"remaining"},{title:"الإجراءات",key:"actions",sortable:!1}],V=E(()=>s.selectedHeaders&&s.selectedHeaders.length>0?f.filter(t=>s.selectedHeaders.includes(t.key)):f),y=l([]),d=l(!1),v=l(null),k=l(1),_=l(10),u=l(0),c=l(!1),n=l({page:1,itemsPerPage:10,sortBy:["due_date"],sortDesc:[!1]});function w(t){v.value=t,d.value=!0}function F({item:t}){const a=parseFloat(t.remaining)||0,e=new Date(t.due_date),r=new Date;return e.setHours(0,0,0,0),r.setHours(0,0,0,0),t.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:t.status==="canceled"?{style:{backgroundColor:"#CFD8DC"}}:t.status==="partially_paid"?{style:{backgroundColor:"#FFECB3"}}:a>0&&e<r?{style:{backgroundColor:"#EF9A9A"}}:a>0?{style:{backgroundColor:"#E0F2F7"}}:{}}function x(){o()}b(()=>s.filters,()=>{n.value.page=1,o()},{deep:!0});async function o(){c.value=!0;const{page:t,itemsPerPage:a,sortBy:e}=n.value,r=e.length?e[0].key:"due_date",B=e.length&&e[0].order?e[0].order:"asc",H={page:t||1,limit:a||10,sort_by:r,sort_order:B,...s.filters};try{const m=await T("installments",H,!0,!0,!0);y.value=m.data,u.value=m.total,I("update:totalItems",u.value)}catch{}finally{c.value=!1}}return U(()=>{o()}),b(()=>n.value.page,()=>{o()}),(t,a)=>(h(),j(R,null,[p(M,{"item-value":"id",options:n.value,"onUpdate:options":[a[0]||(a[0]=e=>n.value=e),o],headers:V.value,items:y.value,"items-length":u.value,loading:c.value,hover:"","show-current-page":"","row-props":F,"loading-text":"جاري تحميل البيانات","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة","hide-default-footer":!i.pagination},{"item.index":g(({index:e})=>[D(P(e+1),1)]),"item.actions":g(({item:e})=>[p(N,{color:e.status==="paid"?"grey":"primary",disabled:e.status==="paid"||e.status==="canceled",density:"compact",onClick:r=>w(e)},{default:g(()=>[D(P(e.status==="paid"?"تم الدفع":"دفع القسط"),1)]),_:2},1032,["color","disabled","onClick"])]),_:1},8,["options","headers","items","items-length","loading","hide-default-footer"]),i.pagination?(h(),O(S,{key:0,modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e),length:Math.ceil(u.value/_.value),class:"mt-4","show-first-last":!0,"total-visible":5},null,8,["modelValue","length"])):q("",!0),p($,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value=e),installment:v.value,"onUpdate:installment":x},null,8,["modelValue","installment"])],64))}},K=A(z,[["__scopeId","data-v-eb28b7bf"]]);export{K as I};
