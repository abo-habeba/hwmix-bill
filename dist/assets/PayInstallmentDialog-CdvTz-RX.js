import{r as d,P as D,ap as w,z as N,w as x,o as f,k as g,j as o,d as s,ah as O,b as h,a1 as T,c as j,aC as q,a as E,a2 as F,a6 as C,az as k,au as z,Y as A,a9 as B,q as L,U as M,X as R,Z as X}from"./index-arSf0HzX.js";const Y={key:0,class:"d-flex flex-column align-center justify-center",style:{height:"150px"}},G={__name:"PayInstallmentDialog",props:{installment:Object,modelValue:Boolean,directPay:{type:Boolean,default:!0}},emits:["update:modelValue","update:installment"],setup(c,{emit:U}){const i=c,P=U,m=d(!1),r=d(!1),V=d(!1),l=d({amount:"",paid_at:new Date().toISOString().substr(0,10),payment_method_id:"",cash_box_id:null,notes:"",installment_ids:[]}),y=d([]),p=d([]);D(async()=>{var t;try{const e=await w("payment-methods",{per_page:-1},!0,!1,!1);y.value=e||[];const a=e.find(u=>{var v;return((v=u.code)==null?void 0:v.trim().toLowerCase())==="cash"});a&&(l.value.payment_method_id=a.id);const n=N();if((t=n.user)!=null&&t.cashBoxes){p.value=n.user.cashBoxes||[];const u=p.value.find(v=>v.is_default);u&&(l.value.cash_box_id=u.id)}}catch(e){console.error("Error fetching payment methods or cashboxes:",e)}});const _=d(!1);x(()=>i.installment,t=>{if(t){console.log("ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… Ù‚Ø³Ø· Ø¬Ø¯ÙŠØ¯:",t),l.value.installment_ids=[t.id],l.value.amount=t.remaining,l.value.user_id=t.user_id,l.value.installment_plan_id=t.installment_plan_id,l.value.notes="",l.value.paid_at=new Date().toISOString().substr(0,10);const e=y.value.find(n=>{var u;return((u=n.code)==null?void 0:u.trim().toLowerCase())==="cash"});l.value.payment_method_id=(e==null?void 0:e.id)||"";const a=p.value.find(n=>n.is_default);l.value.cash_box_id=(a==null?void 0:a.id)||null,l.value.payment_method_id&&l.value.cash_box_id?_.value=!0:console.warn("âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ© ØªÙ…Ù†Ø¹ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.")}}),x(()=>_.value,t=>{console.log("ğŸ”„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù‚Ø³Ø·:",t),t&&i.directPay&&!V.value&&(console.log("ğŸš€ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø© ÙˆØ§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°..."),S())}),x(()=>i.modelValue,t=>{m.value=t});function b(){l.value={amount:"",paid_at:new Date().toISOString().substr(0,10),payment_method_id:"",cash_box_id:null,notes:"",installment_ids:[]},_.value=!1,V.value=!1,m.value=!1,P("update:modelValue",!1)}function S(){!i.directPay&&!r.value||X("installment-payment/pay",l.value,!1,!1).then(t=>{V.value=!0,console.log("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ø·:",t),P("update:installment",t),b()}).catch(t=>{console.error("âŒ Error submitting payment:",t),b()})}return(t,e)=>(f(),g(R,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value=a),"max-width":"400px"},{default:o(()=>[s(M,null,{default:o(()=>[s(O,null,{default:o(()=>e[7]||(e[7]=[h("Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø³Ø·")])),_:1}),s(T,null,{default:o(()=>[c.directPay?(f(),j("div",Y,[s(q,{indeterminate:"",color:"primary",class:"mb-2"}),e[8]||(e[8]=E("p",null,"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯ÙØ¹...",-1))])):(f(),g(F,{key:1,ref:"payForm",modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value=a)},{default:o(()=>[s(C,{class:"ma-1",label:"Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯",modelValue:l.value.amount,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.amount=a),type:"number",rules:[a=>!!a||"Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø·Ù„ÙˆØ¨",a=>a>0||"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±"],required:""},null,8,["modelValue","rules"]),s(C,{class:"ma-1",label:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¯Ø§Ø¯",modelValue:l.value.paid_at,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.paid_at=a),type:"date"},null,8,["modelValue"]),s(k,{class:"ma-1",label:"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",modelValue:l.value.payment_method_id,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.payment_method_id=a),items:y.value,"item-title":"name","item-value":"id",rules:[a=>!!a||"Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹"],required:""},null,8,["modelValue","items","rules"]),s(k,{class:"ma-1",label:"ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©",modelValue:l.value.cash_box_id,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.cash_box_id=a),items:p.value,"item-title":"name","item-value":"id",rules:[a=>!!a||"Ø§Ø®ØªØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"]},null,8,["modelValue","items","rules"]),s(C,{class:"ma-1",label:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",modelValue:l.value.notes,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.notes=a)},null,8,["modelValue"])]),_:1},8,["modelValue"]))]),_:1}),s(z,null,{default:o(()=>[s(A),s(B,{text:"",onClick:b},{default:o(()=>e[9]||(e[9]=[h("Ø¥Ù„ØºØ§Ø¡")])),_:1}),c.directPay?L("",!0):(f(),g(B,{key:0,color:"primary",disabled:!r.value,onClick:S},{default:o(()=>e[10]||(e[10]=[h("Ø¯ÙØ¹ Ø§Ù„Ù‚Ø³Ø·")])),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{G as _};
