import{_ as I,r as s,Q as C,w as F,o as k,c as A,d as o,k as i,b as _,t as y,aa as B,ap as E,bp as T,F as U,aq as $,l as H,W as M}from"./index-BflbBIH_.js";import{_ as N}from"./PayInstallmentDialog-KYoV6w64.js";const S={__name:"InstallmentsDataTable",setup(b){const p=[{title:"رقم القسط",key:"installment_number"},{title:"العميل",key:"user.nickname",sortable:!1},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"قيمة القسط",key:"amount"},{title:"الحالة",key:"status"},{title:"المتبقي",key:"remaining"},{title:"الإجراءات",key:"actions",sortable:!1}],n=s([]),d=s(!1),g=s(null),f=s(1),h=s(10),c=s(0),m=s(!1),r=s({page:1,itemsPerPage:10,sortBy:["due_date"],sortDesc:[!1]});function x(a){g.value=a,d.value=!0}function V({item:a}){const t=parseFloat(a.remaining)||0,e=new Date(a.due_date),l=new Date;return e.setHours(0,0,0,0),l.setHours(0,0,0,0),a.status==="تم الدفع"?{style:{backgroundColor:"#A5D6A7"}}:t>0&&e<l?{style:{backgroundColor:"#EF9A9A"}}:t>0?{style:{backgroundColor:"#FFE082"}}:{}}function D(a){a.forEach(t=>{const e=n.value.findIndex(l=>l.id===t.id);e!==-1&&(n.value[e]=t)})}async function v(){m.value=!0;const{page:a,itemsPerPage:t,sortBy:e}=r.value,l=e.length?e[0].key:"due_date",P=e.length&&e[0].order?e[0].order:"asc",w={page:a||1,limit:t||10,sort_by:l,sort_order:P};try{const u=await $("installments",w,!0,!0,!0);n.value=u.data,c.value=u.total}catch(u){console.error("فشل في جلب الأقساط:",u)}finally{m.value=!1}}return C(()=>{}),F(()=>r.value.page,()=>{v()}),(a,t)=>(k(),A(U,null,[o(E,{"item-value":"id",options:r.value,"onUpdate:options":[t[0]||(t[0]=e=>r.value=e),v],headers:p,items:n.value,"items-length":c.value,loading:m.value,hover:"","show-current-page":"","row-props":V,"loading-text":"جاري تحميل البيانات","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة"},{"item.index":i(({index:e})=>[_(y(e+1),1)]),"item.actions":i(({item:e})=>[o(B,{color:e.status==="تم الدفع"?"grey":"primary",disabled:e.status==="تم الدفع",density:"compact",onClick:l=>x(e)},{default:i(()=>[_(y(e.status==="تم الدفع"?"تم الدفع":"دفع القسط"),1)]),_:2},1032,["color","disabled","onClick"])]),_:1},8,["options","items","items-length","loading"]),o(T,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),length:Math.ceil(c.value/h.value),class:"mt-4","show-first-last":!0,"total-visible":5},null,8,["modelValue","length"]),o(N,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),installment:g.value,"onUpdate:installment":D},null,8,["modelValue","installment"])],64))}},q=I(S,[["__scopeId","data-v-0ed41f83"]]),R={__name:"installments",setup(b){return(p,n)=>(k(),H(M,{class:"pa-0",title:"الاقساط"},{default:i(()=>[o(q)]),_:1}))}};export{R as default};
