const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThermalInstallmentPrint-BdkgfRXe.js","assets/index-DyUclPBZ.js","assets/index-B17eNJ45.css","assets/ThermalInstallmentPrint-Bl1cRlaJ.css"])))=>i.map(i=>d[i]);
import{_ as Q,r as o,h as W,P as Z,c as D,d as a,j as l,U as L,X as ee,F as M,aj as te,o as c,ai as ae,am as le,a6 as ne,a9 as v,a3 as I,b as r,a as x,aJ as se,t as b,bn as oe,A as ie,k,as as T,q as h,a4 as A,a5 as u,ap as re,a1 as ue,aA as de,aq as ce,Y as me,z as pe,bg as fe,aL as ve,T as ge,ag as ye}from"./index-DyUclPBZ.js";import{_ as _e}from"./InfoDisplay-D8loTrv8.js";import{P as xe}from"./PayInstallmentDialog-DV6yGkjA.js";const be={class:"progress-bar-container"},ke={class:"d-flex flex-wrap"},he={key:0,class:"text-grey-darken-1"},Ce={class:"text-end mt-2 me-4"},Ve={__name:"InstallmentPlansTable",setup(Pe){const H=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],F=o(null);function j(n,e){var s;F.value=(s=e==null?void 0:e.item)==null?void 0:s.id,console.log("Selected Row ID:",F.value)}const q=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status_label"},{title:"الإجراءات",key:"actions",sortable:!1}];function G(n){if(n&&n.id){const e=pe();let s="اسم الشركة";if(e.user&&e.user.companies&&e.user.company_id){const _=e.user.companies.find(w=>w.id===e.user.company_id);_&&(s=_.name)}const t=n,d=document.createElement("div");document.body.appendChild(d),fe(()=>import("./ThermalInstallmentPrint-BdkgfRXe.js"),__vite__mapDeps([0,1,2,3])).then(_=>{const w=_.default,z=ve({render(){return ge(w,{installment:t,companyName:s,ref:"thermalRef"})},mounted(){ye(()=>{this.$refs.thermalRef.printThermal&&this.$refs.thermalRef.printThermal(),setTimeout(()=>{z.unmount(),document.body.removeChild(d)},500)})}});z.mount(d)})}}const E=o([]),m=o([]),i=o({}),g=o(!1),S=o(null),C=o(!1),R=o(!0),U=o(10),p=o({page:1,itemsPerPage:10,sortBy:[],sortDesc:[]}),$=o(0),V=o(!1),f=o(null),J=()=>{!f.value||f.value.length<3||(p.value.page=1,P())};function y(n){const e=parseFloat(n.total_installments_pay)||0,s=parseFloat(n.total_installments_amount)||1;return Math.min(Math.round(e/s*100),100)}function O(n){const e=y(n);return e===100?"#4CAF50":e>=50?"#2196F3":e>=20?"#FFC107":"#F44336"}const X=W(()=>i.value.start_date?new Date(i.value.start_date).toLocaleDateString("ar-EG"):"—");function B({item:n}){const e=parseFloat(n.remaining)||0,s=new Date(n.due_date),t=new Date;return s.setHours(0,0,0,0),t.setHours(0,0,0,0),n.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:e>0&&s<t?{style:{backgroundColor:"#EF9A9A"}}:e>0?{style:{backgroundColor:"#FFE082"}}:y(n)=="100"?{style:{backgroundColor:"#E8F5E9"}}:{}}async function P(){V.value=!0;try{const n=await te("installment-plans",{page:p.value.page,per_page:p.value.itemsPerPage,search:f.value});E.value=n.data||[],$.value=n.total||0}catch(n){console.error("حدث خطأ أثناء جلب الخطط",n)}finally{V.value=!1}}function Y(n){n.paid_installments.forEach(e=>{const s=m.value.findIndex(t=>t.id===e.id);s!==-1&&(m.value[s]={...m.value[s],...e})})}function K(n){!n||!Array.isArray(n.installments)||(i.value=n,m.value=n.installments,g.value=!0)}function N(n,e){S.value=n,R.value=e,C.value=!0}return Z(P),(n,e)=>{const s=_e;return c(),D(M,null,[a(L,{class:"pa-2"},{default:l(()=>[a(ae,{"fixed-header":"","items-per-page":U.value,"onUpdate:itemsPerPage":e[1]||(e[1]=t=>U.value=t),options:p.value,"onUpdate:options":[e[2]||(e[2]=t=>p.value=t),P],headers:H,items:E.value,"items-length":$.value,loading:V.value,hover:"","show-current-page":"","show-select":"","item-selectable":"","item-value":"id","row-props":B,class:"elevation-1",density:"compact","loading-text":"جاري تحميل البيانات...","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة","items-per-page-options":[10,25,50,100,500,{value:-1,title:"الكل"}],"onClick:row":j},{top:l(()=>[a(le,null,{default:l(()=>[a(ne,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),label:"ابحث باسم المستخدم","prepend-inner-icon":"ri-search-line","hide-details":"",clearable:"",class:"ma-10","max-width":"200",rounded:"",onInput:J,rules:[t=>t&&t.length>=3||"ادخل 3 حروف على الاقل"]},null,8,["modelValue","rules"])]),_:1})]),"item.actions":l(({item:t})=>[a(v,{color:"primary",density:"compact",onClick:I(d=>K(t),["stop"])},{default:l(()=>e[7]||(e[7]=[r("عرض الأقساط")])),_:2},1032,["onClick"])]),"item.paid_percentage":l(({item:t})=>[x("div",be,[x("div",{class:"progress-bar-fill",style:se({width:y(t)+"%",backgroundColor:O(t)})},b(y(t))+"% ",5)])]),"item.plan_products":l(({item:t})=>[a(oe,{column:""},{default:l(()=>[x("div",ke,[(c(!0),D(M,null,ie(t.invoice_items.slice(0,2),d=>(c(),k(T,{key:d.id,size:"small",color:"info",variant:"outlined"},{default:l(()=>[r(b(d.name),1)]),_:2},1024))),128)),t.invoice_items.length>2?(c(),k(T,{key:0,class:"text-grey px-1"},{default:l(()=>[r("منتجات "+b(t.invoice_items.length-2)+" اخرين ",1)]),_:2},1024)):h("",!0)]),!t.invoice_items||t.invoice_items.length===0?(c(),D("span",he,"لا توجد منتجات")):h("",!0)]),_:2},1024)]),"no-data":l(()=>[a(A,{class:"pa-4"},{default:l(()=>[a(u,{class:"text-center text-grey"},{default:l(()=>e[8]||(e[8]=[r("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items-per-page","options","items","items-length","loading"])]),_:1}),a(ee,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),"max-width":"900px",scrollable:"",persistent:""},{default:l(()=>[a(L,null,{default:l(()=>[a(re,{class:"bg-primary text-white"},{default:l(()=>e[9]||(e[9]=[r(" تفاصيل خطة التقسيط ")])),_:1}),a(ue,{style:{"max-height":"70vh","overflow-y":"auto"}},{default:l(()=>[a(A,{class:"px-4 pt-4",dense:""},{default:l(()=>[a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-user-line",label:"المستخدم",text:((t=i.value.user)==null?void 0:t.nickname)||"غير متوفر"},null,8,["text"])]}),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-file-text-line",label:"الفاتورة",text:((t=i.value.invoice)==null?void 0:t.invoice_number)||"—"},null,8,["text"])]}),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-calendar-line",label:"تاريخ الخطة",text:X.value},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-money-dollar-box-line",label:"إجمالي الفاتورة",text:i.value.total_amount},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-wallet-line",label:"إجمالي المتبقي",text:i.value.total_installments_remaining},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-coin-line",label:"إجمالي المدفوع",text:i.value.total_pay},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(s,{icon:"ri-hand-heart-line",label:"المقدم",text:i.value.down_payment},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(s,{icon:"ri-list-ordered",label:"عدد الأقساط",text:((t=i.value.installments)==null?void 0:t.length)||0},null,8,["text"])]}),_:1})]),_:1}),a(de,{"row-props":B,headers:q,items:m.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":l(({item:t})=>[a(T,{color:t.status==="paid"?"success":"error",dark:""},{default:l(()=>[r(b(t.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[t.status!=="paid"?(c(),k(v,{key:0,color:t.status==="paid"?"grey":"success",disabled:t.status==="paid",density:"compact",class:"me-1",onClick:I(d=>N(t,!0),["stop"])},{default:l(()=>e[10]||(e[10]=[r(" دفع القسط ")])),_:2},1032,["color","disabled","onClick"])):h("",!0),t.status!=="paid"?(c(),k(v,{key:1,color:t.status==="paid"?"grey":"warning",disabled:t.status==="paid",density:"compact",onClick:I(d=>N(t,!1),["stop"])},{default:l(()=>e[11]||(e[11]=[r(" مبلغ مختلف ")])),_:2},1032,["color","disabled","onClick"])):h("",!0)]),"no-data":l(()=>[a(A,{class:"pa-4"},{default:l(()=>[a(u,{class:"text-center text-grey"},{default:l(()=>e[12]||(e[12]=[r(" لا توجد أقساط لهذه الخطة ")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),a(ce,{class:"bg-grey-lighten-4",style:{position:"sticky",bottom:"0","z-index":"1"}},{default:l(()=>[a(me),a(v,{"prepend-icon":"ri-close-line",text:"",onClick:e[3]||(e[3]=t=>g.value=!1)},{default:l(()=>e[13]||(e[13]=[r("إغلاق")])),_:1}),x("div",Ce,[a(v,{"prepend-icon":"ri-printer-line",color:"primary",onClick:e[4]||(e[4]=t=>G(i.value))},{default:l(()=>e[14]||(e[14]=[r(" طباعة الخطة ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(xe,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t),installment:S.value,"direct-pay":R.value,"onUpdate:installment":Y},null,8,["modelValue","installment","direct-pay"])],64)}}},Te=Q(Ve,[["__scopeId","data-v-63803c41"]]);export{Te as default};
