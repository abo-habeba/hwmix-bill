import{_ as B,o as S,c as M,d as e,k as l,b as h,aC as se,F as T,B as Q,l as q,a5 as r,ay as z,aD as ue,a9 as O,a4 as $,aE as ae,a6 as P,s as me,W as J,S as ye,r as w,w as L,ah as ge,Q as fe,ap as R,ai as H,a as k,t as A,a1 as pe,q as ve,u as de,a2 as _e,N as be,Y as ie,$ as ne,j as xe,I as we,n as ke,aF as he,a7 as Ue,ak as re,a3 as G,V as oe,au as Oe,aB as Ce,aa as ce}from"./index-CZ60Lw01.js";import{_ as Se}from"./AttributesDisplay-Wz3rf1q2.js";const Pe={__name:"ProductVariantAttributes",props:{modelValue:Array},emits:["update:modelValue"],setup(o,{emit:E}){const b=o,s=E;function i(v){if(!v)return[];const d=b.modelValue.find(p=>p.id===v);return d?d.values:[]}function f(v,d){const p=i(v).find(V=>V.id===d);return p&&p.color?`background:${p.color};color:${C(p.color)};border-radius:6px;`:""}function C(v){if(!v)return"#000";const d=v.substring(1),p=parseInt(d,16),V=p>>16&255,u=p>>8&255,c=p>>0&255;return .299*V+.587*u+.114*c>186?"#000":"#fff"}function _(){console.log("Adding attribute...");const v={attribute_id:null,attribute_value_id:null};s("update:modelValue",[...b.modelValue,v]),console.log("Updated attributes:",[...b.modelValue,v])}function g(v){console.log("Removing attribute at index:",v);const d=[...b.modelValue];d.splice(v,1),s("update:modelValue",d),console.log("Updated attributes after removal:",d)}return(v,d)=>(S(),M(T,null,[e(se,{class:"ma-1"},{default:l(()=>d[0]||(d[0]=[h("الخصائص (Attributes)")])),_:1}),(S(!0),M(T,null,Q(o.modelValue,(p,V)=>(S(),q($,{dense:"",key:V,class:"d-flex align-center"},{default:l(()=>[e(r,{cols:"5"},{default:l(()=>[e(z,{modelValue:p.attribute_id,"onUpdate:modelValue":[u=>p.attribute_id=u,()=>p.attribute_value_id=null],items:i(p.attribute_id),"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(r,{cols:"5"},{default:l(()=>[e(z,{modelValue:p.attribute_value_id,"onUpdate:modelValue":u=>p.attribute_value_id=u,items:i(p.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!p.attribute_id,"return-object":!1,"hide-details":"auto",style:ue(f(p.attribute_id,p.attribute_value_id))},null,8,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(r,{cols:"2"},{default:l(()=>[e(O,{class:"my-a",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:u=>g(V)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-1 pa-1",text:"",color:"primary",small:"",onClick:_},{default:l(()=>d[1]||(d[1]=[h("+ إضافة خاصية")])),_:1})],64))}},Ve=B(Pe,[["__scopeId","data-v-5ac18778"]]),Ee={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(o,{emit:E}){return(b,s)=>(S(),q($,null,{default:l(()=>[e(r,{cols:"12",sm:"4"},{default:l(()=>[e(ae,{modelValue:o.modelValue.active,"onUpdate:modelValue":s[0]||(s[0]=i=>o.modelValue.active=i),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(ae,{modelValue:o.modelValue.featured,"onUpdate:modelValue":s[1]||(s[1]=i=>o.modelValue.featured=i),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(ae,{modelValue:o.modelValue.returnable,"onUpdate:modelValue":s[2]||(s[2]=i=>o.modelValue.returnable=i),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:o.modelValue.name,"onUpdate:modelValue":s[3]||(s[3]=i=>o.modelValue.name=i),label:"اسم المنتج",rules:o.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(z,{modelValue:o.modelValue.category_id,"onUpdate:modelValue":s[4]||(s[4]=i=>o.modelValue.category_id=i),items:o.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(z,{modelValue:o.modelValue.brand_id,"onUpdate:modelValue":s[5]||(s[5]=i=>o.modelValue.brand_id=i),items:o.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",sm:"6"},{default:l(()=>[e(P,{modelValue:o.modelValue.desc,"onUpdate:modelValue":s[6]||(s[6]=i=>o.modelValue.desc=i),label:"الوصف",rules:o.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",sm:"6"},{default:l(()=>[e(P,{modelValue:o.modelValue.desc_long,"onUpdate:modelValue":s[7]||(s[7]=i=>o.modelValue.desc_long=i),label:"الوصف المفصل",rules:o.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1}))}},Ne=B(Ee,[["__scopeId","data-v-dd0c8570"]]),Ae={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],qty:[]})}},emits:["update:modelValue"],setup(o,{emit:E}){const b=o,s=E,i=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function f(C){if(b.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const _=[...b.modelValue];_.splice(C,1),s("update:modelValue",_)}return(C,_)=>(S(),M(T,null,[e(se,{class:"ma-1"},{default:l(()=>_[1]||(_[1]=[h("المخزون (Stocks)")])),_:1}),(S(!0),M(T,null,Q(o.modelValue,(g,v)=>(S(),q($,{dense:"",key:g.id||v},{default:l(()=>[e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:g.cost,"onUpdate:modelValue":d=>g.cost=d,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:o.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:g.qty,"onUpdate:modelValue":d=>g.qty=d,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:o.stockRules.qty,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"4"},{default:l(()=>[o.warehouses&&o.warehouses.length>0?(S(),q(z,{key:0,modelValue:g.warehouse_id,"onUpdate:modelValue":d=>g.warehouse_id=d,"item-value":"id","item-title":"name",items:o.warehouses,label:"المخزن",rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(S(),q(z,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[d=>!!d||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(r,{cols:"4"},{default:l(()=>[e(z,{modelValue:g.status,"onUpdate:modelValue":d=>g.status=d,items:i,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[d=>!!d||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:g.expiry,"onUpdate:modelValue":d=>g.expiry=d,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:g.loc,"onUpdate:modelValue":d=>g.loc=d,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),o.modelValue.length>1?(S(),q(O,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:_[0]||(_[0]=g=>f(C.sIndex))})):me("",!0)],64))}},$e=B(Ae,[["__scopeId","data-v-7b0f1eb8"]]),qe={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(o,{emit:E}){return(b,s)=>(S(),q($,null,{default:l(()=>[e(r,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:o.variant.retail_price,"onUpdate:modelValue":s[0]||(s[0]=i=>o.variant.retail_price=i),label:"سعر البيع بالتجزئة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:o.variant.wholesale_price,"onUpdate:modelValue":s[1]||(s[1]=i=>o.variant.wholesale_price=i),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",sm:"4"},{default:l(()=>[e(z,{modelValue:o.variant.status,"onUpdate:modelValue":s[2]||(s[2]=i=>o.variant.status=i),items:o.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(J,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Ve,{modelValue:o.variant.attributes,"onUpdate:modelValue":s[3]||(s[3]=i=>o.variant.attributes=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(J,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e($e,{modelValue:o.variant.stocks,"onUpdate:modelValue":s[4]||(s[4]=i=>o.variant.stocks=i),warehouses:o.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(r,{cols:"12"},{default:l(()=>[e(O,{color:"error",onClick:s[5]||(s[5]=i=>b.$emit("remove-variant",o.variantIndex))},{default:l(()=>s[6]||(s[6]=[h("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Fe=B(qe,[["__scopeId","data-v-a521efb2"]]),De={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(o,{emit:E}){const b=o,s=E,{xs:i}=ye(),f=w(b.dialog),C=w(null),_=w(!1),g=w([]),v=w([]),d=w([]),p=w([]),V=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",u=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",c=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",D={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{qty:0,reserved:0,min_qty:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},m=w(JSON.parse(JSON.stringify(D)));function I(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(a=>({id:a.id,barcode:a.barcode||"",sku:a.sku||"",retail_price:parseFloat(a.retail_price)||0,wholesale_price:parseFloat(a.wholesale_price)||0,image:a.image||null,weight:parseFloat(a.weight)||0,dimensions:a.dimensions||"",tax:parseFloat(a.tax)||0,discount:parseFloat(a.discount)||0,status:a.status||"active",attributes:(a.attributes||[]).map(y=>({attribute_id:y.attribute_id||null,attribute_value_id:y.attribute_value_id||null})),stocks:(a.stocks||[]).map(y=>({id:y.id,qty:y.qty||0,reserved:y.reserved||0,min_qty:y.min_qty||0,cost:parseFloat(y.cost)||0,batch:y.batch||"",expiry:y.expiry?new Date(y.expiry).toISOString().substr(0,10):null,loc:y.loc||"",status:y.status??"available",warehouse_id:y.warehouse?y.warehouse.id:null}))}))}}const F={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[c,u],wholesale_price:[c,u],tax:[V,u],discount:[V,u],weight:[V,u],qty:[c,u],cost:[V,u]};function K(){m.value.variants.length>0&&m.value.variants[0].stocks.length>0&&v.value.length>0&&m.value.variants[0].stocks[0].warehouse_id===null&&(m.value.variants[0].stocks[0].warehouse_id=v.value[0].id)}L(()=>b.dialog,async t=>{f.value=t,t&&(b.isEditMode&&b.product?m.value=I(b.product):(m.value=JSON.parse(JSON.stringify(D)),K()),await ge(),C.value&&C.value.resetValidation())},{immediate:!0}),L(f,t=>{s("update:dialog",t)}),L(()=>b.product,t=>{b.isEditMode&&t&&(m.value=I(t))}),fe(async()=>{await Promise.all([Y(),Z(),X(),ee()]),b.isEditMode||K()});async function Y(){try{const t=await R("brands",null,!0,!1);g.value=t.data}catch(t){console.error("Error fetching brands:",t)}}async function Z(){try{const t=await R("attributes",null,!0,!1);p.value=t.data}catch(t){console.error("Error fetching attributes:",t)}}async function X(){try{const t=await R("warehouses",null,!0,!1);v.value=t.data,b.isEditMode||K()}catch(t){console.error("Error fetching warehouses:",t)}}async function ee(){try{const t=await R("categories",null,!0,!1);d.value=t.data}catch(t){console.error("Error fetching categories:",t)}}function W(){s("close"),f.value=!1}function le(){m.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,active:!0,featured:!1,returnable:!0,dimensions:"",tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{qty:0,reserved:0,min_qty:0,cost:0,batch:"",expiry:null,loc:"",status:!0,warehouse_id:v.value.length>0?v.value[0].id:null}]}),console.log("Updated variants after addition:",m.value.variants)}function te(t){m.value.variants.splice(t,1),console.log("Updated variants after removal:",m.value.variants)}async function x(){if(!C.value)return;const{valid:t}=await C.value.validate();if(t)try{const a=JSON.parse(JSON.stringify(m.value));Object.prototype.hasOwnProperty.call(a,"active")||Object.prototype.hasOwnProperty.call(a,"is_active")&&(a.active=a.is_active,delete a.is_active),Object.prototype.hasOwnProperty.call(a,"returnable")||Object.prototype.hasOwnProperty.call(a,"is_returnable")&&(a.returnable=a.is_returnable,delete a.is_returnable),Object.prototype.hasOwnProperty.call(a,"desc")||Object.prototype.hasOwnProperty.call(a,"description")&&(a.desc=a.description,delete a.description),Object.prototype.hasOwnProperty.call(a,"desc_long")||Object.prototype.hasOwnProperty.call(a,"description_long")&&(a.desc_long=a.description_long,delete a.description_long),a.variants.forEach(U=>{U.stocks&&U.stocks.length>0&&U.stocks.forEach(j=>{!j.warehouse_id&&v.value.length>0&&(j.warehouse_id=v.value[0].id)})});let y;if(console.log("Saving product with payload:",a),console.log("Saving product with payload:",JSON.stringify(a)),a.id)y=await ne("product",a,a.id);else{const{id:U,...j}=a;y=await ne("product",j)}s("saved",y.data),W()}catch(a){console.error("Error saving product:",a)}}const n=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];return(t,a)=>{const y=Ve;return S(),q(ie,{fullscreen:de(i),modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=U=>f.value=U)},{default:l(()=>[e(J,null,{default:l(()=>[e(O,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:W}),e(H,{class:"ma-3 text-center"},{default:l(()=>[k("h2",null,A(o.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(pe,{class:ve(de(i)?"px-2":"px-5")},{default:l(()=>[e(_e,{ref_key:"productForm",ref:C,modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=U=>_.value=U)},{default:l(()=>[e(Ne,{modelValue:m.value,categories:d.value,brands:g.value,productRules:F,"onUpdate:modelValue":a[0]||(a[0]=U=>m.value=U)},null,8,["modelValue","categories","brands"]),e(J,{class:"py-2 px-4 ma-2"},{default:l(()=>[e(H,null,{default:l(()=>a[3]||(a[3]=[h(" خيارات المنتج ")])),_:1}),(S(!0),M(T,null,Q(m.value.variants,(U,j)=>(S(),q($,{class:"bg-grey-lighten-4 pa-2",key:j},{default:l(()=>[e(Fe,{variant:U,variantIndex:j,attributes:p.value,warehouses:v.value,statusOptions:n,productRules:F,onRemoveVariant:te},{default:l(()=>[e(y,{modelValue:U.attributes,"onUpdate:modelValue":N=>U.attributes=N,attributes:p.value},null,8,["modelValue","onUpdate:modelValue","attributes"])]),_:2},1032,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e($,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(O,{class:"my-3",color:"primary",onClick:le},{default:l(()=>a[4]||(a[4]=[h("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(be,{class:"my-4"}),e($,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(O,{"prepend-icon":"ri-close-line",color:"error",onClick:W},{default:l(()=>a[5]||(a[5]=[h(" إلغاء ")])),_:1})]),_:1}),e(r,{cols:"6",class:"text-end"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",disabled:!_.value,onClick:x},{default:l(()=>[h(A(o.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})]),_:1},8,["fullscreen","modelValue"])}}},Ie=B(De,[["__scopeId","data-v-7daff030"]]),je={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(o,{emit:E}){const b=o,s=E,i=xe({get:()=>b.modelValue,set:V=>s("update:modelValue",V)}),f=w({});L(()=>b.variant,V=>{f.value=JSON.parse(JSON.stringify(V||{}))},{immediate:!0});function C(V){if(!V)return[];const u=b.attributes.find(c=>c.id===V);return u?u.values:[]}function _(V){if(!V)return"#000";const u=V.substring(1),c=parseInt(u,16),D=c>>16&255,m=c>>8&255,I=c>>0&255;return .299*D+.587*m+.114*I>186?"#000":"#fff"}function g(){f.value.attributes=f.value.attributes||[],f.value.attributes.push({attribute_id:null,attribute_value_id:null})}function v(V){f.value.attributes.splice(V,1)}function d(){s("update:modelValue",!1)}function p(){s("save",JSON.parse(JSON.stringify(f.value))),d()}return(V,u)=>(S(),q(ie,{modelValue:i.value,"onUpdate:modelValue":u[7]||(u[7]=c=>i.value=c),"max-width":"600"},{default:l(()=>[e(J,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(H,null,{default:l(()=>u[8]||(u[8]=[h("تعديل متغير المنتج")])),_:1}),e($,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(r,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e($,null,{default:l(()=>[e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:f.value.purchase_price,"onUpdate:modelValue":u[0]||(u[0]=c=>f.value.purchase_price=c),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:f.value.retail_price,"onUpdate:modelValue":u[1]||(u[1]=c=>f.value.retail_price=c),label:"سعر التجزئة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:l(()=>[e(P,{modelValue:f.value.wholesale_price,"onUpdate:modelValue":u[2]||(u[2]=c=>f.value.wholesale_price=c),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:l(()=>[e($,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(P,{modelValue:f.value.tax_rate,"onUpdate:modelValue":u[3]||(u[3]=c=>f.value.tax_rate=c),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(P,{modelValue:f.value.discount,"onUpdate:modelValue":u[4]||(u[4]=c=>f.value.discount=c),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{class:"py-0",cols:"12"},{default:l(()=>[e($,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(P,{modelValue:f.value.expiry_date,"onUpdate:modelValue":u[5]||(u[5]=c=>f.value.expiry_date=c),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(r,{cols:"6"},{default:l(()=>[e(P,{modelValue:f.value.image_url,"onUpdate:modelValue":u[6]||(u[6]=c=>f.value.image_url=c),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12",class:"mt-4"},{default:l(()=>[e(se,null,{default:l(()=>u[9]||(u[9]=[h("الخصائص (Attributes)")])),_:1}),(S(!0),M(T,null,Q(f.value.attributes,(c,D)=>(S(),q($,{dense:"",key:D,class:"d-flex align-center"},{default:l(()=>[e(r,{cols:"5"},{default:l(()=>[e(z,{modelValue:c.attribute_id,"onUpdate:modelValue":m=>c.attribute_id=m,items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>c.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(r,{cols:"5"},{default:l(()=>[e(z,{modelValue:c.attribute_value_id,"onUpdate:modelValue":m=>c.attribute_value_id=m,items:C(c.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!c.attribute_id,":return-object":!1,"hide-details":"auto",style:ue((()=>{const m=C(c.attribute_id).find(I=>I.id===c.attribute_value_id);return m&&m.color?`background:${m.color};color:${_(m.color)};border-radius:6px;`:""})())},{item:l(({item:m,props:I})=>[e(we,ke({ref_for:!0},I,{style:m.raw.color?`background:${m.raw.color};color:${_(m.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:m})=>[k("span",{style:ue(m.raw.color?`background:${m.raw.color};color:${_(m.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},A(m.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(r,{cols:"2"},{default:l(()=>[e(O,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:m=>v(D)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O,{class:"my-2",text:"",color:"primary",small:"",onClick:g},{default:l(()=>u[10]||(u[10]=[h("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(be,{class:"my-4"}),e($,null,{default:l(()=>[e(r,{cols:"6"},{default:l(()=>[e(O,{"prepend-icon":"ri-close-line",color:"error",onClick:d},{default:l(()=>u[11]||(u[11]=[h(" إلغاء ")])),_:1})]),_:1}),e(r,{cols:"6",class:"text-center"},{default:l(()=>[e(O,{"prepend-icon":"ri-save-line",color:"success",onClick:p},{default:l(()=>u[12]||(u[12]=[h(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ze=B(je,[["__scopeId","data-v-594e8d1d"]]),Me={class:"d-flex align-center justify-space-between mb-2"},Je={class:"d-flex align-center gap-2"},Be=["onClick"],Re={key:0},Te={colspan:"5",class:"pa-0 bg-variant-table"},Ke={class:"bg-variant-table"},We={__name:"products",setup(o){const E=w(!1),b=w({}),s=w(!1),i=w([]),f=w(!1),C=w(null),_=w(null),g=w(0),v=w(!1),d=w({page:1,itemsPerPage:10,sortBy:[]}),p=w(""),V=w(!1),u=w(null),c=w([]),D=[{title:"الاسم",key:"name"},{title:"الكمية",key:"stock_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],m=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"سعر الشراء",key:"purchase_price"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر التجزئة",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];fe(()=>{F(),I()});function I(){R("attributes",null,!0,!1).then(x=>{c.value=x.data})}function F(){v.value=!0;const{page:x,itemsPerPage:n,sortBy:t}=d.value,a=t.length?t[0].key:"id",y=t.length&&t[0].order?t[0].order:"desc";R("products",{page:x,per_page:n,sort_by:a,sort_order:y,search:p.value}).then(U=>{i.value=U.data,g.value=U.total}).finally(()=>{v.value=!1})}function K(){s.value=!1,b.value={},E.value=!0}function Y(x){E.value=!0,s.value=!0,b.value=JSON.parse(JSON.stringify(x)),console.log("Edit Mode: dialogProduct stringify",JSON.stringify(b.value)),console.log("Edit Mode: dialogProduct updated",b.value)}function Z(x){const n=i.value.findIndex(t=>t.id===x.id);n!==-1?i.value[n]=x:i.value.push(x),E.value=!1}function X(x){C.value=x,f.value=!0}function ee(){C.value&&Ce("product/delete",C.value.id).then(()=>{F(),ce.success("تم حذف المنتج بنجاح"),f.value=!1,C.value=null}).catch(()=>ce.error("حدث خطأ أثناء حذف المنتج"))}function W(x){_.value=_.value===x?null:x}function le(x,n){u.value=JSON.parse(JSON.stringify(x)),u.value.product_id=n,console.log("openVariantEditDialog",u.value),console.log("attributes",c.value),V.value=!0}function te(x){const n=i.value.find(a=>a.id===(x.product_id||_.value));if(!n)return;const t=n.variants.findIndex(a=>a.id===x.id);t!==-1&&(n.variants[t]=x),V.value=!1}return(x,n)=>(S(),q(he,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(Ie,{dialog:E.value,"onUpdate:dialog":n[0]||(n[0]=t=>E.value=t),product:b.value,isEditMode:s.value,onSaved:Z},null,8,["dialog","product","isEditMode"]),e(ze,{modelValue:V.value,"onUpdate:modelValue":n[1]||(n[1]=t=>V.value=t),variant:u.value,attributes:c.value,onSave:te},null,8,["modelValue","variant","attributes"]),e(J,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[k("div",Me,[n[8]||(n[8]=k("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(O,{color:"primary",onClick:K,size:"small"},{default:l(()=>n[7]||(n[7]=[h("+ إضافة منتج")])),_:1}),k("div",Je,[e(P,{modelValue:p.value,"onUpdate:modelValue":n[2]||(n[2]=t=>p.value=t),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Ue(F,["enter"]),onBlur:F,clearable:"","onClick:clear":n[3]||(n[3]=()=>{p.value="",F()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":F},null,8,["modelValue"])])]),e(re,{items:i.value,headers:D,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:v.value,options:d.value,"server-items-length":g.value,"items-per-page":d.value.itemsPerPage,page:d.value.page,"sort-by":d.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":F},{item:l(({item:t})=>{var a,y,U,j;return[k("tr",{class:ve({"bg-product-expanded":_.value===t.id}),onClick:N=>W(t.id),style:{cursor:"pointer"}},[k("td",null,A(t.name),1),k("td",null,A(t.stock_quantity??((y=(a=t.variants)==null?void 0:a[0])==null?void 0:y.stock_quantity)??0),1),k("td",null,A(((U=t.category)==null?void 0:U.name)??"-"),1),k("td",null,A(((j=t.brand)==null?void 0:j.name)??"-"),1),k("td",{onClick:n[4]||(n[4]=G(()=>{},["stop"]))},[e(O,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:G(N=>Y(t),["stop"])},null,8,["onClick"]),e(O,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:G(N=>X(t),["stop"])},null,8,["onClick"])])],10,Be),_.value===t.id?(S(),M("tr",Re,[k("td",Te,[e(re,{items:t.variants,headers:m,"item-key":"id",density:"compact",class:"text-start bg-variant-table","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:N})=>[k("tr",Ke,[k("td",null,A(N.sku),1),k("td",null,A(N.barcode),1),k("td",null,A(N.purchase_price),1),k("td",null,A(N.wholesale_price),1),k("td",null,A(N.retail_price),1),k("td",null,A(N.discount),1),k("td",null,[e(Se,{attributes:N.attributes,"font-size":"10px"},null,8,["attributes"])]),k("td",null,[k("div",null,[e(O,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:G(Ge=>le(N,t.id),["stop"])},{default:l(()=>[e(oe,{size:"16"},{default:l(()=>n[9]||(n[9]=[h("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(O,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(oe,{size:"16"},{default:l(()=>n[10]||(n[10]=[h("ri-delete-bin-line")])),_:1})]),_:1}),e(O,{size:"x-small",icon:"",color:"success",title:"طباعة"},{default:l(()=>[e(oe,{size:"16"},{default:l(()=>n[11]||(n[11]=[h("ri-printer-line")])),_:1})]),_:1})])])])]),_:2},1032,["items"])])])):me("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(ie,{modelValue:f.value,"onUpdate:modelValue":n[6]||(n[6]=t=>f.value=t),"max-width":"340"},{default:l(()=>[e(J,null,{default:l(()=>[e(H,null,{default:l(()=>n[12]||(n[12]=[h("تأكيد الحذف")])),_:1}),e(pe,null,{default:l(()=>n[13]||(n[13]=[h("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(Oe,null,{default:l(()=>[e(O,{color:"error",onClick:ee,size:"small"},{default:l(()=>n[14]||(n[14]=[h("تأكيد")])),_:1}),e(O,{onClick:n[5]||(n[5]=t=>f.value=!1),size:"small"},{default:l(()=>n[15]||(n[15]=[h("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Qe=B(We,[["__scopeId","data-v-a9f4d919"]]);export{Qe as default};
