import{S as Y,r as m,w as h,o as r,c as y,d as e,k as l,b,t as D,aa as I,W as T,ai as F,a5 as B,a6 as C,a2 as E,l as R,F as P,B as A,a9 as de,s as L,X as me,av as O,Z,u as x,Y as W,$ as J,Q as pe,aw as ce,a as j,al as ee,_ as le,ag as fe,v as ve,V as be,n as Ve,a4 as H,a8 as ye,i as ge,a7 as q,N as M,H as ke,I as xe,L as _e,a0 as z,A as we,g as Ce,ax as Ne,ay as Ue,az as Q,a3 as Re,aA as X,q as De,aB as $e,h as Ie,aq as Pe,ar as qe}from"./index-Dv1TzYd-.js";const Te={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(N,{emit:w}){const{xs:$}=Y(),g=N,U=w,d=m(g.roles),c=m(!1),f=m([]);h(()=>g.user.roles,p=>{f.value=p?p.map(s=>s.name):[]},{immediate:!0});function v(){const p={user_id:g.user.id,roles:f.value};console.log(p),J("role/assignRole",p).then(s=>{U("update:user",s),c.value=!1})}return(p,s)=>(r(),y(P,null,[e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:s[0]||(s[0]=k=>c.value=!0)},{default:l(()=>[b(D(d.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(W,{fullscreen:x($),modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=k=>c.value=k),"max-width":"500"},{default:l(()=>[e(T,{class:"pa-4"},{default:l(()=>[e(F,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>s[4]||(s[4]=[b("تعديل ادوار المستخدم ")])),_:1}),e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>s[5]||(s[5]=[b(" اضافة دور جديد ")])),_:1}),e(B,{class:"mb-7"},{default:l(()=>[e(C,{cols:"12"},{default:l(()=>[e(E,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[d.value.length?(r(),R(B,{key:0},{default:l(()=>[(r(!0),y(P,null,A(d.value,(k,_)=>(r(),R(C,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:_},{default:l(()=>[k?(r(),R(de,{key:0,modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=a=>f.value=a),label:k.name,value:k.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):L("",!0)]),_:2},1024))),128))]),_:1})):(r(),R(me,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>s[6]||(s[6]=[b(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(O,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(I,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:s[2]||(s[2]=k=>c.value=!1)},{default:l(()=>s[7]||(s[7]=[b(" إلغاء ")])),_:1}),e(Z),e(I,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:v},{default:l(()=>s[8]||(s[8]=[b(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},he={key:0},Ae={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(N,{expose:w}){const $=N,g=m(null),U=m([]);pe(()=>{});const d=m(!1);function c(){d.value=!0}return h(()=>$.userRole,async f=>{f&&f.permissions&&(U.value=f.permissions,g.value=await ce(U.value))},{immediate:!0}),w({openDialog:c}),(f,v)=>(r(),R(W,{modelValue:d.value,"onUpdate:modelValue":v[1]||(v[1]=p=>d.value=p),"max-width":"500px"},{default:l(()=>[e(T,null,{default:l(()=>[e(F,null,{default:l(()=>[j("span",null," صلاحيات الدور "+D(N.userRole.name),1)]),_:1}),g.value?(r(),y("div",he,[(r(!0),y(P,null,A(g.value,(p,s)=>(r(),y("div",{key:s},[v[2]||(v[2]=j("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(F,null,{default:l(()=>[j("span",null,D(p.name),1)]),_:2},1024),(r(!0),y(P,null,A(p.permissions,(k,_)=>(r(),R(ee,{class:"ma-1",key:_,color:"blue","text-color":"white"},{default:l(()=>[b(D(k.name),1)]),_:2},1024))),128))]))),128))])):L("",!0),e(O,null,{default:l(()=>[e(I,{text:"",onClick:v[0]||(v[0]=p=>d.value=!1)},{default:l(()=>v[3]||(v[3]=[b("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Se={class:"phone-input-wrapper"},Fe={key:0},Be={key:1},Le={key:0},je={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(N,{emit:w}){const $=N,g=w,{initialPhoneNumber:U}=fe($),d=m(U.value);h(d,a=>{g("update:phoneNumber",a)}),h(U,a=>{a!==d.value&&(d.value=a)});const c=m(!1),f=m([]),v=m("");function p(a){let n=a.replace(/\s+/g,"").replace(/^\+/,"");return n=n.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),n}async function s(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){z.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const a=["tel","name"],n={multiple:!1},i=await navigator.contacts.select(a,n);i&&i.length&&i[0].tel&&i[0].tel.length?i[0].tel.length===1?d.value=p(i[0].tel[0]):(f.value=i[0].tel.map(p),v.value=i[0].name?i[0].name[0]:"",c.value=!0):z.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{z.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function k(a){d.value=p(a),c.value=!1}const _=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(a,n)=>(r(),y("div",Se,[e(x(q),{modelValue:x(d),"onUpdate:modelValue":n[2]||(n[2]=i=>ge(d)?d.value=i:null),label:N.label,placeholder:N.placeholder,rules:N.rules,counter:N.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":s,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(x(ve),{location:"top"},{activator:l(({props:i})=>[e(x(be),Ve(i,{class:"contact-picker-icon",color:x(_)?"primary":"grey",size:"24",style:x(_)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:n[0]||(n[0]=H(S=>x(_)&&s(),["stop"])),tabindex:"0",onKeydown:n[1]||(n[1]=ye(H(S=>x(_)&&s(),["prevent"]),["enter"])),"aria-disabled":!x(_)}),{default:l(()=>n[5]||(n[5]=[b(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[x(_)?(r(),y("span",Fe,"اختيار من جهات الاتصال")):(r(),y("span",Be,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(W,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=i=>c.value=i),"max-width":"400"},{default:l(()=>[e(T,null,{default:l(()=>[e(F,{class:"text-h6"},{default:l(()=>[n[6]||(n[6]=b("اختر رقم الهاتف ")),v.value?(r(),y("span",Le,"("+D(v.value)+")",1)):L("",!0)]),_:1}),e(M),e(ke,null,{default:l(()=>[(r(!0),y(P,null,A(f.value,(i,S)=>(r(),R(xe,{key:S,onClick:K=>k(i),style:{cursor:"pointer"}},{default:l(()=>[e(_e,null,{default:l(()=>[b(D(i),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(O,null,{default:l(()=>[e(Z),e(I,{text:"",onClick:n[3]||(n[3]=i=>c.value=!1)},{default:l(()=>n[7]||(n[7]=[b("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ze=le(je,[["__scopeId","data-v-9bfc0763"]]),Ee={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Me={__name:"edit",setup(N){Y();const w=Ce(),$=Ie(),g=m(!1),U=m(null),d=m([]),c=m([]),f=m([]),v=m([]),p=we(),s=m(null),k=m(null),_=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=m({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),n=m(w.params.tab||_[0].tab),i=m(!1),S=[u=>!!u||"اسم الشهرة مطلوب"],K=[u=>!!u||"رقم الهاتف مطلوب"],ae=[u=>f.value.length>0||"حدد شركة واحدة على الأقل"],te=[u=>!!u||"كلمة المرور مطلوبة",u=>u.length>=6||"كلمة المرور يجب أن لا تقل عن 6 أحرف"];h(()=>p.user,u=>{u&&oe()},{immediate:!0}),h(()=>w.params.id,u=>{u?(U.value=u,se()):(a.value.password="12345678",g.value=!1,a.value.customer_type="retail")},{immediate:!0});function se(){g.value=!0,Pe("roles",{per_page:-1},!1,!1,!1).then(u=>{d.value=u.data}).catch(()=>{d.value=[]}),qe("user",U.value,!1,!1,!1).then(u=>{var t;a.value=u,f.value=((t=u.user)==null?void 0:t.companies)||[]}).finally(()=>{g.value=!1})}function oe(){var o;const u=[...a.value.companies.map(V=>({...V,disabled:!1})),...(o=p.user)==null?void 0:o.companies.map(V=>({...V,disabled:!0}))],t=Array.from(new Map(u.map(V=>[V.id,V])).values());return v.value=t,f.value=v.value.filter(V=>V.id===p.user.company_id),t}function ue(u){return{title:u.name,subtitle:u.field,disabled:!u.disabled}}async function ne(){const{valid:u}=await k.value.validate();u&&(c.value=Array.from(f.value.map(t=>typeof t=="object"&&t.id!==void 0?t.id:t)),a.value.company_id=c.value.length<=0?null:c.value[0],a.value.company_ids=c.value.length>0?c.value:null,a.value.companies=null,J("user",a.value,w.params.id).then(()=>{setTimeout(()=>{$.go(-1)},1200)}))}const G=m({});function re(u){u&&(G.value=u,s.value.openDialog())}return(u,t)=>(r(),R(T,null,{default:l(()=>[e(Ue,{class:"ma-5",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),y(P,null,A(_,(o,V)=>e(Ne,{key:V,value:o.tab,"append-icon":o.icon},{default:l(()=>[b(D(o.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e($e,{modelValue:n.value,"onUpdate:modelValue":t[11]||(t[11]=o=>n.value=o)},{default:l(()=>[e(Q,{value:"account"},{default:l(()=>[e(B,null,{default:l(()=>[e(C,{cols:"12"},{default:l(()=>[e(T,{elevation:"0",loading:g.value,title:x(w).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(M),e(E,null,{default:l(()=>[e(Re,{class:"mt-6",ref_key:"userForm",ref:k,modelValue:i.value,"onUpdate:modelValue":t[9]||(t[9]=o=>i.value=o)},{default:l(()=>[e(B,null,{default:l(()=>[e(C,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(q,{modelValue:a.value.full_name,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.full_name=o),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(C,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(q,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.nickname=o),label:" اسم الشهرة ",rules:S},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(q,{modelValue:a.value.email,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.email=o),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(ze,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":t[4]||(t[4]=o=>a.value.phone=o),rules:K,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(C,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(q,{modelValue:a.value.username,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.username=o),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(X,{modelValue:a.value.customer_type,"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.customer_type=o),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12"},{default:l(()=>[e(X,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=o=>f.value=o),items:v.value,label:"حدد شركة علي الاقل","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":ue,"return-object":"",rules:ae,required:""},null,8,["modelValue","items"])]),_:1}),e(M,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(C,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(q,{required:!x(w).params.id,modelValue:a.value.password,"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.password=o),label:" الباسورد ",rules:x(w).params.id?!0:te},null,8,["required","modelValue","rules"])]),_:1}),e(C,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(I,{disabled:!i.value,class:De({"forbidden-cursor":!i.value}),onClick:ne},{default:l(()=>t[12]||(t[12]=[b(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(Q,{value:"role"},{default:l(()=>[e(T,{elevation:"0",class:"ma-4"},{default:l(()=>{var o;return[d.value&&a.value?(r(),R(Te,{key:0,user:a.value,"onUpdate:user":t[10]||(t[10]=V=>a.value=V),roles:d.value},null,8,["user","roles"])):L("",!0),e(F,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[13]||(t[13]=[b(" ادوار المستخدم ")])),_:1}),((o=a.value)==null?void 0:o.roles.length)>0?(r(),R(E,{key:1},{default:l(()=>[(r(!0),y(P,null,A(a.value.roles,(V,ie)=>(r(),y("span",{key:ie},[e(ee,{onClick:Oe=>re(V),class:"ma-2",variant:"outlined"},{default:l(()=>[b(D(V.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),y("div",Ee,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Ae,{ref_key:"roleDetail",ref:s,userRole:G.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ke=le(Me,[["__scopeId","data-v-5a7541e0"]]);export{Ke as default};
