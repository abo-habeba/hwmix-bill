import{r as d,j as ve,w as h,o as g,l as w,k as l,d as e,W as I,ai as F,b as n,t as E,a1 as M,a2 as ee,a6 as le,au as N,Z as H,a9 as b,q as te,Y as j,$ as Q,c as z,aG as O,aJ as me,V as S,aa as B,Q as pe,aH as be,ap as Y,N as Ve,a as U,a4 as Z,B as W,a5 as L,al as q,a3 as G,F as J,s as T,aK as ge,aB as X}from"./index-CvGhVP7A.js";const ce={__name:"AddAttribute",props:{addDialog:Boolean,editAttribute:{type:Object,default:null},attributes:{type:Array,default:()=>[]}},emits:["update:addDialog","update:attributes"],setup(P,{emit:_}){const f=P,C=_,i=d(f.addDialog),c=d(""),A=d(""),r=ve(()=>!!f.editAttribute),s=d(null),x=d(!1);h(()=>f.addDialog,v=>{i.value=v,v&&r.value&&f.editAttribute?c.value=f.editAttribute.name:v&&(c.value=""),A.value=""});const $=[v=>!!v||"اسم الخاصية مطلوب",v=>typeof v=="string"&&v.length<=255||"اسم الخاصية يجب ألا يزيد عن 255 حرفًا",v=>!f.attributes.some(m=>m.name===v&&(!r.value||f.editAttribute&&m.id!==f.editAttribute.id))||"اسم الخاصية موجود بالفعل"],D=v=>{i.value=!1,C("update:addDialog",{dialog:i.value,data:v})};async function R(){if(A.value="",!s.value)return;const{valid:v}=await s.value.validate();if(!v)return;const m={name:c.value};let k;try{if(r.value&&f.editAttribute){k=await Q("attribute",{...m,id:f.editAttribute.id},f.editAttribute.id,!0,!0);const V=f.attributes.map(u=>u.id===f.editAttribute.id?{...u,...k.data}:u);C("update:attributes",V)}else k=await Q("attribute",m,!1,!0,!0),C("update:attributes",[...f.attributes,k.data]);D(null)}catch(V){A.value=(V==null?void 0:V.message)||"حدث خطأ أثناء حفظ الخاصية"}}return(v,m)=>(g(),w(j,{modelValue:i.value,"onUpdate:modelValue":m[3]||(m[3]=k=>i.value=k),"max-width":"500px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,null,{default:l(()=>[n(E(r.value?"تعديل خاصية":"اضافة خاصية جديدة"),1)]),_:1}),e(M,null,{default:l(()=>[e(ee,{ref_key:"formRef",ref:s,modelValue:x.value,"onUpdate:modelValue":m[1]||(m[1]=k=>x.value=k)},{default:l(()=>[e(le,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=k=>c.value=k),label:"اسم الخاصية",rules:$,required:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(N,null,{default:l(()=>[e(H),e(b,{color:"grey darken-1",text:"",onClick:m[2]||(m[2]=k=>D(null))},{default:l(()=>m[4]||(m[4]=[n("الغاء")])),_:1}),e(b,{color:"blue darken-1",text:"",class:te({"forbidden-cursor":!x.value}),onClick:R},{default:l(()=>[n(E(r.value?"تعديل":"حفظ"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},xe={__name:"addAttributeValues",props:{attributes:{type:Array,required:!0},editValue:{type:Object,default:null}},emits:["value-added","value-edited"],setup(P,{expose:_,emit:f}){const C=P,i=f,c=d(!1),A=d(!1),r=d({name:"",color:"",attribute_id:null,id:null}),s=d(""),x=d(!1),$=d(null),D=d(!1);function R(){x.value=!1,c.value=!0,r.value={name:"",color:"",attribute_id:null,id:null},s.value=""}function v(V){x.value=!0,c.value=!0,r.value={...V},s.value=""}_({openEditDialog:v});function m(){c.value=!1,r.value={name:"",color:"",attribute_id:null,id:null},s.value=""}async function k(){s.value="";const{valid:V}=await $.value.validate();if(V){C.attributes&&C.attributes[0]&&C.attributes[0].id&&(r.value.attribute_id=C.attributes[0].id);try{const u=await Q("attribute-value",r.value,r.value.id,!0);x.value&&r.value.id?(B.success("تم تعديل القيمة بنجاح"),i("value-edited",u.data)):(B.success("تم حفظ القيمة بنجاح"),i("value-added",u.data)),m()}catch(u){B.error((u==null?void 0:u.message)||"حدث خطأ أثناء حفظ القيمة")}}}return h(()=>C.editValue,V=>{V&&V.id&&v(V)}),(V,u)=>(g(),z("div",null,[e(b,{class:"ma-1",color:"primary",onClick:R},{default:l(()=>u[7]||(u[7]=[n("اضافة قيمة")])),_:1}),e(j,{modelValue:c.value,"onUpdate:modelValue":u[3]||(u[3]=y=>c.value=y),"max-width":"500px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,null,{default:l(()=>[n(E(x.value?"تعديل قيمة":"اضافة قيمة جديدة"),1)]),_:1}),e(M,null,{default:l(()=>[e(ee,{ref_key:"formRef",ref:$,modelValue:D.value,"onUpdate:modelValue":u[2]||(u[2]=y=>D.value=y)},{default:l(()=>[e(le,{class:"pa-3",modelValue:r.value.name,"onUpdate:modelValue":u[0]||(u[0]=y=>r.value.name=y),label:"اسم القيمة",rules:[y=>!!y||"اسم القيمة مطلوب"],required:""},null,8,["modelValue","rules"]),e(b,{class:"ma-3",style:O({backgroundColor:r.value.color||""}),onClick:u[1]||(u[1]=y=>A.value=!0)},{default:l(()=>u[8]||(u[8]=[n(" اختر اللون ")])),_:1},8,["style"])]),_:1},8,["modelValue"])]),_:1}),e(N,null,{default:l(()=>[e(H),e(b,{color:"blue darken-1",text:"",onClick:m},{default:l(()=>u[9]||(u[9]=[n("الغاء")])),_:1}),e(b,{color:"blue darken-1",class:te({"forbidden-cursor":!D.value}),text:"",onClick:k},{default:l(()=>[n(E(x.value?"تحديث":"حفظ"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:A.value,"onUpdate:modelValue":u[6]||(u[6]=y=>A.value=y),"max-width":"500px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,{style:O({backgroundColor:r.value.color||"",position:"fixed",zIndex:"100",width:"100%"})},{default:l(()=>u[10]||(u[10]=[n(" اختر اللون ")])),_:1},8,["style"]),e(M,{class:"mt-10"},{default:l(()=>[e(me,{modelValue:r.value.color,"onUpdate:modelValue":u[4]||(u[4]=y=>r.value.color=y),"show-swatches":"","hide-inputs":""},null,8,["modelValue"])]),_:1}),e(N,null,{default:l(()=>[e(b,{color:"primary",class:"mx-auto my-2 elevated-5",onClick:u[5]||(u[5]=y=>A.value=!1)},{default:l(()=>[e(S,{class:"mx-3",size:"18"},{default:l(()=>u[11]||(u[11]=[n("ri-check-line")])),_:1}),u[12]||(u[12]=n(" تم "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ke={class:"d-flex flex-wrap gap-2 pa-3"},ye={class:"ma-3 flex-grow-1"},Ce={key:0,class:"ms-8 mt-2 mb-4"},Ae={class:"d-flex flex-wrap gap-2"},_e={__name:"attributes",setup(P){const _=d(!1),f=d(!1),C=d(null),i=d([]),c=d(null);d(null);const A=d(null),r=d(!1),s=d(null),x=d(!1),$=d(null);d(!1),d({id:null,name:"",color:""}),d(null),d(!1);const D=d(null),R=d(null);function v(o){if(!o||typeof o!="string"||!o.startsWith("#"))return"#000000";const t=o.replace("#","");if(t.length!==6)return"#000000";const a=parseInt(t.substr(0,2),16),p=parseInt(t.substr(2,2),16),K=parseInt(t.substr(4,2),16);return(a*299+p*587+K*114)/1e3<128?"#FFFFFF":"#000000"}const m=o=>{_.value=o.dialog,console.log(o.data)};function k(o){C.value=o,f.value=!0}function V(o){X("attribute",o).then(()=>{u(),f.value=!1,B.success("تم حذف الخاصية بنجاح")}).catch(()=>B.error("حدث خطأ أثناء حذف الخاصية"))}function u(){Y("attributes").then(o=>{i.value=o.data})}const y=()=>{_.value=!0,c.value=null},ae=o=>{c.value={...o},_.value=!0},ue=o=>{i.value=o};function oe(o){s.value=o,r.value=!0}function se(o){s.value&&s.value.values&&s.value.values.push(o)}function ne(o){const t=s.value.values.findIndex(p=>p.id===o.id);t!==-1&&(s.value.values[t]=o);const a=i.value.findIndex(p=>p.id===s.value.id);if(a!==-1&&i.value[a].values){const p=i.value[a].values.findIndex(K=>K.id===o.id);p!==-1&&(i.value[a].values[p]=o)}}function de(o){$.value=o,x.value=!0}function ie(){X("attribute-value",$.value).then(()=>{B.success("تم حذف القيمة بنجاح"),re($.value),x.value=!1}).catch(()=>B.error("حدث خطأ أثناء حذف القيمة"))}function re(o=null){if(o&&s.value&&s.value.values){s.value.values=s.value.values.filter(a=>a.id!==o);const t=i.value.findIndex(a=>a.id===s.value.id);t!==-1&&i.value[t].values&&(i.value[t].values=i.value[t].values.filter(a=>a.id!==o));return}Y(`attribute/${s.value.id}/values`).then(t=>{s.value.values=t.data;const a=i.value.findIndex(p=>p.id===s.value.id);a!==-1&&(i.value[a].values=t.data)})}function fe(o){R.value={...o},D.value&&D.value.openEditDialog(o)}return pe(()=>{u()}),(o,t)=>(g(),w(be,null,{default:l(()=>[e(b,{color:"primary",onClick:y},{default:l(()=>t[7]||(t[7]=[n("اضافة خاصية جديدة")])),_:1}),e(I,{class:"mt-4 pa-3"},{default:l(()=>[e(F,null,{default:l(()=>t[8]||(t[8]=[n(" الخصائص")])),_:1}),e(Ve),U("div",ke,[e(Z,null,{default:l(()=>[i.value.length?(g(!0),z(J,{key:0},W(i.value,a=>(g(),w(L,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[e(q,{class:"d-flex align-center pa-1",onClick:p=>oe(a),style:{minHeight:"35px"}},{default:l(()=>[U("div",ye,E(a.name),1),e(b,{icon:"",size:"x-small",color:"primary",class:"ma-1",style:{"margin-inline-start":"4px"},onClick:G(p=>ae(a),["stop"]),title:"تعديل"},{default:l(()=>[e(S,{size:"18"},{default:l(()=>t[9]||(t[9]=[n("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(b,{icon:"",size:"x-small",color:"error",class:"ma-1",style:{"margin-inline-start":"2px"},onClick:G(p=>k(a.id),["stop"]),title:"حذف"},{default:l(()=>[e(S,{size:"18"},{default:l(()=>t[10]||(t[10]=[n("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["onClick"])]),_:2},1024))),128)):T("",!0)]),_:1}),i.value.length===0?(g(),w(q,{key:0},{default:l(()=>t[11]||(t[11]=[n("لا توجد خصائص حتى الآن")])),_:1})):T("",!0)]),(g(!0),z(J,null,W(i.value,a=>(g(),z("div",{key:"values-"+a.id},[e(ge,null,{default:l(()=>[A.value===a.id&&a.values&&a.values.length?(g(),z("div",Ce,[e(I,{flat:"",class:"pa-2",color:"#f8f8f8"},{default:l(()=>[U("div",Ae,[(g(!0),z(J,null,W(a.values,p=>(g(),w(q,{key:p.id,class:"d-flex align-center pa-1",style:O({backgroundColor:p.color||"#e0e0e0"})},{default:l(()=>[U("span",null,E(p.name),1)]),_:2},1032,["style"]))),128)),a.values.length===0?(g(),w(q,{key:0},{default:l(()=>t[12]||(t[12]=[n("لا توجد قيم لهذه الخاصية")])),_:1})):T("",!0)])]),_:2},1024)])):T("",!0)]),_:2},1024)]))),128))]),_:1}),e(ce,{attributes:i.value,addDialog:_.value,editAttribute:c.value,"onUpdate:addDialog":m,"onUpdate:attributes":ue},null,8,["attributes","addDialog","editAttribute"]),e(j,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a),"max-width":"400px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,null,{default:l(()=>t[13]||(t[13]=[n("تأكيد الحذف")])),_:1}),e(M,null,{default:l(()=>t[14]||(t[14]=[n("هل أنت متأكد من حذف هذه الخاصية؟")])),_:1}),e(N,null,{default:l(()=>[e(H),e(b,{color:"grey darken-1",text:"",onClick:t[0]||(t[0]=a=>f.value=!1)},{default:l(()=>t[15]||(t[15]=[n("الغاء")])),_:1}),e(b,{color:"red darken-1",text:"",onClick:t[1]||(t[1]=a=>V(C.value))},{default:l(()=>t[16]||(t[16]=[n("حذف")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=a=>r.value=a),"max-width":"600px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,{class:"d-flex align-center justify-space-between"},{default:l(()=>{var a;return[U("span",null,"قيم الخاصية : "+E((a=s.value)==null?void 0:a.name),1),s.value?(g(),w(xe,{key:0,attributes:[s.value],"edit-value":R.value,onValueAdded:se,onValueEdited:ne,ref_key:"addEditValueRef",ref:D},null,8,["attributes","edit-value"])):T("",!0)]}),_:1}),e(M,{class:"my-2"},{default:l(()=>[e(Z,null,{default:l(()=>[(g(!0),z(J,null,W(s.value.values,a=>(g(),w(L,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[U("div",{class:"w-100 elevation-6 box-attribute-values",style:O({backgroundColor:a.color||"#e0e0e0",minHeight:"33px",color:v(a.color)})},[U("div",{style:O({backgroundColor:a.color||"#e0e0e0",color:v(a.color)}),class:"ma-3 flex-grow-1"},E(a.name),5),e(b,{class:"ma-2",icon:"",size:"x-small",color:"primary",style:{"margin-inline-start":"4px"},onClick:G(p=>fe(a),["stop"]),title:"تعديل القيمة"},{default:l(()=>[e(S,{size:"16"},{default:l(()=>t[17]||(t[17]=[n("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(b,{class:"ma-2",icon:"",size:"x-small",color:"error",style:{"margin-inline-start":"2px"},onClick:G(p=>de(a.id),["stop"]),title:"حذف القيمة"},{default:l(()=>[e(S,{size:"16"},{default:l(()=>t[18]||(t[18]=[n("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])],4)]),_:2},1024))),128)),!s.value.values||s.value.values.length===0?(g(),w(L,{key:0,cols:"12"},{default:l(()=>[e(q,null,{default:l(()=>t[19]||(t[19]=[n("لا توجد قيم لهذه الخاصية")])),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}),e(N,null,{default:l(()=>[e(H),e(b,{color:"blue darken-1",text:"",onClick:t[3]||(t[3]=a=>r.value=!1)},{default:l(()=>t[20]||(t[20]=[n("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=a=>x.value=a),"max-width":"350px"},{default:l(()=>[e(I,null,{default:l(()=>[e(F,null,{default:l(()=>t[21]||(t[21]=[n("تأكيد حذف القيمة")])),_:1}),e(M,null,{default:l(()=>t[22]||(t[22]=[n("هل أنت متأكد من حذف هذه القيمة؟")])),_:1}),e(N,null,{default:l(()=>[e(H),e(b,{color:"grey darken-1",text:"",onClick:t[5]||(t[5]=a=>x.value=!1)},{default:l(()=>t[23]||(t[23]=[n("إلغاء")])),_:1}),e(b,{color:"red darken-1",text:"",onClick:ie},{default:l(()=>t[24]||(t[24]=[n("حذف")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{_e as default};
