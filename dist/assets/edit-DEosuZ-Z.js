import{S as Y,r as d,w as B,o as r,c as y,d as e,k as l,b as V,t as R,a9 as $,W as S,ai as q,a4 as L,a5 as _,a1 as E,l as N,F as D,B as h,a8 as ne,s as j,X as re,au as O,Z,u as w,Y as W,$ as J,Q as ee,a as z,al as le,_ as ae,ag as ie,v as de,V as me,n as pe,a3 as H,a7 as ce,i as ve,a6 as T,N as M,H as fe,I as be,L as Ve,aa as F,A as ye,ap as ge,ar as ke,g as xe,av as _e,aw as we,ax as Q,a2 as Ce,ay as X,q as Ne,az as Ue,h as Re}from"./index-CBHNJf0a.js";import{g as Ie}from"./permissions-3fwV70Qx.js";const $e={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(C,{emit:x}){const{xs:I}=Y(),k=C,U=x,i=d(k.roles),p=d(!1),c=d([]);B(()=>k.user.roles,v=>{c.value=v?v.map(o=>o.name):[]},{immediate:!0});function b(){const v={user_id:k.user.id,roles:c.value};console.log(v),J("role/assignRole",v).then(o=>{U("update:user",o),p.value=!1})}return(v,o)=>(r(),y(D,null,[e($,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:o[0]||(o[0]=g=>p.value=!0)},{default:l(()=>[V(R(i.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(W,{fullscreen:w(I),modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=g=>p.value=g),"max-width":"500"},{default:l(()=>[e(S,{class:"pa-4"},{default:l(()=>[e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>o[4]||(o[4]=[V("تعديل ادوار المستخدم ")])),_:1}),e($,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>o[5]||(o[5]=[V(" اضافة دور جديد ")])),_:1}),e(L,{class:"mb-7"},{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(E,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[i.value.length?(r(),N(L,{key:0},{default:l(()=>[(r(!0),y(D,null,h(i.value,(g,a)=>(r(),N(_,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:a},{default:l(()=>[g?(r(),N(ne,{key:0,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=f=>c.value=f),label:g.name,value:g.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):j("",!0)]),_:2},1024))),128))]),_:1})):(r(),N(re,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>o[6]||(o[6]=[V(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(O,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e($,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:o[2]||(o[2]=g=>p.value=!1)},{default:l(()=>o[7]||(o[7]=[V(" إلغاء ")])),_:1}),e(Z),e($,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:b},{default:l(()=>o[8]||(o[8]=[V(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},De={key:0},Pe={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(C,{expose:x}){const I=C,k=d(null),U=d([]);ee(()=>{});const i=d(!1);function p(){i.value=!0}return B(()=>I.userRole,c=>{c&&c.permissions&&(U.value=c.permissions,k.value=Ie(U.value))},{immediate:!0}),x({openDialog:p}),(c,b)=>(r(),N(W,{modelValue:i.value,"onUpdate:modelValue":b[1]||(b[1]=v=>i.value=v),"max-width":"500px"},{default:l(()=>[e(S,null,{default:l(()=>[e(q,null,{default:l(()=>[z("span",null," صلاحيات الدور "+R(C.userRole.name),1)]),_:1}),k.value?(r(),y("div",De,[(r(!0),y(D,null,h(k.value,(v,o)=>(r(),y("div",{key:o},[b[2]||(b[2]=z("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(q,null,{default:l(()=>[z("span",null,R(v.name),1)]),_:2},1024),(r(!0),y(D,null,h(v.permissions,(g,a)=>(r(),N(le,{class:"ma-1",key:a,color:"blue","text-color":"white"},{default:l(()=>[V(R(g.name),1)]),_:2},1024))),128))]))),128))])):j("",!0),e(O,null,{default:l(()=>[e($,{text:"",onClick:b[0]||(b[0]=v=>i.value=!1)},{default:l(()=>b[3]||(b[3]=[V("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Te={class:"phone-input-wrapper"},Se={key:0},he={key:1},Ae={key:0},qe={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(C,{emit:x}){const I=C,k=x,{initialPhoneNumber:U}=ie(I),i=d(U.value);B(i,f=>{k("update:phoneNumber",f)}),B(U,f=>{f!==i.value&&(i.value=f)});const p=d(!1),c=d([]),b=d("");function v(f){let u=f.replace(/\s+/g,"").replace(/^\+/,"");return u=u.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),u}async function o(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){F.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const f=["tel","name"],u={multiple:!1},m=await navigator.contacts.select(f,u);m&&m.length&&m[0].tel&&m[0].tel.length?m[0].tel.length===1?i.value=v(m[0].tel[0]):(c.value=m[0].tel.map(v),b.value=m[0].name?m[0].name[0]:"",p.value=!0):F.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{F.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function g(f){i.value=v(f),p.value=!1}const a=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(f,u)=>(r(),y("div",Te,[e(w(T),{modelValue:w(i),"onUpdate:modelValue":u[2]||(u[2]=m=>ve(i)?i.value=m:null),label:C.label,placeholder:C.placeholder,rules:C.rules,counter:C.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":o,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(w(de),{location:"top"},{activator:l(({props:m})=>[e(w(me),pe(m,{class:"contact-picker-icon",color:w(a)?"primary":"grey",size:"24",style:w(a)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:u[0]||(u[0]=H(A=>w(a)&&o(),["stop"])),tabindex:"0",onKeydown:u[1]||(u[1]=ce(H(A=>w(a)&&o(),["prevent"]),["enter"])),"aria-disabled":!w(a)}),{default:l(()=>u[5]||(u[5]=[V(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[w(a)?(r(),y("span",Se,"اختيار من جهات الاتصال")):(r(),y("span",he,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(W,{modelValue:p.value,"onUpdate:modelValue":u[4]||(u[4]=m=>p.value=m),"max-width":"400"},{default:l(()=>[e(S,null,{default:l(()=>[e(q,{class:"text-h6"},{default:l(()=>[u[6]||(u[6]=V("اختر رقم الهاتف ")),b.value?(r(),y("span",Ae,"("+R(b.value)+")",1)):j("",!0)]),_:1}),e(M),e(fe,null,{default:l(()=>[(r(!0),y(D,null,h(c.value,(m,A)=>(r(),N(be,{key:A,onClick:K=>g(m),style:{cursor:"pointer"}},{default:l(()=>[e(Ve,null,{default:l(()=>[V(R(m),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(O,null,{default:l(()=>[e(Z),e($,{text:"",onClick:u[3]||(u[3]=m=>p.value=!1)},{default:l(()=>u[7]||(u[7]=[V("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fe=ae(qe,[["__scopeId","data-v-9bfc0763"]]),Be={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Le={__name:"edit",setup(C){Y();const x=xe(),I=Re(),k=d(!1),U=d(x.params.id),i=d([]),p=d([]);d([]);const c=d([]),b=d([]),v=ye(),o=d(null),g=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=d({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),f=d(x.params.tab||g[0].tab),u=d(!1),m=[n=>!!n||"اسم الشهرة مطلوب"],A=[n=>!!n||"رقم الهاتف مطلوب"];ee(()=>{K(),x.params.id?(k.value=!0,ge("roles").then(n=>{i.value=n.data,console.log("roles",i.value)}).catch(n=>{i.value=[]}),ke("user",U.value,!0).then(n=>{a.value=n,c.value=n.companies}).finally(n=>{k.value=!1})):a.value.password="12345678"});function K(){const n=[...a.value.companies.map(t=>({...t,disabled:!1})),...v.user.companies.map(t=>({...t,disabled:!0}))],s=Array.from(new Map(n.map(t=>[t.id,t])).values());return b.value=s,c.value=b.value.filter(t=>t.id===v.user.company_id),s}function te(n){return{title:n.name,subtitle:n.field,disabled:!n.disabled}}function oe(){console.log("selectedCompanies",c.value),p.value=Array.from(c.value.map(n=>typeof n=="object"&&n.id!==void 0?n.id:n)),console.log("companyIds",p.value),a.value.company_id=p.value.length<=0?null:p.value[0],a.value.company_ids=p.value.length>0?p.value:null,a.value.companies=null,J("user",a.value,x.params.id).then(()=>{F.success(x.params.id?"تم تعديل المستخدم بنجاح":"تم إضافة المستخدم بنجاح"),setTimeout(()=>{I.go(-1)},1200)})}const G=d({});function se(n){n&&(G.value=n,o.value.openDialog())}return(n,s)=>(r(),N(S,null,{default:l(()=>[e(we,{class:"ma-5",modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),y(D,null,h(g,(t,P)=>e(_e,{key:P,value:t.tab,"append-icon":t.icon},{default:l(()=>[V(R(t.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(Ue,{modelValue:f.value,"onUpdate:modelValue":s[11]||(s[11]=t=>f.value=t)},{default:l(()=>[e(Q,{value:"account"},{default:l(()=>[e(L,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(S,{elevation:"0",loading:k.value,title:w(x).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(M),e(E,null,{default:l(()=>[e(Ce,{class:"mt-6",ref:"userForm",modelValue:u.value,"onUpdate:modelValue":s[9]||(s[9]=t=>u.value=t)},{default:l(()=>[e(L,null,{default:l(()=>[e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{modelValue:a.value.full_name,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.full_name=t),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(_,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(T,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.nickname=t),label:" اسم الشهرة ",rules:m},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.email,"onUpdate:modelValue":s[3]||(s[3]=t=>a.value.email=t),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Fe,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":s[4]||(s[4]=t=>a.value.phone=t),rules:A,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{modelValue:a.value.username,"onUpdate:modelValue":s[5]||(s[5]=t=>a.value.username=t),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(X,{modelValue:a.value.customer_type,"onUpdate:modelValue":s[6]||(s[6]=t=>a.value.customer_type=t),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[e(X,{modelValue:c.value,"onUpdate:modelValue":s[7]||(s[7]=t=>c.value=t),items:b.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":te,"return-object":""},null,8,["modelValue","items"])]),_:1}),e(M,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(_,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(T,{required:"",modelValue:a.value.password,"onUpdate:modelValue":s[8]||(s[8]=t=>a.value.password=t),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e($,{disabled:!u.value,class:Ne({"forbidden-cursor":!u.value}),onClick:oe},{default:l(()=>s[12]||(s[12]=[V(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(Q,{value:"role"},{default:l(()=>[e(S,{elevation:"0",class:"ma-4"},{default:l(()=>{var t;return[i.value&&a.value?(r(),N($e,{key:0,user:a.value,"onUpdate:user":s[10]||(s[10]=P=>a.value=P),roles:i.value},null,8,["user","roles"])):j("",!0),e(q,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>s[13]||(s[13]=[V(" ادوار المستخدم ")])),_:1}),((t=a.value)==null?void 0:t.roles.length)>0?(r(),N(E,{key:1},{default:l(()=>[(r(!0),y(D,null,h(a.value.roles,(P,ue)=>(r(),y("span",{key:ue},[e(le,{onClick:je=>se(P),class:"ma-2",variant:"outlined"},{default:l(()=>[V(R(P.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),y("div",Be,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Pe,{ref_key:"roleDetail",ref:o,userRole:G.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=ae(Le,[["__scopeId","data-v-e43c8c9e"]]);export{Me as default};
