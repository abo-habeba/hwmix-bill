import{_ as J,o as S,k as D,j as l,a as g,d as e,aJ as se,a4 as N,a5 as c,a6 as q,az as M,aI as Ve,c as B,b as C,aK as ce,F as L,A as Y,aL as de,H as ge,m as _e,a9 as h,q as xe,U as R,R as he,r as k,w as X,ag as we,P as ke,ap as H,ah as W,t as A,a1 as re,a2 as Oe,aM as Se,M as Ce,au as me,X as Q,Z as fe,h as qe,a7 as Pe,aj as pe,a3 as G,p as ve,V as ne,aH as $e,$ as be,aN as Ae,T as Ee}from"./index-BOAZ3P5O.js";import{_ as Ne}from"./AttributesDisplay-C7E7UxWP.js";import{P as ye}from"./ProductSticker-Coh-KpmX.js";const De={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Fe={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(u,{emit:$}){return(_,i)=>(S(),D(Ve,null,{default:l(()=>[g("div",De,[g("div",null,[e(se,{modelValue:u.modelValue.active,"onUpdate:modelValue":i[0]||(i[0]=s=>u.modelValue.active=s),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:u.modelValue.featured,"onUpdate:modelValue":i[1]||(i[1]=s=>u.modelValue.featured=s),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:u.modelValue.returnable,"onUpdate:modelValue":i[2]||(i[2]=s=>u.modelValue.returnable=s),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(N,{dense:""},{default:l(()=>[e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:u.modelValue.name,"onUpdate:modelValue":i[3]||(i[3]=s=>u.modelValue.name=s),label:"اسم المنتج",rules:u.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:u.modelValue.category_id,"onUpdate:modelValue":i[4]||(i[4]=s=>u.modelValue.category_id=s),items:u.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:u.modelValue.brand_id,"onUpdate:modelValue":i[5]||(i[5]=s=>u.modelValue.brand_id=s),items:u.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:u.modelValue.desc,"onUpdate:modelValue":i[6]||(i[6]=s=>u.modelValue.desc=s),label:"الوصف",rules:u.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:u.modelValue.desc_long,"onUpdate:modelValue":i[7]||(i[7]=s=>u.modelValue.desc_long=s),label:"الوصف المفصل",rules:u.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},Me=J(Fe,[["__scopeId","data-v-c923be84"]]),je={__name:"ProductVariantAttributesForm",props:{modelValue:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{emit:$}){const _=u,i=$;function s(m){const y=_.attributes.find(n=>n.id===m);return(y==null?void 0:y.values)||[]}function f(m,y){const n=[..._.modelValue];n[m]={attribute_id:y,attribute_value_id:null},i("update:modelValue",n)}function P(){const m=[..._.modelValue,{attribute_id:null,attribute_value_id:null}];i("update:modelValue",m)}function U(m){const y=[..._.modelValue];y.splice(m,1),i("update:modelValue",y)}function b(m){if(!m)return"#000";const y=m.substring(1),n=parseInt(y,16),r=n>>16&255,d=n>>8&255,x=n&255;return .299*r+.587*d+.114*x>186?"#000":"#fff"}function E(m,y){const n=s(m).find(r=>r.id===y);return n!=null&&n.color?`background:${n.color};color:${b(n.color)};border-radius:6px;padding-inline:6px;`:""}return(m,y)=>(S(),B(L,null,[e(ce,{class:"ma-2"},{default:l(()=>y[0]||(y[0]=[C("الخصائص (Attributes)")])),_:1}),(S(!0),B(L,null,Y(u.modelValue,(n,r)=>(S(),D(N,{dense:"",key:r,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5"},{default:l(()=>[e(M,{modelValue:n.attribute_id,"onUpdate:modelValue":[d=>n.attribute_id=d,d=>f(r,d)],items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(c,{cols:"5"},{default:l(()=>[e(M,{modelValue:n.attribute_value_id,"onUpdate:modelValue":d=>n.attribute_value_id=d,items:s(n.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"","hide-details":"auto",disabled:!n.attribute_id,style:de(E(n.attribute_id,n.attribute_value_id))},{item:l(({props:d,item:x})=>[e(ge,_e({ref_for:!0},d,{style:x.raw.color?`background:${x.raw.color};`:""}),null,16,["style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2",class:"text-end"},{default:l(()=>[e(h,{icon:"ri-delete-bin-line",color:"error",size:"x-small",variant:"text",onClick:d=>U(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-2",text:"",color:"primary",density:"comfortable",onClick:P},{default:l(()=>y[1]||(y[1]=[C(" + إضافة خاصية ")])),_:1})],64))}},Ie=J(je,[["__scopeId","data-v-da98878c"]]),ze={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(u,{emit:$}){const _=u,i=$,s=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function f(P){if(_.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const U=[..._.modelValue];U.splice(P,1),i("update:modelValue",U)}return(P,U)=>(S(),B(L,null,[e(ce,{class:"ma-2"},{default:l(()=>U[1]||(U[1]=[C("المخزون")])),_:1}),(S(!0),B(L,null,Y(u.modelValue,(b,E)=>(S(),D(N,{dense:"",key:b.id||E},{default:l(()=>[e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.cost,"onUpdate:modelValue":m=>b.cost=m,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:u.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.quantity,"onUpdate:modelValue":m=>b.quantity=m,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:u.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[u.warehouses&&u.warehouses.length>0?(S(),D(M,{key:0,modelValue:b.warehouse_id,"onUpdate:modelValue":m=>b.warehouse_id=m,"item-value":"id","item-title":"name",items:u.warehouses,label:"المخزن",rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(S(),D(M,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(M,{modelValue:b.status,"onUpdate:modelValue":m=>b.status=m,items:s,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[m=>!!m||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.expiry,"onUpdate:modelValue":m=>b.expiry=m,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.loc,"onUpdate:modelValue":m=>b.loc=m,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),u.modelValue.length>1?(S(),D(h,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:U[0]||(U[0]=b=>f(P.sIndex))})):xe("",!0)],64))}},Re=J(ze,[["__scopeId","data-v-382b902c"]]),Be={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(u,{emit:$}){return(_,i)=>(S(),D(N,null,{default:l(()=>[e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:u.variant.retail_price,"onUpdate:modelValue":i[0]||(i[0]=s=>u.variant.retail_price=s),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:u.variant.wholesale_price,"onUpdate:modelValue":i[1]||(i[1]=s=>u.variant.wholesale_price=s),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(M,{modelValue:u.variant.status,"onUpdate:modelValue":i[2]||(i[2]=s=>u.variant.status=s),items:u.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:u.variant.min_quantity,"onUpdate:modelValue":i[3]||(i[3]=s=>u.variant.min_quantity=s),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Ie,{modelValue:u.variant.attributes,"onUpdate:modelValue":i[4]||(i[4]=s=>u.variant.attributes=s),attributes:u.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Re,{modelValue:u.variant.stocks,"onUpdate:modelValue":i[5]||(i[5]=s=>u.variant.stocks=s),warehouses:u.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-2 py-1"},{default:l(()=>[e(h,{color:"error",onClick:i[6]||(i[6]=s=>_.$emit("remove-variant",u.variantIndex))},{default:l(()=>i[7]||(i[7]=[C("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Je=J(Be,[["__scopeId","data-v-d71e48c9"]]),Te={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(u,{emit:$}){const _=u,i=$;he();const s=k(_.dialog),f=k(null),P=k(!1),U=k([]),b=k([]),E=k([]),m=k([]),y=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",n=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",r=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",d={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},x=k(JSON.parse(JSON.stringify(d)));function w(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(a=>({id:a.id,barcode:a.barcode||"",sku:a.sku||"",retail_price:parseFloat(a.retail_price)||0,wholesale_price:parseFloat(a.wholesale_price)||0,image:a.image||null,weight:parseFloat(a.weight)||0,dimensions:a.dimensions||"",min_quantity:a.min_quantity||"",tax:parseFloat(a.tax)||0,discount:parseFloat(a.discount)||0,status:a.status||"active",attributes:(a.attributes||[]).map(V=>({attribute_id:V.attribute_id||null,attribute_value_id:V.attribute_value_id||null})),stocks:(a.stocks||[]).map(V=>({id:V.id,quantity:V.quantity||0,reserved:V.reserved||0,min_quantity:V.min_quantity||0,cost:parseFloat(V.cost)||0,batch:V.batch||"",expiry:V.expiry?new Date(V.expiry).toISOString().substr(0,10):null,loc:V.loc||"",status:V.status??"available",warehouse_id:V.warehouse?V.warehouse.id:null}))}))}}const F={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[r,n],wholesale_price:[r,n],tax:[y,n],discount:[y,n],weight:[y,n],quantity:[r,n],cost:[y,n]};function T(){var t,a;(t=x.value)!=null&&t.variants&&x.value.variants&&(a=x.value.variants[0])!=null&&a.stocks&&b.value&&x.value.variants[0].stocks[0].warehouse_id===null&&(x.value.variants[0].stocks[0].warehouse_id=b.value[0].id)}X(()=>_.dialog,async t=>{s.value=t,t&&(_.isEditMode&&_.product?x.value=w(_.product):(x.value=JSON.parse(JSON.stringify(d)),T()),await we(),f.value&&f.value.resetValidation())},{immediate:!0}),X(s,t=>{i("update:dialog",t)}),X(()=>_.product,t=>{_.isEditMode&&t&&(x.value=w(t))}),ke(async()=>{await Promise.all([I(),ee(),le(),te()]),_.isEditMode||T()});async function I(){try{const t=await H("brands",null,!0,!1);U.value=t}catch(t){console.error("Error fetching brands:",t)}}async function ee(){try{const t=await H("attributes",null,!0,!1);m.value=t}catch(t){console.error("Error fetching attributes:",t)}}async function le(){try{const t=await H("warehouses",null,!0,!1);b.value=t.data,_.isEditMode||T()}catch(t){console.error("Error fetching warehouses:",t)}}async function te(){try{const t=await H("categories",null,!0,!1);E.value=t}catch(t){console.error("Error fetching categories:",t)}}function ae(){x.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:b.value.length>0?b.value[0].id:null}]})}function ue(t){x.value.variants.splice(t,1)}async function oe(){if(!f.value)return;const{valid:t}=await f.value.validate();if(t)try{const a=JSON.parse(JSON.stringify(x.value));Object.prototype.hasOwnProperty.call(a,"active")||Object.prototype.hasOwnProperty.call(a,"is_active")&&(a.active=a.is_active,delete a.is_active),Object.prototype.hasOwnProperty.call(a,"returnable")||Object.prototype.hasOwnProperty.call(a,"is_returnable")&&(a.returnable=a.is_returnable,delete a.is_returnable),Object.prototype.hasOwnProperty.call(a,"desc")||Object.prototype.hasOwnProperty.call(a,"description")&&(a.desc=a.description,delete a.description),Object.prototype.hasOwnProperty.call(a,"desc_long")||Object.prototype.hasOwnProperty.call(a,"description_long")&&(a.desc_long=a.description_long,delete a.desc_long),a.variants.forEach(j=>{j.stocks&&j.stocks.length>0&&j.stocks.forEach(v=>{!v.warehouse_id&&b.value.length>0&&(v.warehouse_id=b.value[0].id)})});let V;if(a.id)V=await fe("product",a,a.id);else{const{id:j,...v}=a;V=await fe("product",v)}i("saved",V),K()}catch(a){console.error("Error saving product:",a)}}const ie=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function K(){s.value=!1,i("close")}return(t,a)=>(S(),D(Q,{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=V=>s.value=V),"max-width":"900px"},{default:l(()=>[e(R,null,{default:l(()=>[e(h,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:K}),e(W,{class:"ma-3 text-center"},{default:l(()=>[g("h2",null,A(u.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(re,{class:"pa-0"},{default:l(()=>[e(Oe,{ref_key:"productForm",ref:f,modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=V=>P.value=V)},{default:l(()=>[e(Me,{modelValue:x.value,categories:E.value,brands:U.value,productRules:F,"onUpdate:modelValue":a[0]||(a[0]=V=>x.value=V)},null,8,["modelValue","categories","brands"]),e(R,{class:"pa-2 ma-1",outlined:""},{default:l(()=>[e(W,{class:"ma-2"},{default:l(()=>a[3]||(a[3]=[C(" خيارات المنتج ")])),_:1}),(S(!0),B(L,null,Y(x.value.variants,(V,j)=>(S(),D(N,{class:"bg-grey-lighten-1 pa-2",key:j},{default:l(()=>[e(Je,{variant:V,variantIndex:j,attributes:m.value,warehouses:b.value,statusOptions:ie,productRules:F,onRemoveVariant:ue},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(N,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(h,{class:"ma-3",color:"primary",onClick:ae},{default:l(()=>a[4]||(a[4]=[C("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(Se,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:l(()=>[e(Ce,{class:"my-2"}),e(me,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:l(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!P.value,onClick:oe,class:"text-capitalize"},{default:l(()=>[C(A(u.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(h,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:K,class:"text-capitalize"},{default:l(()=>a[5]||(a[5]=[C(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},He=J(Te,[["__scopeId","data-v-907c08f9"]]),Le={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(u,{emit:$}){const _=u,i=$,s=qe({get:()=>_.modelValue,set:n=>i("update:modelValue",n)}),f=k({});X(()=>_.variant,n=>{f.value=JSON.parse(JSON.stringify(n||{}))},{immediate:!0});function P(n){if(!n)return[];const r=_.attributes.find(d=>d.id===n);return r?r.values:[]}function U(n){if(!n)return"#000";const r=n.substring(1),d=parseInt(r,16),x=d>>16&255,w=d>>8&255,F=d>>0&255;return .299*x+.587*w+.114*F>186?"#000":"#fff"}function b(){f.value.attributes=f.value.attributes||[],f.value.attributes.push({attribute_id:null,attribute_value_id:null})}function E(n){f.value.attributes.splice(n,1)}function m(){i("update:modelValue",!1)}function y(){i("save",JSON.parse(JSON.stringify(f.value))),m()}return(n,r)=>(S(),D(Q,{modelValue:s.value,"onUpdate:modelValue":r[7]||(r[7]=d=>s.value=d),"max-width":"600"},{default:l(()=>[e(R,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(W,null,{default:l(()=>r[8]||(r[8]=[C("تعديل متغير المنتج")])),_:1}),e(N,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(c,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.purchase_price,"onUpdate:modelValue":r[0]||(r[0]=d=>f.value.purchase_price=d),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.retail_price,"onUpdate:modelValue":r[1]||(r[1]=d=>f.value.retail_price=d),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.wholesale_price,"onUpdate:modelValue":r[2]||(r[2]=d=>f.value.wholesale_price=d),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.tax_rate,"onUpdate:modelValue":r[3]||(r[3]=d=>f.value.tax_rate=d),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.discount,"onUpdate:modelValue":r[4]||(r[4]=d=>f.value.discount=d),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{class:"py-0",cols:"12"},{default:l(()=>[e(N,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.expiry_date,"onUpdate:modelValue":r[5]||(r[5]=d=>f.value.expiry_date=d),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.image_url,"onUpdate:modelValue":r[6]||(r[6]=d=>f.value.image_url=d),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",class:"mt-4"},{default:l(()=>[e(ce,null,{default:l(()=>r[9]||(r[9]=[C("الخصائص (Attributes)")])),_:1}),(S(!0),B(L,null,Y(f.value.attributes,(d,x)=>(S(),D(N,{dense:"",key:x,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5"},{default:l(()=>[e(M,{modelValue:d.attribute_id,"onUpdate:modelValue":w=>d.attribute_id=w,items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>d.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(c,{cols:"5"},{default:l(()=>[e(M,{modelValue:d.attribute_value_id,"onUpdate:modelValue":w=>d.attribute_value_id=w,items:P(d.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!d.attribute_id,":return-object":!1,"hide-details":"auto",style:de((()=>{const w=P(d.attribute_id).find(F=>F.id===d.attribute_value_id);return w&&w.color?`background:${w.color};color:${U(w.color)};border-radius:6px;`:""})())},{item:l(({item:w,props:F})=>[e(ge,_e({ref_for:!0},F,{style:w.raw.color?`background:${w.raw.color};color:${U(w.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:w})=>[g("span",{style:de(w.raw.color?`background:${w.raw.color};color:${U(w.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},A(w.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2"},{default:l(()=>[e(h,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:w=>E(x)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-2",text:"",color:"primary",small:"",onClick:b},{default:l(()=>r[10]||(r[10]=[C("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(Ce,{class:"my-4"}),e(N,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(h,{"prepend-icon":"ri-close-line",color:"error",onClick:m},{default:l(()=>r[11]||(r[11]=[C(" إلغاء ")])),_:1})]),_:1}),e(c,{cols:"6",class:"text-center"},{default:l(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",onClick:y},{default:l(()=>r[12]||(r[12]=[C(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ke=J(Le,[["__scopeId","data-v-400d4050"]]),Ge={class:"d-flex align-center justify-space-between mb-2"},We={class:"d-flex align-center gap-2"},Ze=["onClick"],Xe={key:0},Qe={colspan:"5",class:"pa-0"},Ye={id:"mobile-sticker-print"},el={__name:"products",setup(u){const $=k(!1),_=k({}),i=k(!1),s=k([]),f=k(!1),P=k(null),U=k(null),b=k(0),E=k(!1),m=k({page:1,itemsPerPage:10,sortBy:[]}),y=k(""),n=k(!1),r=k(null),d=k([]),x=k(null),w=[{title:"الاسم",key:"name"},{title:"اجمالي الكمية",key:"total_available_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],F=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];ke(()=>{T()});function T(){H("attributes",null,!0,!1).then(v=>{d.value=v.data})}function I(){E.value=!0;const{page:v,itemsPerPage:o,sortBy:p}=m.value,z=p.length?p[0].key:"id",Z=p.length&&p[0].order?p[0].order:"desc";H("products",{page:v,per_page:o,sort_by:z,sort_order:Z,search:y.value}).then(O=>{s.value=O.data,b.value=O.total}).finally(()=>{E.value=!1})}function ee(){i.value=!1,_.value={},$.value=!0}function le(v){$.value=!0,i.value=!0,_.value=JSON.parse(JSON.stringify(v))}function te(v){const o=s.value.findIndex(p=>p.id===v.id);o!==-1?s.value[o]=v:s.value.push(v),$.value=!1}function ae(v){P.value=v,f.value=!0}function ue(){P.value&&$e("product/delete",P.value.id).then(()=>{I(),be.success("تم حذف المنتج بنجاح"),f.value=!1,P.value=null}).catch(()=>be.error("حدث خطأ أثناء حذف المنتج"))}function oe(v){U.value=U.value===v?null:v}function ie(v,o){r.value=JSON.parse(JSON.stringify(v)),r.value.product_id=o,console.log("openVariantEditDialog",r.value),console.log("attributes",d.value),n.value=!0}function K(v){const o=s.value.find(z=>z.id===(v.product_id||U.value));if(!o)return;const p=o.variants.findIndex(z=>z.id===v.id);p!==-1&&(o.variants[p]=v),n.value=!1}function t(){return/android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(navigator.userAgent)}const a=k(!1);function V(v){if(t())x.value=v,a.value=!0;else{const o=document.createElement("div");document.body.appendChild(o);const p=Ae({render(){return Ee(ye,{product:v,ref:"stickerRef"})},mounted(){we(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{p.unmount(),document.body.removeChild(o)},5e3)})}});p.mount(o)}}function j(){const v=document.body.innerHTML,o=document.getElementById("mobile-sticker-print").outerHTML;document.body.innerHTML=o,window.print(),document.body.innerHTML=v,a.value=!1}return(v,o)=>(S(),D(Ve,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(He,{dialog:$.value,"onUpdate:dialog":o[0]||(o[0]=p=>$.value=p),product:_.value,isEditMode:i.value,onSaved:te},null,8,["dialog","product","isEditMode"]),e(Ke,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=p=>n.value=p),variant:r.value,attributes:d.value,onSave:K},null,8,["modelValue","variant","attributes"]),e(R,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[g("div",Ge,[o[10]||(o[10]=g("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(h,{color:"primary",onClick:ee,size:"small"},{default:l(()=>o[9]||(o[9]=[C("+ إضافة منتج")])),_:1}),g("div",We,[e(q,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=p=>y.value=p),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Pe(I,["enter"]),onBlur:I,clearable:"","onClick:clear":o[3]||(o[3]=()=>{y.value="",I()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":I},null,8,["modelValue"])])]),e(pe,{items:s.value,headers:w,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:E.value,options:m.value,"server-items-length":b.value,"items-per-page":m.value.itemsPerPage,page:m.value.page,"sort-by":m.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":I},{item:l(({item:p})=>{var z,Z;return[g("tr",{class:ve({"bg-product-expanded":U.value===p.id}),onClick:O=>oe(p.id),style:{cursor:"pointer"}},[g("td",null,A(p.name),1),g("td",null,A(p.total_available_quantity),1),g("td",null,A(((z=p.category)==null?void 0:z.name)??"-"),1),g("td",null,A(((Z=p.brand)==null?void 0:Z.name)??"-"),1),g("td",{onClick:o[4]||(o[4]=G(()=>{},["stop"]))},[e(h,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:G(O=>le(p),["stop"])},null,8,["onClick"]),e(h,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:G(O=>ae(p),["stop"])},null,8,["onClick"])])],10,Ze),U.value===p.id?(S(),B("tr",Xe,[g("td",Qe,[e(pe,{items:p.variants,headers:F,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:O})=>[g("tr",{class:ve(O.quantity<=O.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[g("td",null,A(O.sku),1),g("td",null,A(O.barcode),1),g("td",null,A(O.quantity),1),g("td",null,A(O.min_quantity),1),g("td",null,A(O.cost),1),g("td",null,A(O.wholesale_price),1),g("td",null,A(O.retail_price),1),g("td",null,A(O.discount),1),g("td",null,[e(Ne,{attributes:O.attributes,"font-size":"10px"},null,8,["attributes"])]),g("td",null,[g("div",null,[e(h,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:G(Ue=>ie(O,p.id),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[11]||(o[11]=[C("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(h,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[12]||(o[12]=[C("ri-delete-bin-line")])),_:1})]),_:1}),e(h,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:G(Ue=>V(O),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>o[13]||(o[13]=[C("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):xe("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(Q,{modelValue:f.value,"onUpdate:modelValue":o[6]||(o[6]=p=>f.value=p),"max-width":"340"},{default:l(()=>[e(R,null,{default:l(()=>[e(W,null,{default:l(()=>o[14]||(o[14]=[C("تأكيد الحذف")])),_:1}),e(re,null,{default:l(()=>o[15]||(o[15]=[C("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(me,null,{default:l(()=>[e(h,{color:"error",onClick:ue,size:"small"},{default:l(()=>o[16]||(o[16]=[C("تأكيد")])),_:1}),e(h,{onClick:o[5]||(o[5]=p=>f.value=!1),size:"small"},{default:l(()=>o[17]||(o[17]=[C("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:a.value,"onUpdate:modelValue":o[8]||(o[8]=p=>a.value=p),"max-width":"350"},{default:l(()=>[e(R,null,{default:l(()=>[e(W,{class:"text-center"},{default:l(()=>o[18]||(o[18]=[C("معاينة استيكر المنتج")])),_:1}),e(re,null,{default:l(()=>[g("div",Ye,[e(ye,{product:x.value,ref:"mobileStickerRef"},null,8,["product"])])]),_:1}),e(me,{class:"justify-center"},{default:l(()=>[e(h,{color:"primary",onClick:j},{default:l(()=>o[19]||(o[19]=[C("طباعة")])),_:1}),e(h,{color:"grey",onClick:o[7]||(o[7]=p=>a.value=!1)},{default:l(()=>o[20]||(o[20]=[C("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ul=J(el,[["__scopeId","data-v-5ff5c175"]]);export{ul as default};
