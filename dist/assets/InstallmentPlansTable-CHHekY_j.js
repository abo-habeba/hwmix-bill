import{_ as L}from"./InfoDisplay-CYjwHgxA.js";import{_ as j,r as u,h as z,P as G,c as x,d as a,j as l,aj as E,X as q,F as B,ap as X,o as d,a9 as _,a3 as b,b as i,a as C,aL as Y,t as v,bp as J,A as K,k as y,ak as V,q as g,a4 as w,a5 as r,U as O,ah as Q,a1 as W,au as Z,Y as ee}from"./index-pP7MSS3c.js";import{P as te}from"./PayInstallmentDialog-CbXAkwXy.js";const ae={class:"progress-bar-container"},le={class:"d-flex flex-wrap"},se={key:0,class:"text-grey-darken-1"},ne={__name:"InstallmentPlansTable",setup(oe){const S=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],D=u(null);function T(s,t){var n;D.value=(n=t==null?void 0:t.item)==null?void 0:n.id,console.log("Selected Row ID:",D.value)}const R=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status_label"},{title:"الإجراءات",key:"actions",sortable:!1}],P=u([]),c=u([]),o=u({}),p=u(!1),F=u(null),k=u(!1),I=u(!0);function f(s){const t=parseFloat(s.total_installments_pay)||0,n=parseFloat(s.total_installments_amount)||1;return Math.min(Math.round(t/n*100),100)}function $(s){const t=f(s);return t===100?"#4CAF50":t>=50?"#2196F3":t>=20?"#FFC107":"#F44336"}const M=z(()=>o.value.start_date?new Date(o.value.start_date).toLocaleDateString("ar-EG"):"—");function h({item:s}){const t=parseFloat(s.remaining)||0,n=new Date(s.due_date),e=new Date;return n.setHours(0,0,0,0),e.setHours(0,0,0,0),s.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:t>0&&n<e?{style:{backgroundColor:"#EF9A9A"}}:t>0?{style:{backgroundColor:"#FFE082"}}:f(s)=="100"?{style:{backgroundColor:"#E8F5E9"}}:{}}function N(){X("installment-plans",{per_page:-1},!0,!0,!1).then(s=>{P.value=s||[]})}function U(s){s.paid_installments.forEach(t=>{const n=c.value.findIndex(e=>e.id===t.id);n!==-1&&(c.value[n]={...c.value[n],...t})})}function H(s){!s||!Array.isArray(s.installments)||(o.value=s,console.log("currentPlan.value",o.value),c.value=s.installments,p.value=!0)}function A(s,t){F.value=s,I.value=t,k.value=!0}return G(N),(s,t)=>{const n=L;return d(),x(B,null,[a(E,{"fixed-header":"",headers:S,items:P.value,"item-value":"id","row-props":h,class:"elevation-1",density:"compact","hide-default-footer":"",hover:"","onClick:row":T},{"item.actions":l(({item:e})=>[a(_,{color:"primary",density:"compact",onClick:b(m=>H(e),["stop"])},{default:l(()=>t[3]||(t[3]=[i("عرض الأقساط")])),_:2},1032,["onClick"])]),"item.paid_percentage":l(({item:e})=>[C("div",ae,[C("div",{class:"progress-bar-fill",style:Y({width:f(e)+"%",backgroundColor:$(e)})},v(f(e))+"% ",5)])]),"item.plan_products":l(({item:e})=>[a(J,{column:""},{default:l(()=>[C("div",le,[(d(!0),x(B,null,K(e.invoice_items.slice(0,2),m=>(d(),y(V,{key:m.id,size:"small",color:"info",variant:"outlined"},{default:l(()=>[i(v(m.name),1)]),_:2},1024))),128)),e.invoice_items.length>2?(d(),y(V,{key:0,class:"text-grey px-1"},{default:l(()=>[i("منتجات "+v(e.invoice_items.length-2)+" اخرين ",1)]),_:2},1024)):g("",!0)]),!e.invoice_items||e.invoice_items.length===0?(d(),x("span",se,"لا توجد منتجات")):g("",!0)]),_:2},1024)]),"no-data":l(()=>[a(w,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>t[4]||(t[4]=[i("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items"]),a(q,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),"max-width":"900px",scrollable:""},{default:l(()=>[a(O,null,{default:l(()=>[a(Q,{class:"bg-primary text-white"},{default:l(()=>t[5]||(t[5]=[i("تفاصيل خطة التقسيط")])),_:1}),a(W,null,{default:l(()=>[a(w,{class:"px-4 pt-4",dense:""},{default:l(()=>[a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(n,{icon:"ri-user-line",label:"المستخدم",text:((e=o.value.user)==null?void 0:e.nickname)||"غير متوفر"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(n,{icon:"ri-file-text-line",label:"الفاتورة",text:((e=o.value.invoice)==null?void 0:e.invoice_number)||"—"},null,8,["text"])]}),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-calendar-line",label:"تاريخ البدء",text:M.value},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-money-dollar-box-line",label:"إجمالي الفاتورة",text:o.value.total_amount},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-wallet-line",label:"إجمالي المتبقي",text:o.value.total_installments_remaining},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-hand-coin-line",label:"إجمالي المدفوع",text:o.value.total_pay},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-hand-heart-line",label:"المقدم",text:o.value.down_payment},null,8,["text"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:l(()=>{var e;return[a(n,{icon:"ri-list-ordered",label:"عدد الأقساط",text:((e=o.value.installments)==null?void 0:e.length)||0},null,8,["text"])]}),_:1})]),_:1}),a(E,{"row-props":h,headers:R,items:c.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":l(({item:e})=>[a(V,{color:e.status==="paid"?"success":"error",dark:""},{default:l(()=>[i(v(e.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[e.status!=="paid"?(d(),y(_,{key:0,color:e.status==="paid"?"grey":"success",disabled:e.status==="paid",density:"compact",class:"me-1",onClick:b(m=>A(e,!0),["stop"])},{default:l(()=>t[6]||(t[6]=[i("دفع القسط")])),_:2},1032,["color","disabled","onClick"])):g("",!0),e.status!=="paid"?(d(),y(_,{key:1,color:e.status==="paid"?"grey":"warning",disabled:e.status==="paid",density:"compact",onClick:b(m=>A(e,!1),["stop"])},{default:l(()=>t[7]||(t[7]=[i("مبلغ مختلف")])),_:2},1032,["color","disabled","onClick"])):g("",!0)]),"no-data":l(()=>[a(w,{class:"pa-4"},{default:l(()=>[a(r,{class:"text-center text-grey"},{default:l(()=>t[8]||(t[8]=[i("لا توجد أقساط لهذه الخطة")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),a(Z,null,{default:l(()=>[a(ee),a(_,{text:"",onClick:t[0]||(t[0]=e=>p.value=!1)},{default:l(()=>t[9]||(t[9]=[i("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(te,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),installment:F.value,"direct-pay":I.value,"onUpdate:installment":U},null,8,["modelValue","installment","direct-pay"])],64)}}},de=j(ne,[["__scopeId","data-v-5dd61371"]]);export{de as default};
