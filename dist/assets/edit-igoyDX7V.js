import{S as X,r as m,w as F,o as r,c as y,d as e,k as l,b as V,t as U,a9 as I,W as T,ai as h,a4 as B,a5 as x,a1 as z,l as C,F as $,B as S,a8 as ne,s as L,X as re,au as M,Z as Y,u as _,Y as O,$ as Z,Q as J,a as j,al as ee,_ as le,ag as ie,v as de,V as me,n as pe,a3 as G,a7 as ce,i as ve,a6 as P,N as E,H as fe,I as be,L as Ve,aa as q,A as ye,ap as ge,ar as ke,g as xe,av as _e,aw as we,ax as H,a2 as Ce,ay as Q,q as Ne,az as Ue,h as Re}from"./index-CjjdYkdB.js";import{g as Ie}from"./permissions-3fwV70Qx.js";const $e={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(w,{emit:k}){const{xs:R}=X(),g=w,N=k,d=m(g.roles),p=m(!1),c=m([]);F(()=>g.user.roles,v=>{c.value=v?v.map(s=>s.name):[]},{immediate:!0});function b(){const v={user_id:g.user.id,roles:c.value};console.log(v),Z("role/assignRole",v).then(s=>{N("update:user",s),p.value=!1})}return(v,s)=>(r(),y($,null,[e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:s[0]||(s[0]=f=>p.value=!0)},{default:l(()=>[V(U(d.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(O,{fullscreen:_(R),modelValue:p.value,"onUpdate:modelValue":s[3]||(s[3]=f=>p.value=f),"max-width":"500"},{default:l(()=>[e(T,{class:"pa-4"},{default:l(()=>[e(h,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>s[4]||(s[4]=[V("تعديل ادوار المستخدم ")])),_:1}),e(I,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>s[5]||(s[5]=[V(" اضافة دور جديد ")])),_:1}),e(B,{class:"mb-7"},{default:l(()=>[e(x,{cols:"12"},{default:l(()=>[e(z,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[d.value.length?(r(),C(B,{key:0},{default:l(()=>[(r(!0),y($,null,S(d.value,(f,a)=>(r(),C(x,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:a},{default:l(()=>[f?(r(),C(ne,{key:0,modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=n=>c.value=n),label:f.name,value:f.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):L("",!0)]),_:2},1024))),128))]),_:1})):(r(),C(re,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>s[6]||(s[6]=[V(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(M,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(I,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:s[2]||(s[2]=f=>p.value=!1)},{default:l(()=>s[7]||(s[7]=[V(" إلغاء ")])),_:1}),e(Y),e(I,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:b},{default:l(()=>s[8]||(s[8]=[V(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},De={key:0},Pe={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(w,{expose:k}){const R=w,g=m(null),N=m([]);J(()=>{});const d=m(!1);function p(){d.value=!0}return F(()=>R.userRole,c=>{c&&c.permissions&&(N.value=c.permissions,g.value=Ie(N.value))},{immediate:!0}),k({openDialog:p}),(c,b)=>(r(),C(O,{modelValue:d.value,"onUpdate:modelValue":b[1]||(b[1]=v=>d.value=v),"max-width":"500px"},{default:l(()=>[e(T,null,{default:l(()=>[e(h,null,{default:l(()=>[j("span",null," صلاحيات الدور "+U(w.userRole.name),1)]),_:1}),g.value?(r(),y("div",De,[(r(!0),y($,null,S(g.value,(v,s)=>(r(),y("div",{key:s},[b[2]||(b[2]=j("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(h,null,{default:l(()=>[j("span",null,U(v.name),1)]),_:2},1024),(r(!0),y($,null,S(v.permissions,(f,a)=>(r(),C(ee,{class:"ma-1",key:a,color:"blue","text-color":"white"},{default:l(()=>[V(U(f.name),1)]),_:2},1024))),128))]))),128))])):L("",!0),e(M,null,{default:l(()=>[e(I,{text:"",onClick:b[0]||(b[0]=v=>d.value=!1)},{default:l(()=>b[3]||(b[3]=[V("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Te={class:"phone-input-wrapper"},Se={key:0},Ae={key:1},he={key:0},qe={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(w,{emit:k}){const R=w,g=k,{initialPhoneNumber:N}=ie(R),d=m(N.value);F(d,a=>{g("update:phoneNumber",a)}),F(N,a=>{a!==d.value&&(d.value=a)});const p=m(!1),c=m([]),b=m("");async function v(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){q.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const a=["tel","name"],n={multiple:!1},i=await navigator.contacts.select(a,n);i&&i.length&&i[0].tel&&i[0].tel.length?i[0].tel.length===1?d.value=i[0].tel[0]:(c.value=i[0].tel,b.value=i[0].name?i[0].name[0]:"",p.value=!0):q.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{q.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function s(a){d.value=a,p.value=!1}const f=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(a,n)=>(r(),y("div",Te,[e(_(P),{modelValue:_(d),"onUpdate:modelValue":n[2]||(n[2]=i=>ve(d)?d.value=i:null),label:w.label,placeholder:w.placeholder,rules:w.rules,counter:w.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":v,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(_(de),{location:"top"},{activator:l(({props:i})=>[e(_(me),pe(i,{class:"contact-picker-icon",color:_(f)?"primary":"grey",size:"24",style:_(f)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:n[0]||(n[0]=G(A=>_(f)&&v(),["stop"])),tabindex:"0",onKeydown:n[1]||(n[1]=ce(G(A=>_(f)&&v(),["prevent"]),["enter"])),"aria-disabled":!_(f)}),{default:l(()=>n[5]||(n[5]=[V(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[_(f)?(r(),y("span",Se,"اختيار من جهات الاتصال")):(r(),y("span",Ae,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(O,{modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=i=>p.value=i),"max-width":"400"},{default:l(()=>[e(T,null,{default:l(()=>[e(h,{class:"text-h6"},{default:l(()=>[n[6]||(n[6]=V("اختر رقم الهاتف ")),b.value?(r(),y("span",he,"("+U(b.value)+")",1)):L("",!0)]),_:1}),e(E),e(fe,null,{default:l(()=>[(r(!0),y($,null,S(c.value,(i,A)=>(r(),C(be,{key:A,onClick:W=>s(i),style:{cursor:"pointer"}},{default:l(()=>[e(Ve,null,{default:l(()=>[V(U(i),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(M,null,{default:l(()=>[e(Y),e(I,{text:"",onClick:n[3]||(n[3]=i=>p.value=!1)},{default:l(()=>n[7]||(n[7]=[V("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fe=le(qe,[["__scopeId","data-v-28c969c6"]]),Be={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},Le={__name:"edit",setup(w){X();const k=xe(),R=Re(),g=m(!1),N=m(k.params.id),d=m([]),p=m([]);m([]);const c=m([]),b=m([]),v=ye(),s=m(null),f=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=m({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],password:""}),n=m(k.params.tab||f[0].tab),i=m(!1),A=[u=>!!u||"اسم الشهرة مطلوب"],W=[u=>!!u||"رقم الهاتف مطلوب",u=>/^\d{10,15}$/.test(u)||"رقم الهاتف غير صحيح"];J(()=>{ae(),k.params.id?(g.value=!0,ge("roles").then(u=>{d.value=u.data,console.log("roles",d.value)}).catch(u=>{d.value=[]}),ke("user",N.value,!0).then(u=>{a.value=u,c.value=u.companies}).finally(u=>{g.value=!1})):a.value.password="12345678"});function ae(){const u=[...a.value.companies.map(t=>({...t,disabled:!1})),...v.user.companies.map(t=>({...t,disabled:!0}))],o=Array.from(new Map(u.map(t=>[t.id,t])).values());return b.value=o,c.value=b.value.filter(t=>t.id===v.user.company_id),o}function te(u){return{title:u.name,subtitle:u.field,disabled:!u.disabled}}function oe(){console.log("selectedCompanies",c.value),p.value=Array.from(c.value.map(u=>typeof u=="object"&&u.id!==void 0?u.id:u)),console.log("companyIds",p.value),a.value.company_id=p.value.length<=0?null:p.value[0],a.value.company_ids=p.value.length>0?p.value:null,a.value.companies=null,Z("user",a.value,k.params.id).then(()=>{q.success(k.params.id?"تم تعديل المستخدم بنجاح":"تم إضافة المستخدم بنجاح"),setTimeout(()=>{R.go(-1)},1200)})}const K=m({});function se(u){u&&(K.value=u,s.value.openDialog())}return(u,o)=>(r(),C(T,null,{default:l(()=>[e(we,{class:"ma-5",modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=t=>n.value=t),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),y($,null,S(f,(t,D)=>e(_e,{key:D,value:t.tab,"append-icon":t.icon},{default:l(()=>[V(U(t.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(Ue,{modelValue:n.value,"onUpdate:modelValue":o[11]||(o[11]=t=>n.value=t)},{default:l(()=>[e(H,{value:"account"},{default:l(()=>[e(B,null,{default:l(()=>[e(x,{cols:"12"},{default:l(()=>[e(T,{elevation:"0",loading:g.value,title:_(k).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(E),e(z,null,{default:l(()=>[e(Ce,{class:"mt-6",ref:"userForm",modelValue:i.value,"onUpdate:modelValue":o[9]||(o[9]=t=>i.value=t)},{default:l(()=>[e(B,null,{default:l(()=>[e(x,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(P,{modelValue:a.value.full_name,"onUpdate:modelValue":o[1]||(o[1]=t=>a.value.full_name=t),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(x,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(P,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":o[2]||(o[2]=t=>a.value.nickname=t),label:" اسم الشهرة ",rules:A},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(P,{modelValue:a.value.email,"onUpdate:modelValue":o[3]||(o[3]=t=>a.value.email=t),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Fe,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":o[4]||(o[4]=t=>a.value.phone=t),rules:W,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(x,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(P,{modelValue:a.value.username,"onUpdate:modelValue":o[5]||(o[5]=t=>a.value.username=t),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Q,{modelValue:a.value.customer_type,"onUpdate:modelValue":o[6]||(o[6]=t=>a.value.customer_type=t),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{cols:"12"},{default:l(()=>[e(Q,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=t=>c.value=t),items:b.value,label:"حدد الشركة","item-title":"name","item-value":"id","item-color":"red",chips:"","closable-chips":"",multiple:"","item-props":te,"return-object":""},null,8,["modelValue","items"])]),_:1}),e(E,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(x,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(P,{required:"",modelValue:a.value.password,"onUpdate:modelValue":o[8]||(o[8]=t=>a.value.password=t),label:" الباسورد ",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(I,{disabled:!i.value,class:Ne({"forbidden-cursor":!i.value}),onClick:oe},{default:l(()=>o[12]||(o[12]=[V(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(H,{value:"role"},{default:l(()=>[e(T,{elevation:"0",class:"ma-4"},{default:l(()=>{var t;return[d.value&&a.value?(r(),C($e,{key:0,user:a.value,"onUpdate:user":o[10]||(o[10]=D=>a.value=D),roles:d.value},null,8,["user","roles"])):L("",!0),e(h,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>o[13]||(o[13]=[V(" ادوار المستخدم ")])),_:1}),((t=a.value)==null?void 0:t.roles.length)>0?(r(),C(z,{key:1},{default:l(()=>[(r(!0),y($,null,S(a.value.roles,(D,ue)=>(r(),y("span",{key:ue},[e(ee,{onClick:je=>se(D),class:"ma-2",variant:"outlined"},{default:l(()=>[V(U(D.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),y("div",Be,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Pe,{ref_key:"roleDetail",ref:s,userRole:K.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=le(Le,[["__scopeId","data-v-f298d284"]]);export{Me as default};
