import{S as Ce,r as i,j as T,Q as xe,ah as x,w as R,m as S,n as t,ay as ke,o as v,d as e,X as $,a2 as f,aa as I,a as r,t as k,a1 as W,q as we,u as X,a7 as b,a8 as o,al as m,aG as z,aH as J,au as Z,v as Y,aI as L,b as p,aJ as h,c as g,C as N,F,I as ee,aK as le,V as Se,N as ae,Z as te,ak as Ne,ad as ue,aq as Fe,aL as Oe,az as qe,aE as y,a0 as oe,aF as Je}from"./index-CTwtWwMO.js";const Ae={style:{display:"flex",position:"sticky",bottom:"4px",left:"0",right:"0",width:"100%"}},De={key:0},Be={__name:"products",setup(Pe){const{xs:j}=Ce(),_=i(!1),w=i([]),U=i(null),A=i([]),O=i([]),K=i([]),D=i([]),q=i(""),M=i("");i("");const P=i(""),d=i({name:"",slug:"",is_active:!0,featured:!1,is_returnable:!0,description:"",description_long:"",category_id:null,brand_id:null,warehouse_id:null,variants:[{attributes:[{attribute_id:null,attribute_value_id:null}],dimensions:"",discount:null,expiry_date:"",image_url:"",status:"active",tax_rate:null}]}),G=T(()=>U.value!==null);xe(()=>{const u=localStorage.getItem("products");u&&(w.value=JSON.parse(u)),de(),ne(),re(),ie(),me(),se()});function de(){x("products").then(u=>{A.value=u.data})}function ne(){x("attributes").then(u=>{A.value=u.data})}function se(){x("product-variants").then(u=>{P.value=u.data,console.log(P.value)})}function re(){x("warehouses").then(async u=>{O.value=u.data,d.value.warehouse_id=O.value[0].id})}function ie(){x("brands").then(u=>{K.value=u.data})}function me(){x("categories").then(u=>{D.value=u.data})}R(w,u=>{localStorage.setItem("products",JSON.stringify(u)),console.log(u)},{deep:!0});const pe=()=>{const u=JSON.parse(JSON.stringify(d.value.variants[0]));d.value.variants.push(u)},ve=u=>{d.value.variants.splice(u,1)},E=()=>{Object.assign(d.value,{name:"",slug:"",is_active:!0,featured:!1,is_returnable:!0,published_at:"",description:"",description_long:"",company_id:1,created_by:1,category_id:null,brand_id:null,variants:[{attributes:[{attribute_id:null,attribute_value_id:null}],dimensions:"",discount:null,expiry_date:"",image_url:"",status:"active",tax_rate:null}]})},fe=()=>{E(),U.value=null,_.value=!0},H=i(!1),s=i(null),Ve=u=>{s.value=u,d.value=s.value.product,d.value.variants=s.value,d.value.variants.attributes=s.value.attributes,_.value=!0},ce=u=>{const a=JSON.parse(JSON.stringify(u));return a.variants&&Array.isArray(a.variants)&&(a.variants=a.variants.map(l=>(l.attributes&&Array.isArray(l.attributes)&&(l.attributes=l.attributes.map(V=>{const{values:n,...C}=V;return C})),l))),a},be=()=>{const u=ce(d.value);if(!d.value.name){y.error("اسم المنتج مطلوب");return}U.value!==null?oe("product",u,!1,!0,!0).then(()=>{w.value[U.value]=JSON.parse(JSON.stringify(d.value)),y.success("تم تعديل المنتج بنجاح"),E(),_.value=!1,U.value=null}).catch(()=>y.error("حدث خطأ أثناء تعديل المنتج")):oe("product",u,!1,!0,!0).then(()=>{w.value.push(JSON.parse(JSON.stringify(d.value))),y.success("تم إضافة المنتج بنجاح"),E(),_.value=!1,U.value=null}).catch(()=>y.error("حدث خطأ أثناء إضافة المنتج"))},_e=u=>{Je("product-variant",u).then(()=>{y.success("تم حذف المنتج بنجاح")}).catch(()=>y.error("حدث خطأ أثناء حذف المنتج"))};function ge(u){return u.normalize("NFKD").toLowerCase().trim().replace(/[\u0300-\u036f]/g,"").replace(/[^\w\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]+/g,"-").replace(/^-+|-+$/g,"")}R(()=>d.value.name,u=>{d.value.slug=ge(u)},{immediate:!0});const Q=T(()=>{const u=[],a=(l,V=0)=>{u.push({id:l.id,name:`${"".repeat(V)}${l.name}`}),l.children&&l.children.length&&l.children.forEach(n=>a(n,V+1))};return D.value.forEach(l=>a(l)),u}),ye=T(()=>q.value?Q.value.filter(u=>u.name.includes(q.value)):Q.value);function Ue(){_.value=!1}return(u,a)=>(v(),S(ke,null,{default:t(()=>[e(te,{fullscreen:X(j),modelValue:_.value,"onUpdate:modelValue":a[14]||(a[14]=l=>_.value=l)},{default:t(()=>[e($,null,{default:t(()=>[e(f,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:a[0]||(a[0]=l=>_.value=!1)}),e(I,{class:"ma-5 text-center"},{default:t(()=>[r("h2",null,k(G.value?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(W,{class:we(X(j)?"px-2":"px-5")},{default:t(()=>[e(b,{class:"elevation-10 my-3"},{default:t(()=>[e(o,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:d.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>d.value.name=l),label:"اسم المنتج",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,null,{default:t(()=>[e(z,{modelValue:d.value.is_active,"onUpdate:modelValue":a[2]||(a[2]=l=>d.value.is_active=l),label:"نشط"},null,8,["modelValue"])]),_:1}),e(o,null,{default:t(()=>[e(z,{modelValue:d.value.featured,"onUpdate:modelValue":a[3]||(a[3]=l=>d.value.featured=l),label:"مميز"},null,8,["modelValue"])]),_:1}),e(o,null,{default:t(()=>[e(z,{modelValue:d.value.is_returnable,"onUpdate:modelValue":a[4]||(a[4]=l=>d.value.is_returnable=l),label:"قابل للإرجاع"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(o,{cols:"12"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,null,{default:t(()=>[e(J,{modelValue:d.value.category_id,"onUpdate:modelValue":[a[5]||(a[5]=l=>d.value.category_id=l),a[6]||(a[6]=l=>d.value.category_id=l?l.id:null)],"item-value":"id","item-title":"name",items:ye.value||[],label:"الفئة",search:q.value,"onUpdate:search":a[7]||(a[7]=l=>q.value=l),"hide-no-data":"","hide-selected":""},null,8,["modelValue","items","search"])]),_:1}),e(o,{class:"px-0"},{default:t(()=>[e(J,{modelValue:d.value.brand_id,"onUpdate:modelValue":[a[8]||(a[8]=l=>d.value.brand_id=l),a[9]||(a[9]=l=>d.value.brand_id=l?l.id:null)],"item-value":"id","item-title":"name",items:K.value||[],label:"العلامة التجارية",search:M.value,"onUpdate:search":a[10]||(a[10]=l=>M.value=l),"hide-no-data":"","hide-selected":""},null,8,["modelValue","items","search"])]),_:1}),e(o,null,{default:t(()=>[O.value.length?(v(),S(Z,{key:0,modelValue:d.value.warehouse_id,"onUpdate:modelValue":a[11]||(a[11]=l=>d.value.warehouse_id=l),"item-value":"id","item-title":"name",items:O.value||[],label:"المخزن"},null,8,["modelValue","items"])):Y("",!0)]),_:1})]),_:1})]),_:1}),e(o,{cols:"12"},{default:t(()=>[e(L,{rows:"1","auto-grow":"",modelValue:d.value.description,"onUpdate:modelValue":a[12]||(a[12]=l=>d.value.description=l),label:"الوصف القصير"},null,8,["modelValue"])]),_:1}),e(o,{cols:"12"},{default:t(()=>[e(L,{rows:"2","auto-grow":"",modelValue:d.value.description_long,"onUpdate:modelValue":a[13]||(a[13]=l=>d.value.description_long=l),label:"الوصف المفصل"},null,8,["modelValue"])]),_:1})]),_:1}),e(I,null,{default:t(()=>a[24]||(a[24]=[p(" تفاصيل المنتج الإضافية ")])),_:1}),e(h,{class:"pb-2"},{default:t(()=>a[25]||(a[25]=[p(" مثل السعر والصور والخصومات ")])),_:1}),(v(!0),g(F,null,N(d.value.variants,(l,V)=>(v(),S(b,{class:"elevation-10 my-5",key:V},{default:t(()=>[e(o,{cols:"12"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,{cols:"4"},{default:t(()=>[e(m,{modelValue:l.purchase_price,"onUpdate:modelValue":n=>l.purchase_price=n,label:"سعر الشراء",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(o,{cols:"4"},{default:t(()=>[e(m,{modelValue:l.retail_price,"onUpdate:modelValue":n=>l.retail_price=n,label:"سعر التجزئة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(o,{cols:"4"},{default:t(()=>[e(m,{modelValue:l.wholesale_price,"onUpdate:modelValue":n=>l.wholesale_price=n,label:"سعر الجملة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{cols:"12"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,{cols:"6"},{default:t(()=>[e(m,{modelValue:l.tax_rate,"onUpdate:modelValue":n=>l.tax_rate=n,label:"نسبة الضريبة",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(o,{cols:"6"},{default:t(()=>[e(m,{modelValue:l.discount,"onUpdate:modelValue":n=>l.discount=n,label:"الخصم",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{class:"py-0",cols:"12"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,{cols:"6"},{default:t(()=>[e(m,{modelValue:l.expiry_date,"onUpdate:modelValue":n=>l.expiry_date=n,label:"تاريخ الانتهاء",type:"date"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(o,{cols:"6"},{default:t(()=>[e(m,{modelValue:l.image_url,"onUpdate:modelValue":n=>l.image_url=n,label:"رابط الصورة"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{cols:"12"},{default:t(()=>[e(f,{variant:"text",color:"primary",onClick:n=>l.attributes.push({attribute_id:null,attribute_value_id:null,values:[]})},{default:t(()=>a[26]||(a[26]=[p(" + إضافة خصائص ")])),_:2},1032,["onClick"]),e(h,null,{default:t(()=>a[27]||(a[27]=[p("اختيار خصائص مثل اللون والحجم")])),_:1}),(v(!0),g(F,null,N(l.attributes,(n,C)=>(v(),g("div",{key:C,class:"d-flex align-center mb-2"},[e(o,{cols:"5"},{default:t(()=>[e(J,{modelValue:n.attribute_id,"onUpdate:modelValue":[c=>n.attribute_id=c,c=>n.attribute_id=c?c.id:null],items:A.value||[],"item-title":"name","item-value":"id",label:"الخاصية",class:"mr-2"},{item:t(({props:c,item:B})=>[e(ee,le({ref_for:!0},c,{onClick:()=>{n.attribute_value_id=null,n.values=B.raw.values}}),null,16,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(o,{cols:"5"},{default:t(()=>[e(J,{modelValue:n.attribute_value_id,"onUpdate:modelValue":c=>n.attribute_value_id=c,items:n.values||[],"item-title":"name","item-value":"id",label:"اختر قيمة",class:"mr-2","return-object":!1},{item:t(({props:c,item:B})=>[e(ee,le({"append-icon":"ri-pantone-fill",style:{color:B.raw.value||""},ref_for:!0},c),null,16,["style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(o,{cols:"2"},{default:t(()=>[e(f,{variant:"text",class:"ms-2",color:"red",icon:"",onClick:c=>l.attributes.splice(C,1)},{default:t(()=>[e(Se,null,{default:t(()=>a[28]||(a[28]=[p("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]))),128))]),_:2},1024),e(o,{cols:"12",md:"12"},{default:t(()=>[e(f,{"prepend-icon":"ri-delete-bin-line",color:"error",onClick:n=>ve(V)},{default:t(()=>a[29]||(a[29]=[p("حذف التفاصيل")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(f,{variant:"text",onClick:pe,class:"mb-3"},{default:t(()=>a[30]||(a[30]=[p("+ إضافة تفاصيل جديدة")])),_:1}),e(ae,{class:"my-4"}),r("div",Ae,[e(b,null,{default:t(()=>[e(o,{cols:"4"},{default:t(()=>[e(f,{"prepend-icon":"ri-close-line",color:"error",onClick:Ue},{default:t(()=>a[31]||(a[31]=[p(" إلغاء ")])),_:1})]),_:1}),e(o,{cols:"4",class:"text-center"},{default:t(()=>[e(f,{"prepend-icon":"ri-save-line",color:"success",onClick:be},{default:t(()=>[p(k(G.value?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1})]),_:1})]),_:1})])]),_:1},8,["class"])]),_:1})]),_:1},8,["fullscreen","modelValue"]),e(te,{modelValue:H.value,"onUpdate:modelValue":a[23]||(a[23]=l=>H.value=l),"max-width":"600px"},{default:t(()=>[e($,null,{default:t(()=>[e(I,null,{default:t(()=>a[32]||(a[32]=[r("span",{class:"headline"},"تعديل المنتج",-1)])),_:1}),e(W,null,{default:t(()=>[e(Ne,{ref:"form"},{default:t(()=>[e(b,null,{default:t(()=>[e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:s.value.name,"onUpdate:modelValue":a[15]||(a[15]=l=>s.value.name=l),label:"اسم المنتج",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(L,{modelValue:s.value.description,"onUpdate:modelValue":a[16]||(a[16]=l=>s.value.description=l),label:"الوصف",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(Z,{modelValue:s.value.category,"onUpdate:modelValue":a[17]||(a[17]=l=>s.value.category=l),items:D.value,label:"الفئة",required:""},null,8,["modelValue","items"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:s.value.purchase_price,"onUpdate:modelValue":a[18]||(a[18]=l=>s.value.purchase_price=l),label:"سعر الشراء",type:"number",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:s.value.retail_price,"onUpdate:modelValue":a[19]||(a[19]=l=>s.value.retail_price=l),label:"السعر التجزئة",type:"number",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:s.value.discount,"onUpdate:modelValue":a[20]||(a[20]=l=>s.value.discount=l),label:"الخصم",type:"number",required:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:s.value.sku,"onUpdate:modelValue":a[21]||(a[21]=l=>s.value.sku=l),label:"SKU",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(ae),e(ue,null,{default:t(()=>a[33]||(a[33]=[p("الخصائص")])),_:1}),(v(!0),g(F,null,N(s.value.attributes,(l,V)=>(v(),S(b,{key:V},{default:t(()=>[e(o,{cols:"12",sm:"6"},{default:t(()=>[e(m,{modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,label:l.name},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)]),_:1}),e(Fe,null,{default:t(()=>[e(f,{text:"",onClick:a[22]||(a[22]=l=>_.value=!1)},{default:t(()=>a[34]||(a[34]=[p("إلغاء")])),_:1}),e(f,{color:"primary"},{default:t(()=>a[35]||(a[35]=[p("حفظ التغييرات")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($,{class:"pa-4"},{default:t(()=>[e(f,{color:"primary",onClick:fe},{default:t(()=>a[36]||(a[36]=[p("+ إضافة منتج")])),_:1}),e(Oe,{class:"mt-4"},{default:t(()=>[a[37]||(a[37]=r("thead",null,[r("tr",null,[r("th",null,"الاسم"),r("th",null,"الخصائص"),r("th",null,"الكمية"),r("th",null,"الفئة"),r("th",null,"الإجراء")])],-1)),w.value.length?(v(),g("tbody",De,[(v(!0),g(F,null,N(P.value,(l,V)=>(v(),g("tr",{key:V},[r("td",null,k(l.name),1),r("td",null,[(v(!0),g(F,null,N(l.attributes,(n,C)=>(v(),S(ue,{key:C,style:qe({color:n.value.value}),class:"ma-1","text-color":"white"},{default:t(()=>[p(k(n.value.name||"غير محدد"),1)]),_:2},1032,["style"]))),128))]),r("td",null,k(l.stock_quantity),1),r("td",null,k(l.category),1),r("td",null,[e(f,{variant:"text",color:"blue",icon:"ri-edit-line",onClick:n=>Ve(l)},null,8,["onClick"]),e(f,{variant:"text",icon:"ri-delete-bin-line",color:"red",onClick:n=>_e(l.id)},null,8,["onClick"])])]))),128))])):Y("",!0)]),_:1})]),_:1})]),_:1}))}};export{Be as default};
