import{r as d,h as ve,w as K,o as b,k as w,j as t,d as e,U as $,ah as F,b as s,t as U,a1 as B,a2 as h,a6 as ee,au as M,Y as P,a9 as V,p as le,X as j,Z as te,c as z,aL as S,aP as me,V as N,$ as W,P as pe,aI as Ve,ap as Z,M as be,a as E,a4 as G,A as O,a5 as Y,ak as q,a3 as L,F as Q,q as T,aQ as ge,aH as J}from"./index-BkFnaqPs.js";const xe={__name:"AddAttribute",props:{addDialog:Boolean,editAttribute:{type:Object,default:null},attributes:{type:Array,default:()=>[]}},emits:["update:addDialog","update:attributes"],setup(H,{emit:_}){const p=H,C=_,i=d(p.addDialog),g=d(""),D=d(""),r=ve(()=>!!p.editAttribute),n=d(null),x=d(!1);K(()=>p.addDialog,f=>{i.value=f,f&&r.value&&p.editAttribute?g.value=p.editAttribute.name:f&&(g.value=""),D.value=""});const I=[f=>!!f||"اسم الخاصية مطلوب",f=>typeof f=="string"&&f.length<=255||"اسم الخاصية يجب ألا يزيد عن 255 حرفًا",f=>!p.attributes.some(v=>v.name===f&&(!r.value||p.editAttribute&&v.id!==p.editAttribute.id))||"اسم الخاصية موجود بالفعل"],A=f=>{i.value=!1,C("update:addDialog",{dialog:i.value,data:f})};async function R(){var y;if(D.value="",!n.value)return;const{valid:f}=await n.value.validate();if(!f)return;const v={name:g.value};let k;try{const u=((y=p.editAttribute)==null?void 0:y.id)??!1;k=await te("attribute",v,u,!1,!0,!0),C("update:attributes",k),A(null)}catch(u){D.value=(u==null?void 0:u.message)||"حدث خطأ أثناء حفظ الخاصية"}}return(f,v)=>(b(),w(j,{modelValue:i.value,"onUpdate:modelValue":v[3]||(v[3]=k=>i.value=k),"max-width":"500px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,null,{default:t(()=>[s(U(r.value?"تعديل خاصية":"اضافة خاصية جديدة"),1)]),_:1}),e(B,null,{default:t(()=>[e(h,{ref_key:"formRef",ref:n,modelValue:x.value,"onUpdate:modelValue":v[1]||(v[1]=k=>x.value=k)},{default:t(()=>[e(ee,{modelValue:g.value,"onUpdate:modelValue":v[0]||(v[0]=k=>g.value=k),label:"اسم الخاصية",rules:I,required:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(P),e(V,{color:"grey darken-1",text:"",onClick:v[2]||(v[2]=k=>A(null))},{default:t(()=>v[4]||(v[4]=[s("الغاء")])),_:1}),e(V,{color:"blue darken-1",text:"",class:le({"forbidden-cursor":!x.value}),onClick:R},{default:t(()=>[s(U(r.value?"تعديل":"حفظ"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ce={__name:"addAttributeValues",props:{attributes:{type:Array,required:!0},editValue:{type:Object,default:null}},emits:["value-added","value-edited"],setup(H,{expose:_,emit:p}){const C=H,i=p,g=d(!1),D=d(!1),r=d({name:"",color:"",attribute_id:null,id:null}),n=d(""),x=d(!1),I=d(null),A=d(!1);function R(){x.value=!1,g.value=!0,r.value={name:"",color:"",attribute_id:null,id:null},n.value=""}function f(y){x.value=!0,g.value=!0,r.value={...y},n.value=""}_({openEditDialog:f});function v(){g.value=!1,r.value={name:"",color:"",attribute_id:null,id:null},n.value=""}async function k(){n.value="";const{valid:y}=await I.value.validate();if(y){C.attributes&&C.attributes[0]&&C.attributes[0].id&&(r.value.attribute_id=C.attributes[0].id);try{const u=await te("attribute-value",r.value,r.value.id,!0);x.value&&r.value.id?i("value-edited",u):i("value-added",u),v()}catch(u){W.error((u==null?void 0:u.message)||"حدث خطأ أثناء حفظ القيمة")}}}return K(()=>C.editValue,y=>{y&&y.id&&f(y)}),(y,u)=>(b(),z("div",null,[e(V,{class:"ma-1",color:"primary",onClick:R},{default:t(()=>u[7]||(u[7]=[s("اضافة قيمة")])),_:1}),e(j,{modelValue:g.value,"onUpdate:modelValue":u[3]||(u[3]=c=>g.value=c),"max-width":"500px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,null,{default:t(()=>[s(U(x.value?"تعديل قيمة":"اضافة قيمة جديدة"),1)]),_:1}),e(B,null,{default:t(()=>[e(h,{ref_key:"formRef",ref:I,modelValue:A.value,"onUpdate:modelValue":u[2]||(u[2]=c=>A.value=c)},{default:t(()=>[e(ee,{class:"pa-3",modelValue:r.value.name,"onUpdate:modelValue":u[0]||(u[0]=c=>r.value.name=c),label:"اسم القيمة",rules:[c=>!!c||"اسم القيمة مطلوب"],required:""},null,8,["modelValue","rules"]),e(V,{class:"ma-3",style:S({backgroundColor:r.value.color||""}),onClick:u[1]||(u[1]=c=>D.value=!0)},{default:t(()=>u[8]||(u[8]=[s(" اختر اللون ")])),_:1},8,["style"])]),_:1},8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(P),e(V,{color:"blue darken-1",text:"",onClick:v},{default:t(()=>u[9]||(u[9]=[s("الغاء")])),_:1}),e(V,{color:"blue darken-1",class:le({"forbidden-cursor":!A.value}),text:"",onClick:k},{default:t(()=>[s(U(x.value?"تحديث":"حفظ"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:D.value,"onUpdate:modelValue":u[6]||(u[6]=c=>D.value=c),"max-width":"500px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,{style:S({backgroundColor:r.value.color||"",position:"fixed",zIndex:"100",width:"100%"})},{default:t(()=>u[10]||(u[10]=[s(" اختر اللون ")])),_:1},8,["style"]),e(B,{class:"mt-10"},{default:t(()=>[e(me,{modelValue:r.value.color,"onUpdate:modelValue":u[4]||(u[4]=c=>r.value.color=c),"show-swatches":"","hide-inputs":""},null,8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(V,{color:"primary",class:"mx-auto my-2 elevated-5",onClick:u[5]||(u[5]=c=>D.value=!1)},{default:t(()=>[e(N,{class:"mx-3",size:"18"},{default:t(()=>u[11]||(u[11]=[s("ri-check-line")])),_:1}),u[12]||(u[12]=s(" تم "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ke={class:"d-flex flex-wrap gap-2 pa-3"},ye={class:"ma-3 flex-grow-1"},Ce={key:0,class:"ms-8 mt-2 mb-4"},De={class:"d-flex flex-wrap gap-2"},_e={__name:"attributes",setup(H){const _=d(!1),p=d(!1),C=d(null),i=d([]),g=d(null);d(null);const D=d(null),r=d(!1),n=d(null),x=d(!1),I=d(null);d(!1),d({id:null,name:"",color:""}),d(null),d(!1);const A=d(null),R=d(null);function f(o){if(!o||typeof o!="string"||!o.startsWith("#"))return"#000000";const l=o.replace("#","");if(l.length!==6)return"#000000";const a=parseInt(l.substr(0,2),16),m=parseInt(l.substr(2,2),16),X=parseInt(l.substr(4,2),16);return(a*299+m*587+X*114)/1e3<128?"#FFFFFF":"#000000"}const v=o=>{_.value=o.dialog,console.log(o.data)};function k(o){C.value=o,p.value=!0}function y(o){J("attribute",o).then(()=>{u(),p.value=!1}).catch(()=>W.error("حدث خطأ أثناء حذف الخاصية"))}function u(){Z("attributes",null,!0,!0).then(o=>{i.value=o})}const c=()=>{_.value=!0,g.value=null},ae=o=>{g.value={...o},_.value=!0},ue=o=>{const l=i.value.findIndex(a=>a.id===o.id);l!==-1?i.value[l]=o:i.value.push(o)};function oe(o){n.value=o,r.value=!0}function ne(o){n.value&&n.value.values&&n.value.values.push(o)}function se(o){const l=n.value.values.findIndex(m=>m.id===o.id);l!==-1&&(n.value.values[l]=o);const a=i.value.findIndex(m=>m.id===n.value.id);if(a!==-1&&i.value[a].values){const m=i.value[a].values.findIndex(X=>X.id===o.id);m!==-1&&(i.value[a].values[m]=o)}}function de(o){I.value=o,x.value=!0}function ie(){J("attribute-value",I.value).then(()=>{W.success("تم حذف القيمة بنجاح"),re(I.value),x.value=!1}).catch(()=>W.error("حدث خطأ أثناء حذف القيمة"))}function re(o=null){if(o&&n.value&&n.value.values){n.value.values=n.value.values.filter(a=>a.id!==o);const l=i.value.findIndex(a=>a.id===n.value.id);l!==-1&&i.value[l].values&&(i.value[l].values=i.value[l].values.filter(a=>a.id!==o));return}Z(`attribute/${n.value.id}/values`).then(l=>{n.value.values=l.data;const a=i.value.findIndex(m=>m.id===n.value.id);a!==-1&&(i.value[a].values=l.data)})}function fe(o){R.value={...o},A.value&&A.value.openEditDialog(o)}return pe(()=>{u()}),(o,l)=>(b(),w(Ve,null,{default:t(()=>[e(V,{color:"primary",onClick:c},{default:t(()=>l[7]||(l[7]=[s("اضافة خاصية جديدة")])),_:1}),e($,{class:"mt-4 pa-3"},{default:t(()=>[e(F,null,{default:t(()=>l[8]||(l[8]=[s(" الخصائص")])),_:1}),e(be),E("div",ke,[e(G,null,{default:t(()=>[i.value.length?(b(!0),z(Q,{key:0},O(i.value,a=>(b(),w(Y,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[e(q,{class:"d-flex align-center pa-1",onClick:m=>oe(a),style:{minHeight:"35px"}},{default:t(()=>[E("div",ye,U(a.name),1),e(V,{icon:"",size:"x-small",color:"primary",class:"ma-1",style:{"margin-inline-start":"4px"},onClick:L(m=>ae(a),["stop"]),title:"تعديل"},{default:t(()=>[e(N,{size:"18"},{default:t(()=>l[9]||(l[9]=[s("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(V,{icon:"",size:"x-small",color:"error",class:"ma-1",style:{"margin-inline-start":"2px"},onClick:L(m=>k(a.id),["stop"]),title:"حذف"},{default:t(()=>[e(N,{size:"18"},{default:t(()=>l[10]||(l[10]=[s("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["onClick"])]),_:2},1024))),128)):T("",!0)]),_:1}),i.value.length===0?(b(),w(q,{key:0},{default:t(()=>l[11]||(l[11]=[s("لا توجد خصائص حتى الآن")])),_:1})):T("",!0)]),(b(!0),z(Q,null,O(i.value,a=>(b(),z("div",{key:"values-"+a.id},[e(ge,null,{default:t(()=>[D.value===a.id&&a.values&&a.values.length?(b(),z("div",Ce,[e($,{flat:"",class:"pa-2",color:"#f8f8f8"},{default:t(()=>[E("div",De,[(b(!0),z(Q,null,O(a.values,m=>(b(),w(q,{key:m.id,class:"d-flex align-center pa-1",style:S({backgroundColor:m.color||"#e0e0e0"})},{default:t(()=>[E("span",null,U(m.name),1)]),_:2},1032,["style"]))),128)),a.values.length===0?(b(),w(q,{key:0},{default:t(()=>l[12]||(l[12]=[s("لا توجد قيم لهذه الخاصية")])),_:1})):T("",!0)])]),_:2},1024)])):T("",!0)]),_:2},1024)]))),128))]),_:1}),e(xe,{attributes:i.value,addDialog:_.value,editAttribute:g.value,"onUpdate:addDialog":v,"onUpdate:attributes":ue},null,8,["attributes","addDialog","editAttribute"]),e(j,{modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=a=>p.value=a),"max-width":"400px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,null,{default:t(()=>l[13]||(l[13]=[s("تأكيد الحذف")])),_:1}),e(B,null,{default:t(()=>l[14]||(l[14]=[s("هل أنت متأكد من حذف هذه الخاصية؟")])),_:1}),e(M,null,{default:t(()=>[e(P),e(V,{color:"grey darken-1",text:"",onClick:l[0]||(l[0]=a=>p.value=!1)},{default:t(()=>l[15]||(l[15]=[s("الغاء")])),_:1}),e(V,{color:"red darken-1",text:"",onClick:l[1]||(l[1]=a=>y(C.value))},{default:t(()=>l[16]||(l[16]=[s("حذف")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:r.value,"onUpdate:modelValue":l[4]||(l[4]=a=>r.value=a),"max-width":"600px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,{class:"d-flex align-center justify-space-between"},{default:t(()=>{var a;return[E("span",null,"قيم الخاصية : "+U((a=n.value)==null?void 0:a.name),1),n.value?(b(),w(ce,{key:0,attributes:[n.value],"edit-value":R.value,onValueAdded:ne,onValueEdited:se,ref_key:"addEditValueRef",ref:A},null,8,["attributes","edit-value"])):T("",!0)]}),_:1}),e(B,{class:"my-2"},{default:t(()=>[e(G,null,{default:t(()=>[(b(!0),z(Q,null,O(n.value.values,a=>(b(),w(Y,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[E("div",{class:"w-100 elevation-6 box-attribute-values",style:S({backgroundColor:a.color||"#e0e0e0",minHeight:"33px",color:f(a.color)})},[E("div",{style:S({backgroundColor:a.color||"#e0e0e0",color:f(a.color)}),class:"ma-3 flex-grow-1"},U(a.name),5),e(V,{class:"ma-2",icon:"",size:"x-small",color:"primary",style:{"margin-inline-start":"4px"},onClick:L(m=>fe(a),["stop"]),title:"تعديل القيمة"},{default:t(()=>[e(N,{size:"16"},{default:t(()=>l[17]||(l[17]=[s("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(V,{class:"ma-2",icon:"",size:"x-small",color:"error",style:{"margin-inline-start":"2px"},onClick:L(m=>de(a.id),["stop"]),title:"حذف القيمة"},{default:t(()=>[e(N,{size:"16"},{default:t(()=>l[18]||(l[18]=[s("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])],4)]),_:2},1024))),128)),!n.value.values||n.value.values.length===0?(b(),w(Y,{key:0,cols:"12"},{default:t(()=>[e(q,null,{default:t(()=>l[19]||(l[19]=[s("لا توجد قيم لهذه الخاصية")])),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(P),e(V,{color:"blue darken-1",text:"",onClick:l[3]||(l[3]=a=>r.value=!1)},{default:t(()=>l[20]||(l[20]=[s("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:x.value,"onUpdate:modelValue":l[6]||(l[6]=a=>x.value=a),"max-width":"350px"},{default:t(()=>[e($,null,{default:t(()=>[e(F,null,{default:t(()=>l[21]||(l[21]=[s("تأكيد حذف القيمة")])),_:1}),e(B,null,{default:t(()=>l[22]||(l[22]=[s("هل أنت متأكد من حذف هذه القيمة؟")])),_:1}),e(M,null,{default:t(()=>[e(P),e(V,{color:"grey darken-1",text:"",onClick:l[5]||(l[5]=a=>x.value=!1)},{default:t(()=>l[23]||(l[23]=[s("إلغاء")])),_:1}),e(V,{color:"red darken-1",text:"",onClick:ie},{default:t(()=>l[24]||(l[24]=[s("حذف")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{_e as default};
