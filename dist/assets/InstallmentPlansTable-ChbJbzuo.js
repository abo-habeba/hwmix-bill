import{_ as U,r as f,j as k,Q as q,c as _,d as l,k as a,ak as A,Y as z,F as I,aq as G,o as c,aa as v,a4 as b,b as n,a as o,aL as R,t as r,bq as j,B as Q,l as C,al as B,s as V,a5 as x,a6 as d,W,ai as Y,a2 as Z,av as J,Z as K}from"./index-BflbBIH_.js";import{_ as O}from"./PayInstallmentDialog-KYoV6w64.js";const X={class:"progress-bar-container"},h={key:0,class:"text-grey-darken-1"},tt={__name:"InstallmentPlansTable",setup(et){const T=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],E=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status"},{title:"الإجراءات",key:"actions",sortable:!1}],w=f([]),m=f([]),u=f({}),p=f(!1),D=f(null),y=f(!1),F=f(!0);function g(s){const t=parseFloat(s.total_installments_pay)||0,e=parseFloat(s.total_installments_amount)||1;return Math.min(Math.round(t/e*100),100)}function S(s){const t=g(s);return t===100?"#4CAF50":t>=50?"#2196F3":t>=20?"#FFC107":"#F44336"}const $=k(()=>u.value.start_date?new Date(u.value.start_date).toLocaleDateString("ar-EG"):"—");function M({item:s}){const t=parseFloat(s.remaining)||0,e=new Date(s.due_date),i=new Date;return e.setHours(0,0,0,0),i.setHours(0,0,0,0),s.status==="تم الدفع"?{style:{backgroundColor:"#A5D6A7"}}:t>0&&e<i?{style:{backgroundColor:"#EF9A9A"}}:t>0?{style:{backgroundColor:"#FFE082"}}:{}}k(()=>m.value.reduce((s,t)=>s+(t.remaining||0),0)),k(()=>m.value.reduce((s,t)=>s+(t.amount-(t.remaining||0)),0));function N(){G("installment-plans",{per_page:-1},!0,!0,!1).then(s=>{w.value=s||[]})}function H(s){s.forEach(t=>{const e=m.value.findIndex(i=>i.id===t.id);e!==-1&&(m.value[e]={...m.value[e],...t})})}function L(s){!s||!Array.isArray(s.installments)||(u.value=s,m.value=s.installments,p.value=!0)}function P(s,t){D.value=s,F.value=t,y.value=!0}return q(N),(s,t)=>(c(),_(I,null,[l(A,{headers:T,items:w.value,"item-value":"id",class:"elevation-1",density:"compact","hide-default-footer":""},{"item.actions":a(({item:e})=>[l(v,{color:"primary",density:"compact",onClick:b(i=>L(e),["stop"])},{default:a(()=>t[3]||(t[3]=[n("عرض الأقساط")])),_:2},1032,["onClick"])]),"item.paid_percentage":a(({item:e})=>[o("div",X,[o("div",{class:"progress-bar-fill",style:R({width:g(e)+"%",backgroundColor:S(e)})},r(g(e))+"% ",5)])]),"item.plan_products":a(({item:e})=>[l(j,{column:""},{default:a(()=>[o("div",null,[(c(!0),_(I,null,Q(e.invoice_items,i=>(c(),C(B,{key:i.id,size:"small",color:"info",variant:"outlined"},{default:a(()=>[n(r(i.name),1)]),_:2},1024))),128))]),!e.invoice_items||e.invoice_items.length===0?(c(),_("span",h,"لا توجد منتجات")):V("",!0)]),_:2},1024)]),"no-data":a(()=>[l(x,{class:"pa-4"},{default:a(()=>[l(d,{class:"text-center text-grey"},{default:a(()=>t[4]||(t[4]=[n("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items"]),l(z,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),"max-width":"900px",scrollable:""},{default:a(()=>[l(W,null,{default:a(()=>[l(Y,{class:"bg-primary text-white"},{default:a(()=>t[5]||(t[5]=[n("تفاصيل خطة التقسيط")])),_:1}),l(Z,null,{default:a(()=>[l(x,{class:"px-4 pt-4",dense:""},{default:a(()=>[l(d,{cols:"6"},{default:a(()=>{var e;return[t[6]||(t[6]=o("strong",null,"المستخدم:",-1)),n(" "+r(((e=u.value.user)==null?void 0:e.nickname)||"غير متوفر"),1)]}),_:1}),l(d,{cols:"6"},{default:a(()=>{var e;return[t[7]||(t[7]=o("strong",null,"الفاتورة:",-1)),n(" "+r(((e=u.value.invoice)==null?void 0:e.invoice_number)||"—"),1)]}),_:1}),l(d,{cols:"6"},{default:a(()=>[t[8]||(t[8]=o("strong",null,"تاريخ البدء:",-1)),n(" "+r($.value),1)]),_:1}),l(d,{cols:"6"},{default:a(()=>[t[9]||(t[9]=o("strong",null,"إجمالي الفاتورة:",-1)),n(" "+r(u.value.total_amount),1)]),_:1}),l(d,{cols:"6"},{default:a(()=>[t[10]||(t[10]=o("strong",null,"إجمالي المتبقي:",-1)),n(" "+r(u.value.total_installments_remaining),1)]),_:1}),l(d,{cols:"6"},{default:a(()=>[t[11]||(t[11]=o("strong",null,"إجمالي المدفوع:",-1)),n(" "+r(u.value.total_pay),1)]),_:1}),l(d,{cols:"6"},{default:a(()=>[t[12]||(t[12]=o("strong",null,"المقدم:",-1)),n(" "+r(u.value.down_payment),1)]),_:1}),l(d,{cols:"6"},{default:a(()=>{var e;return[t[13]||(t[13]=o("strong",null,"عدد الأقساط:",-1)),n(" "+r(((e=u.value.installments)==null?void 0:e.length)||0),1)]}),_:1})]),_:1}),l(A,{"row-props":M,headers:E,items:m.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":a(({item:e})=>[l(B,{color:e.status==="تم الدفع"?"success":"error",dark:""},{default:a(()=>[n(r(e.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[e.status!=="تم الدفع"?(c(),C(v,{key:0,color:e.status==="تم الدفع"?"grey":"success",disabled:e.status==="تم الدفع",density:"compact",class:"me-1",onClick:b(i=>P(e,!0),["stop"])},{default:a(()=>t[14]||(t[14]=[n("دفع القسط")])),_:2},1032,["color","disabled","onClick"])):V("",!0),e.status!=="تم الدفع"?(c(),C(v,{key:1,color:e.status==="تم الدفع"?"grey":"warning",disabled:e.status==="تم الدفع",density:"compact",onClick:b(i=>P(e,!1),["stop"])},{default:a(()=>t[15]||(t[15]=[n("مبلغ مختلف")])),_:2},1032,["color","disabled","onClick"])):V("",!0)]),"no-data":a(()=>[l(x,{class:"pa-4"},{default:a(()=>[l(d,{class:"text-center text-grey"},{default:a(()=>t[16]||(t[16]=[n("لا توجد أقساط لهذه الخطة")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),l(J,null,{default:a(()=>[l(K),l(v,{text:"",onClick:t[0]||(t[0]=e=>p.value=!1)},{default:a(()=>t[17]||(t[17]=[n("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(O,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e),installment:D.value,"direct-pay":F.value,"onUpdate:installment":H},null,8,["modelValue","installment","direct-pay"])],64))}},st=U(tt,[["__scopeId","data-v-012a1a47"]]);export{st as default};
