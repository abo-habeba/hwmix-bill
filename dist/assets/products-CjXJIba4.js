import{_ as B,o as S,k as N,j as l,a as g,d as e,aH as se,a4 as F,a5 as c,a6 as q,aw as j,aG as Ve,c as R,b as U,aI as ce,F as T,A as Q,aJ as de,H as ge,m as _e,a9 as h,q as xe,U as M,R as he,r as k,w as Z,ag as we,z as Oe,P as ke,aj as J,ap as G,t as $,a1 as re,a2 as Se,aK as qe,M as Ue,aq as me,X,Z as fe,h as Ae,a7 as Pe,aA as pe,a3 as K,p as ve,V as ne,aF as $e,$ as be,aL as Ee,T as Fe}from"./index-B62nS35K.js";import{_ as Ne}from"./AttributesDisplay-DemQZF5I.js";import{P as ye}from"./ProductSticker-CecqEI9Q.js";const De={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},je={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue"],setup(o,{emit:P}){return(_,i)=>(S(),N(Ve,null,{default:l(()=>[g("div",De,[g("div",null,[e(se,{modelValue:o.modelValue.active,"onUpdate:modelValue":i[0]||(i[0]=s=>o.modelValue.active=s),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:o.modelValue.featured,"onUpdate:modelValue":i[1]||(i[1]=s=>o.modelValue.featured=s),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),g("div",null,[e(se,{modelValue:o.modelValue.returnable,"onUpdate:modelValue":i[2]||(i[2]=s=>o.modelValue.returnable=s),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(F,{dense:""},{default:l(()=>[e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:o.modelValue.name,"onUpdate:modelValue":i[3]||(i[3]=s=>o.modelValue.name=s),label:"اسم المنتج",rules:o.productRules.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:l(()=>[e(j,{modelValue:o.modelValue.category_id,"onUpdate:modelValue":i[4]||(i[4]=s=>o.modelValue.category_id=s),items:o.categories,"item-value":"id","item-title":"name",label:"التصنيف",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:l(()=>[e(j,{modelValue:o.modelValue.brand_id,"onUpdate:modelValue":i[5]||(i[5]=s=>o.modelValue.brand_id=s),items:o.brands,"item-value":"id","item-title":"name",label:"العلامة التجارية",required:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:o.modelValue.desc,"onUpdate:modelValue":i[6]||(i[6]=s=>o.modelValue.desc=s),label:"الوصف",rules:o.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"12"},{default:l(()=>[e(q,{modelValue:o.modelValue.desc_long,"onUpdate:modelValue":i[7]||(i[7]=s=>o.modelValue.desc_long=s),label:"الوصف المفصل",rules:o.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},Ie=B(je,[["__scopeId","data-v-c923be84"]]),ze={__name:"ProductVariantAttributesForm",props:{modelValue:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:P}){const _=o,i=P;function s(m){const y=_.attributes.find(n=>n.id===m);return(y==null?void 0:y.values)||[]}function f(m,y){const n=[..._.modelValue];n[m]={attribute_id:y,attribute_value_id:null},i("update:modelValue",n)}function A(){const m=[..._.modelValue,{attribute_id:null,attribute_value_id:null}];i("update:modelValue",m)}function C(m){const y=[..._.modelValue];y.splice(m,1),i("update:modelValue",y)}function b(m){if(!m)return"#000";const y=m.substring(1),n=parseInt(y,16),r=n>>16&255,d=n>>8&255,x=n&255;return .299*r+.587*d+.114*x>186?"#000":"#fff"}function E(m,y){const n=s(m).find(r=>r.id===y);return n!=null&&n.color?`background:${n.color};color:${b(n.color)};border-radius:6px;padding-inline:6px;`:""}return(m,y)=>(S(),R(T,null,[e(ce,{class:"ma-2"},{default:l(()=>y[0]||(y[0]=[U("الخصائص (Attributes)")])),_:1}),(S(!0),R(T,null,Q(o.modelValue,(n,r)=>(S(),N(F,{dense:"",key:r,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5"},{default:l(()=>[e(j,{modelValue:n.attribute_id,"onUpdate:modelValue":[d=>n.attribute_id=d,d=>f(r,d)],items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(c,{cols:"5"},{default:l(()=>[e(j,{modelValue:n.attribute_value_id,"onUpdate:modelValue":d=>n.attribute_value_id=d,items:s(n.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"","hide-details":"auto",disabled:!n.attribute_id,style:de(E(n.attribute_id,n.attribute_value_id))},{item:l(({props:d,item:x})=>[e(ge,_e({ref_for:!0},d,{style:x.raw.color?`background:${x.raw.color};`:""}),null,16,["style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2",class:"text-end"},{default:l(()=>[e(h,{icon:"ri-delete-bin-line",color:"error",size:"x-small",variant:"text",onClick:d=>C(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-2",text:"",color:"primary",density:"comfortable",onClick:A},{default:l(()=>y[1]||(y[1]=[U(" + إضافة خاصية ")])),_:1})],64))}},Me=B(ze,[["__scopeId","data-v-da98878c"]]),Re={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(o,{emit:P}){const _=o,i=P,s=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function f(A){if(_.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const C=[..._.modelValue];C.splice(A,1),i("update:modelValue",C)}return(A,C)=>(S(),R(T,null,[e(ce,{class:"ma-2"},{default:l(()=>C[1]||(C[1]=[U("المخزون")])),_:1}),(S(!0),R(T,null,Q(o.modelValue,(b,E)=>(S(),N(F,{dense:"",key:b.id||E},{default:l(()=>[e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.cost,"onUpdate:modelValue":m=>b.cost=m,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:o.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.quantity,"onUpdate:modelValue":m=>b.quantity=m,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:o.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[o.warehouses&&o.warehouses.length>0?(S(),N(j,{key:0,modelValue:b.warehouse_id,"onUpdate:modelValue":m=>b.warehouse_id=m,"item-value":"id","item-title":"name",items:o.warehouses,label:"المخزن",rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(S(),N(j,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[m=>!!m||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(j,{modelValue:b.status,"onUpdate:modelValue":m=>b.status=m,items:s,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[m=>!!m||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.expiry,"onUpdate:modelValue":m=>b.expiry=m,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{cols:"6",sm:"6",md:"4",lg:"2"},{default:l(()=>[e(q,{modelValue:b.loc,"onUpdate:modelValue":m=>b.loc=m,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),o.modelValue.length>1?(S(),N(h,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:C[0]||(C[0]=b=>f(A.sIndex))})):xe("",!0)],64))}},Be=B(Re,[["__scopeId","data-v-382b902c"]]),Je={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(o,{emit:P}){return(_,i)=>(S(),N(F,null,{default:l(()=>[e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:o.variant.retail_price,"onUpdate:modelValue":i[0]||(i[0]=s=>o.variant.retail_price=s),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:o.variant.wholesale_price,"onUpdate:modelValue":i[1]||(i[1]=s=>o.variant.wholesale_price=s),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(j,{modelValue:o.variant.status,"onUpdate:modelValue":i[2]||(i[2]=s=>o.variant.status=s),items:o.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6",class:"my-0 py-1"},{default:l(()=>[e(q,{modelValue:o.variant.min_quantity,"onUpdate:modelValue":i[3]||(i[3]=s=>o.variant.min_quantity=s),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(M,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Me,{modelValue:o.variant.attributes,"onUpdate:modelValue":i[4]||(i[4]=s=>o.variant.attributes=s),attributes:o.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-0 py-1"},{default:l(()=>[e(M,{class:"mb-1 pa-2",outlined:""},{default:l(()=>[e(Be,{modelValue:o.variant.stocks,"onUpdate:modelValue":i[5]||(i[5]=s=>o.variant.stocks=s),warehouses:o.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(c,{cols:"12",class:"my-2 py-1"},{default:l(()=>[e(h,{color:"error",onClick:i[6]||(i[6]=s=>_.$emit("remove-variant",o.variantIndex))},{default:l(()=>i[7]||(i[7]=[U("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Te=B(Je,[["__scopeId","data-v-d71e48c9"]]),He={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(o,{emit:P}){const _=o,i=P;he();const s=k(_.dialog),f=k(null),A=k(!1),C=k([]),b=k([]),E=k([]),m=k([]),y=t=>typeof t=="number"&&!isNaN(t)||"يجب أن يكون رقمًا",n=t=>parseFloat(t)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا",r=t=>typeof t=="number"&&!isNaN(t)&&t!==null||"مطلوب ويجب أن يكون رقمًا",d={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},x=k(JSON.parse(JSON.stringify(d)));function w(t){return{id:t.id,name:t.name||"",active:t.active??!0,featured:t.featured??!1,returnable:t.returnable??!0,desc:t.desc||"",desc_long:t.desc_long||"",category_id:t.category_id||null,brand_id:t.brand_id||null,variants:(t.variants||[]).map(u=>({id:u.id,barcode:u.barcode||"",sku:u.sku||"",retail_price:parseFloat(u.retail_price)||0,wholesale_price:parseFloat(u.wholesale_price)||0,image:u.image||null,weight:parseFloat(u.weight)||0,dimensions:u.dimensions||"",min_quantity:u.min_quantity||"",tax:parseFloat(u.tax)||0,discount:parseFloat(u.discount)||0,status:u.status||"active",attributes:(u.attributes||[]).map(V=>({attribute_id:V.attribute_id||null,attribute_value_id:V.attribute_value_id||null})),stocks:(u.stocks||[]).map(V=>({id:V.id,quantity:V.quantity||0,reserved:V.reserved||0,min_quantity:V.min_quantity||0,cost:parseFloat(V.cost)||0,batch:V.batch||"",expiry:V.expiry?new Date(V.expiry).toISOString().substr(0,10):null,loc:V.loc||"",status:V.status??"available",warehouse_id:V.warehouse?V.warehouse.id:null}))}))}}const D={name:[t=>!!t||"اسم المنتج مطلوب",t=>typeof t=="string"&&t.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[t=>!t||typeof t=="string"||"الوصف يجب أن يكون نصًا"],description_long:[t=>!t||typeof t=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[r,n],wholesale_price:[r,n],tax:[y,n],discount:[y,n],weight:[y,n],quantity:[r,n],cost:[y,n]};function H(){var t,u;(t=x.value)!=null&&t.variants&&x.value.variants&&(u=x.value.variants[0])!=null&&u.stocks&&b.value&&x.value.variants[0].stocks[0].warehouse_id===null&&(x.value.variants[0].stocks[0].warehouse_id=b.value[0].id)}Z(()=>_.dialog,async t=>{s.value=t,t&&(_.isEditMode&&_.product?x.value=w(_.product):(x.value=JSON.parse(JSON.stringify(d)),H()),await we(),f.value&&f.value.resetValidation())},{immediate:!0}),Z(s,t=>{i("update:dialog",t)}),Z(()=>_.product,t=>{_.isEditMode&&t&&(x.value=w(t))});const I=Oe();ke(async()=>{I.loadingApi=!0;try{await Promise.all([Y(),ee(),le(),te()]),console.log("All initial data fetched successfully!")}catch(t){console.error("An error occurred during data fetching:",t)}finally{I.loadingApi=!1,_.isEditMode||H()}});async function Y(){try{const t=await J("brands",null,!0,!1);C.value=t.data}catch(t){console.error("Error fetching brands:",t)}}async function ee(){try{const t=await J("attributes",null,!0,!1);m.value=t.data}catch(t){console.error("Error fetching attributes:",t)}}async function le(){try{const t=await J("warehouses",null,!0,!1);b.value=t.data}catch(t){console.error("Error fetching warehouses:",t)}}async function te(){try{const t=await J("categories",null,!0,!1);E.value=t.data}catch(t){console.error("Error fetching categories:",t)}}function ae(){x.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:b.value.length>0?b.value[0].id:null}]})}function ue(t){x.value.variants.splice(t,1)}async function oe(){if(!f.value)return;const{valid:t}=await f.value.validate();if(t)try{const u=JSON.parse(JSON.stringify(x.value));Object.prototype.hasOwnProperty.call(u,"active")||Object.prototype.hasOwnProperty.call(u,"is_active")&&(u.active=u.is_active,delete u.is_active),Object.prototype.hasOwnProperty.call(u,"returnable")||Object.prototype.hasOwnProperty.call(u,"is_returnable")&&(u.returnable=u.is_returnable,delete u.is_returnable),Object.prototype.hasOwnProperty.call(u,"desc")||Object.prototype.hasOwnProperty.call(u,"description")&&(u.desc=u.description,delete u.description),Object.prototype.hasOwnProperty.call(u,"desc_long")||Object.prototype.hasOwnProperty.call(u,"description_long")&&(u.desc_long=u.description_long,delete u.desc_long),u.variants.forEach(v=>{v.stocks&&v.stocks.length>0&&v.stocks.forEach(a=>{!a.warehouse_id&&b.value.length>0&&(a.warehouse_id=b.value[0].id)})});let V;if(u.id)V=await fe("product",u,u.id);else{const{id:v,...a}=u;V=await fe("product",a)}i("saved",V),L()}catch(u){console.error("Error saving product:",u)}}const ie=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function L(){s.value=!1,i("close")}return(t,u)=>(S(),N(X,{modelValue:s.value,"onUpdate:modelValue":u[2]||(u[2]=V=>s.value=V),"max-width":"900px",persistent:""},{default:l(()=>[e(M,null,{default:l(()=>[e(h,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:L}),e(G,{class:"ma-3 text-center"},{default:l(()=>[g("h2",null,$(o.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(re,{class:"pa-0"},{default:l(()=>[e(Se,{ref_key:"productForm",ref:f,modelValue:A.value,"onUpdate:modelValue":u[1]||(u[1]=V=>A.value=V)},{default:l(()=>[e(Ie,{modelValue:x.value,categories:E.value,brands:C.value,productRules:D,"onUpdate:modelValue":u[0]||(u[0]=V=>x.value=V)},null,8,["modelValue","categories","brands"]),e(M,{class:"pa-2 ma-1",outlined:""},{default:l(()=>[e(G,{class:"ma-2"},{default:l(()=>u[3]||(u[3]=[U(" خيارات المنتج ")])),_:1}),(S(!0),R(T,null,Q(x.value.variants,(V,v)=>(S(),N(F,{class:"bg-grey-lighten-1 pa-2",key:v},{default:l(()=>[e(Te,{variant:V,variantIndex:v,attributes:m.value,warehouses:b.value,statusOptions:ie,productRules:D,onRemoveVariant:ue},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(F,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(h,{class:"ma-3",color:"primary",onClick:ae},{default:l(()=>u[4]||(u[4]=[U("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(qe,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:l(()=>[e(Ue,{class:"my-2"}),e(me,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:l(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!A.value,onClick:oe,class:"text-capitalize"},{default:l(()=>[U($(o.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(h,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:L,class:"text-capitalize"},{default:l(()=>u[5]||(u[5]=[U(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Le=B(He,[["__scopeId","data-v-3747ad60"]]),Ke={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(o,{emit:P}){const _=o,i=P,s=Ae({get:()=>_.modelValue,set:n=>i("update:modelValue",n)}),f=k({});Z(()=>_.variant,n=>{f.value=JSON.parse(JSON.stringify(n||{}))},{immediate:!0});function A(n){if(!n)return[];const r=_.attributes.find(d=>d.id===n);return r?r.values:[]}function C(n){if(!n)return"#000";const r=n.substring(1),d=parseInt(r,16),x=d>>16&255,w=d>>8&255,D=d>>0&255;return .299*x+.587*w+.114*D>186?"#000":"#fff"}function b(){f.value.attributes=f.value.attributes||[],f.value.attributes.push({attribute_id:null,attribute_value_id:null})}function E(n){f.value.attributes.splice(n,1)}function m(){i("update:modelValue",!1)}function y(){i("save",JSON.parse(JSON.stringify(f.value))),m()}return(n,r)=>(S(),N(X,{modelValue:s.value,"onUpdate:modelValue":r[7]||(r[7]=d=>s.value=d),"max-width":"600",persistent:""},{default:l(()=>[e(M,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(G,null,{default:l(()=>r[8]||(r[8]=[U("تعديل متغير المنتج")])),_:1}),e(F,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(c,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.purchase_price,"onUpdate:modelValue":r[0]||(r[0]=d=>f.value.purchase_price=d),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.retail_price,"onUpdate:modelValue":r[1]||(r[1]=d=>f.value.retail_price=d),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(q,{modelValue:f.value.wholesale_price,"onUpdate:modelValue":r[2]||(r[2]=d=>f.value.wholesale_price=d),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.tax_rate,"onUpdate:modelValue":r[3]||(r[3]=d=>f.value.tax_rate=d),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.discount,"onUpdate:modelValue":r[4]||(r[4]=d=>f.value.discount=d),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{class:"py-0",cols:"12"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.expiry_date,"onUpdate:modelValue":r[5]||(r[5]=d=>f.value.expiry_date=d),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(q,{modelValue:f.value.image_url,"onUpdate:modelValue":r[6]||(r[6]=d=>f.value.image_url=d),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",class:"mt-4"},{default:l(()=>[e(ce,null,{default:l(()=>r[9]||(r[9]=[U("الخصائص (Attributes)")])),_:1}),(S(!0),R(T,null,Q(f.value.attributes,(d,x)=>(S(),N(F,{dense:"",key:x,class:"d-flex align-center"},{default:l(()=>[e(c,{cols:"5"},{default:l(()=>[e(j,{modelValue:d.attribute_id,"onUpdate:modelValue":w=>d.attribute_id=w,items:o.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>d.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(c,{cols:"5"},{default:l(()=>[e(j,{modelValue:d.attribute_value_id,"onUpdate:modelValue":w=>d.attribute_value_id=w,items:A(d.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!d.attribute_id,":return-object":!1,"hide-details":"auto",style:de((()=>{const w=A(d.attribute_id).find(D=>D.id===d.attribute_value_id);return w&&w.color?`background:${w.color};color:${C(w.color)};border-radius:6px;`:""})())},{item:l(({item:w,props:D})=>[e(ge,_e({ref_for:!0},D,{style:w.raw.color?`background:${w.raw.color};color:${C(w.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:w})=>[g("span",{style:de(w.raw.color?`background:${w.raw.color};color:${C(w.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},$(w.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(c,{cols:"2"},{default:l(()=>[e(h,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:w=>E(x)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(h,{class:"my-2",text:"",color:"primary",small:"",onClick:b},{default:l(()=>r[10]||(r[10]=[U("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(Ue,{class:"my-4"}),e(F,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[e(h,{"prepend-icon":"ri-close-line",color:"error",onClick:m},{default:l(()=>r[11]||(r[11]=[U(" إلغاء ")])),_:1})]),_:1}),e(c,{cols:"6",class:"text-center"},{default:l(()=>[e(h,{"prepend-icon":"ri-save-line",color:"success",onClick:y},{default:l(()=>r[12]||(r[12]=[U(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ge=B(Ke,[["__scopeId","data-v-2f5b889d"]]),We={class:"d-flex align-center justify-space-between mb-2"},Ze={class:"d-flex align-center gap-2"},Xe=["onClick"],Qe={key:0},Ye={colspan:"5",class:"pa-0"},el={id:"mobile-sticker-print"},ll={__name:"products",setup(o){const P=k(!1),_=k({}),i=k(!1),s=k([]),f=k(!1),A=k(null),C=k(null),b=k(0),E=k(!1),m=k({page:1,itemsPerPage:10,sortBy:[]}),y=k(""),n=k(!1),r=k(null),d=k([]),x=k(null),w=[{title:"الاسم",key:"name"},{title:"اجمالي الكمية",key:"total_available_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],D=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];ke(()=>{H()});function H(){J("attributes",null,!0,!1).then(v=>{d.value=v.data})}function I(){E.value=!0;const{page:v,itemsPerPage:a,sortBy:p}=m.value,z=p.length?p[0].key:"id",W=p.length&&p[0].order?p[0].order:"desc";J("products",{page:v,per_page:a,sort_by:z,sort_order:W,search:y.value}).then(O=>{s.value=O.data,b.value=O.total}).finally(()=>{E.value=!1})}function Y(){i.value=!1,_.value={},P.value=!0}function ee(v){P.value=!0,i.value=!0,_.value=JSON.parse(JSON.stringify(v))}function le(v){const a=s.value.findIndex(p=>p.id===v.id);a!==-1?s.value[a]=v:s.value.push(v),P.value=!1}function te(v){A.value=v,f.value=!0}function ae(){A.value&&$e("product/delete",A.value.id).then(()=>{I(),be.success("تم حذف المنتج بنجاح"),f.value=!1,A.value=null}).catch(()=>be.error("حدث خطأ أثناء حذف المنتج"))}function ue(v){C.value=C.value===v?null:v}function oe(v,a){r.value=JSON.parse(JSON.stringify(v)),r.value.product_id=a,console.log("openVariantEditDialog",r.value),console.log("attributes",d.value),n.value=!0}function ie(v){const a=s.value.find(z=>z.id===(v.product_id||C.value));if(!a)return;const p=a.variants.findIndex(z=>z.id===v.id);p!==-1&&(a.variants[p]=v),n.value=!1}function L(){return/android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(navigator.userAgent)}const t=k(!1);function u(v){if(L())x.value=v,t.value=!0;else{const a=document.createElement("div");document.body.appendChild(a);const p=Ee({render(){return Fe(ye,{product:v,ref:"stickerRef"})},mounted(){we(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{p.unmount(),document.body.removeChild(a)},5e3)})}});p.mount(a)}}function V(){const v=document.body.innerHTML,a=document.getElementById("mobile-sticker-print").outerHTML;document.body.innerHTML=a,window.print(),document.body.innerHTML=v,t.value=!1}return(v,a)=>(S(),N(Ve,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(Le,{dialog:P.value,"onUpdate:dialog":a[0]||(a[0]=p=>P.value=p),product:_.value,isEditMode:i.value,onSaved:le},null,8,["dialog","product","isEditMode"]),e(Ge,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=p=>n.value=p),variant:r.value,attributes:d.value,onSave:ie},null,8,["modelValue","variant","attributes"]),e(M,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[g("div",We,[a[10]||(a[10]=g("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(h,{color:"primary",onClick:Y,size:"small"},{default:l(()=>a[9]||(a[9]=[U("+ إضافة منتج")])),_:1}),g("div",Ze,[e(q,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=p=>y.value=p),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Pe(I,["enter"]),onBlur:I,clearable:"","onClick:clear":a[3]||(a[3]=()=>{y.value="",I()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":I},null,8,["modelValue"])])]),e(pe,{items:s.value,headers:w,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:E.value,options:m.value,"server-items-length":b.value,"items-per-page":m.value.itemsPerPage,page:m.value.page,"sort-by":m.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":I},{item:l(({item:p})=>{var z,W;return[g("tr",{class:ve({"bg-product-expanded":C.value===p.id}),onClick:O=>ue(p.id),style:{cursor:"pointer"}},[g("td",null,$(p.name),1),g("td",null,$(p.total_available_quantity),1),g("td",null,$(((z=p.category)==null?void 0:z.name)??"-"),1),g("td",null,$(((W=p.brand)==null?void 0:W.name)??"-"),1),g("td",{onClick:a[4]||(a[4]=K(()=>{},["stop"]))},[e(h,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:K(O=>ee(p),["stop"])},null,8,["onClick"]),e(h,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:K(O=>te(p),["stop"])},null,8,["onClick"])])],10,Xe),C.value===p.id?(S(),R("tr",Qe,[g("td",Ye,[e(pe,{items:p.variants,headers:D,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:O})=>[g("tr",{class:ve(O.quantity<=O.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[g("td",null,$(O.sku),1),g("td",null,$(O.barcode),1),g("td",null,$(O.quantity),1),g("td",null,$(O.min_quantity),1),g("td",null,$(O.cost),1),g("td",null,$(O.wholesale_price),1),g("td",null,$(O.retail_price),1),g("td",null,$(O.discount),1),g("td",null,[a[11]||(a[11]=U("= ")),e(Ne,{attributes:O.attributes,"font-size":"10px"},null,8,["attributes"])]),g("td",null,[g("div",null,[e(h,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:K(Ce=>oe(O,p.id),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>a[12]||(a[12]=[U("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(h,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>a[13]||(a[13]=[U("ri-delete-bin-line")])),_:1})]),_:1}),e(h,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:K(Ce=>u(O),["stop"])},{default:l(()=>[e(ne,{size:"16"},{default:l(()=>a[14]||(a[14]=[U("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):xe("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(X,{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=p=>f.value=p),"max-width":"340",persistent:""},{default:l(()=>[e(M,null,{default:l(()=>[e(G,null,{default:l(()=>a[15]||(a[15]=[U("تأكيد الحذف")])),_:1}),e(re,null,{default:l(()=>a[16]||(a[16]=[U("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(me,null,{default:l(()=>[e(h,{color:"error",onClick:ae,size:"small"},{default:l(()=>a[17]||(a[17]=[U("تأكيد")])),_:1}),e(h,{onClick:a[5]||(a[5]=p=>f.value=!1),size:"small"},{default:l(()=>a[18]||(a[18]=[U("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:t.value,"onUpdate:modelValue":a[8]||(a[8]=p=>t.value=p),"max-width":"350",persistent:""},{default:l(()=>[e(M,null,{default:l(()=>[e(G,{class:"text-center"},{default:l(()=>a[19]||(a[19]=[U("معاينة استيكر المنتج")])),_:1}),e(re,null,{default:l(()=>[g("div",el,[e(ye,{product:x.value,ref:"mobileStickerRef"},null,8,["product"])])]),_:1}),e(me,{class:"justify-center"},{default:l(()=>[e(h,{color:"primary",onClick:V},{default:l(()=>a[20]||(a[20]=[U("طباعة")])),_:1}),e(h,{color:"grey",onClick:a[7]||(a[7]=p=>t.value=!1)},{default:l(()=>a[21]||(a[21]=[U("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ol=B(ll,[["__scopeId","data-v-366d0d81"]]);export{ol as default};
