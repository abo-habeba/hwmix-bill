import{r as V,w as ee,o as U,k as O,j as t,d as e,H as G,q as pe,aH as ke,aj as B,_ as j,h as we,V as Y,a7 as _e,a3 as J,Z as re,ag as W,a as k,aI as de,a4 as F,a5 as b,a6 as P,aG as Ce,c as L,b as _,aJ as ve,F as H,A as le,aw as I,aK as me,m as Ue,a9 as C,U as R,R as $e,z as Pe,P as Se,ap as X,t as q,a1 as ce,a2 as qe,aL as Oe,M as he,aq as fe,X as te,aA as be,p as ye,aF as Te,$ as Ve,aM as Fe,T as ze}from"./index-BGcZs_2M.js";import{_ as De}from"./AttributesDisplay-QkRcmJTD.js";import{P as ge}from"./ProductSticker--M4y5srw.js";const Me={__name:"ProductFreeTextInput",props:{modelValue:[String,null]},emits:["update:modelValue"],setup(u,{emit:h}){const p=h,f=u,m=V([]),n=V(!1),d=V(f.modelValue||"");let c=null;const v=V(!1);ee(()=>f.modelValue,l=>{typeof l=="string"&&l!==d.value?d.value=l:l===null&&(d.value="",v.value=!1)},{immediate:!0});async function N(l){if(p("update:modelValue",l),d.value=l,c&&clearTimeout(c),v.value&&l.length>0&&m.value.length===0){c=setTimeout(()=>{},400);return}c=setTimeout(async()=>{var o;if(!l||l.length<2){m.value=[],v.value=!1;return}v.value=!1,n.value=!0;try{const $=((o=(await B("product-variants/search-by-product",{search:l,per_page:20},!1,!1,!1)).data)==null?void 0:o.map(x=>({id:x.id,name:x.full_product_name||x.product_name||"بدون اسم",...x})))||[];m.value=$,$.length===0&&(v.value=!0)}catch(i){console.error(i),m.value=[],v.value=!0}finally{n.value=!1}},400)}function r(l){console.log("Selection prevented:",l)}function g(){p("update:modelValue",""),d.value="",m.value=[],v.value=!1}return(l,o)=>(U(),O(ke,{items:m.value,loading:n.value,search:d.value,"item-title":"name","item-value":"id",label:"اسم المنتج",clearable:"","hide-no-data":"","no-filter":"","hide-details":"","model-value":d.value,"return-object":"","onUpdate:search":N,"onUpdate:modelValue":r,"onClick:clear":g},{item:t(({item:i})=>[e(G,{title:i.raw.name,class:"text-medium-emphasis cursor-default",style:{pointerEvents:"none"}},null,8,["title"])]),"no-data":t(()=>[d.value?(U(),O(G,{key:0,title:d.value},null,8,["title"])):pe("",!0)]),_:1},8,["items","loading","search","model-value"]))}},Ee={__name:"SearchAndCreateSelect",props:{modelValue:[Number,String,null],items:{type:Array,default:()=>[]},label:{type:String,default:"البحث"},entity:{type:String,required:!0,validator:u=>["category","brand"].includes(u)},itemTitle:{type:String,default:"name"}},emits:["update:modelValue","item-created"],setup(u,{emit:h}){const p=u,f=h,m=V(!1),n=V(""),d=V(null),c=we({get:()=>p.modelValue,set:l=>f("update:modelValue",l)});function v(l){n.value=l}function N(l){l&&p.items.some(o=>o.id===l)&&(n.value="")}async function r(l){if(l){if(p.items.some(o=>o[p.itemTitle].toLowerCase()===l.toLowerCase())){n.value="";return}m.value=!0;try{const o={name:l},i=await re(p.entity,o,!1,!1,!0,!1);console.log("نم الحفظ",i.data),i.data.entity=p.entity,f("item-created",i.data),await W(),d.value&&d.value.blur(),console.log("تم المرور علي الحدث",i.data)}catch(o){console.error(`فشل إضافة ${p.entity}:`,o)}finally{m.value=!1,n.value=""}}}function g(){var o;const l=(o=n.value)==null?void 0:o.trim();l&&(p.items.some(i=>i[p.itemTitle].toLowerCase()===l.toLowerCase())?n.value="":r(l))}return(l,o)=>(U(),O(ke,{modelValue:c.value,"onUpdate:modelValue":[o[1]||(o[1]=i=>c.value=i),N],items:u.items,"item-title":u.itemTitle,"item-value":"id",label:u.label,loading:m.value,search:n.value,clearable:"","hide-details":"",ref_key:"autocompleteRef",ref:d,"onUpdate:search":v,onKeydown:_e(J(g,["prevent"]),["enter"])},{"no-data":t(()=>[e(G,{title:n.value,onClick:o[0]||(o[0]=i=>r(n.value))},{prepend:t(()=>[e(Y,{icon:"ri-add-line",color:"primary"})]),_:1},8,["title"])]),_:1},8,["modelValue","items","item-title","label","loading","search","onKeydown"]))}},xe=j(Ee,[["__scopeId","data-v-1b2feee3"]]),Ie={class:"mb-2 d-flex space-between flex-wrap justify-center align-center w-100"},Re={__name:"ProductGeneralInfoForm",props:{modelValue:Object,categories:Array,brands:Array,productRules:Object},emits:["update:modelValue","update:categories","update:brands"],setup(u,{emit:h}){const p=u,f=h;function m(n){console.log("تم اطلاق الحدث الفرعي ",n),n&&(n.entity==="category"?(f("update:categories",[...p.categories,n]),W(()=>{f("update:modelValue",{...p.modelValue,category_id:n.id})})):n.entity==="brand"&&(f("update:brands",[...p.brands,n]),W(()=>{f("update:modelValue",{...p.modelValue,brand_id:n.id})})))}return(n,d)=>(U(),O(Ce,null,{default:t(()=>[k("div",Ie,[k("div",null,[e(de,{modelValue:u.modelValue.active,"onUpdate:modelValue":d[0]||(d[0]=c=>u.modelValue.active=c),label:"نشط",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),k("div",null,[e(de,{modelValue:u.modelValue.featured,"onUpdate:modelValue":d[1]||(d[1]=c=>u.modelValue.featured=c),label:"مميز",color:"primary","hide-details":"auto"},null,8,["modelValue"])]),k("div",null,[e(de,{modelValue:u.modelValue.returnable,"onUpdate:modelValue":d[2]||(d[2]=c=>u.modelValue.returnable=c),label:"قابل للإرجاع",color:"primary","hide-details":"auto"},null,8,["modelValue"])])]),e(F,{dense:""},{default:t(()=>[e(b,{cols:"12",sm:"12"},{default:t(()=>[e(Me,{modelValue:u.modelValue.name,"onUpdate:modelValue":d[3]||(d[3]=c=>u.modelValue.name=c)},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",sm:"6"},{default:t(()=>[e(xe,{modelValue:u.modelValue.category_id,"onUpdate:modelValue":d[4]||(d[4]=c=>u.modelValue.category_id=c),items:u.categories,entity:"category",label:"القسم",onItemCreated:m},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",sm:"6"},{default:t(()=>[e(xe,{modelValue:u.modelValue.brand_id,"onUpdate:modelValue":d[5]||(d[5]=c=>u.modelValue.brand_id=c),items:u.brands,entity:"brand",label:"العلامة التجارية",onItemCreated:m},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",sm:"12"},{default:t(()=>[e(P,{modelValue:u.modelValue.desc,"onUpdate:modelValue":d[6]||(d[6]=c=>u.modelValue.desc=c),label:"الوصف",rules:u.productRules.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",sm:"12"},{default:t(()=>[e(P,{modelValue:u.modelValue.desc_long,"onUpdate:modelValue":d[7]||(d[7]=c=>u.modelValue.desc_long=c),label:"الوصف المفصل",rules:u.productRules.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}))}},Be=j(Re,[["__scopeId","data-v-e20805f0"]]),Le={__name:"ProductVariantAttributesForm",props:{modelValue:{type:Array,default:()=>[]},attributes:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{emit:h}){const p=u,f=h;function m(r){const g=p.attributes.find(l=>l.id===r);return(g==null?void 0:g.values)||[]}function n(r,g){const l=[...p.modelValue];l[r]={attribute_id:g,attribute_value_id:null},f("update:modelValue",l)}function d(){const r=[...p.modelValue,{attribute_id:null,attribute_value_id:null}];f("update:modelValue",r)}function c(r){const g=[...p.modelValue];g.splice(r,1),f("update:modelValue",g)}function v(r){if(!r)return"#000";const g=r.substring(1),l=parseInt(g,16),o=l>>16&255,i=l>>8&255,$=l&255;return .299*o+.587*i+.114*$>186?"#000":"#fff"}function N(r,g){const l=m(r).find(o=>o.id===g);return l!=null&&l.color?`background:${l.color};color:${v(l.color)};border-radius:6px;padding-inline:6px;`:""}return(r,g)=>(U(),L(H,null,[e(ve,{class:"ma-2"},{default:t(()=>g[0]||(g[0]=[_("الخصائص (Attributes)")])),_:1}),(U(!0),L(H,null,le(u.modelValue,(l,o)=>(U(),O(F,{dense:"",key:o,class:"d-flex align-center"},{default:t(()=>[e(b,{cols:"5"},{default:t(()=>[e(I,{modelValue:l.attribute_id,"onUpdate:modelValue":[i=>l.attribute_id=i,i=>n(o,i)],items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(b,{cols:"5"},{default:t(()=>[e(I,{modelValue:l.attribute_value_id,"onUpdate:modelValue":i=>l.attribute_value_id=i,items:m(l.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"","hide-details":"auto",disabled:!l.attribute_id,style:me(N(l.attribute_id,l.attribute_value_id))},{item:t(({props:i,item:$})=>[e(G,Ue({ref_for:!0},i,{style:$.raw.color?`background:${$.raw.color};`:""}),null,16,["style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(b,{cols:"2",class:"text-end"},{default:t(()=>[e(C,{icon:"ri-delete-bin-line",color:"error",size:"x-small",variant:"text",onClick:i=>c(o)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-2",text:"",color:"primary",density:"comfortable",onClick:d},{default:t(()=>g[1]||(g[1]=[_(" + إضافة خاصية ")])),_:1})],64))}},je=j(Le,[["__scopeId","data-v-da98878c"]]),Je={__name:"ProductVariantStocks",props:{modelValue:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},stockRules:{type:Object,default:()=>({cost:[],quantity:[]})}},emits:["update:modelValue"],setup(u,{emit:h}){const p=u,f=h,m=[{value:"available",text:"متاح"},{value:"unavailable",text:"غير متاح"},{value:"expired",text:"منتهي"}];function n(d){if(p.modelValue.length<=1){alert("لا يمكن حذف آخر سجل مخزون لهذا الخيار.");return}const c=[...p.modelValue];c.splice(d,1),f("update:modelValue",c)}return(d,c)=>(U(),L(H,null,[e(ve,{class:"ma-2"},{default:t(()=>c[1]||(c[1]=[_("المخزون")])),_:1}),(U(!0),L(H,null,le(u.modelValue,(v,N)=>(U(),O(F,{dense:"",key:v.id||N},{default:t(()=>[e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(P,{modelValue:v.cost,"onUpdate:modelValue":r=>v.cost=r,modelModifiers:{number:!0},label:"سعر الشراء",type:"number",rules:u.stockRules.cost,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(P,{modelValue:v.quantity,"onUpdate:modelValue":r=>v.quantity=r,modelModifiers:{number:!0},label:"الكمية",type:"number",rules:u.stockRules.quantity,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[u.warehouses&&u.warehouses.length>0?(U(),O(I,{key:0,modelValue:v.warehouse_id,"onUpdate:modelValue":r=>v.warehouse_id=r,"item-value":"id","item-title":"name",items:u.warehouses,label:"المخزن",rules:[r=>!!r||"المخزن مطلوب"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","onUpdate:modelValue","items","rules"])):(U(),O(I,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,rules:[r=>!!r||"المخزن مطلوب"],required:"","hide-details":"auto",disabled:""},null,8,["rules"]))]),_:2},1024),e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(I,{modelValue:v.status,"onUpdate:modelValue":r=>v.status=r,items:m,"item-value":"value","item-title":"text",label:"حالة المخزون","hide-details":"auto",rules:[r=>!!r||"حالة المخزون مطلوبة"],required:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(P,{modelValue:v.expiry,"onUpdate:modelValue":r=>v.expiry=r,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(b,{cols:"6",sm:"6",md:"4",lg:"2"},{default:t(()=>[e(P,{modelValue:v.loc,"onUpdate:modelValue":r=>v.loc=r,label:"الموقع","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),u.modelValue.length>1?(U(),O(C,{key:0,class:"mt-2",icon:"ri-delete-bin-line",color:"error",size:"small",onClick:c[0]||(c[0]=v=>n(d.sIndex))})):pe("",!0)],64))}},He=j(Je,[["__scopeId","data-v-382b902c"]]),Ke={__name:"ProductVariantForm",props:{variant:Object,variantIndex:Number,attributes:Array,warehouses:Array,statusOptions:Array},emits:["remove-variant"],setup(u,{emit:h}){return(p,f)=>(U(),O(F,null,{default:t(()=>[e(b,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(P,{modelValue:u.variant.retail_price,"onUpdate:modelValue":f[0]||(f[0]=m=>u.variant.retail_price=m),label:"سعر البيع قطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(P,{modelValue:u.variant.wholesale_price,"onUpdate:modelValue":f[1]||(f[1]=m=>u.variant.wholesale_price=m),label:"سعر البيع بالجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(I,{modelValue:u.variant.status,"onUpdate:modelValue":f[2]||(f[2]=m=>u.variant.status=m),items:u.statusOptions,"item-value":"value","item-title":"text",label:"الحالة","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",sm:"6",class:"my-0 py-1"},{default:t(()=>[e(P,{modelValue:u.variant.min_quantity,"onUpdate:modelValue":f[3]||(f[3]=m=>u.variant.min_quantity=m),label:" حد التحزير ","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e(je,{modelValue:u.variant.attributes,"onUpdate:modelValue":f[4]||(f[4]=m=>u.variant.attributes=m),attributes:u.attributes},null,8,["modelValue","attributes"])]),_:1})]),_:1}),e(b,{cols:"12",class:"my-0 py-1"},{default:t(()=>[e(R,{class:"mb-1 pa-2",outlined:""},{default:t(()=>[e(He,{modelValue:u.variant.stocks,"onUpdate:modelValue":f[5]||(f[5]=m=>u.variant.stocks=m),warehouses:u.warehouses},null,8,["modelValue","warehouses"])]),_:1})]),_:1}),e(b,{cols:"12",class:"my-2 py-1"},{default:t(()=>[e(C,{color:"error",onClick:f[6]||(f[6]=m=>p.$emit("remove-variant",u.variantIndex))},{default:t(()=>f[7]||(f[7]=[_("حذف هذا الخيار")])),_:1})]),_:1})]),_:1}))}},Ge=j(Ke,[["__scopeId","data-v-d71e48c9"]]),We={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(u,{emit:h}){const p=u,f=h;$e();const m=V(p.dialog),n=V(null),d=V(!1),c=V([]),v=V([]),N=V([]),r=V([]),g={id:null,name:"",active:!0,featured:!1,returnable:!0,desc:"",desc_long:"",category_id:null,brand_id:null,variants:[{barcode:"",sku:"",retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:"",tax:0,discount:0,status:"active",attributes:[],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:null}]}]},l=V(JSON.parse(JSON.stringify(g))),o={name:[a=>!!a||"اسم المنتج مطلوب",a=>typeof a=="string"&&a.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[a=>!a||typeof a=="string"||"الوصف يجب أن يكون نصًا"],description_long:[a=>!a||typeof a=="string"||"الوصف المفصل يجب أن يكون نصًا"],retail_price:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],wholesale_price:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],tax:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],discount:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],weight:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],quantity:[a=>typeof a=="number"&&!isNaN(a)||"مطلوب ويجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"],cost:[a=>typeof a=="number"&&!isNaN(a)||"يجب أن يكون رقمًا",a=>parseFloat(a)>=0||"يجب أن يكون رقمًا موجبًا أو صفرًا"]};ee(()=>p.dialog,async a=>{m.value=a,a&&(p.isEditMode&&p.product?l.value={...p.product}:(l.value=JSON.parse(JSON.stringify(g)),v.value.length>0&&(l.value.variants[0].stocks[0].warehouse_id=v.value[0].id)),await W(),n.value&&n.value.resetValidation())},{immediate:!0}),ee(m,a=>f("update:dialog",a));const i=Pe();Se(async()=>{i.loadingApi=!0;try{await Promise.all([$(),x(),z(),Z()])}finally{i.loadingApi=!1,!p.isEditMode&&v.value.length>0&&(l.value.variants[0].stocks[0].warehouse_id=v.value[0].id)}});async function $(){try{const a=await B("brands");c.value=a.data}catch(a){console.error(a)}}async function x(){try{const a=await B("attributes");r.value=a.data}catch(a){console.error(a)}}async function z(){try{const a=await B("warehouses");v.value=a.data}catch(a){console.error(a)}}async function Z(){try{const a=await B("categories");N.value=a.data}catch(a){console.error(a)}}function M(a){N.value=[...a]}function ae(a){c.value=[...a]}function ue(){var a;l.value.variants.push({retail_price:0,wholesale_price:0,image:null,weight:0,dimensions:"",min_quantity:0,tax:0,discount:0,status:"active",attributes:[{attribute_id:null,attribute_value_id:null}],stocks:[{quantity:0,reserved:0,min_quantity:0,cost:0,batch:"",expiry:null,loc:"",status:"available",warehouse_id:((a=v.value[0])==null?void 0:a.id)??null}]})}function oe(a){l.value.variants.splice(a,1)}async function ie(){if(!n.value)return;const{valid:a}=await n.value.validate();if(a)try{const S=JSON.parse(JSON.stringify(l.value));let T;if(S.id)T=await re("product",S,S.id);else{const{id:D,...se}=S;T=await re("product",se)}f("saved",T),K()}catch(S){console.error(S)}}const ne=[{value:"active",text:"نشط"},{value:"inactive",text:"غير نشط"},{value:"discontinued",text:"متوقف"}];function K(){m.value=!1,f("close")}return(a,S)=>(U(),O(te,{modelValue:m.value,"onUpdate:modelValue":S[2]||(S[2]=T=>m.value=T),"max-width":"900px",persistent:""},{default:t(()=>[e(R,null,{default:t(()=>[e(C,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:K}),e(X,{class:"ma-3 text-center"},{default:t(()=>[k("h2",null,q(u.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(ce,{class:"pa-0"},{default:t(()=>[e(qe,{ref_key:"productForm",ref:n,modelValue:d.value,"onUpdate:modelValue":S[1]||(S[1]=T=>d.value=T)},{default:t(()=>[e(Be,{modelValue:l.value,categories:N.value,brands:c.value,productRules:o,"onUpdate:modelValue":S[0]||(S[0]=T=>l.value=T),"onUpdate:categories":M,"onUpdate:brands":ae},null,8,["modelValue","categories","brands"]),e(R,{class:"pa-2 ma-1",outlined:""},{default:t(()=>[e(X,{class:"ma-2"},{default:t(()=>S[3]||(S[3]=[_("خيارات المنتج")])),_:1}),(U(!0),L(H,null,le(l.value.variants,(T,D)=>(U(),O(F,{class:"bg-grey-lighten-1 pa-2",key:D},{default:t(()=>[e(Ge,{variant:T,variantIndex:D,attributes:r.value,warehouses:v.value,statusOptions:ne,productRules:o,onRemoveVariant:oe},null,8,["variant","variantIndex","attributes","warehouses"])]),_:2},1024))),128))]),_:1}),e(F,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(C,{class:"ma-3",color:"primary",onClick:ue},{default:t(()=>S[4]||(S[4]=[_("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(Oe,{class:"position-sticky bottom-0 bg-grey-lighten-2",elevation:"1"},{default:t(()=>[e(he,{class:"my-2"}),e(fe,{class:"justify-center bg-grey-lighten-3 pa-2 ma-2 gap-8"},{default:t(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",variant:"outlined",disabled:!d.value,onClick:ie,class:"text-capitalize"},{default:t(()=>[_(q(u.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["disabled"]),e(C,{"prepend-icon":"ri-close-line",color:"error",variant:"outlined",onClick:K,class:"text-capitalize"},{default:t(()=>S[5]||(S[5]=[_("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Xe={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(u,{emit:h}){const p=u,f=h,m=we({get:()=>p.modelValue,set:l=>f("update:modelValue",l)}),n=V({});ee(()=>p.variant,l=>{n.value=JSON.parse(JSON.stringify(l||{}))},{immediate:!0});function d(l){if(!l)return[];const o=p.attributes.find(i=>i.id===l);return o?o.values:[]}function c(l){if(!l)return"#000";const o=l.substring(1),i=parseInt(o,16),$=i>>16&255,x=i>>8&255,z=i>>0&255;return .299*$+.587*x+.114*z>186?"#000":"#fff"}function v(){n.value.attributes=n.value.attributes||[],n.value.attributes.push({attribute_id:null,attribute_value_id:null})}function N(l){n.value.attributes.splice(l,1)}function r(){f("update:modelValue",!1)}function g(){f("save",JSON.parse(JSON.stringify(n.value))),r()}return(l,o)=>(U(),O(te,{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=i=>m.value=i),"max-width":"600",persistent:""},{default:t(()=>[e(R,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(X,null,{default:t(()=>o[8]||(o[8]=[_("تعديل متغير المنتج")])),_:1}),e(F,{class:"bg-grey-lighten-4 pa-2"},{default:t(()=>[e(b,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:t(()=>[e(F,null,{default:t(()=>[e(b,{cols:"4"},{default:t(()=>[e(P,{modelValue:n.value.purchase_price,"onUpdate:modelValue":o[0]||(o[0]=i=>n.value.purchase_price=i),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"4"},{default:t(()=>[e(P,{modelValue:n.value.retail_price,"onUpdate:modelValue":o[1]||(o[1]=i=>n.value.retail_price=i),label:"سعر القطاعي",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"4"},{default:t(()=>[e(P,{modelValue:n.value.wholesale_price,"onUpdate:modelValue":o[2]||(o[2]=i=>n.value.wholesale_price=i),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(F,null,{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[e(P,{modelValue:n.value.tax_rate,"onUpdate:modelValue":o[3]||(o[3]=i=>n.value.tax_rate=i),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(P,{modelValue:n.value.discount,"onUpdate:modelValue":o[4]||(o[4]=i=>n.value.discount=i),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{class:"py-0",cols:"12"},{default:t(()=>[e(F,null,{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[e(P,{modelValue:n.value.expiry_date,"onUpdate:modelValue":o[5]||(o[5]=i=>n.value.expiry_date=i),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(P,{modelValue:n.value.image_url,"onUpdate:modelValue":o[6]||(o[6]=i=>n.value.image_url=i),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"mt-4"},{default:t(()=>[e(ve,null,{default:t(()=>o[9]||(o[9]=[_("الخصائص (Attributes)")])),_:1}),(U(!0),L(H,null,le(n.value.attributes,(i,$)=>(U(),O(F,{dense:"",key:$,class:"d-flex align-center"},{default:t(()=>[e(b,{cols:"5"},{default:t(()=>[e(I,{modelValue:i.attribute_id,"onUpdate:modelValue":x=>i.attribute_id=x,items:u.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>i.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(b,{cols:"5"},{default:t(()=>[e(I,{modelValue:i.attribute_value_id,"onUpdate:modelValue":x=>i.attribute_value_id=x,items:d(i.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!i.attribute_id,":return-object":!1,"hide-details":"auto",style:me((()=>{const x=d(i.attribute_id).find(z=>z.id===i.attribute_value_id);return x&&x.color?`background:${x.color};color:${c(x.color)};border-radius:6px;`:""})())},{item:t(({item:x,props:z})=>[e(G,Ue({ref_for:!0},z,{style:x.raw.color?`background:${x.raw.color};color:${c(x.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:t(({item:x})=>[k("span",{style:me(x.raw.color?`background:${x.raw.color};color:${c(x.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},q(x.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(b,{cols:"2"},{default:t(()=>[e(C,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:x=>N($)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"my-2",text:"",color:"primary",small:"",onClick:v},{default:t(()=>o[10]||(o[10]=[_("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(he,{class:"my-4"}),e(F,null,{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[e(C,{"prepend-icon":"ri-close-line",color:"error",onClick:r},{default:t(()=>o[11]||(o[11]=[_(" إلغاء ")])),_:1})]),_:1}),e(b,{cols:"6",class:"text-center"},{default:t(()=>[e(C,{"prepend-icon":"ri-save-line",color:"success",onClick:g},{default:t(()=>o[12]||(o[12]=[_(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ze=j(Xe,[["__scopeId","data-v-2f5b889d"]]),Qe={class:"d-flex align-center justify-space-between mb-2"},Ye={class:"d-flex align-center gap-2"},et=["onClick"],tt={key:0},lt={colspan:"5",class:"pa-0"},at={id:"mobile-sticker-print"},ut={__name:"products",setup(u){const h=V(!1),p=V({}),f=V(!1),m=V([]),n=V(!1),d=V(null),c=V(null),v=V(0),N=V(!1),r=V({page:1,itemsPerPage:10,sortBy:[]}),g=V(""),l=V(!1),o=V(null),i=V([]),$=V(null),x=[{title:"الاسم",key:"name"},{title:"اجمالي الكمية",key:"total_available_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],z=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"الكمية",key:"quantity"},{title:" كمية التحزير ",key:"min_quantity"},{title:"سعر الشراء",key:"cost"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر القطاعي",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];Se(()=>{Z()});function Z(){B("attributes",null,!0,!1).then(w=>{i.value=w.data})}function M(){N.value=!0;const{page:w,itemsPerPage:s,sortBy:y}=r.value,E=y.length?y[0].key:"id",Q=y.length&&y[0].order?y[0].order:"desc";B("products",{page:w,per_page:s,sort_by:E,sort_order:Q,search:g.value}).then(A=>{m.value=A.data,v.value=A.total}).finally(()=>{N.value=!1})}function ae(){f.value=!1,p.value={},h.value=!0}function ue(w){h.value=!0,f.value=!0,p.value=JSON.parse(JSON.stringify(w))}function oe(w){const s=m.value.findIndex(y=>y.id===w.id);s!==-1?m.value[s]=w:m.value.push(w),h.value=!1}function ie(w){d.value=w,n.value=!0}function ne(){d.value&&Te("product/delete",d.value.id).then(()=>{M(),Ve.success("تم حذف المنتج بنجاح"),n.value=!1,d.value=null}).catch(()=>Ve.error("حدث خطأ أثناء حذف المنتج"))}function K(w){c.value=c.value===w?null:w}function a(w,s){o.value=JSON.parse(JSON.stringify(w)),o.value.product_id=s,console.log("openVariantEditDialog",o.value),console.log("attributes",i.value),l.value=!0}function S(w){const s=m.value.find(E=>E.id===(w.product_id||c.value));if(!s)return;const y=s.variants.findIndex(E=>E.id===w.id);y!==-1&&(s.variants[y]=w),l.value=!1}function T(){return/android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(navigator.userAgent)}const D=V(!1);function se(w){if(T())$.value=w,D.value=!0;else{const s=document.createElement("div");document.body.appendChild(s);const y=Fe({render(){return ze(ge,{product:w,ref:"stickerRef"})},mounted(){W(()=>{this.$refs.stickerRef.printSticker(),setTimeout(()=>{y.unmount(),document.body.removeChild(s)},5e3)})}});y.mount(s)}}function Ae(){const w=document.body.innerHTML,s=document.getElementById("mobile-sticker-print").outerHTML;document.body.innerHTML=s,window.print(),document.body.innerHTML=w,D.value=!1}return(w,s)=>(U(),O(Ce,{class:"pa-1",style:{"max-width":"1200px"}},{default:t(()=>[e(We,{dialog:h.value,"onUpdate:dialog":s[0]||(s[0]=y=>h.value=y),product:p.value,isEditMode:f.value,onSaved:oe},null,8,["dialog","product","isEditMode"]),e(Ze,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=y=>l.value=y),variant:o.value,attributes:i.value,onSave:S},null,8,["modelValue","variant","attributes"]),e(R,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:t(()=>[k("div",Qe,[s[10]||(s[10]=k("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),e(C,{color:"primary",onClick:ae,size:"small"},{default:t(()=>s[9]||(s[9]=[_("+ إضافة منتج")])),_:1}),k("div",Ye,[e(P,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=y=>g.value=y),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:_e(M,["enter"]),onBlur:M,clearable:"","onClick:clear":s[3]||(s[3]=()=>{g.value="",M()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":M},null,8,["modelValue"])])]),e(be,{items:m.value,headers:x,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:N.value,options:r.value,"server-items-length":v.value,"items-per-page":r.value.itemsPerPage,page:r.value.page,"sort-by":r.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":M},{item:t(({item:y})=>{var E,Q;return[k("tr",{class:ye({"bg-product-expanded":c.value===y.id}),onClick:A=>K(y.id),style:{cursor:"pointer"}},[k("td",null,q(y.name),1),k("td",null,q(y.total_available_quantity),1),k("td",null,q(((E=y.category)==null?void 0:E.name)??"-"),1),k("td",null,q(((Q=y.brand)==null?void 0:Q.name)??"-"),1),k("td",{onClick:s[4]||(s[4]=J(()=>{},["stop"]))},[e(C,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:J(A=>ue(y),["stop"])},null,8,["onClick"]),e(C,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:J(A=>ie(y),["stop"])},null,8,["onClick"])])],10,et),c.value===y.id?(U(),L("tr",tt,[k("td",lt,[e(be,{items:y.variants,headers:z,"item-key":"id",density:"compact",class:"text-start","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:t(({item:A})=>[k("tr",{class:ye(A.quantity<=A.min_quantity?"bg-variant-min-quantity":"bg-variant-normal")},[k("td",null,q(A.sku),1),k("td",null,q(A.barcode),1),k("td",null,q(A.quantity),1),k("td",null,q(A.min_quantity),1),k("td",null,q(A.cost),1),k("td",null,q(A.wholesale_price),1),k("td",null,q(A.retail_price),1),k("td",null,q(A.discount),1),k("td",null,[s[11]||(s[11]=_("= ")),e(De,{attributes:A.attributes,"font-size":"10px"},null,8,["attributes"])]),k("td",null,[k("div",null,[e(C,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:J(Ne=>a(A,y.id),["stop"])},{default:t(()=>[e(Y,{size:"16"},{default:t(()=>s[12]||(s[12]=[_("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(C,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:t(()=>[e(Y,{size:"16"},{default:t(()=>s[13]||(s[13]=[_("ri-delete-bin-line")])),_:1})]),_:1}),e(C,{size:"x-small",icon:"",color:"success",title:"طباعة استيكر",onClick:J(Ne=>se(A),["stop"])},{default:t(()=>[e(Y,{size:"16"},{default:t(()=>s[14]||(s[14]=[_("ri-printer-line")])),_:1})]),_:2},1032,["onClick"])])])],2)]),_:2},1032,["items"])])])):pe("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(te,{modelValue:n.value,"onUpdate:modelValue":s[6]||(s[6]=y=>n.value=y),"max-width":"340",persistent:""},{default:t(()=>[e(R,null,{default:t(()=>[e(X,null,{default:t(()=>s[15]||(s[15]=[_("تأكيد الحذف")])),_:1}),e(ce,null,{default:t(()=>s[16]||(s[16]=[_("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(fe,null,{default:t(()=>[e(C,{color:"error",onClick:ne,size:"small"},{default:t(()=>s[17]||(s[17]=[_("تأكيد")])),_:1}),e(C,{onClick:s[5]||(s[5]=y=>n.value=!1),size:"small"},{default:t(()=>s[18]||(s[18]=[_("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:D.value,"onUpdate:modelValue":s[8]||(s[8]=y=>D.value=y),"max-width":"350",persistent:""},{default:t(()=>[e(R,null,{default:t(()=>[e(X,{class:"text-center"},{default:t(()=>s[19]||(s[19]=[_("معاينة استيكر المنتج")])),_:1}),e(ce,null,{default:t(()=>[k("div",at,[e(ge,{product:$.value,ref:"mobileStickerRef"},null,8,["product"])])]),_:1}),e(fe,{class:"justify-center"},{default:t(()=>[e(C,{color:"primary",onClick:Ae},{default:t(()=>s[20]||(s[20]=[_("طباعة")])),_:1}),e(C,{color:"grey",onClick:s[7]||(s[7]=y=>D.value=!1)},{default:t(()=>s[21]||(s[21]=[_("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},st=j(ut,[["__scopeId","data-v-366d0d81"]]);export{st as default};
