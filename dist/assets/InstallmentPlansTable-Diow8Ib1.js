const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThermalInstallmentPrint-2Jo3Wlnq.js","assets/index-Hb9LFdW-.js","assets/index-DIsnh7q0.css","assets/ThermalInstallmentPrint-Bl1cRlaJ.css"])))=>i.map(i=>d[i]);
import{_ as Q,r as o,h as W,P as Z,c as D,d as a,j as l,U as L,X as ee,F as M,aj as te,o as c,ai as ae,am as le,a6 as se,a as m,a9 as y,a3 as I,b as r,aJ as ne,t as k,bn as oe,A as ie,k as b,as as T,q as h,a4 as A,a5 as u,ap as re,a1 as ue,aA as de,aq as ce,Y as me,z as pe,bg as fe,aL as ve,T as ye,ag as ge}from"./index-Hb9LFdW-.js";import{_ as _e}from"./InfoDisplay-Bz966-Ve.js";import{P as xe}from"./PayInstallmentDialog-CI36FsCV.js";const ke={class:"sticky-column"},be={class:"progress-bar-container"},he={class:"d-flex flex-wrap"},Ce={key:0,class:"text-grey-darken-1"},Ve={class:"text-end mt-2 me-4"},Pe={__name:"InstallmentPlansTable",setup(we){const H=[{title:"رقم الخطة",key:"id"},{title:"نسبه مئوية %",key:"paid_percentage",sortable:!1},{title:"منتجات الخطة",key:"plan_products",sortable:!1},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1,class:"sticky-column"}],F=o(null);function j(s,e){var n;F.value=(n=e==null?void 0:e.item)==null?void 0:n.id,console.log("Selected Row ID:",F.value)}const q=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status_label"},{title:"الإجراءات",key:"actions",sortable:!1}];function G(s){if(s&&s.id){const e=pe();let n="اسم الشركة";if(e.user&&e.user.companies&&e.user.company_id){const x=e.user.companies.find(w=>w.id===e.user.company_id);x&&(n=x.name)}const t=s,d=document.createElement("div");document.body.appendChild(d),fe(()=>import("./ThermalInstallmentPrint-2Jo3Wlnq.js"),__vite__mapDeps([0,1,2,3])).then(x=>{const w=x.default,z=ve({render(){return ye(w,{installment:t,companyName:n,ref:"thermalRef"})},mounted(){ge(()=>{this.$refs.thermalRef.printThermal&&this.$refs.thermalRef.printThermal(),setTimeout(()=>{z.unmount(),document.body.removeChild(d)},500)})}});z.mount(d)})}}const E=o([]),p=o([]),i=o({}),g=o(!1),S=o(null),C=o(!1),R=o(!0),U=o(10),f=o({page:1,itemsPerPage:10,sortBy:[],sortDesc:[]}),$=o(0),V=o(!1),v=o(null),J=()=>{!v.value||v.value.length<3||(f.value.page=1,P())};function _(s){const e=parseFloat(s.total_installments_pay)||0,n=parseFloat(s.total_installments_amount)||1;return Math.min(Math.round(e/n*100),100)}function O(s){const e=_(s);return e===100?"#4CAF50":e>=50?"#2196F3":e>=20?"#FFC107":"#F44336"}const X=W(()=>i.value.start_date?new Date(i.value.start_date).toLocaleDateString("ar-EG"):"—");function B({item:s}){const e=parseFloat(s.remaining)||0,n=new Date(s.due_date),t=new Date;return n.setHours(0,0,0,0),t.setHours(0,0,0,0),s.status==="paid"?{style:{backgroundColor:"#A5D6A7"}}:e>0&&n<t?{style:{backgroundColor:"#EF9A9A"}}:e>0?{style:{backgroundColor:"#FFE082"}}:_(s)=="100"?{style:{backgroundColor:"#E8F5E9"}}:{}}async function P(){V.value=!0;try{const s=await te("installment-plans",{page:f.value.page,per_page:f.value.itemsPerPage,search:v.value});E.value=s.data||[],$.value=s.total||0}catch(s){console.error("حدث خطأ أثناء جلب الخطط",s)}finally{V.value=!1}}function Y(s){s.paid_installments.forEach(e=>{const n=p.value.findIndex(t=>t.id===e.id);n!==-1&&(p.value[n]={...p.value[n],...e})})}function K(s){!s||!Array.isArray(s.installments)||(i.value=s,p.value=s.installments,g.value=!0)}function N(s,e){S.value=s,R.value=e,C.value=!0}return Z(P),(s,e)=>{const n=_e;return c(),D(M,null,[a(L,{class:"pa-2"},{default:l(()=>[a(ae,{"items-per-page":U.value,"onUpdate:itemsPerPage":e[1]||(e[1]=t=>U.value=t),options:f.value,"onUpdate:options":[e[2]||(e[2]=t=>f.value=t),P],headers:H,items:E.value,"items-length":$.value,loading:V.value,hover:"",striped:"even","show-current-page":"","item-value":"id","row-props":B,class:"elevation-1",density:"compact","loading-text":"جاري تحميل البيانات...","no-data-text":"لا توجد بيانات","items-per-page-text":"عدد الصفوف في الصفحة","items-per-page-options":[10,25,50,100,500,{value:-1,title:"الكل"}],"onClick:row":j},{top:l(()=>[a(le,null,{default:l(()=>[a(se,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),label:"ابحث باسم المستخدم","prepend-inner-icon":"ri-search-line","hide-details":"",clearable:"",class:"ma-10","max-width":"330",rounded:"",onInput:J,rules:[t=>t&&t.length>=3||"ادخل 3 حروف على الاقل"]},null,8,["modelValue","rules"])]),_:1})]),"header.actions":l(()=>e[7]||(e[7]=[m("th",{class:"sticky-column"},"الإجراءات",-1)])),"item.actions":l(({item:t})=>[m("div",ke,[a(y,{color:"primary",density:"compact",onClick:I(d=>K(t),["stop"])},{default:l(()=>e[8]||(e[8]=[r(" عرض الأقساط ")])),_:2},1032,["onClick"])])]),"item.paid_percentage":l(({item:t})=>[m("div",be,[m("div",{class:"progress-bar-fill",style:ne({width:_(t)+"%",backgroundColor:O(t)})},k(_(t))+"% ",5)])]),"item.plan_products":l(({item:t})=>[a(oe,{column:""},{default:l(()=>[m("div",he,[(c(!0),D(M,null,ie(t.invoice_items.slice(0,2),d=>(c(),b(T,{key:d.id,size:"small",color:"info",variant:"outlined"},{default:l(()=>[r(k(d.name),1)]),_:2},1024))),128)),t.invoice_items.length>2?(c(),b(T,{key:0,class:"text-grey px-1"},{default:l(()=>[r("منتجات "+k(t.invoice_items.length-2)+" اخرين ",1)]),_:2},1024)):h("",!0)]),!t.invoice_items||t.invoice_items.length===0?(c(),D("span",Ce,"لا توجد منتجات")):h("",!0)]),_:2},1024)]),"no-data":l(()=>[a(A,{class:"pa-4"},{default:l(()=>[a(u,{class:"text-center text-grey"},{default:l(()=>e[9]||(e[9]=[r("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items-per-page","options","items","items-length","loading"])]),_:1}),a(ee,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),"max-width":"900px",scrollable:"",persistent:""},{default:l(()=>[a(L,null,{default:l(()=>[a(re,{class:"bg-primary text-white"},{default:l(()=>e[10]||(e[10]=[r(" تفاصيل خطة التقسيط ")])),_:1}),a(ue,{style:{"max-height":"70vh","overflow-y":"auto"}},{default:l(()=>[a(A,{class:"px-4 pt-4",dense:""},{default:l(()=>[a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(n,{icon:"ri-user-line",label:"المستخدم",text:((t=i.value.user)==null?void 0:t.nickname)||"غير متوفر"},null,8,["text"])]}),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(n,{icon:"ri-file-text-line",label:"الفاتورة",text:((t=i.value.invoice)==null?void 0:t.invoice_number)||"—"},null,8,["text"])]}),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-calendar-line",label:"تاريخ الخطة",text:X.value},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-money-dollar-box-line",label:"إجمالي الفاتورة",text:i.value.total_amount},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-wallet-line",label:"إجمالي المتبقي",text:i.value.total_installments_remaining},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-hand-coin-line",label:"إجمالي المدفوع",text:i.value.total_pay},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>[a(n,{icon:"ri-hand-heart-line",label:"المقدم",text:i.value.down_payment},null,8,["text"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:l(()=>{var t;return[a(n,{icon:"ri-list-ordered",label:"عدد الأقساط",text:((t=i.value.installments)==null?void 0:t.length)||0},null,8,["text"])]}),_:1})]),_:1}),a(de,{"row-props":B,headers:q,items:p.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":l(({item:t})=>[a(T,{color:t.status==="paid"?"success":"error",dark:""},{default:l(()=>[r(k(t.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[t.status!=="paid"?(c(),b(y,{key:0,color:t.status==="paid"?"grey":"success",disabled:t.status==="paid",density:"compact",class:"me-1",onClick:I(d=>N(t,!0),["stop"])},{default:l(()=>e[11]||(e[11]=[r(" دفع القسط ")])),_:2},1032,["color","disabled","onClick"])):h("",!0),t.status!=="paid"?(c(),b(y,{key:1,color:t.status==="paid"?"grey":"warning",disabled:t.status==="paid",density:"compact",onClick:I(d=>N(t,!1),["stop"])},{default:l(()=>e[12]||(e[12]=[r(" مبلغ مختلف ")])),_:2},1032,["color","disabled","onClick"])):h("",!0)]),"no-data":l(()=>[a(A,{class:"pa-4"},{default:l(()=>[a(u,{class:"text-center text-grey"},{default:l(()=>e[13]||(e[13]=[r(" لا توجد أقساط لهذه الخطة ")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),a(ce,{class:"bg-grey-lighten-4",style:{position:"sticky",bottom:"0","z-index":"1"}},{default:l(()=>[a(me),a(y,{"prepend-icon":"ri-close-line",text:"",onClick:e[3]||(e[3]=t=>g.value=!1)},{default:l(()=>e[14]||(e[14]=[r("إغلاق")])),_:1}),m("div",Ve,[a(y,{"prepend-icon":"ri-printer-line",color:"primary",onClick:e[4]||(e[4]=t=>G(i.value))},{default:l(()=>e[15]||(e[15]=[r(" طباعة الخطة ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(xe,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t),installment:S.value,"direct-pay":R.value,"onUpdate:installment":Y},null,8,["modelValue","installment","direct-pay"])],64)}}},Ae=Q(Pe,[["__scopeId","data-v-e0ed8cdd"]]);export{Ae as default};
