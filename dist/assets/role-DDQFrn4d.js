import{g as W}from"./permissions-3fwV70Qx.js";import{R as ee,r as n,z as le,w as ae,P as te,ap as se,c as D,d as e,j as a,a4 as U,U as V,u as N,X as S,o as u,a5 as R,a as v,Y as y,k,b as i,a9 as r,q as P,ak as oe,aA as ne,a6 as j,ai as h,t as q,M as B,a1 as T,a2 as ie,F as I,A as L,a8 as re,au as M,Z as ue,aa as f,$ as de,aB as me}from"./index-CDiS6puo.js";const ve={class:"mx-auto mt-10 pa-10",style:{"max-width":"700px","background-color":"white"}},fe={class:"d-flex gap-2"},ge={__name:"role",setup(ce){ue();const{xs:O}=ee(),p=n(!1),x=n(!1),b=n(!1),d=n(!1),c=n(!1),C=n(""),z=n(!1),$=n(null),A=n({}),w=n({}),_=le();ae(()=>_.user,()=>{console.log("rin watch"),A.value=_.user.permissions||[],w.value=W(A.value)},{immediate:!0}),te(async()=>{p.value=!0,se("roles").then(s=>{m.value=s.data,p.value=!1}).catch(s=>{p.value=!1,s.data.error})});const E=n([{title:"اسم الدور",key:"name",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"center"},{title:"الإجراءات",key:"actions",align:"center",sortable:!1}]),m=n([]),o=n({name:"",permissions:[]}),G=[s=>!!s||"اسم الدور مطلوب",s=>s.length>=3||"يجب أن يكون الاسم 3 أحرف على الأقل"],X=()=>{o.value={name:"",permissions:[]},d.value=!0},F=()=>{d.value=!1,o.value={name:"",permissions:[]}},Y=s=>{o.value={...s},d.value=!0},Z=s=>{o.value={...s},c.value=!0},H=()=>{if(x.value=!0,!$.value.validate()){f.error("يرجى تعبئة جميع الحقول المطلوبة بشكل صحيح"),x.value=!1;return}try{de("role",o.value,o.value.id).then(s=>{if(o.value.id){let l=m.value.find(t=>t.id===s.id);Object.assign(l,o.value),f.success("تم تعديل الدور بنجاح")}else m.value.push(s),f.success("تم إضافة الدور بنجاح");d.value=!1}).catch(()=>f.error("حدث خطأ أثناء حفظ الدور"))}finally{x.value=!1}},J=async()=>{b.value=!0;try{me("role",o.value.id).then(()=>{m.value=m.value.filter(s=>s.id!==o.value.id),f.success("تم حذف الدور بنجاح")}).catch(()=>f.error("حدث خطأ أثناء حذف الدور"))}finally{c.value=!1,b.value=!1}};return(s,l)=>(u(),D("div",ve,[e(U,null,{default:a(()=>[e(R,{cols:"12",class:"d-flex align-center"},{default:a(()=>[l[9]||(l[9]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold"},"إدارة الأدوار"),v("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"},"قم بإدارة أدوار المستخدمين وصلاحياتهم في النظام")],-1)),e(y),N(_).can(["roles_create","super_admin","company_owner"])?(u(),k(r,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:l[0]||(l[0]=t=>X()),elevation:"2",size:"large"},{default:a(()=>l[8]||(l[8]=[i(" دور جديد ")])),_:1})):P("",!0)]),_:1})]),_:1}),e(V,{elevation:"2"},{default:a(()=>[e(oe,{headers:E.value,items:m.value,loading:p.value,search:C.value,hover:"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة"},{top:a(()=>[e(ne,{color:"transparent"},{default:a(()=>[e(j,{class:"ma-10",modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=t=>C.value=t),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),"item.actions":a(({item:t})=>[v("div",fe,[e(r,{icon:"ri-pencil-line",color:"primary",size:"small",variant:"text",onClick:g=>Y(t)},null,8,["onClick"]),e(r,{icon:"ri-delete-bin-line",color:"error",size:"small",variant:"text",onClick:g=>Z(t)},null,8,["onClick"])])]),_:1},8,["headers","items","loading","search"])]),_:1}),e(S,{fullscreen:N(O),modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=t=>d.value=t),"max-width":"700",persistent:""},{default:a(()=>[e(V,{style:{position:"relative"}},{default:a(()=>[v("div",{onClick:F,style:{position:"fixed",top:"5px",left:"5px"}},[e(r,{icon:"ri-close-line"})]),e(h,{class:"text-h5"},{default:a(()=>[i(q(o.value.id?"تعديل دور":"إضافة دور جديد")+" ",1),e(y)]),_:1}),e(B),e(T,null,{default:a(()=>[e(ie,{ref_key:"form",ref:$,modelValue:z.value,"onUpdate:modelValue":l[4]||(l[4]=t=>z.value=t)},{default:a(()=>[e(j,{modelValue:o.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.name=t),label:"اسم الدور",rules:G,required:"",variant:"outlined",density:"comfortable"},null,8,["modelValue"]),e(B,{class:"my-4"}),l[10]||(l[10]=v("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)),w.value?(u(),k(U,{key:0,class:"mb-10"},{default:a(()=>[(u(!0),D(I,null,L(w.value,t=>(u(),k(R,{class:"pa-0",key:t.name,cols:"12"},{default:a(()=>[e(V,{variant:"outlined",class:"mb-4"},{default:a(()=>[e(h,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:a(()=>[i(q(t.name),1)]),_:2},1024),e(T,null,{default:a(()=>[e(U,null,{default:a(()=>[(u(!0),D(I,null,L(t.permissions,(g,K)=>(u(),k(R,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:K},{default:a(()=>[e(re,{modelValue:o.value.permissions,"onUpdate:modelValue":l[3]||(l[3]=Q=>o.value.permissions=Q),label:g.name,value:g.value,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):P("",!0)]),_:1},8,["modelValue"])]),_:1}),e(B),e(M,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 ma-auto"},{default:a(()=>[e(r,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:F},{default:a(()=>l[11]||(l[11]=[i(" إلغاء ")])),_:1}),e(y),e(r,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},loading:x.value,onClick:H},{default:a(()=>l[12]||(l[12]=[i(" حفظ ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"]),e(S,{modelValue:c.value,"onUpdate:modelValue":l[7]||(l[7]=t=>c.value=t),"max-width":"400"},{default:a(()=>[e(V,null,{default:a(()=>[e(h,{class:"text-h5 pa-4"},{default:a(()=>l[13]||(l[13]=[i(" تأكيد الحذف ")])),_:1}),e(T,{class:"pa-4"},{default:a(()=>l[14]||(l[14]=[i(" هل أنت متأكد من حذف هذا الدور؟ لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),e(M,{class:"pa-4"},{default:a(()=>[e(y),e(r,{color:"grey-darken-1",variant:"text",onClick:l[6]||(l[6]=t=>c.value=!1)},{default:a(()=>l[15]||(l[15]=[i(" إلغاء ")])),_:1}),e(r,{color:"error",loading:b.value,onClick:J},{default:a(()=>l[16]||(l[16]=[i(" حذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ge as default};
