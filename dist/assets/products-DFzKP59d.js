import{_ as ie,S as Ve,r as f,w as K,Q as pe,ah as F,o as $,m as O,n as l,d as e,X as L,a2 as g,aa as R,a as p,t as C,a1 as fe,q as ae,u as se,ak as ye,a7 as y,a8 as i,al as x,aG as le,aH as ne,au as J,aI as re,b as v,c as G,F as ue,C as oe,aJ as _e,az as Q,I as ve,aK as be,N as ge,Z as de,a0 as xe,j as ke,ay as we,aL as Ce,ac as ce,an as H,V as te,v as Ue,aq as he,aF as $e,aE as me}from"./index-BJ29Ge3K.js";import{_ as De}from"./AttributesDisplay-bLG8JYwB.js";const Ee={__name:"ProductDialog",props:{dialog:Boolean,product:Object,isEditMode:Boolean},emits:["update:dialog","saved","close"],setup(j,{emit:B}){const b=j,D=B,{xs:h}=Ve(),r=f(b.dialog),E=f(null),U=f(!1),q=f([]),w=f([]),S=f([]),z=f([]),o=f({id:null,name:"",is_active:!0,featured:!1,is_returnable:!0,description:"",description_long:"",category_id:null,brand_id:null,variants:[{retail_price:0,purchase_price:0,wholesale_price:0,dimensions:0,discount:0,expiry_date:"",image_url:"",attributes:[{attribute_id:null,attribute_value_id:null}]}]});function d(a){var t,u,V,n;return{id:a.id,name:a.name,is_active:a.is_active??!0,featured:!!a.featured,is_returnable:a.is_returnable??!0,description:a.description||"",description_long:a.description_long||"",category_id:((t=a.category_id)==null?void 0:t.id)||((u=a.category)==null?void 0:u.id)||null,brand_id:((V=a.brand_id)==null?void 0:V.id)||((n=a.brand)==null?void 0:n.id)||null,warehouse_id:a.warehouse_id||null,variants:((a==null?void 0:a.variants)||[]).map(_=>({retail_price:_.retail_price??0,purchase_price:_.purchase_price??0,wholesale_price:_.wholesale_price??0,dimensions:_.dimensions??"",discount:_.discount??0,expiry_date:_.expiry_date||"",image_url:_.image_url||"",attributes:((_==null?void 0:_.attributes)||[]).map(c=>({attribute_id:c.attribute_id,attribute_value_id:c.attribute_value_id}))}))}}const s={name:[a=>!!a||"اسم المنتج مطلوب",a=>typeof a=="string"&&a.length<=255||"اسم المنتج يجب ألا يزيد عن 255 حرفًا"],description:[a=>!a||typeof a=="string"||"الوصف يجب أن يكون نصًا"],description_long:[a=>!a||typeof a=="string"||"الوصف المفصل يجب أن يكون نصًا"]};K(()=>b.dialog,a=>{r.value=a,a&&(b.isEditMode&&b.product?(o.value=d(b.product),console.log("Edit onMounted localProduct",o.value),b.isEditMode&&b.product&&d(b.product)):(o.value={id:null,name:"",is_active:!0,featured:!1,is_returnable:!0,description:"",description_long:"",category_id:null,brand_id:null,warehouse_id:w.value.length>0?w.value[0].id:null,variants:[{attributes:[{attribute_id:null,attribute_value_id:null}],retail_price:0,purchase_price:0,wholesale_price:0,dimensions:"",discount:0,expiry_date:"",image_url:""}]},console.log("new onMounted localProduct",o.value)))}),K(r,a=>D("update:dialog",a)),K(()=>b.product,a=>{b.isEditMode&&a&&(o.value=d(a))}),K(()=>[w.value,b.product],([a,t])=>{!o.value.warehouse_id&&a.length>0&&(o.value.warehouse_id=a[0].id)},{immediate:!0}),pe(async()=>{await Promise.all([N(),m(),M(),A()])});function N(){F("brands",null,!0,!1).then(a=>{q.value=a.data})}function m(){F("attributes",null,!0,!1).then(a=>{z.value=a.data})}function M(){F("warehouses",null,!0,!1).then(a=>{w.value=a.data,!o.value.warehouse_id&&w.value.length>0&&(o.value.warehouse_id=w.value[0].id)})}function A(){F("categories",null,!0,!1).then(a=>{S.value=a.data})}function P(a){if(!a)return[];const t=z.value.find(u=>u.id===a);return t?t.values:[]}function T(a){if(!a)return"#000";const t=a.substring(1),u=parseInt(t,16),V=u>>16&255,n=u>>8&255,_=u>>0&255;return .299*V+.587*n+.114*_>186?"#000":"#fff"}function W(a){o.value.variants[a].attributes.push({attribute_id:null,attribute_value_id:null})}function X(a,t){o.value.variants[a].attributes.splice(t,1)}function I(){D("close"),r.value=!1}function Z(){o.value.variants.push({attributes:[{attribute_id:null,attribute_value_id:null}],dimensions:"",discount:null,expiry_date:"",image_url:"",status:"active",tax_rate:null})}function Y(a){o.value.variants.splice(a,1)}function ee(){E.value&&E.value.validate().then(async({valid:a})=>{if(a)try{const t=await xe("product",o.value,o.value.id);D("saved",t.data),I()}catch{}})}return(a,t)=>($(),O(de,{fullscreen:se(h),modelValue:r.value,"onUpdate:modelValue":t[10]||(t[10]=u=>r.value=u)},{default:l(()=>[e(L,null,{default:l(()=>[e(g,{color:"error",style:{position:"fixed","z-index":"10"},class:"ma-2",icon:"ri-close-line",onClick:I}),e(R,{class:"ma-5 text-center"},{default:l(()=>[p("h2",null,C(j.isEditMode?"تعديل المنتج":"إضافة منتج جديد"),1)]),_:1}),e(fe,{class:ae(se(h)?"px-2":"px-5")},{default:l(()=>[e(ye,{ref_key:"productForm",ref:E,modelValue:U.value,"onUpdate:modelValue":t[9]||(t[9]=u=>U.value=u)},{default:l(()=>[e(y,{class:"my-3"},{default:l(()=>[e(i,{cols:"12",md:"6"},{default:l(()=>[e(x,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.name=u),label:"اسم المنتج",rules:s.name,required:"","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,null,{default:l(()=>[e(le,{modelValue:o.value.is_active,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.is_active=u),label:"نشط",color:o.value.is_active?"primary":"grey","hide-details":"auto"},null,8,["modelValue","color"])]),_:1}),e(i,null,{default:l(()=>[e(le,{modelValue:o.value.featured,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.featured=u),label:"مميز",color:o.value.featured?"primary":"grey","hide-details":"auto"},null,8,["modelValue","color"])]),_:1}),e(i,null,{default:l(()=>[e(le,{modelValue:o.value.is_returnable,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.is_returnable=u),label:"قابل للإرجاع",color:o.value.is_returnable?"primary":"grey","hide-details":"auto"},null,8,["modelValue","color"])]),_:1})]),_:1})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,null,{default:l(()=>[e(ne,{modelValue:o.value.category_id,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.category_id=u),"item-value":"id","item-title":"name",items:S.value||[],label:"الفئة",rules:[u=>!!u||"الفئة مطلوبة"],required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","items","rules"])]),_:1}),e(i,{class:"px-0"},{default:l(()=>[e(ne,{modelValue:o.value.brand_id,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.brand_id=u),"item-value":"id","item-title":"name",items:q.value||[],label:"العلامة التجارية","hide-details":"auto","return-object":!1},null,8,["modelValue","items"])]),_:1}),e(i,null,{default:l(()=>[w.value.length?($(),O(J,{key:0,modelValue:o.value.warehouse_id,"onUpdate:modelValue":t[6]||(t[6]=u=>o.value.warehouse_id=u),"item-value":"id","item-title":"name",items:w.value||[],label:"المخزن",required:"","hide-details":"auto","return-object":!1},null,8,["modelValue","items"])):($(),O(J,{key:1,items:[{id:null,name:"لا يوجد مخازن، يرجى إضافة مخزن أولاً",disabled:!0}],label:"المخزن","item-title":"name",value:null,required:"","hide-details":"auto"}))]),_:1})]),_:1})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(re,{rows:"1","auto-grow":"",modelValue:o.value.description,"onUpdate:modelValue":t[7]||(t[7]=u=>o.value.description=u),label:"الوصف القصير",rules:s.description,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(re,{rows:"2","auto-grow":"",modelValue:o.value.description_long,"onUpdate:modelValue":t[8]||(t[8]=u=>o.value.description_long=u),label:"الوصف المفصل",rules:s.description_long,"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(L,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(R,null,{default:l(()=>t[11]||(t[11]=[v(" خيارات المنتج ")])),_:1}),($(!0),G(ue,null,oe(o.value.variants,(u,V)=>($(),O(y,{class:"bg-grey-lighten-4 pa-2",key:V},{default:l(()=>[e(i,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:u.purchase_price,"onUpdate:modelValue":n=>u.purchase_price=n,label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:u.retail_price,"onUpdate:modelValue":n=>u.retail_price=n,label:"سعر التجزئة",type:"number","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:u.wholesale_price,"onUpdate:modelValue":n=>u.wholesale_price=n,label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(i,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:u.tax_rate,"onUpdate:modelValue":n=>u.tax_rate=n,label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:u.discount,"onUpdate:modelValue":n=>u.discount=n,label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(i,{class:"py-0",cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:u.expiry_date,"onUpdate:modelValue":n=>u.expiry_date=n,label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:u.image_url,"onUpdate:modelValue":n=>u.image_url=n,label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(i,{cols:"12",class:"mt-4"},{default:l(()=>[e(_e,null,{default:l(()=>t[12]||(t[12]=[v("الخصائص (Attributes)")])),_:1}),($(!0),G(ue,null,oe(u.attributes,(n,_)=>($(),O(y,{dense:"",key:_,class:"d-flex align-center"},{default:l(()=>[e(i,{cols:"5"},{default:l(()=>[e(J,{modelValue:n.attribute_id,"onUpdate:modelValue":c=>n.attribute_id=c,items:z.value,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>n.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(i,{cols:"5"},{default:l(()=>[e(J,{modelValue:n.attribute_value_id,"onUpdate:modelValue":c=>n.attribute_value_id=c,items:P(n.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!n.attribute_id,":return-object":!1,"hide-details":"auto",style:Q((()=>{const c=P(n.attribute_id).find(k=>k.id===n.attribute_value_id);return c&&c.color?`background:${c.color};color:${T(c.color)};border-radius:6px;`:""})())},{item:l(({item:c,props:k})=>[e(ve,be({ref_for:!0},k,{style:c.raw.color?`background:${c.raw.color};color:${T(c.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:c})=>[p("span",{style:Q(c.raw.color?`background:${c.raw.color};color:${T(c.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},C(c.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(i,{cols:"2"},{default:l(()=>[e(g,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:c=>X(V,_)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(g,{class:"my-2",text:"",color:"primary",small:"",onClick:n=>W(V)},{default:l(()=>t[13]||(t[13]=[v("+ إضافة خاصية جديدة")])),_:2},1032,["onClick"])]),_:2},1024),e(i,{cols:"12"},{default:l(()=>[e(g,{variant:"text",color:"error","append-icon":"ri-delete-bin-line",onClick:n=>Y(V)},{default:l(()=>t[14]||(t[14]=[v("حذف")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(y,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(g,{class:"my-3",color:"primary",onClick:Z},{default:l(()=>t[15]||(t[15]=[v("+ اضافة خيار جديد ")])),_:1})]),_:1})]),_:1}),e(ge,{class:"my-4"}),e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(g,{"prepend-icon":"ri-close-line",color:"error",onClick:I},{default:l(()=>t[16]||(t[16]=[v(" إلغاء ")])),_:1})]),_:1}),e(i,{cols:"6",class:"text-center"},{default:l(()=>[e(g,{"prepend-icon":"ri-save-line",color:"success",class:ae({"forbidden-cursor":!U.value}),onClick:ee},{default:l(()=>[v(C(j.isEditMode?"حفظ التعديلات":"إضافة المنتج"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})]),_:1},8,["fullscreen","modelValue"]))}},Se=ie(Ee,[["__scopeId","data-v-cc9b158d"]]),ze={__name:"VariantEditDialog",props:{modelValue:Boolean,variant:Object,attributes:Array},emits:["update:modelValue","save"],setup(j,{emit:B}){const b=j,D=B,h=ke({get:()=>b.modelValue,set:o=>D("update:modelValue",o)}),r=f({});K(()=>b.variant,o=>{r.value=JSON.parse(JSON.stringify(o||{}))},{immediate:!0});function E(o){if(!o)return[];const d=b.attributes.find(s=>s.id===o);return d?d.values:[]}function U(o){if(!o)return"#000";const d=o.substring(1),s=parseInt(d,16),N=s>>16&255,m=s>>8&255,M=s>>0&255;return .299*N+.587*m+.114*M>186?"#000":"#fff"}function q(){r.value.attributes=r.value.attributes||[],r.value.attributes.push({attribute_id:null,attribute_value_id:null})}function w(o){r.value.attributes.splice(o,1)}function S(){D("update:modelValue",!1)}function z(){D("save",JSON.parse(JSON.stringify(r.value))),S()}return(o,d)=>($(),O(de,{modelValue:h.value,"onUpdate:modelValue":d[7]||(d[7]=s=>h.value=s),"max-width":"600"},{default:l(()=>[e(L,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(R,null,{default:l(()=>d[8]||(d[8]=[v("تعديل متغير المنتج")])),_:1}),e(y,{class:"bg-grey-lighten-4 pa-2"},{default:l(()=>[e(i,{class:"bg-grey-lighten-4 pa-2",cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:r.value.purchase_price,"onUpdate:modelValue":d[0]||(d[0]=s=>r.value.purchase_price=s),label:"سعر الشراء",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:r.value.retail_price,"onUpdate:modelValue":d[1]||(d[1]=s=>r.value.retail_price=s),label:"سعر التجزئة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(x,{modelValue:r.value.wholesale_price,"onUpdate:modelValue":d[2]||(d[2]=s=>r.value.wholesale_price=s),label:"سعر الجملة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:r.value.tax_rate,"onUpdate:modelValue":d[3]||(d[3]=s=>r.value.tax_rate=s),label:"نسبة الضريبة",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:r.value.discount,"onUpdate:modelValue":d[4]||(d[4]=s=>r.value.discount=s),label:"الخصم",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{class:"py-0",cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:r.value.expiry_date,"onUpdate:modelValue":d[5]||(d[5]=s=>r.value.expiry_date=s),label:"تاريخ الانتهاء",type:"date","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(x,{modelValue:r.value.image_url,"onUpdate:modelValue":d[6]||(d[6]=s=>r.value.image_url=s),label:"رابط الصورة","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{cols:"12",class:"mt-4"},{default:l(()=>[e(_e,null,{default:l(()=>d[9]||(d[9]=[v("الخصائص (Attributes)")])),_:1}),($(!0),G(ue,null,oe(r.value.attributes,(s,N)=>($(),O(y,{dense:"",key:N,class:"d-flex align-center"},{default:l(()=>[e(i,{cols:"5"},{default:l(()=>[e(J,{modelValue:s.attribute_id,"onUpdate:modelValue":m=>s.attribute_id=m,items:j.attributes,"item-title":"name","item-value":"id",label:"اختر الخاصية",dense:"",outlined:"","hide-details":"auto",onChange:()=>s.attribute_value_id=null},null,8,["modelValue","onUpdate:modelValue","items","onChange"])]),_:2},1024),e(i,{cols:"5"},{default:l(()=>[e(J,{modelValue:s.attribute_value_id,"onUpdate:modelValue":m=>s.attribute_value_id=m,items:E(s.attribute_id),"item-title":"name","item-value":"id",label:"اختر القيمة",dense:"",outlined:"",disabled:!s.attribute_id,":return-object":!1,"hide-details":"auto",style:Q((()=>{const m=E(s.attribute_id).find(M=>M.id===s.attribute_value_id);return m&&m.color?`background:${m.color};color:${U(m.color)};border-radius:6px;`:""})())},{item:l(({item:m,props:M})=>[e(ve,be({ref_for:!0},M,{style:m.raw.color?`background:${m.raw.color};color:${U(m.raw.color)};border-radius:6px;`:""}),null,16,["style"])]),selection:l(({item:m})=>[p("span",{style:Q(m.raw.color?`background:${m.raw.color};color:${U(m.raw.color)};padding:2px 8px;border-radius:6px;display:inline-block`:"")},C(m.raw.name),5)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled","style"])]),_:2},1024),e(i,{cols:"2"},{default:l(()=>[e(g,{class:"my-a",icon:"ri-delete-bin-line",color:"error",onClick:m=>w(N)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(g,{class:"my-2",text:"",color:"primary",small:"",onClick:q},{default:l(()=>d[10]||(d[10]=[v("+ إضافة خاصية جديدة")])),_:1})]),_:1})]),_:1}),e(ge,{class:"my-4"}),e(y,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(g,{"prepend-icon":"ri-close-line",color:"error",onClick:S},{default:l(()=>d[11]||(d[11]=[v(" إلغاء ")])),_:1})]),_:1}),e(i,{cols:"6",class:"text-center"},{default:l(()=>[e(g,{"prepend-icon":"ri-save-line",color:"success",onClick:z},{default:l(()=>d[12]||(d[12]=[v(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ae=ie(ze,[["__scopeId","data-v-594e8d1d"]]),Be={class:"d-flex align-center justify-space-between mb-2"},Me={class:"d-flex align-center gap-2"},Ne=["onClick"],Oe={key:0},je={colspan:"5",class:"pa-0 bg-variant-table"},qe={class:"bg-variant-table"},Fe={__name:"products",setup(j){const B=f(!1),b=f({}),D=f(!1),h=f([]),r=f(!1),E=f(null),U=f(null),q=f(0),w=f(!1),S=f({page:1,itemsPerPage:10,sortBy:[]}),z=f(""),o=f(!1),d=f(null),s=f([]),N=[{title:"الاسم",key:"name"},{title:"الكمية",key:"stock_quantity"},{title:"القسم",key:"category"},{title:"الماركة",key:"brand"},{title:"الإجراء",key:"actions",sortable:!1}],m=[{title:"SKU",key:"sku"},{title:"الباركود",key:"barcode"},{title:"سعر الشراء",key:"purchase_price"},{title:"سعر الجملة",key:"wholesale_price"},{title:"سعر التجزئة",key:"retail_price"},{title:"الخصم",key:"discount"},{title:"الخصائص",key:"attributes"},{title:"الإجراء",key:"actions",sortable:!1}];pe(()=>{A(),M()});function M(){F("attributes",null,!0,!1).then(a=>{s.value=a.data})}function A(){w.value=!0;const{page:a,itemsPerPage:t,sortBy:u}=S.value,V=u.length?u[0].key:"id",n=u.length&&u[0].order?u[0].order:"desc";F("products",{page:a,per_page:t,sort_by:V,sort_order:n,search:z.value}).then(_=>{h.value=_.data,q.value=_.total}).finally(()=>{w.value=!1})}function P(){D.value=!1,b.value={},B.value=!0}function T(a){B.value=!0,D.value=!0,b.value=JSON.parse(JSON.stringify(a))}function W(a){const t=h.value.findIndex(u=>u.id===a.id);t!==-1?h.value[t]=a:h.value.push(a),B.value=!1}function X(a){E.value=a,r.value=!0}function I(){E.value&&$e("product/delete",E.value.id).then(()=>{A(),me.success("تم حذف المنتج بنجاح"),r.value=!1,E.value=null}).catch(()=>me.error("حدث خطأ أثناء حذف المنتج"))}function Z(a){U.value=U.value===a?null:a}function Y(a,t){d.value=JSON.parse(JSON.stringify(a)),d.value.product_id=t,o.value=!0}function ee(a){const t=h.value.find(V=>V.id===(a.product_id||U.value));if(!t)return;const u=t.variants.findIndex(V=>V.id===a.id);u!==-1&&(t.variants[u]=a),o.value=!1}return(a,t)=>($(),O(we,{class:"pa-1",style:{"max-width":"1200px"}},{default:l(()=>[e(Se,{dialog:B.value,"onUpdate:dialog":t[0]||(t[0]=u=>B.value=u),product:b.value,isEditMode:D.value,onSaved:W},null,8,["dialog","product","isEditMode"]),e(Ae,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value=u),variant:d.value,attributes:s.value,onSave:ee},null,8,["modelValue","variant","attributes"]),e(L,{class:"pa-2",style:{"overflow-x":"auto","overflow-y":"unset"}},{default:l(()=>[p("div",Be,[t[8]||(t[8]=p("h3",{class:"text-h6 font-weight-bold mb-0"},"قائمة المنتجات",-1)),p("div",Me,[e(x,{modelValue:z.value,"onUpdate:modelValue":t[2]||(t[2]=u=>z.value=u),placeholder:"بحث عن منتج...","hide-details":"",rounded:"",style:{"max-width":"180px","min-width":"120px","font-size":"13px"},onKeydown:Ce(A,["enter"]),onBlur:A,clearable:"","onClick:clear":t[3]||(t[3]=()=>{z.value="",A()}),"prepend-inner-icon":"ri-search-line","onClick:prependInner":A},null,8,["modelValue"]),e(g,{color:"primary",onClick:P,size:"small"},{default:l(()=>t[7]||(t[7]=[v("+ إضافة منتج")])),_:1})])]),e(ce,{items:h.value,headers:N,"item-key":"id",class:"text-start",density:"compact",style:{direction:"rtl"},loading:w.value,options:S.value,"server-items-length":q.value,"items-per-page":S.value.itemsPerPage,page:S.value.page,"sort-by":S.value.sortBy,"no-data-text":"لا توجد بيانات","loading-text":"جاري تحميل البيانات...","items-per-page-text":"عدد العناصر في الصفحة","page-text":"{0}-{1} من {2}","onUpdate:options":A},{item:l(({item:u})=>{var V,n,_,c;return[p("tr",{class:ae({"bg-product-expanded":U.value===u.id}),onClick:k=>Z(u.id),style:{cursor:"pointer"}},[p("td",null,C(u.name),1),p("td",null,C(u.stock_quantity??((n=(V=u.variants)==null?void 0:V[0])==null?void 0:n.stock_quantity)??0),1),p("td",null,C(((_=u.category)==null?void 0:_.name)??"-"),1),p("td",null,C(((c=u.brand)==null?void 0:c.name)??"-"),1),p("td",{onClick:t[4]||(t[4]=H(()=>{},["stop"]))},[e(g,{class:"mx-2",size:"small",icon:"ri-edit-line",color:"primary",onClick:H(k=>T(u),["stop"])},null,8,["onClick"]),e(g,{class:"mx-2",size:"small",icon:"ri-delete-bin-line",color:"error",onClick:H(k=>X(u),["stop"])},null,8,["onClick"])])],10,Ne),U.value===u.id?($(),G("tr",Oe,[p("td",je,[e(ce,{items:u.variants,headers:m,"item-key":"id",density:"compact",class:"text-start bg-variant-table","hide-default-footer":"","no-data-text":"لا يوجد متغيرات لهذا المنتج"},{item:l(({item:k})=>[p("tr",qe,[p("td",null,C(k.sku),1),p("td",null,C(k.barcode),1),p("td",null,C(k.purchase_price),1),p("td",null,C(k.wholesale_price),1),p("td",null,C(k.retail_price),1),p("td",null,C(k.discount),1),p("td",null,[e(De,{attributes:k.attributes,"font-size":"10px"},null,8,["attributes"])]),p("td",null,[p("div",null,[e(g,{size:"x-small",icon:"",color:"blue",title:"تعديل",onClick:H(Je=>Y(k,u.id),["stop"])},{default:l(()=>[e(te,{size:"16"},{default:l(()=>t[9]||(t[9]=[v("ri-edit-line")])),_:1})]),_:2},1032,["onClick"]),e(g,{size:"x-small",icon:"",color:"red",title:"حذف"},{default:l(()=>[e(te,{size:"16"},{default:l(()=>t[10]||(t[10]=[v("ri-delete-bin-line")])),_:1})]),_:1}),e(g,{size:"x-small",icon:"",color:"success",title:"طباعة"},{default:l(()=>[e(te,{size:"16"},{default:l(()=>t[11]||(t[11]=[v("ri-printer-line")])),_:1})]),_:1})])])])]),_:2},1032,["items"])])])):Ue("",!0)]}),_:1},8,["items","loading","options","server-items-length","items-per-page","page","sort-by"])]),_:1}),e(de,{modelValue:r.value,"onUpdate:modelValue":t[6]||(t[6]=u=>r.value=u),"max-width":"340"},{default:l(()=>[e(L,null,{default:l(()=>[e(R,null,{default:l(()=>t[12]||(t[12]=[v("تأكيد الحذف")])),_:1}),e(fe,null,{default:l(()=>t[13]||(t[13]=[v("هل أنت متأكد أنك تريد حذف هذا المنتج؟")])),_:1}),e(he,null,{default:l(()=>[e(g,{color:"error",onClick:I,size:"small"},{default:l(()=>t[14]||(t[14]=[v("تأكيد")])),_:1}),e(g,{onClick:t[5]||(t[5]=u=>r.value=!1),size:"small"},{default:l(()=>t[15]||(t[15]=[v("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ke=ie(Fe,[["__scopeId","data-v-34b64ed5"]]);export{Ke as default};
