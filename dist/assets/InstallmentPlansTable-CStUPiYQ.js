import{_ as E,r as f,j as k,Q as U,c as F,d as l,k as a,ak as D,Y as R,F as j,ap as G,o as V,a9 as c,a3 as _,b as n,a4 as x,a5 as u,W as H,ai as J,a1 as L,a as d,t as i,al as O,l as I,s as P,au as Q,Z as W}from"./index-B7z_x196.js";import{_ as Y}from"./PayInstallmentDialog-B9lU3rVQ.js";const Z={__name:"InstallmentPlansTable",setup(q){const $=[{title:"رقم الخطة",key:"id"},{title:"المستخدم",key:"user.nickname",sortable:!1},{title:"المبلغ الإجمالي",key:"total_amount"},{title:"الدفعة الأولى",key:"down_payment"},{title:"الإجراءات",key:"actions",sortable:!1}],T=[{title:"رقم القسط",key:"installment_number"},{title:"تاريخ الاستحقاق",key:"due_date"},{title:"المبلغ",key:"amount"},{title:"المتبقي",key:"remaining"},{title:"الحالة",key:"status"},{title:"الإجراءات",key:"actions",sortable:!1}],v=f([]),m=f([]),o=f({}),p=f(!1),b=f(null),y=f(!1),C=f(!0);function B({item:s}){const t=s.total_pay||0,e=s.total_amount||1,r=Math.min(Math.round(t/e*100),100);let g="#4caf50";return r<50&&(g="#ff9800"),r<20&&(g="#f44336"),{style:{background:`linear-gradient(to right, ${g} ${r}%, transparent ${r}%)`}}}const N=k(()=>o.value.start_date?new Date(o.value.start_date).toLocaleDateString("ar-EG"):"—");k(()=>m.value.reduce((s,t)=>s+(t.remaining||0),0)),k(()=>m.value.reduce((s,t)=>s+(t.amount-(t.remaining||0)),0));function S(){G("installment-plans").then(s=>{v.value=s.data||[],console.log("تم جلب الخطط بنجاح:",JSON.stringify(v.value[1].installments))}).catch(s=>console.error("فشل في جلب الخطط:",s))}function A(s){s.forEach(t=>{const e=m.value.findIndex(r=>r.id===t.id);e!==-1&&(m.value[e]={...m.value[e],...t})})}function M(s){!s||!Array.isArray(s.installments)||(o.value=s,m.value=s.installments,p.value=!0)}function w(s,t){b.value=s,C.value=t,y.value=!0}return U(S),(s,t)=>(V(),F(j,null,[l(D,{headers:$,items:v.value,"item-value":"id",class:"elevation-1",density:"compact","row-props":B,"hide-default-footer":""},{"item.actions":a(({item:e})=>[l(c,{color:"primary",density:"compact",onClick:_(r=>M(e),["stop"])},{default:a(()=>t[3]||(t[3]=[n("عرض الأقساط")])),_:2},1032,["onClick"])]),"no-data":a(()=>[l(x,{class:"pa-4"},{default:a(()=>[l(u,{class:"text-center text-grey"},{default:a(()=>t[4]||(t[4]=[n("لا توجد بيانات خطط أقساط")])),_:1})]),_:1})]),_:1},8,["items"]),l(R,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),"max-width":"900px",scrollable:""},{default:a(()=>[l(H,null,{default:a(()=>[l(J,{class:"bg-primary text-white"},{default:a(()=>t[5]||(t[5]=[n("تفاصيل خطة التقسيط")])),_:1}),l(L,null,{default:a(()=>[l(x,{class:"px-4 pt-4",dense:""},{default:a(()=>[l(u,{cols:"6"},{default:a(()=>{var e;return[t[6]||(t[6]=d("strong",null,"المستخدم:",-1)),n(" "+i(((e=o.value.user)==null?void 0:e.nickname)||"غير متوفر"),1)]}),_:1}),l(u,{cols:"6"},{default:a(()=>{var e;return[t[7]||(t[7]=d("strong",null,"الفاتورة:",-1)),n(" "+i(((e=o.value.invoice)==null?void 0:e.invoice_number)||"—"),1)]}),_:1}),l(u,{cols:"6"},{default:a(()=>[t[8]||(t[8]=d("strong",null,"تاريخ البدء:",-1)),n(" "+i(N.value),1)]),_:1}),l(u,{cols:"6"},{default:a(()=>[t[9]||(t[9]=d("strong",null,"إجمالي الفاتورة:",-1)),n(" "+i(o.value.total_amount),1)]),_:1}),l(u,{cols:"6"},{default:a(()=>[t[10]||(t[10]=d("strong",null,"إجمالي المتبقي:",-1)),n(" "+i(o.value.total_remaining),1)]),_:1}),l(u,{cols:"6"},{default:a(()=>[t[11]||(t[11]=d("strong",null,"إجمالي المدفوع:",-1)),n(" "+i(o.value.total_pay),1)]),_:1}),l(u,{cols:"6"},{default:a(()=>[t[12]||(t[12]=d("strong",null,"المقدم:",-1)),n(" "+i(o.value.down_payment),1)]),_:1}),l(u,{cols:"6"},{default:a(()=>{var e;return[t[13]||(t[13]=d("strong",null,"عدد الأقساط:",-1)),n(" "+i(((e=o.value.installments)==null?void 0:e.length)||0),1)]}),_:1})]),_:1}),l(D,{headers:T,items:m.value,"item-value":"id",class:"elevation-1 mt-4",density:"compact","items-per-page":-1,"hide-default-footer":""},{"item.status":a(({item:e})=>[l(O,{color:e.status==="تم الدفع"?"success":"error",dark:""},{default:a(()=>[n(i(e.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[e.status!=="تم الدفع"?(V(),I(c,{key:0,color:e.status==="تم الدفع"?"grey":"success",disabled:e.status==="تم الدفع",density:"compact",class:"me-1",onClick:_(r=>w(e,!0),["stop"])},{default:a(()=>t[14]||(t[14]=[n("دفع القسط")])),_:2},1032,["color","disabled","onClick"])):P("",!0),e.status!=="تم الدفع"?(V(),I(c,{key:1,color:e.status==="تم الدفع"?"grey":"warning",disabled:e.status==="تم الدفع",density:"compact",onClick:_(r=>w(e,!1),["stop"])},{default:a(()=>t[15]||(t[15]=[n("مبلغ مختلف")])),_:2},1032,["color","disabled","onClick"])):P("",!0)]),"no-data":a(()=>[l(x,{class:"pa-4"},{default:a(()=>[l(u,{class:"text-center text-grey"},{default:a(()=>t[16]||(t[16]=[n("لا توجد أقساط لهذه الخطة")])),_:1})]),_:1})]),_:1},8,["items"])]),_:1}),l(Q,null,{default:a(()=>[l(W),l(c,{text:"",onClick:t[0]||(t[0]=e=>p.value=!1)},{default:a(()=>t[17]||(t[17]=[n("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Y,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e),installment:b.value,"direct-pay":C.value,"onUpdate:installment":A},null,8,["modelValue","installment","direct-pay"])],64))}},X=E(Z,[["__scopeId","data-v-fcc46af4"]]);export{X as default};
