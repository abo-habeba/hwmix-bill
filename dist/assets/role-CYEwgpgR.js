import{g as K}from"./permissions-3fwV70Qx.js";import{S as Y,r as n,B as ee,w as le,Q as ae,ah as te,c as _,d as e,n as a,a7 as D,X as x,u as z,Z as F,o as u,a8 as U,a as v,$ as g,m as V,b as i,a2 as r,v as q,ac as se,aD as oe,al as A,aa as B,t as E,N as R,a1 as T,ak as ne,F as I,C as L,ap as ie,aq as O,W as re,a0 as ue,aE as de}from"./index-C2tXxNt1.js";const me={class:"mx-auto mt-10 pa-10",style:{"max-width":"700px","background-color":"white"}},ve={class:"d-flex gap-2"},xe={__name:"role",setup(fe){re();const{xs:P}=Y(),p=n(!1),y=n(!1),k=n(!1),d=n(!1),f=n(!1),b=n(""),h=n(!1),N=n(null),S=n({}),C=n({}),w=ee();le(()=>w.user,()=>{console.log("rin watch"),S.value=w.user.permissions||[],C.value=K(S.value)},{immediate:!0}),ae(async()=>{p.value=!0,te("roles").then(s=>{m.value=s.data,p.value=!1}).catch(s=>{p.value=!1,s.data.error})});const j=n([{title:"اسم الدور",key:"name",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"center"},{title:"الإجراءات",key:"actions",align:"center",sortable:!1}]),m=n([]),o=n({name:"",permissions:[]}),G=[s=>!!s||"اسم الدور مطلوب",s=>s.length>=3||"يجب أن يكون الاسم 3 أحرف على الأقل"],M=()=>{o.value={name:"",permissions:[]},d.value=!0},$=()=>{d.value=!1,o.value={name:"",permissions:[]}},Q=s=>{o.value={...s},d.value=!0},W=s=>{o.value={...s},f.value=!0},X=()=>{if(y.value=!0,!!N.value.validate())try{ue("role",o.value,o.value.id).then(s=>{if(o.value.id){let l=m.value.find(t=>t.id===s.id);Object.assign(l,o.value)}else m.value.push(s)})}finally{y.value=!1,d.value=!1}},Z=async()=>{k.value=!0;try{de("role",o.value.id).then(()=>{m.value=m.value.filter(s=>s.id!==o.value.id)})}finally{f.value=!1,k.value=!1}};return(s,l)=>(u(),_("div",me,[e(D,null,{default:a(()=>[e(U,{cols:"12",class:"d-flex align-center"},{default:a(()=>[l[9]||(l[9]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold"},"إدارة الأدوار"),v("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"},"قم بإدارة أدوار المستخدمين وصلاحياتهم في النظام")],-1)),e(g),z(w).can(["roles_create","super_admin","company_owner"])?(u(),V(r,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:l[0]||(l[0]=t=>M()),elevation:"2",size:"large"},{default:a(()=>l[8]||(l[8]=[i(" دور جديد ")])),_:1})):q("",!0)]),_:1})]),_:1}),e(x,{elevation:"2"},{default:a(()=>[e(se,{headers:j.value,items:m.value,loading:p.value,search:b.value,hover:"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة"},{top:a(()=>[e(oe,{color:"transparent"},{default:a(()=>[e(A,{class:"ma-10",modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=t=>b.value=t),"prepend-icon":"ri-search-line",label:"بحث...","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),"item.actions":a(({item:t})=>[v("div",ve,[e(r,{icon:"ri-pencil-line",color:"primary",size:"small",variant:"text",onClick:c=>Q(t)},null,8,["onClick"]),e(r,{icon:"ri-delete-bin-line",color:"error",size:"small",variant:"text",onClick:c=>W(t)},null,8,["onClick"])])]),_:1},8,["headers","items","loading","search"])]),_:1}),e(F,{fullscreen:z(P),modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=t=>d.value=t),"max-width":"700",persistent:""},{default:a(()=>[e(x,{style:{position:"relative"}},{default:a(()=>[v("div",{onClick:$,style:{position:"fixed",top:"5px",left:"5px"}},[e(r,{icon:"ri-close-line"})]),e(B,{class:"text-h5"},{default:a(()=>[i(E(o.value.id?"تعديل دور":"إضافة دور جديد")+" ",1),e(g)]),_:1}),e(R),e(T,null,{default:a(()=>[e(ne,{ref_key:"form",ref:N,modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=t=>h.value=t)},{default:a(()=>[e(A,{modelValue:o.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.name=t),label:"اسم الدور",rules:G,required:"",variant:"outlined",density:"comfortable"},null,8,["modelValue"]),e(R,{class:"my-4"}),l[10]||(l[10]=v("div",{class:"text-subtitle-1 mb-3"},"الصلاحيات",-1)),C.value?(u(),V(D,{key:0,class:"mb-10"},{default:a(()=>[(u(!0),_(I,null,L(C.value,t=>(u(),V(U,{class:"pa-0",key:t.name,cols:"12"},{default:a(()=>[e(x,{variant:"outlined",class:"mb-4"},{default:a(()=>[e(B,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:a(()=>[i(E(t.name),1)]),_:2},1024),e(T,null,{default:a(()=>[e(D,null,{default:a(()=>[(u(!0),_(I,null,L(t.permissions,(c,H)=>(u(),V(U,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:H},{default:a(()=>[e(ie,{modelValue:o.value.permissions,"onUpdate:modelValue":l[3]||(l[3]=J=>o.value.permissions=J),label:c.name,value:c.value,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):q("",!0)]),_:1},8,["modelValue"])]),_:1}),e(R),e(O,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 ma-auto"},{default:a(()=>[e(r,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:$},{default:a(()=>l[11]||(l[11]=[i(" إلغاء ")])),_:1}),e(g),e(r,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},loading:y.value,onClick:X},{default:a(()=>l[12]||(l[12]=[i(" حفظ ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"]),e(F,{modelValue:f.value,"onUpdate:modelValue":l[7]||(l[7]=t=>f.value=t),"max-width":"400"},{default:a(()=>[e(x,null,{default:a(()=>[e(B,{class:"text-h5 pa-4"},{default:a(()=>l[13]||(l[13]=[i(" تأكيد الحذف ")])),_:1}),e(T,{class:"pa-4"},{default:a(()=>l[14]||(l[14]=[i(" هل أنت متأكد من حذف هذا الدور؟ لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),e(O,{class:"pa-4"},{default:a(()=>[e(g),e(r,{color:"grey-darken-1",variant:"text",onClick:l[6]||(l[6]=t=>f.value=!1)},{default:a(()=>l[15]||(l[15]=[i(" إلغاء ")])),_:1}),e(r,{color:"error",loading:k.value,onClick:Z},{default:a(()=>l[16]||(l[16]=[i(" حذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{xe as default};
