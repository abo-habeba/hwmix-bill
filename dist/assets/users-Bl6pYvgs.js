import{_ as j}from"./ContextMenu-BkJXfYLX.js";import{A as T,h as G,r as a,Q as H,$ as J,w as K,ao as L,ap as X,o as p,c as A,d as c,a as Y,l as x,k as v,b as N,t as I,a9 as b,s as E,a3 as Z,aq as ee,F as $,_ as te,u as ae,W as le}from"./index-B-osrc5p.js";import{u as se}from"./appState-DUqqdqKK.js";import{D as ne}from"./DeletedItem-D_YT5R1R.js";const oe={id:"dataTable",style:{position:"relative !important"}},re={__name:"UsersDataTable",setup(w){const o=T(),C=G(),D=se(),s=a([]),f=a(0),r=a([]),i=a(null);a(null);const V=a(!1),P=a(10),z=a({nickname:"",phone:"",status:"",created_at_from:"",created_at_to:""}),_=a({page:1,sortBy:[],itemsPerPage:10});a([{name:"nickname",type:"input",label:" اسم الشهرة "},{name:"phone",type:"input",label:"  الهاتف "}]);const F=a([{title:"#",key:"index",sortable:!1},{title:"اسم الشهره",key:"nickname",align:"start"},{title:"الهاتف",key:"phone",align:"start"},{title:"الرصيد",key:"balance",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"start"},{title:"الإجراءات",key:"action",sortable:!1,align:"center"}]);H(()=>{S()});const g=a(null);a(null);const R=a(()=>{C.push({name:"edit-user",params:{id:i.value.id}}),d()}),M=a(()=>{s.value.length?g.value=r.value.filter(e=>s.value.includes(e.id)):g.value=[i.value],D.dialogDelete=!0,d()}),U=a(()=>{d()}),q=a(()=>{const e=i.value.status==="0"?"1":"0";J("user",{status:e},i.value.id).then(()=>{r.value.forEach(t=>{t.id===i.value.id&&(t.status=e)}),d()})}),y=a([]),h=a([]);K(()=>i.value,async e=>{if(!e)return;const t=await o.can(["users.update_any","users.update_children","users.update_self","users.create","admin.super","company.owner"]),n=await o.can(["users.delete_any","users.delete_children","users.delete_self","admin.super","company.owner"]),l=await o.can(["users.view_any","users.view_children","users.view_self","admin.super","company.owner"]);h.value=[!s.value.length&&t?{title:Number(e==null?void 0:e.status)===1?"تعطيل":"تفعيل",color:Number(e==null?void 0:e.status)===1?"#ffc107":"#28a745",icon:Number(e==null?void 0:e.status)===1?"ri-toggle-line":"ri-toggle-fill",callback:q.value}:null,!s.value.length&&t?{title:"تعديل",color:"#007bff",icon:"ri-pencil-line",callback:R.value}:null,n?{title:"حذف",color:"#dc3545",icon:"ri-delete-bin-line",callback:M.value}:null,!s.value.length&&l?{title:"عرض",color:"#17a2b8",icon:"ri-eye-line",callback:U.value}:null].filter(Boolean)},{immediate:!0}),L(()=>{h.value.length===0?y.value=[{title:"لا تملك إجراءات",color:"#6c757d",icon:"ri-spam-3-line",callback:()=>{}}]:y.value=h.value});const O=e=>{r.value=r.value.filter(t=>!e.includes(t.id)),s.value=[]},u=a(null),B=(e,{item:t})=>{i.value=t,e.preventDefault(),u.value&&u.value.showContextMenu(e)},d=()=>{u.value?u.value.colsContextMenu():console.error("Context menu is not initialized.")};async function S(){const{page:e,itemsPerPage:t,sortBy:n}=_.value,l=n.length?n[0].key:"id",k=n.length&&n[0].order?n[0].order:"desc",W=t===-1?f.value:t;try{const m=await X("users",{page:e,per_page:W,sort_by:l,sort_order:k,...z.value});r.value=m.data,f.value=m.total,console.log("users",r.value)}catch(m){console.error("Error fetching users:",m)}finally{V.value=!1}}function Q({item:e,index:t}){return{class:e.status==="1"?"active-row":"inactive-row","data-index":t}}return(e,t)=>{const n=j;return p(),A($,null,[c(ne,{onUpdateItems:O,api:"users/delete",dataDelete:{items:g.value,key:"nickname"}},null,8,["dataDelete"]),Y("div",oe,[s.value.length?(p(),x(b,{key:0,class:"text-center my-2 mx-10",density:"compact",variant:"flat",style:{"background-color":"#dc3545 !important",color:"white",position:"absolute",top:"-30px","z-index":"10"},"prepend-icon":"ri-delete-bin-line",onClick:M.value},{default:v(()=>[N(" حذف عدد "+I(s.value.length)+" من العناصر ",1)]),_:1},8,["onClick"])):E("",!0),c(ee,{"item-value":"id","items-per-page":P.value,"onUpdate:itemsPerPage":t[0]||(t[0]=l=>P.value=l),options:_.value,"onUpdate:options":[t[1]||(t[1]=l=>_.value=l),S],headers:F.value,items:r.value,"items-length":f.value,loading:V.value,hover:"","show-current-page":"","row-props":Q,modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=l=>s.value=l),"show-select":"","item-selectable":"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة","onContextmenu:row":B,onClick:d},{"item.index":v(({index:l})=>[N(I(l+1),1)]),"item.action":v(({item:l})=>[c(b,{density:"compact",variant:"text",color:"#0086CD","prepend-icon":"ri-more-2-fill",onClick:Z(k=>B(k,{item:l}),["stop"])},null,8,["onClick"])]),_:1},8,["items-per-page","options","headers","items","items-length","loading","modelValue"]),c(n,{ref_key:"contextMenu",ref:u,actions:y.value},null,8,["actions"])])],64)}}},ie={};function ce(w,o){return p(),x(b,{class:"text-center",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:{name:"edit-user"}})}const ue=te(ie,[["render",ce],["__scopeId","data-v-8b3e4ec3"]]),fe={__name:"users",setup(w){const o=T();return console.log(o.can(["users.create","admin.super","company.owner"])),(C,D)=>{const s=re;return p(),A($,null,[ae(o).can(["users.create","admin.super","company.owner"])?(p(),x(ue,{key:0,class:"ma-3"})):E("",!0),c(le,{class:"pa-0",title:"المستخدمين"},{default:v(()=>[c(s)]),_:1})],64)}}};export{fe as default};
